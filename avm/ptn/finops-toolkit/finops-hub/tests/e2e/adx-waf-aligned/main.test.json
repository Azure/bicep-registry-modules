{
  "$schema": "https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "_generator": {
      "name": "bicep",
      "version": "0.40.2.10011",
      "templateHash": "6661995590737271383"
    },
    "name": "ADX WAF-aligned",
    "description": "This instance deploys the module with Azure Data Explorer in alignment with the best-practices of the Azure Well-Architected Framework, including private endpoints."
  },
  "parameters": {
    "resourceGroupName": {
      "type": "string",
      "defaultValue": "[format('dep-{0}-finops-hub-{1}-rg', parameters('namePrefix'), parameters('serviceShort'))]",
      "maxLength": 90,
      "metadata": {
        "description": "Optional. The name of the resource group to deploy for testing purposes."
      }
    },
    "resourceLocation": {
      "type": "string",
      "defaultValue": "[deployment().location]",
      "metadata": {
        "description": "Optional. The location to deploy resources to."
      }
    },
    "serviceShort": {
      "type": "string",
      "defaultValue": "fhaxw",
      "metadata": {
        "description": "Optional. A short identifier for the kind of deployment. Should be kept short to not run into resource-name length-constraints."
      }
    },
    "namePrefix": {
      "type": "string",
      "defaultValue": "#_namePrefix_#",
      "metadata": {
        "description": "Optional. A token to inject into the name of each resource."
      }
    },
    "deployerPrincipalId": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Optional. Principal ID of the deployer to grant ADX access for testing. If not provided, only the ADF managed identity will have access."
      }
    }
  },
  "variables": {
    "enforcedLocation": "italynorth",
    "deploymentSuffix": "[take(uniqueString(subscription().subscriptionId, parameters('namePrefix'), parameters('serviceShort')), 4)]"
  },
  "resources": [
    {
      "type": "Microsoft.Resources/resourceGroups",
      "apiVersion": "2025-03-01",
      "name": "[parameters('resourceGroupName')]",
      "location": "[variables('enforcedLocation')]"
    },
    {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2025-04-01",
      "name": "[format('{0}-dependencies', uniqueString(deployment().name, variables('enforcedLocation')))]",
      "resourceGroup": "[parameters('resourceGroupName')]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "location": {
            "value": "[variables('enforcedLocation')]"
          },
          "namePrefix": {
            "value": "[format('{0}{1}', parameters('namePrefix'), parameters('serviceShort'))]"
          }
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.40.2.10011",
              "templateHash": "11430394124532358843"
            }
          },
          "parameters": {
            "location": {
              "type": "string",
              "metadata": {
                "description": "Required. The location to deploy resources to."
              }
            },
            "namePrefix": {
              "type": "string",
              "metadata": {
                "description": "Required. The name prefix for resources."
              }
            },
            "secondaryLocation": {
              "type": "string",
              "defaultValue": "westeurope",
              "metadata": {
                "description": "Optional. Secondary location for Log Analytics workspace replication (WAF: AZR-000425)."
              }
            }
          },
          "resources": [
            {
              "type": "Microsoft.Network/networkSecurityGroups",
              "apiVersion": "2024-05-01",
              "name": "[format('{0}-nsg', parameters('namePrefix'))]",
              "location": "[parameters('location')]",
              "tags": {
                "SecurityControl": "Ignore",
                "Environment": "Test",
                "hidden-title": "FinOps Hub Test Dependencies - NSG"
              },
              "properties": {
                "securityRules": [
                  {
                    "name": "AllowVnetInbound",
                    "properties": {
                      "priority": 100,
                      "direction": "Inbound",
                      "access": "Allow",
                      "protocol": "*",
                      "sourceAddressPrefix": "VirtualNetwork",
                      "sourcePortRange": "*",
                      "destinationAddressPrefix": "VirtualNetwork",
                      "destinationPortRange": "*"
                    }
                  },
                  {
                    "name": "DenyInternetOutbound",
                    "properties": {
                      "priority": 4096,
                      "direction": "Outbound",
                      "access": "Deny",
                      "protocol": "*",
                      "sourceAddressPrefix": "*",
                      "sourcePortRange": "*",
                      "destinationAddressPrefix": "Internet",
                      "destinationPortRange": "*"
                    }
                  }
                ]
              }
            },
            {
              "type": "Microsoft.Network/virtualNetworks",
              "apiVersion": "2024-05-01",
              "name": "[format('{0}-vnet', parameters('namePrefix'))]",
              "location": "[parameters('location')]",
              "tags": {
                "SecurityControl": "Ignore",
                "Environment": "Test",
                "hidden-title": "FinOps Hub Test Dependencies - VNet"
              },
              "properties": {
                "addressSpace": {
                  "addressPrefixes": [
                    "10.0.0.0/16"
                  ]
                },
                "subnets": [
                  {
                    "name": "private-endpoints",
                    "properties": {
                      "addressPrefix": "10.0.1.0/24",
                      "privateEndpointNetworkPolicies": "Disabled",
                      "networkSecurityGroup": {
                        "id": "[resourceId('Microsoft.Network/networkSecurityGroups', format('{0}-nsg', parameters('namePrefix')))]"
                      }
                    }
                  }
                ]
              },
              "dependsOn": [
                "[resourceId('Microsoft.Network/networkSecurityGroups', format('{0}-nsg', parameters('namePrefix')))]"
              ]
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces",
              "apiVersion": "2025-02-01",
              "name": "[format('{0}-law', parameters('namePrefix'))]",
              "location": "[parameters('location')]",
              "tags": {
                "SecurityControl": "Ignore",
                "Environment": "Test",
                "hidden-title": "FinOps Hub Test Dependencies - LAW"
              },
              "properties": {
                "replication": {
                  "enabled": true,
                  "location": "[parameters('secondaryLocation')]"
                },
                "sku": {
                  "name": "PerGB2018"
                },
                "retentionInDays": 30
              }
            },
            {
              "type": "Microsoft.Network/privateDnsZones",
              "apiVersion": "2024-06-01",
              "name": "[format('privatelink.blob.{0}', environment().suffixes.storage)]",
              "location": "global"
            },
            {
              "type": "Microsoft.Network/privateDnsZones/virtualNetworkLinks",
              "apiVersion": "2024-06-01",
              "name": "[format('{0}/{1}', format('privatelink.blob.{0}', environment().suffixes.storage), format('{0}-blob-vnet-link', parameters('namePrefix')))]",
              "location": "global",
              "properties": {
                "registrationEnabled": false,
                "virtualNetwork": {
                  "id": "[resourceId('Microsoft.Network/virtualNetworks', format('{0}-vnet', parameters('namePrefix')))]"
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.Network/privateDnsZones', format('privatelink.blob.{0}', environment().suffixes.storage))]",
                "[resourceId('Microsoft.Network/virtualNetworks', format('{0}-vnet', parameters('namePrefix')))]"
              ]
            },
            {
              "type": "Microsoft.Network/privateDnsZones",
              "apiVersion": "2024-06-01",
              "name": "[format('privatelink.dfs.{0}', environment().suffixes.storage)]",
              "location": "global"
            },
            {
              "type": "Microsoft.Network/privateDnsZones/virtualNetworkLinks",
              "apiVersion": "2024-06-01",
              "name": "[format('{0}/{1}', format('privatelink.dfs.{0}', environment().suffixes.storage), format('{0}-dfs-vnet-link', parameters('namePrefix')))]",
              "location": "global",
              "properties": {
                "registrationEnabled": false,
                "virtualNetwork": {
                  "id": "[resourceId('Microsoft.Network/virtualNetworks', format('{0}-vnet', parameters('namePrefix')))]"
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.Network/privateDnsZones', format('privatelink.dfs.{0}', environment().suffixes.storage))]",
                "[resourceId('Microsoft.Network/virtualNetworks', format('{0}-vnet', parameters('namePrefix')))]"
              ]
            },
            {
              "type": "Microsoft.Network/privateDnsZones",
              "apiVersion": "2024-06-01",
              "name": "privatelink.vaultcore.azure.net",
              "location": "global"
            },
            {
              "type": "Microsoft.Network/privateDnsZones/virtualNetworkLinks",
              "apiVersion": "2024-06-01",
              "name": "[format('{0}/{1}', 'privatelink.vaultcore.azure.net', format('{0}-kv-vnet-link', parameters('namePrefix')))]",
              "location": "global",
              "properties": {
                "registrationEnabled": false,
                "virtualNetwork": {
                  "id": "[resourceId('Microsoft.Network/virtualNetworks', format('{0}-vnet', parameters('namePrefix')))]"
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.Network/privateDnsZones', 'privatelink.vaultcore.azure.net')]",
                "[resourceId('Microsoft.Network/virtualNetworks', format('{0}-vnet', parameters('namePrefix')))]"
              ]
            },
            {
              "type": "Microsoft.Network/privateDnsZones",
              "apiVersion": "2024-06-01",
              "name": "privatelink.datafactory.azure.net",
              "location": "global"
            },
            {
              "type": "Microsoft.Network/privateDnsZones/virtualNetworkLinks",
              "apiVersion": "2024-06-01",
              "name": "[format('{0}/{1}', 'privatelink.datafactory.azure.net', format('{0}-adf-vnet-link', parameters('namePrefix')))]",
              "location": "global",
              "properties": {
                "registrationEnabled": false,
                "virtualNetwork": {
                  "id": "[resourceId('Microsoft.Network/virtualNetworks', format('{0}-vnet', parameters('namePrefix')))]"
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.Network/privateDnsZones', 'privatelink.datafactory.azure.net')]",
                "[resourceId('Microsoft.Network/virtualNetworks', format('{0}-vnet', parameters('namePrefix')))]"
              ]
            }
          ],
          "outputs": {
            "privateEndpointSubnetId": {
              "type": "string",
              "metadata": {
                "description": "The resource ID of the private endpoint subnet."
              },
              "value": "[reference(resourceId('Microsoft.Network/virtualNetworks', format('{0}-vnet', parameters('namePrefix'))), '2024-05-01').subnets[0].id]"
            },
            "storageBlobPrivateDnsZoneId": {
              "type": "string",
              "metadata": {
                "description": "The resource ID of the blob storage private DNS zone."
              },
              "value": "[resourceId('Microsoft.Network/privateDnsZones', format('privatelink.blob.{0}', environment().suffixes.storage))]"
            },
            "storageDfsPrivateDnsZoneId": {
              "type": "string",
              "metadata": {
                "description": "The resource ID of the DFS storage private DNS zone."
              },
              "value": "[resourceId('Microsoft.Network/privateDnsZones', format('privatelink.dfs.{0}', environment().suffixes.storage))]"
            },
            "keyVaultPrivateDnsZoneId": {
              "type": "string",
              "metadata": {
                "description": "The resource ID of the Key Vault private DNS zone."
              },
              "value": "[resourceId('Microsoft.Network/privateDnsZones', 'privatelink.vaultcore.azure.net')]"
            },
            "dataFactoryPrivateDnsZoneId": {
              "type": "string",
              "metadata": {
                "description": "The resource ID of the Data Factory private DNS zone."
              },
              "value": "[resourceId('Microsoft.Network/privateDnsZones', 'privatelink.datafactory.azure.net')]"
            },
            "logAnalyticsWorkspaceId": {
              "type": "string",
              "metadata": {
                "description": "The resource ID of the Log Analytics workspace for diagnostic settings."
              },
              "value": "[resourceId('Microsoft.OperationalInsights/workspaces', format('{0}-law', parameters('namePrefix')))]"
            }
          }
        }
      },
      "dependsOn": [
        "[subscriptionResourceId('Microsoft.Resources/resourceGroups', parameters('resourceGroupName'))]"
      ]
    },
    {
      "copy": {
        "name": "testDeployment",
        "count": "[length(createArray('init', 'idem'))]",
        "mode": "serial",
        "batchSize": 1
      },
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2025-04-01",
      "name": "[format('{0}-test-{1}-{2}', uniqueString(deployment().name, variables('enforcedLocation')), parameters('serviceShort'), createArray('init', 'idem')[copyIndex()])]",
      "resourceGroup": "[parameters('resourceGroupName')]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "hubName": {
            "value": "[format('{0}{1}{2}', parameters('namePrefix'), parameters('serviceShort'), variables('deploymentSuffix'))]"
          },
          "location": {
            "value": "[variables('enforcedLocation')]"
          },
          "deploymentConfiguration": {
            "value": "waf-aligned"
          },
          "deploymentType": {
            "value": "adx"
          },
          "dataExplorerClusterName": {
            "value": "[format('{0}{1}adx{2}', parameters('namePrefix'), parameters('serviceShort'), variables('deploymentSuffix'))]"
          },
          "networkIsolationMode": {
            "value": "BringYourOwn"
          },
          "byoSubnetResourceId": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('resourceGroupName')), 'Microsoft.Resources/deployments', format('{0}-dependencies', uniqueString(deployment().name, variables('enforcedLocation')))), '2025-04-01').outputs.privateEndpointSubnetId.value]"
          },
          "byoBlobDnsZoneId": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('resourceGroupName')), 'Microsoft.Resources/deployments', format('{0}-dependencies', uniqueString(deployment().name, variables('enforcedLocation')))), '2025-04-01').outputs.storageBlobPrivateDnsZoneId.value]"
          },
          "byoDfsDnsZoneId": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('resourceGroupName')), 'Microsoft.Resources/deployments', format('{0}-dependencies', uniqueString(deployment().name, variables('enforcedLocation')))), '2025-04-01').outputs.storageDfsPrivateDnsZoneId.value]"
          },
          "byoVaultDnsZoneId": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('resourceGroupName')), 'Microsoft.Resources/deployments', format('{0}-dependencies', uniqueString(deployment().name, variables('enforcedLocation')))), '2025-04-01').outputs.keyVaultPrivateDnsZoneId.value]"
          },
          "byoDataFactoryDnsZoneId": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('resourceGroupName')), 'Microsoft.Resources/deployments', format('{0}-dependencies', uniqueString(deployment().name, variables('enforcedLocation')))), '2025-04-01').outputs.dataFactoryPrivateDnsZoneId.value]"
          },
          "enablePrivateDnsZoneGroups": {
            "value": true
          },
          "adxAdminPrincipalIds": {
            "value": []
          },
          "deployerPrincipalId": {
            "value": "[parameters('deployerPrincipalId')]"
          },
          "enableTelemetry": {
            "value": true
          },
          "diagnosticSettings": {
            "value": [
              {
                "workspaceResourceId": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('resourceGroupName')), 'Microsoft.Resources/deployments', format('{0}-dependencies', uniqueString(deployment().name, variables('enforcedLocation')))), '2025-04-01').outputs.logAnalyticsWorkspaceId.value]"
              }
            ]
          },
          "tags": {
            "value": {
              "SecurityControl": "Ignore",
              "Environment": "Production",
              "hidden-title": "FinOps Hub - ADX WAF Aligned",
              "CostCenter": "FinOps",
              "Criticality": "High"
            }
          }
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "languageVersion": "2.0",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.40.2.10011",
              "templateHash": "16294480083992708201"
            },
            "name": "FinOps Hub",
            "description": "Deploys a FinOps Hub for cloud cost analytics using Azure Verified Modules.",
            "version": "0.2.0",
            "owner": "FinOps Team"
          },
          "definitions": {
            "diagnosticSettingFullType": {
              "type": "object",
              "properties": {
                "name": {
                  "type": "string",
                  "nullable": true,
                  "metadata": {
                    "description": "Optional. The name of the diagnostic setting."
                  }
                },
                "logCategoriesAndGroups": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "category": {
                        "type": "string",
                        "nullable": true,
                        "metadata": {
                          "description": "Optional. Name of a Diagnostic Log category for a resource type this setting is applied to. Set the specific logs to collect here."
                        }
                      },
                      "categoryGroup": {
                        "type": "string",
                        "nullable": true,
                        "metadata": {
                          "description": "Optional. Name of a Diagnostic Log category group for a resource type this setting is applied to. Set to `allLogs` to collect all logs."
                        }
                      },
                      "enabled": {
                        "type": "bool",
                        "nullable": true,
                        "metadata": {
                          "description": "Optional. Enable or disable the category explicitly. Default is `true`."
                        }
                      }
                    }
                  },
                  "nullable": true,
                  "metadata": {
                    "description": "Optional. The name of logs that will be streamed. \"allLogs\" includes all possible logs for the resource. Set to `[]` to disable log collection."
                  }
                },
                "metricCategories": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "category": {
                        "type": "string",
                        "metadata": {
                          "description": "Required. Name of a Diagnostic Metric category for a resource type this setting is applied to. Set to `AllMetrics` to collect all metrics."
                        }
                      },
                      "enabled": {
                        "type": "bool",
                        "nullable": true,
                        "metadata": {
                          "description": "Optional. Enable or disable the category explicitly. Default is `true`."
                        }
                      }
                    }
                  },
                  "nullable": true,
                  "metadata": {
                    "description": "Optional. The name of metrics that will be streamed. \"allMetrics\" includes all possible metrics for the resource. Set to `[]` to disable metric collection."
                  }
                },
                "logAnalyticsDestinationType": {
                  "type": "string",
                  "allowedValues": [
                    "AzureDiagnostics",
                    "Dedicated"
                  ],
                  "nullable": true,
                  "metadata": {
                    "description": "Optional. A string indicating whether the export to Log Analytics should use the default destination type, i.e. AzureDiagnostics, or use a destination type."
                  }
                },
                "workspaceResourceId": {
                  "type": "string",
                  "nullable": true,
                  "metadata": {
                    "description": "Optional. Resource ID of the diagnostic log analytics workspace. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                  }
                },
                "storageAccountResourceId": {
                  "type": "string",
                  "nullable": true,
                  "metadata": {
                    "description": "Optional. Resource ID of the diagnostic storage account. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                  }
                },
                "eventHubAuthorizationRuleResourceId": {
                  "type": "string",
                  "nullable": true,
                  "metadata": {
                    "description": "Optional. Resource ID of the diagnostic event hub authorization rule for the Event Hubs namespace in which the event hub should be created or streamed to."
                  }
                },
                "eventHubName": {
                  "type": "string",
                  "nullable": true,
                  "metadata": {
                    "description": "Optional. Name of the diagnostic event hub within the namespace to which logs are streamed. Without this, an event hub is created for each log category. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                  }
                },
                "marketplacePartnerResourceId": {
                  "type": "string",
                  "nullable": true,
                  "metadata": {
                    "description": "Optional. The full ARM resource ID of the Marketplace resource to which you would like to send Diagnostic Logs."
                  }
                }
              },
              "metadata": {
                "description": "An AVM-aligned type for a diagnostic setting. To be used if both logs & metrics are supported by the resource provider.",
                "__bicep_imported_from!": {
                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                }
              }
            },
            "lockType": {
              "type": "object",
              "properties": {
                "name": {
                  "type": "string",
                  "nullable": true,
                  "metadata": {
                    "description": "Optional. Specify the name of lock."
                  }
                },
                "kind": {
                  "type": "string",
                  "allowedValues": [
                    "CanNotDelete",
                    "None",
                    "ReadOnly"
                  ],
                  "nullable": true,
                  "metadata": {
                    "description": "Optional. Specify the type of lock."
                  }
                },
                "notes": {
                  "type": "string",
                  "nullable": true,
                  "metadata": {
                    "description": "Optional. Specify the notes of the lock."
                  }
                }
              },
              "metadata": {
                "description": "An AVM-aligned type for a lock.",
                "__bicep_imported_from!": {
                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                }
              }
            }
          },
          "parameters": {
            "hubName": {
              "type": "string",
              "minLength": 3,
              "maxLength": 24,
              "metadata": {
                "description": "Required. Name of the FinOps Hub instance. Used for resource naming."
              }
            },
            "location": {
              "type": "string",
              "defaultValue": "[resourceGroup().location]",
              "metadata": {
                "description": "Optional. Azure region for all resources. Default: resource group location."
              }
            },
            "deploymentConfiguration": {
              "type": "string",
              "defaultValue": "minimal",
              "allowedValues": [
                "minimal",
                "waf-aligned"
              ],
              "metadata": {
                "description": "Optional. Deployment configuration profile. \"minimal\" for lowest cost dev/test, \"waf-aligned\" for production with HA/DR."
              }
            },
            "deploymentType": {
              "type": "string",
              "defaultValue": "storage-only",
              "allowedValues": [
                "adx",
                "fabric",
                "storage-only"
              ],
              "metadata": {
                "description": "Optional. Deployment type: \"adx\" for Azure Data Explorer, \"fabric\" for Microsoft Fabric, \"storage-only\" for basic deployment."
              }
            },
            "dataExplorerClusterName": {
              "type": "string",
              "defaultValue": "",
              "metadata": {
                "description": "Conditional. Azure Data Explorer cluster name. Required if deploymentType is \"adx\" and not using existing cluster."
              }
            },
            "existingDataExplorerClusterId": {
              "type": "string",
              "defaultValue": "",
              "metadata": {
                "description": "Optional. Resource ID of an existing Azure Data Explorer cluster to use. When provided, no new cluster is created."
              }
            },
            "dataExplorerSku": {
              "type": "string",
              "defaultValue": "",
              "metadata": {
                "description": "Optional. Azure Data Explorer SKU. Leave empty to use configuration default (minimal: Dev SKU, waf-aligned: Standard SKU)."
              }
            },
            "dataExplorerCapacity": {
              "type": "int",
              "defaultValue": 0,
              "metadata": {
                "description": "Optional. Number of instances in the Data Explorer cluster. Set to 0 to use configuration default (minimal: 1, waf-aligned: 2)."
              }
            },
            "fabricQueryUri": {
              "type": "string",
              "defaultValue": "",
              "metadata": {
                "description": "Conditional. Microsoft Fabric eventhouse Query URI. Required if deploymentType is \"fabric\"."
              }
            },
            "fabricIngestionUri": {
              "type": "string",
              "defaultValue": "",
              "metadata": {
                "description": "Optional. Microsoft Fabric eventhouse ingestion URI. Used for data ingestion pipelines."
              }
            },
            "fabricDatabaseName": {
              "type": "string",
              "defaultValue": "finops",
              "metadata": {
                "description": "Optional. Microsoft Fabric database name in the eventhouse."
              }
            },
            "existingManagedIdentityResourceId": {
              "type": "string",
              "defaultValue": "",
              "metadata": {
                "description": "Optional. Resource ID of an existing user-assigned managed identity. When provided, no new identity is created. Use this for strict security policies where identities must be pre-created."
              }
            },
            "deployerPrincipalId": {
              "type": "string",
              "defaultValue": "",
              "metadata": {
                "description": "Optional. Principal ID of the deployer. Grants Storage Blob Data Contributor (for test data upload) and ADX AllDatabasesAdmin (for cluster management and troubleshooting)."
              }
            },
            "adxAdminPrincipalIds": {
              "type": "array",
              "defaultValue": [],
              "metadata": {
                "description": "Optional. Array of additional ADX admin principal IDs (users or groups) to grant AllDatabasesAdmin role."
              }
            },
            "billingAccountType": {
              "type": "string",
              "defaultValue": "auto",
              "allowedValues": [
                "auto",
                "ea",
                "mca",
                "mpa",
                "paygo",
                "csp"
              ],
              "metadata": {
                "description": "Optional. Billing type hint: \"ea\", \"mca\", \"mpa\" support exports; \"paygo\", \"csp\" use demo mode. See README for export support matrix."
              }
            },
            "billingAccountId": {
              "type": "string",
              "defaultValue": "",
              "metadata": {
                "description": "Optional. Billing account ID for MACC tracking. Requires ADF MI to have Billing Account Reader role."
              }
            },
            "scopesToMonitor": {
              "type": "array",
              "defaultValue": [],
              "metadata": {
                "description": "Optional. Billing scopes to monitor. See README for scope types and export support matrix."
              }
            },
            "enableRbacAuthorization": {
              "type": "bool",
              "defaultValue": true,
              "metadata": {
                "description": "Optional. Enable RBAC authorization for Key Vault (recommended)."
              }
            },
            "enablePurgeProtection": {
              "type": "bool",
              "defaultValue": false,
              "metadata": {
                "description": "Optional. Enable Key Vault purge protection. Automatically enabled for waf-aligned."
              }
            },
            "enablePublicAccess": {
              "type": "bool",
              "defaultValue": true,
              "metadata": {
                "description": "Optional. Enable public network access. Automatically disabled for waf-aligned."
              }
            },
            "networkIsolationMode": {
              "type": "string",
              "defaultValue": "None",
              "allowedValues": [
                "None",
                "Managed",
                "BringYourOwn"
              ],
              "metadata": {
                "description": "Optional. Network isolation: \"None\" (public), \"Managed\" (module creates VNet/PEs), or \"BringYourOwn\" (you provide subnet/DNS)."
              }
            },
            "managedVnetAddressPrefix": {
              "type": "string",
              "defaultValue": "10.0.0.0/24",
              "metadata": {
                "description": "Optional. Address prefix for the managed VNet. Only used when networkIsolationMode is \"Managed\". Default: 10.0.0.0/24."
              }
            },
            "managedSubnetAddressPrefix": {
              "type": "string",
              "defaultValue": "10.0.0.0/26",
              "metadata": {
                "description": "Optional. Address prefix for the private endpoints subnet. Only used when networkIsolationMode is \"Managed\". Default: 10.0.0.0/26."
              }
            },
            "byoSubnetResourceId": {
              "type": "string",
              "defaultValue": "",
              "metadata": {
                "description": "Conditional. Subnet resource ID for private endpoints. Required if networkIsolationMode is \"BringYourOwn\"."
              }
            },
            "byoBlobDnsZoneId": {
              "type": "string",
              "defaultValue": "",
              "metadata": {
                "description": "Conditional. Resource ID of the private DNS zone for blob storage (privatelink.blob.core.windows.net). Required if networkIsolationMode is \"BringYourOwn\" and enablePrivateDnsZoneGroups is true."
              }
            },
            "byoDfsDnsZoneId": {
              "type": "string",
              "defaultValue": "",
              "metadata": {
                "description": "Conditional. Resource ID of the private DNS zone for DFS storage (privatelink.dfs.core.windows.net). Required if networkIsolationMode is \"BringYourOwn\" and enablePrivateDnsZoneGroups is true."
              }
            },
            "byoVaultDnsZoneId": {
              "type": "string",
              "defaultValue": "",
              "metadata": {
                "description": "Conditional. Resource ID of the private DNS zone for Key Vault (privatelink.vaultcore.azure.net). Required if networkIsolationMode is \"BringYourOwn\" and enablePrivateDnsZoneGroups is true."
              }
            },
            "byoDataFactoryDnsZoneId": {
              "type": "string",
              "defaultValue": "",
              "metadata": {
                "description": "Conditional. Resource ID of the private DNS zone for Data Factory (privatelink.datafactory.azure.net). Required if networkIsolationMode is \"BringYourOwn\" and enablePrivateDnsZoneGroups is true."
              }
            },
            "byoKustoDnsZoneId": {
              "type": "string",
              "defaultValue": "",
              "metadata": {
                "description": "Conditional. Resource ID of the private DNS zone for Kusto/ADX (privatelink.<region>.kusto.windows.net). Required if networkIsolationMode is \"BringYourOwn\", deploymentType is \"adx\", and enablePrivateDnsZoneGroups is true."
              }
            },
            "enableAdfManagedVnet": {
              "type": "bool",
              "defaultValue": false,
              "metadata": {
                "description": "Optional. Enable Data Factory Managed Virtual Network with Managed Integration Runtime. Required for accessing private endpoints from ADF pipelines. Automatically enabled when networkIsolationMode is \"Managed\" or \"BringYourOwn\". See enableManagedPeAutoApproval parameter for PE approval options."
              }
            },
            "enableManagedPeAutoApproval": {
              "type": "bool",
              "defaultValue": true,
              "metadata": {
                "description": "Optional. Enable automatic approval of ADF Managed Private Endpoints. When true (Option A), grants ADF control-plane permissions to auto-approve its PE connections to Storage and Key Vault. When false (Option B), PE connections require manual approval via Azure Portal or CLI. Default: true for streamlined deployments."
              }
            },
            "enablePrivateDnsZoneGroups": {
              "type": "bool",
              "defaultValue": true,
              "metadata": {
                "description": "Optional. Create DNS zone groups for private endpoints. Set false when Azure Policy manages DNS records (ESLZ pattern)."
              }
            },
            "privateEndpointSubnetId": {
              "type": "string",
              "defaultValue": "",
              "metadata": {
                "description": "Optional. Note: This is a deprecated property, please use `networkIsolationMode=\"BringYourOwn\"` with `byoSubnetResourceId` instead. Resource ID of the subnet for private endpoints."
              }
            },
            "storageBlobPrivateDnsZoneId": {
              "type": "string",
              "defaultValue": "",
              "metadata": {
                "description": "Optional. Note: This is a deprecated property, please use `byoBlobDnsZoneId` instead."
              }
            },
            "storageDfsPrivateDnsZoneId": {
              "type": "string",
              "defaultValue": "",
              "metadata": {
                "description": "Optional. Note: This is a deprecated property, please use `byoDfsDnsZoneId` instead."
              }
            },
            "keyVaultPrivateDnsZoneId": {
              "type": "string",
              "defaultValue": "",
              "metadata": {
                "description": "Optional. Note: This is a deprecated property, please use `byoVaultDnsZoneId` instead."
              }
            },
            "dataFactoryPrivateDnsZoneId": {
              "type": "string",
              "defaultValue": "",
              "metadata": {
                "description": "Optional. Note: This is a deprecated property, please use `byoDataFactoryDnsZoneId` instead."
              }
            },
            "tags": {
              "type": "object",
              "defaultValue": {},
              "metadata": {
                "description": "Optional. Tags to apply to all resources."
              }
            },
            "tagsByResource": {
              "type": "object",
              "defaultValue": {},
              "metadata": {
                "description": "Optional. Resource-specific tags by resource type."
              }
            },
            "enableTelemetry": {
              "type": "bool",
              "defaultValue": true,
              "metadata": {
                "description": "Optional. Enable/Disable usage telemetry for module."
              }
            },
            "lock": {
              "$ref": "#/definitions/lockType",
              "nullable": true,
              "metadata": {
                "description": "Optional. The lock settings of the service."
              }
            },
            "diagnosticSettings": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/diagnosticSettingFullType"
              },
              "nullable": true,
              "metadata": {
                "description": "Optional. The diagnostic settings of the service. Applies to Storage Account and Key Vault."
              }
            },
            "enableTriggerManagement": {
              "type": "bool",
              "defaultValue": false,
              "metadata": {
                "description": "Optional. Enable automatic trigger start/stop for idempotent redeployments. Requires shared key access on storage."
              }
            }
          },
          "variables": {
            "copy": [
              {
                "name": "adxAdminAssignments",
                "count": "[length(parameters('adxAdminPrincipalIds'))]",
                "input": {
                  "principalId": "[parameters('adxAdminPrincipalIds')[copyIndex('adxAdminAssignments')]]",
                  "principalType": "User",
                  "role": "AllDatabasesAdmin",
                  "tenantId": "[tenant().tenantId]"
                }
              },
              {
                "name": "settingsJsonScopes",
                "count": "[length(parameters('scopesToMonitor'))]",
                "input": {
                  "scope": "[coalesce(tryGet(parameters('scopesToMonitor')[copyIndex('settingsJsonScopes')], 'scopeId'), '')]",
                  "displayName": "[coalesce(tryGet(parameters('scopesToMonitor')[copyIndex('settingsJsonScopes')], 'displayName'), '')]",
                  "tenantId": "[coalesce(tryGet(parameters('scopesToMonitor')[copyIndex('settingsJsonScopes')], 'tenantId'), tenant().tenantId)]"
                }
              }
            ],
            "storageSku": "[if(equals(parameters('deploymentConfiguration'), 'waf-aligned'), 'Premium_ZRS', 'Standard_LRS')]",
            "storageKind": "[if(equals(parameters('deploymentConfiguration'), 'waf-aligned'), 'BlockBlobStorage', 'StorageV2')]",
            "effectiveAdxSku": "[if(not(empty(parameters('dataExplorerSku'))), parameters('dataExplorerSku'), 'Standard_E2d_v5')]",
            "effectiveAdxTier": "[if(startsWith(variables('effectiveAdxSku'), 'Dev'), 'Basic', 'Standard')]",
            "effectiveAdxCapacity": "[if(greater(parameters('dataExplorerCapacity'), 0), parameters('dataExplorerCapacity'), if(startsWith(variables('effectiveAdxSku'), 'Dev'), 1, 2))]",
            "effectivePurgeProtection": "[if(equals(parameters('deploymentConfiguration'), 'waf-aligned'), true(), parameters('enablePurgeProtection'))]",
            "effectivePublicAccess": "[if(equals(parameters('deploymentConfiguration'), 'waf-aligned'), false(), parameters('enablePublicAccess'))]",
            "enableManagedExports": "[and(contains(createArray('ea', 'mca', 'mpa'), parameters('billingAccountType')), not(empty(parameters('scopesToMonitor'))))]",
            "effectiveNetworkIsolationMode": "[if(and(equals(parameters('deploymentConfiguration'), 'waf-aligned'), equals(parameters('networkIsolationMode'), 'None')), 'Managed', if(and(not(empty(parameters('privateEndpointSubnetId'))), equals(parameters('networkIsolationMode'), 'None')), 'BringYourOwn', parameters('networkIsolationMode')))]",
            "enablePrivateEndpoints": "[not(equals(variables('effectiveNetworkIsolationMode'), 'None'))]",
            "effectiveAdfManagedVnet": "[or(parameters('enableAdfManagedVnet'), variables('enablePrivateEndpoints'))]",
            "uniqueSuffix": "[uniqueString(resourceGroup().id, parameters('hubName'))]",
            "storageAccountName": "[take(toLower(format('st{0}{1}', replace(parameters('hubName'), '-', ''), variables('uniqueSuffix'))), 24)]",
            "keyVaultName": "[take(format('kv-{0}-{1}', parameters('hubName'), take(variables('uniqueSuffix'), 6)), 24)]",
            "dataFactoryName": "[take(format('adf-{0}-{1}', parameters('hubName'), take(variables('uniqueSuffix'), 6)), 63)]",
            "managedIdentityName": "[format('id-{0}', parameters('hubName'))]",
            "adxClusterName": "[if(not(empty(parameters('dataExplorerClusterName'))), take(toLower(format('{0}{1}', replace(parameters('dataExplorerClusterName'), '-', ''), take(variables('uniqueSuffix'), 6))), 22), '')]",
            "useExistingIdentity": "[not(empty(parameters('existingManagedIdentityResourceId')))]",
            "useExistingAdx": "[not(empty(parameters('existingDataExplorerClusterId')))]",
            "createNewAdx": "[and(and(equals(parameters('deploymentType'), 'adx'), not(empty(parameters('dataExplorerClusterName')))), not(variables('useExistingAdx')))]",
            "useFabric": "[and(equals(parameters('deploymentType'), 'fabric'), not(empty(parameters('fabricQueryUri'))))]",
            "deployAdxSchema": "[and(equals(parameters('deploymentType'), 'adx'), or(variables('createNewAdx'), variables('useExistingAdx')))]",
            "deployerAdminAssignment": "[if(not(empty(parameters('deployerPrincipalId'))), createArray(createObject('principalId', parameters('deployerPrincipalId'), 'principalType', 'User', 'role', 'AllDatabasesAdmin', 'tenantId', tenant().tenantId)), createArray())]",
            "existingIdentityName": "[if(variables('useExistingIdentity'), last(split(parameters('existingManagedIdentityResourceId'), '/')), '')]",
            "existingAdxClusterName": "[if(variables('useExistingAdx'), last(split(parameters('existingDataExplorerClusterId'), '/')), '')]",
            "containers": [
              "config",
              "msexports",
              "ingestion"
            ],
            "ftkVersion": "0.7.0",
            "hubModuleVersion": "0.2.0",
            "allTags": "[union(parameters('tags'), createObject('cm-resource-parent', parameters('hubName'), 'ftk-version', variables('ftkVersion'), 'ftk-hub-module', variables('hubModuleVersion'), 'deployment-configuration', parameters('deploymentConfiguration')))]"
          },
          "resources": {
            "avmTelemetry": {
              "condition": "[parameters('enableTelemetry')]",
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2024-03-01",
              "name": "[format('46d3xbcp.ptn.finopstoolkit-finopshub.{0}.{1}', replace('-..--..-', '.', '-'), substring(uniqueString(deployment().name, parameters('location')), 0, 4))]",
              "properties": {
                "mode": "Incremental",
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "resources": [],
                  "outputs": {
                    "telemetry": {
                      "type": "String",
                      "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                    }
                  }
                }
              }
            },
            "existingManagedIdentity": {
              "condition": "[variables('useExistingIdentity')]",
              "existing": true,
              "type": "Microsoft.ManagedIdentity/userAssignedIdentities",
              "apiVersion": "2024-11-30",
              "name": "[variables('existingIdentityName')]"
            },
            "managedNetwork": {
              "condition": "[equals(variables('effectiveNetworkIsolationMode'), 'Managed')]",
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-managed-network', uniqueString(deployment().name, parameters('location')))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "hubName": {
                    "value": "[parameters('hubName')]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "vnetAddressPrefix": {
                    "value": "[parameters('managedVnetAddressPrefix')]"
                  },
                  "subnetAddressPrefix": {
                    "value": "[parameters('managedSubnetAddressPrefix')]"
                  },
                  "tags": {
                    "value": "[variables('allTags')]"
                  },
                  "enableTelemetry": {
                    "value": "[parameters('enableTelemetry')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.40.2.10011",
                      "templateHash": "14738094090789284178"
                    },
                    "name": "FinOps Hub Managed Network",
                    "description": "Deploys a self-contained VNet with private endpoints and DNS zones for FinOps Hub."
                  },
                  "parameters": {
                    "hubName": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. Name of the FinOps Hub (used for resource naming)."
                      }
                    },
                    "location": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. Azure region for network resources."
                      }
                    },
                    "vnetAddressPrefix": {
                      "type": "string",
                      "defaultValue": "10.0.0.0/24",
                      "metadata": {
                        "description": "Optional. Address prefix for the VNet. Default: 10.0.0.0/24."
                      }
                    },
                    "subnetAddressPrefix": {
                      "type": "string",
                      "defaultValue": "10.0.0.0/26",
                      "metadata": {
                        "description": "Optional. Address prefix for the private endpoints subnet. Default: 10.0.0.0/26 (62 usable IPs)."
                      }
                    },
                    "tags": {
                      "type": "object",
                      "defaultValue": {},
                      "metadata": {
                        "description": "Optional. Tags to apply to network resources."
                      }
                    },
                    "enableTelemetry": {
                      "type": "bool",
                      "defaultValue": false,
                      "metadata": {
                        "description": "Optional. Enable AVM telemetry."
                      }
                    }
                  },
                  "variables": {
                    "uniqueSuffix": "[uniqueString(resourceGroup().id, parameters('hubName'))]",
                    "vnetName": "[format('vnet-{0}-{1}', parameters('hubName'), take(variables('uniqueSuffix'), 6))]",
                    "subnetName": "snet-private-endpoints",
                    "nsgName": "[format('nsg-{0}-pe', parameters('hubName'))]",
                    "dnsZoneNames": {
                      "blob": "[format('privatelink.blob.{0}', environment().suffixes.storage)]",
                      "dfs": "[format('privatelink.dfs.{0}', environment().suffixes.storage)]",
                      "vault": "[replace(environment().suffixes.keyvaultDns, '.', 'privatelink.')]",
                      "dataFactory": "privatelink.datafactory.azure.net",
                      "kusto": "[format('privatelink.{0}.kusto.windows.net', parameters('location'))]"
                    }
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "[format('{0}-nsg', uniqueString(deployment().name, parameters('location')))]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "name": {
                            "value": "[variables('nsgName')]"
                          },
                          "location": {
                            "value": "[parameters('location')]"
                          },
                          "tags": {
                            "value": "[parameters('tags')]"
                          },
                          "enableTelemetry": {
                            "value": "[parameters('enableTelemetry')]"
                          },
                          "securityRules": {
                            "value": [
                              {
                                "name": "AllowVnetInbound",
                                "properties": {
                                  "priority": 100,
                                  "direction": "Inbound",
                                  "access": "Allow",
                                  "protocol": "*",
                                  "sourceAddressPrefix": "VirtualNetwork",
                                  "sourcePortRange": "*",
                                  "destinationAddressPrefix": "VirtualNetwork",
                                  "destinationPortRange": "*"
                                }
                              },
                              {
                                "name": "DenyAllInbound",
                                "properties": {
                                  "priority": 4096,
                                  "direction": "Inbound",
                                  "access": "Deny",
                                  "protocol": "*",
                                  "sourceAddressPrefix": "*",
                                  "sourcePortRange": "*",
                                  "destinationAddressPrefix": "*",
                                  "destinationPortRange": "*"
                                }
                              }
                            ]
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.38.5.1644",
                              "templateHash": "11959948740766233645"
                            },
                            "name": "Network Security Groups",
                            "description": "This module deploys a Network security Group (NSG)."
                          },
                          "definitions": {
                            "securityRuleType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the security rule."
                                  }
                                },
                                "properties": {
                                  "type": "object",
                                  "properties": {
                                    "access": {
                                      "type": "string",
                                      "allowedValues": [
                                        "Allow",
                                        "Deny"
                                      ],
                                      "metadata": {
                                        "description": "Required. Whether network traffic is allowed or denied."
                                      }
                                    },
                                    "description": {
                                      "type": "string",
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. The description of the security rule."
                                      }
                                    },
                                    "destinationAddressPrefix": {
                                      "type": "string",
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Optional. The destination address prefix. CIDR or destination IP range. Asterisk \"*\" can also be used to match all source IPs. Default tags such as \"VirtualNetwork\", \"AzureLoadBalancer\" and \"Internet\" can also be used."
                                      }
                                    },
                                    "destinationAddressPrefixes": {
                                      "type": "array",
                                      "items": {
                                        "type": "string"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. The destination address prefixes. CIDR or destination IP ranges."
                                      }
                                    },
                                    "destinationApplicationSecurityGroupResourceIds": {
                                      "type": "array",
                                      "items": {
                                        "type": "string"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. The resource IDs of the application security groups specified as destination."
                                      }
                                    },
                                    "destinationPortRange": {
                                      "type": "string",
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. The destination port or range. Integer or range between 0 and 65535. Asterisk \"*\" can also be used to match all ports."
                                      }
                                    },
                                    "destinationPortRanges": {
                                      "type": "array",
                                      "items": {
                                        "type": "string"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. The destination port ranges."
                                      }
                                    },
                                    "direction": {
                                      "type": "string",
                                      "allowedValues": [
                                        "Inbound",
                                        "Outbound"
                                      ],
                                      "metadata": {
                                        "description": "Required. The direction of the rule. The direction specifies if rule will be evaluated on incoming or outgoing traffic."
                                      }
                                    },
                                    "priority": {
                                      "type": "int",
                                      "minValue": 100,
                                      "maxValue": 4096,
                                      "metadata": {
                                        "description": "Required. Required. The priority of the rule. The value can be between 100 and 4096. The priority number must be unique for each rule in the collection. The lower the priority number, the higher the priority of the rule."
                                      }
                                    },
                                    "protocol": {
                                      "type": "string",
                                      "allowedValues": [
                                        "*",
                                        "Ah",
                                        "Esp",
                                        "Icmp",
                                        "Tcp",
                                        "Udp"
                                      ],
                                      "metadata": {
                                        "description": "Required. Network protocol this rule applies to."
                                      }
                                    },
                                    "sourceAddressPrefix": {
                                      "type": "string",
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. The CIDR or source IP range. Asterisk \"*\" can also be used to match all source IPs. Default tags such as \"VirtualNetwork\", \"AzureLoadBalancer\" and \"Internet\" can also be used. If this is an ingress rule, specifies where network traffic originates from."
                                      }
                                    },
                                    "sourceAddressPrefixes": {
                                      "type": "array",
                                      "items": {
                                        "type": "string"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. The CIDR or source IP ranges."
                                      }
                                    },
                                    "sourceApplicationSecurityGroupResourceIds": {
                                      "type": "array",
                                      "items": {
                                        "type": "string"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. The resource IDs of the application security groups specified as source."
                                      }
                                    },
                                    "sourcePortRange": {
                                      "type": "string",
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. The source port or range. Integer or range between 0 and 65535. Asterisk \"*\" can also be used to match all ports."
                                      }
                                    },
                                    "sourcePortRanges": {
                                      "type": "array",
                                      "items": {
                                        "type": "string"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. The source port ranges."
                                      }
                                    }
                                  },
                                  "metadata": {
                                    "description": "Required. The properties of the security rule."
                                  }
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type of a security rule."
                              }
                            },
                            "diagnosticSettingLogsOnlyType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name of diagnostic setting."
                                  }
                                },
                                "logCategoriesAndGroups": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "category": {
                                        "type": "string",
                                        "nullable": true,
                                        "metadata": {
                                          "description": "Optional. Name of a Diagnostic Log category for a resource type this setting is applied to. Set the specific logs to collect here."
                                        }
                                      },
                                      "categoryGroup": {
                                        "type": "string",
                                        "nullable": true,
                                        "metadata": {
                                          "description": "Optional. Name of a Diagnostic Log category group for a resource type this setting is applied to. Set to `allLogs` to collect all logs."
                                        }
                                      },
                                      "enabled": {
                                        "type": "bool",
                                        "nullable": true,
                                        "metadata": {
                                          "description": "Optional. Enable or disable the category explicitly. Default is `true`."
                                        }
                                      }
                                    }
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name of logs that will be streamed. \"allLogs\" includes all possible logs for the resource. Set to `[]` to disable log collection."
                                  }
                                },
                                "logAnalyticsDestinationType": {
                                  "type": "string",
                                  "allowedValues": [
                                    "AzureDiagnostics",
                                    "Dedicated"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. A string indicating whether the export to Log Analytics should use the default destination type, i.e. AzureDiagnostics, or use a destination type."
                                  }
                                },
                                "workspaceResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Resource ID of the diagnostic log analytics workspace. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                                  }
                                },
                                "storageAccountResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Resource ID of the diagnostic storage account. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                                  }
                                },
                                "eventHubAuthorizationRuleResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Resource ID of the diagnostic event hub authorization rule for the Event Hubs namespace in which the event hub should be created or streamed to."
                                  }
                                },
                                "eventHubName": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Name of the diagnostic event hub within the namespace to which logs are streamed. Without this, an event hub is created for each log category. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                                  }
                                },
                                "marketplacePartnerResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The full ARM resource ID of the Marketplace resource to which you would like to send Diagnostic Logs."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for a diagnostic setting. To be used if only logs are supported by the resource provider.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                }
                              }
                            },
                            "lockType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Specify the name of lock."
                                  }
                                },
                                "kind": {
                                  "type": "string",
                                  "allowedValues": [
                                    "CanNotDelete",
                                    "None",
                                    "ReadOnly"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Specify the type of lock."
                                  }
                                },
                                "notes": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Specify the notes of the lock."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for a lock.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.0"
                                }
                              }
                            },
                            "roleAssignmentType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                  }
                                },
                                "roleDefinitionIdOrName": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                  }
                                },
                                "principalId": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                  }
                                },
                                "principalType": {
                                  "type": "string",
                                  "allowedValues": [
                                    "Device",
                                    "ForeignGroup",
                                    "Group",
                                    "ServicePrincipal",
                                    "User"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The principal type of the assigned principal ID."
                                  }
                                },
                                "description": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The description of the role assignment."
                                  }
                                },
                                "condition": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                  }
                                },
                                "conditionVersion": {
                                  "type": "string",
                                  "allowedValues": [
                                    "2.0"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Version of the condition."
                                  }
                                },
                                "delegatedManagedIdentityResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The Resource Id of the delegated managed identity resource."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for a role assignment.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                }
                              }
                            }
                          },
                          "parameters": {
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. Name of the Network Security Group."
                              }
                            },
                            "location": {
                              "type": "string",
                              "defaultValue": "[resourceGroup().location]",
                              "metadata": {
                                "description": "Optional. Location for all resources."
                              }
                            },
                            "securityRules": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/securityRuleType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of Security Rules to deploy to the Network Security Group. When not provided, an NSG including only the built-in roles will be deployed."
                              }
                            },
                            "flushConnection": {
                              "type": "bool",
                              "defaultValue": false,
                              "metadata": {
                                "description": "Optional. When enabled, flows created from Network Security Group connections will be re-evaluated when rules are updates. Initial enablement will trigger re-evaluation. Network Security Group connection flushing is not available in all regions."
                              }
                            },
                            "diagnosticSettings": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/diagnosticSettingLogsOnlyType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The diagnostic settings of the service."
                              }
                            },
                            "lock": {
                              "$ref": "#/definitions/lockType",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The lock settings of the service."
                              }
                            },
                            "roleAssignments": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/roleAssignmentType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of role assignments to create."
                              }
                            },
                            "tags": {
                              "type": "object",
                              "metadata": {
                                "__bicep_resource_derived_type!": {
                                  "source": "Microsoft.Network/networkSecurityGroups@2024-07-01#properties/tags"
                                },
                                "description": "Optional. Tags of the NSG resource."
                              },
                              "nullable": true
                            },
                            "enableTelemetry": {
                              "type": "bool",
                              "defaultValue": true,
                              "metadata": {
                                "description": "Optional. Enable/Disable usage telemetry for module."
                              }
                            }
                          },
                          "variables": {
                            "copy": [
                              {
                                "name": "formattedRoleAssignments",
                                "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                              }
                            ],
                            "builtInRoleNames": {
                              "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                              "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                              "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                              "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                              "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                              "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                            }
                          },
                          "resources": {
                            "avmTelemetry": {
                              "condition": "[parameters('enableTelemetry')]",
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2024-03-01",
                              "name": "[format('46d3xbcp.res.network-networksecuritygroup.{0}.{1}', replace('0.5.2', '.', '-'), substring(uniqueString(deployment().name, parameters('location')), 0, 4))]",
                              "properties": {
                                "mode": "Incremental",
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "contentVersion": "1.0.0.0",
                                  "resources": [],
                                  "outputs": {
                                    "telemetry": {
                                      "type": "String",
                                      "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                    }
                                  }
                                }
                              }
                            },
                            "networkSecurityGroup": {
                              "type": "Microsoft.Network/networkSecurityGroups",
                              "apiVersion": "2023-11-01",
                              "name": "[parameters('name')]",
                              "location": "[parameters('location')]",
                              "tags": "[parameters('tags')]",
                              "properties": {
                                "copy": [
                                  {
                                    "name": "securityRules",
                                    "count": "[length(coalesce(parameters('securityRules'), createArray()))]",
                                    "input": {
                                      "name": "[coalesce(parameters('securityRules'), createArray())[copyIndex('securityRules')].name]",
                                      "properties": {
                                        "access": "[coalesce(parameters('securityRules'), createArray())[copyIndex('securityRules')].properties.access]",
                                        "description": "[coalesce(tryGet(coalesce(parameters('securityRules'), createArray())[copyIndex('securityRules')].properties, 'description'), '')]",
                                        "destinationAddressPrefix": "[coalesce(tryGet(coalesce(parameters('securityRules'), createArray())[copyIndex('securityRules')].properties, 'destinationAddressPrefix'), '')]",
                                        "destinationAddressPrefixes": "[coalesce(tryGet(coalesce(parameters('securityRules'), createArray())[copyIndex('securityRules')].properties, 'destinationAddressPrefixes'), createArray())]",
                                        "destinationApplicationSecurityGroups": "[map(coalesce(tryGet(coalesce(parameters('securityRules'), createArray())[copyIndex('securityRules')].properties, 'destinationApplicationSecurityGroupResourceIds'), createArray()), lambda('destinationApplicationSecurityGroupResourceId', createObject('id', lambdaVariables('destinationApplicationSecurityGroupResourceId'))))]",
                                        "destinationPortRange": "[coalesce(tryGet(coalesce(parameters('securityRules'), createArray())[copyIndex('securityRules')].properties, 'destinationPortRange'), '')]",
                                        "destinationPortRanges": "[coalesce(tryGet(coalesce(parameters('securityRules'), createArray())[copyIndex('securityRules')].properties, 'destinationPortRanges'), createArray())]",
                                        "direction": "[coalesce(parameters('securityRules'), createArray())[copyIndex('securityRules')].properties.direction]",
                                        "priority": "[coalesce(parameters('securityRules'), createArray())[copyIndex('securityRules')].properties.priority]",
                                        "protocol": "[coalesce(parameters('securityRules'), createArray())[copyIndex('securityRules')].properties.protocol]",
                                        "sourceAddressPrefix": "[coalesce(tryGet(coalesce(parameters('securityRules'), createArray())[copyIndex('securityRules')].properties, 'sourceAddressPrefix'), '')]",
                                        "sourceAddressPrefixes": "[coalesce(tryGet(coalesce(parameters('securityRules'), createArray())[copyIndex('securityRules')].properties, 'sourceAddressPrefixes'), createArray())]",
                                        "sourceApplicationSecurityGroups": "[map(coalesce(tryGet(coalesce(parameters('securityRules'), createArray())[copyIndex('securityRules')].properties, 'sourceApplicationSecurityGroupResourceIds'), createArray()), lambda('sourceApplicationSecurityGroupResourceId', createObject('id', lambdaVariables('sourceApplicationSecurityGroupResourceId'))))]",
                                        "sourcePortRange": "[coalesce(tryGet(coalesce(parameters('securityRules'), createArray())[copyIndex('securityRules')].properties, 'sourcePortRange'), '')]",
                                        "sourcePortRanges": "[coalesce(tryGet(coalesce(parameters('securityRules'), createArray())[copyIndex('securityRules')].properties, 'sourcePortRanges'), createArray())]"
                                      }
                                    }
                                  }
                                ],
                                "flushConnection": "[parameters('flushConnection')]"
                              }
                            },
                            "networkSecurityGroup_lock": {
                              "condition": "[and(not(empty(coalesce(parameters('lock'), createObject()))), not(equals(tryGet(parameters('lock'), 'kind'), 'None')))]",
                              "type": "Microsoft.Authorization/locks",
                              "apiVersion": "2020-05-01",
                              "scope": "[format('Microsoft.Network/networkSecurityGroups/{0}', parameters('name'))]",
                              "name": "[coalesce(tryGet(parameters('lock'), 'name'), format('lock-{0}', parameters('name')))]",
                              "properties": {
                                "level": "[coalesce(tryGet(parameters('lock'), 'kind'), '')]",
                                "notes": "[coalesce(tryGet(parameters('lock'), 'notes'), if(equals(tryGet(parameters('lock'), 'kind'), 'CanNotDelete'), 'Cannot delete resource or child resources.', 'Cannot delete or modify the resource or child resources.'))]"
                              },
                              "dependsOn": [
                                "networkSecurityGroup"
                              ]
                            },
                            "networkSecurityGroup_diagnosticSettings": {
                              "copy": {
                                "name": "networkSecurityGroup_diagnosticSettings",
                                "count": "[length(coalesce(parameters('diagnosticSettings'), createArray()))]"
                              },
                              "type": "Microsoft.Insights/diagnosticSettings",
                              "apiVersion": "2021-05-01-preview",
                              "scope": "[format('Microsoft.Network/networkSecurityGroups/{0}', parameters('name'))]",
                              "name": "[coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'name'), format('{0}-diagnosticSettings', parameters('name')))]",
                              "properties": {
                                "copy": [
                                  {
                                    "name": "logs",
                                    "count": "[length(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs'))))]",
                                    "input": {
                                      "categoryGroup": "[tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs')))[copyIndex('logs')], 'categoryGroup')]",
                                      "category": "[tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs')))[copyIndex('logs')], 'category')]",
                                      "enabled": "[coalesce(tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs')))[copyIndex('logs')], 'enabled'), true())]"
                                    }
                                  }
                                ],
                                "storageAccountId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'storageAccountResourceId')]",
                                "workspaceId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'workspaceResourceId')]",
                                "eventHubAuthorizationRuleId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'eventHubAuthorizationRuleResourceId')]",
                                "eventHubName": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'eventHubName')]",
                                "marketplacePartnerId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'marketplacePartnerResourceId')]",
                                "logAnalyticsDestinationType": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logAnalyticsDestinationType')]"
                              },
                              "dependsOn": [
                                "networkSecurityGroup"
                              ]
                            },
                            "networkSecurityGroup_roleAssignments": {
                              "copy": {
                                "name": "networkSecurityGroup_roleAssignments",
                                "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                              },
                              "type": "Microsoft.Authorization/roleAssignments",
                              "apiVersion": "2022-04-01",
                              "scope": "[format('Microsoft.Network/networkSecurityGroups/{0}', parameters('name'))]",
                              "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/networkSecurityGroups', parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                              "properties": {
                                "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                              },
                              "dependsOn": [
                                "networkSecurityGroup"
                              ]
                            }
                          },
                          "outputs": {
                            "resourceGroupName": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource group the network security group was deployed into."
                              },
                              "value": "[resourceGroup().name]"
                            },
                            "resourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource ID of the network security group."
                              },
                              "value": "[resourceId('Microsoft.Network/networkSecurityGroups', parameters('name'))]"
                            },
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the network security group."
                              },
                              "value": "[parameters('name')]"
                            },
                            "location": {
                              "type": "string",
                              "metadata": {
                                "description": "The location the resource was deployed into."
                              },
                              "value": "[reference('networkSecurityGroup', '2023-11-01', 'full').location]"
                            }
                          }
                        }
                      }
                    },
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "[format('{0}-vnet', uniqueString(deployment().name, parameters('location')))]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "name": {
                            "value": "[variables('vnetName')]"
                          },
                          "location": {
                            "value": "[parameters('location')]"
                          },
                          "tags": {
                            "value": "[parameters('tags')]"
                          },
                          "enableTelemetry": {
                            "value": "[parameters('enableTelemetry')]"
                          },
                          "addressPrefixes": {
                            "value": [
                              "[parameters('vnetAddressPrefix')]"
                            ]
                          },
                          "subnets": {
                            "value": [
                              {
                                "name": "[variables('subnetName')]",
                                "addressPrefix": "[parameters('subnetAddressPrefix')]",
                                "networkSecurityGroupResourceId": "[reference(resourceId('Microsoft.Resources/deployments', format('{0}-nsg', uniqueString(deployment().name, parameters('location')))), '2025-04-01').outputs.resourceId.value]",
                                "privateEndpointNetworkPolicies": "Disabled"
                              }
                            ]
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.39.26.7824",
                              "templateHash": "15393147213974991892"
                            },
                            "name": "Virtual Networks",
                            "description": "This module deploys a Virtual Network (vNet)."
                          },
                          "definitions": {
                            "peeringType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The Name of VNET Peering resource. If not provided, default value will be peer-localVnetName-remoteVnetName."
                                  }
                                },
                                "remoteVirtualNetworkResourceId": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The Resource ID of the VNet that is this Local VNet is being peered to. Should be in the format of a Resource ID."
                                  }
                                },
                                "allowForwardedTraffic": {
                                  "type": "bool",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Whether the forwarded traffic from the VMs in the local virtual network will be allowed/disallowed in remote virtual network. Default is true."
                                  }
                                },
                                "allowGatewayTransit": {
                                  "type": "bool",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. If gateway links can be used in remote virtual networking to link to this virtual network. Default is false."
                                  }
                                },
                                "allowVirtualNetworkAccess": {
                                  "type": "bool",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Whether the VMs in the local virtual network space would be able to access the VMs in remote virtual network space. Default is true."
                                  }
                                },
                                "doNotVerifyRemoteGateways": {
                                  "type": "bool",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Do not verify the provisioning state of the remote gateway. Default is true."
                                  }
                                },
                                "useRemoteGateways": {
                                  "type": "bool",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. If remote gateways can be used on this virtual network. If the flag is set to true, and allowGatewayTransit on remote peering is also true, virtual network will use gateways of remote virtual network for transit. Only one peering can have this flag set to true. This flag cannot be set if virtual network already has a gateway. Default is false."
                                  }
                                },
                                "remotePeeringEnabled": {
                                  "type": "bool",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Deploy the outbound and the inbound peering."
                                  }
                                },
                                "remotePeeringName": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name of the VNET Peering resource in the remove Virtual Network. If not provided, default value will be peer-remoteVnetName-localVnetName."
                                  }
                                },
                                "remotePeeringAllowForwardedTraffic": {
                                  "type": "bool",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Whether the forwarded traffic from the VMs in the local virtual network will be allowed/disallowed in remote virtual network. Default is true."
                                  }
                                },
                                "remotePeeringAllowGatewayTransit": {
                                  "type": "bool",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. If gateway links can be used in remote virtual networking to link to this virtual network. Default is false."
                                  }
                                },
                                "remotePeeringAllowVirtualNetworkAccess": {
                                  "type": "bool",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Whether the VMs in the local virtual network space would be able to access the VMs in remote virtual network space. Default is true."
                                  }
                                },
                                "remotePeeringDoNotVerifyRemoteGateways": {
                                  "type": "bool",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Do not verify the provisioning state of the remote gateway. Default is true."
                                  }
                                },
                                "remotePeeringUseRemoteGateways": {
                                  "type": "bool",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. If remote gateways can be used on this virtual network. If the flag is set to true, and allowGatewayTransit on remote peering is also true, virtual network will use gateways of remote virtual network for transit. Only one peering can have this flag set to true. This flag cannot be set if virtual network already has a gateway. Default is false."
                                  }
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true
                              }
                            },
                            "subnetType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The Name of the subnet resource."
                                  }
                                },
                                "addressPrefix": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Conditional. The address prefix for the subnet. Required if `addressPrefixes` is empty."
                                  }
                                },
                                "addressPrefixes": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Conditional. List of address prefixes for the subnet. Required if `addressPrefix` is empty."
                                  }
                                },
                                "ipamPoolPrefixAllocations": {
                                  "type": "array",
                                  "prefixItems": [
                                    {
                                      "type": "object",
                                      "properties": {
                                        "pool": {
                                          "type": "object",
                                          "properties": {
                                            "id": {
                                              "type": "string",
                                              "metadata": {
                                                "description": "Required. The Resource ID of the IPAM pool."
                                              }
                                            }
                                          },
                                          "metadata": {
                                            "description": "Required. The Resource ID of the IPAM pool."
                                          }
                                        },
                                        "numberOfIpAddresses": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. Number of IP addresses allocated from the pool."
                                          }
                                        }
                                      }
                                    }
                                  ],
                                  "items": false,
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Conditional. The address space for the subnet, deployed from IPAM Pool. Required if `addressPrefixes` and `addressPrefix` is empty and the VNet address space configured to use IPAM Pool."
                                  }
                                },
                                "applicationGatewayIPConfigurations": {
                                  "type": "array",
                                  "items": {
                                    "type": "object"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Application gateway IP configurations of virtual network resource."
                                  }
                                },
                                "delegation": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The delegation to enable on the subnet."
                                  }
                                },
                                "natGatewayResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The resource ID of the NAT Gateway to use for the subnet."
                                  }
                                },
                                "networkSecurityGroupResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The resource ID of the network security group to assign to the subnet."
                                  }
                                },
                                "privateEndpointNetworkPolicies": {
                                  "type": "string",
                                  "allowedValues": [
                                    "Disabled",
                                    "Enabled",
                                    "NetworkSecurityGroupEnabled",
                                    "RouteTableEnabled"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. enable or disable apply network policies on private endpoint in the subnet."
                                  }
                                },
                                "privateLinkServiceNetworkPolicies": {
                                  "type": "string",
                                  "allowedValues": [
                                    "Disabled",
                                    "Enabled"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. enable or disable apply network policies on private link service in the subnet."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "routeTableResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The resource ID of the route table to assign to the subnet."
                                  }
                                },
                                "serviceEndpointPolicies": {
                                  "type": "array",
                                  "items": {
                                    "type": "object"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. An array of service endpoint policies."
                                  }
                                },
                                "serviceEndpoints": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The service endpoints to enable on the subnet."
                                  }
                                },
                                "defaultOutboundAccess": {
                                  "type": "bool",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Set this property to false to disable default outbound connectivity for all VMs in the subnet. This property can only be set at the time of subnet creation and cannot be updated for an existing subnet."
                                  }
                                },
                                "sharingScope": {
                                  "type": "string",
                                  "allowedValues": [
                                    "DelegatedServices",
                                    "Tenant"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Set this property to Tenant to allow sharing subnet with other subscriptions in your AAD tenant. This property can only be set if defaultOutboundAccess is set to false, both properties can only be set if subnet is empty."
                                  }
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true
                              }
                            },
                            "diagnosticSettingFullType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name of the diagnostic setting."
                                  }
                                },
                                "logCategoriesAndGroups": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "category": {
                                        "type": "string",
                                        "nullable": true,
                                        "metadata": {
                                          "description": "Optional. Name of a Diagnostic Log category for a resource type this setting is applied to. Set the specific logs to collect here."
                                        }
                                      },
                                      "categoryGroup": {
                                        "type": "string",
                                        "nullable": true,
                                        "metadata": {
                                          "description": "Optional. Name of a Diagnostic Log category group for a resource type this setting is applied to. Set to `allLogs` to collect all logs."
                                        }
                                      },
                                      "enabled": {
                                        "type": "bool",
                                        "nullable": true,
                                        "metadata": {
                                          "description": "Optional. Enable or disable the category explicitly. Default is `true`."
                                        }
                                      }
                                    }
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name of logs that will be streamed. \"allLogs\" includes all possible logs for the resource. Set to `[]` to disable log collection."
                                  }
                                },
                                "metricCategories": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "category": {
                                        "type": "string",
                                        "metadata": {
                                          "description": "Required. Name of a Diagnostic Metric category for a resource type this setting is applied to. Set to `AllMetrics` to collect all metrics."
                                        }
                                      },
                                      "enabled": {
                                        "type": "bool",
                                        "nullable": true,
                                        "metadata": {
                                          "description": "Optional. Enable or disable the category explicitly. Default is `true`."
                                        }
                                      }
                                    }
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name of metrics that will be streamed. \"allMetrics\" includes all possible metrics for the resource. Set to `[]` to disable metric collection."
                                  }
                                },
                                "logAnalyticsDestinationType": {
                                  "type": "string",
                                  "allowedValues": [
                                    "AzureDiagnostics",
                                    "Dedicated"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. A string indicating whether the export to Log Analytics should use the default destination type, i.e. AzureDiagnostics, or use a destination type."
                                  }
                                },
                                "workspaceResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Resource ID of the diagnostic log analytics workspace. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                                  }
                                },
                                "storageAccountResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Resource ID of the diagnostic storage account. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                                  }
                                },
                                "eventHubAuthorizationRuleResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Resource ID of the diagnostic event hub authorization rule for the Event Hubs namespace in which the event hub should be created or streamed to."
                                  }
                                },
                                "eventHubName": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Name of the diagnostic event hub within the namespace to which logs are streamed. Without this, an event hub is created for each log category. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                                  }
                                },
                                "marketplacePartnerResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The full ARM resource ID of the Marketplace resource to which you would like to send Diagnostic Logs."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for a diagnostic setting. To be used if both logs & metrics are supported by the resource provider.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.2.1"
                                }
                              }
                            },
                            "lockType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Specify the name of lock."
                                  }
                                },
                                "kind": {
                                  "type": "string",
                                  "allowedValues": [
                                    "CanNotDelete",
                                    "None",
                                    "ReadOnly"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Specify the type of lock."
                                  }
                                },
                                "notes": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Specify the notes of the lock."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for a lock.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.0"
                                }
                              }
                            },
                            "roleAssignmentType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                  }
                                },
                                "roleDefinitionIdOrName": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                  }
                                },
                                "principalId": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                  }
                                },
                                "principalType": {
                                  "type": "string",
                                  "allowedValues": [
                                    "Device",
                                    "ForeignGroup",
                                    "Group",
                                    "ServicePrincipal",
                                    "User"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The principal type of the assigned principal ID."
                                  }
                                },
                                "description": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The description of the role assignment."
                                  }
                                },
                                "condition": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                  }
                                },
                                "conditionVersion": {
                                  "type": "string",
                                  "allowedValues": [
                                    "2.0"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Version of the condition."
                                  }
                                },
                                "delegatedManagedIdentityResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The Resource Id of the delegated managed identity resource."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for a role assignment.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.2.1"
                                }
                              }
                            }
                          },
                          "parameters": {
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. The name of the Virtual Network (vNet)."
                              }
                            },
                            "location": {
                              "type": "string",
                              "defaultValue": "[resourceGroup().location]",
                              "metadata": {
                                "description": "Optional. Location for all resources."
                              }
                            },
                            "addressPrefixes": {
                              "type": "array",
                              "metadata": {
                                "description": "Required. An Array of 1 or more IP Address Prefixes OR the resource ID of the IPAM pool to be used for the Virtual Network. When specifying an IPAM pool resource ID you must also set a value for the parameter called `ipamPoolNumberOfIpAddresses`."
                              }
                            },
                            "ipamPoolNumberOfIpAddresses": {
                              "type": "string",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Number of IP addresses allocated from the pool. To be used only when the addressPrefix param is defined with a resource ID of an IPAM pool."
                              }
                            },
                            "virtualNetworkBgpCommunity": {
                              "type": "string",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The BGP community associated with the virtual network."
                              }
                            },
                            "subnets": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/subnetType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. An Array of subnets to deploy to the Virtual Network."
                              }
                            },
                            "dnsServers": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. DNS Servers associated to the Virtual Network."
                              }
                            },
                            "ddosProtectionPlanResourceId": {
                              "type": "string",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Resource ID of the DDoS protection plan to assign the VNET to. If it's left blank, DDoS protection will not be configured. If it's provided, the VNET created by this template will be attached to the referenced DDoS protection plan. The DDoS protection plan can exist in the same or in a different subscription."
                              }
                            },
                            "peerings": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/peeringType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Virtual Network Peering configurations."
                              }
                            },
                            "vnetEncryption": {
                              "type": "bool",
                              "defaultValue": false,
                              "metadata": {
                                "description": "Optional. Indicates if encryption is enabled on virtual network and if VM without encryption is allowed in encrypted VNet. Requires the EnableVNetEncryption feature to be registered for the subscription and a supported region to use this property."
                              }
                            },
                            "vnetEncryptionEnforcement": {
                              "type": "string",
                              "defaultValue": "AllowUnencrypted",
                              "allowedValues": [
                                "AllowUnencrypted",
                                "DropUnencrypted"
                              ],
                              "metadata": {
                                "description": "Optional. If the encrypted VNet allows VM that does not support encryption. Can only be used when vnetEncryption is enabled."
                              }
                            },
                            "flowTimeoutInMinutes": {
                              "type": "int",
                              "defaultValue": 0,
                              "maxValue": 30,
                              "metadata": {
                                "description": "Optional. The flow timeout in minutes for the Virtual Network, which is used to enable connection tracking for intra-VM flows. Possible values are between 4 and 30 minutes. Default value 0 will set the property to null."
                              }
                            },
                            "diagnosticSettings": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/diagnosticSettingFullType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The diagnostic settings of the service."
                              }
                            },
                            "lock": {
                              "$ref": "#/definitions/lockType",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The lock settings of the service."
                              }
                            },
                            "roleAssignments": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/roleAssignmentType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of role assignments to create."
                              }
                            },
                            "tags": {
                              "type": "object",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Tags of the resource."
                              }
                            },
                            "enableTelemetry": {
                              "type": "bool",
                              "defaultValue": true,
                              "metadata": {
                                "description": "Optional. Enable/Disable usage telemetry for module."
                              }
                            },
                            "enableVmProtection": {
                              "type": "bool",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Indicates if VM protection is enabled for all the subnets in the virtual network."
                              }
                            }
                          },
                          "variables": {
                            "copy": [
                              {
                                "name": "formattedRoleAssignments",
                                "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                              }
                            ],
                            "enableReferencedModulesTelemetry": false,
                            "builtInRoleNames": {
                              "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                              "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                              "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                              "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                              "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                              "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                            }
                          },
                          "resources": {
                            "avmTelemetry": {
                              "condition": "[parameters('enableTelemetry')]",
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2024-03-01",
                              "name": "[format('46d3xbcp.res.network-virtualnetwork.{0}.{1}', replace('0.7.2', '.', '-'), substring(uniqueString(deployment().name, parameters('location')), 0, 4))]",
                              "properties": {
                                "mode": "Incremental",
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "contentVersion": "1.0.0.0",
                                  "resources": [],
                                  "outputs": {
                                    "telemetry": {
                                      "type": "String",
                                      "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                    }
                                  }
                                }
                              }
                            },
                            "virtualNetwork": {
                              "type": "Microsoft.Network/virtualNetworks",
                              "apiVersion": "2024-05-01",
                              "name": "[parameters('name')]",
                              "location": "[parameters('location')]",
                              "tags": "[parameters('tags')]",
                              "properties": {
                                "addressSpace": "[if(contains(parameters('addressPrefixes')[0], '/Microsoft.Network/networkManagers/'), createObject('ipamPoolPrefixAllocations', createArray(createObject('pool', createObject('id', parameters('addressPrefixes')[0]), 'numberOfIpAddresses', parameters('ipamPoolNumberOfIpAddresses')))), createObject('addressPrefixes', parameters('addressPrefixes')))]",
                                "bgpCommunities": "[if(not(empty(parameters('virtualNetworkBgpCommunity'))), createObject('virtualNetworkCommunity', parameters('virtualNetworkBgpCommunity')), null())]",
                                "ddosProtectionPlan": "[if(not(empty(parameters('ddosProtectionPlanResourceId'))), createObject('id', parameters('ddosProtectionPlanResourceId')), null())]",
                                "dhcpOptions": "[if(not(empty(parameters('dnsServers'))), createObject('dnsServers', array(parameters('dnsServers'))), null())]",
                                "enableDdosProtection": "[not(empty(parameters('ddosProtectionPlanResourceId')))]",
                                "encryption": "[if(equals(parameters('vnetEncryption'), true()), createObject('enabled', parameters('vnetEncryption'), 'enforcement', parameters('vnetEncryptionEnforcement')), null())]",
                                "flowTimeoutInMinutes": "[if(not(equals(parameters('flowTimeoutInMinutes'), 0)), parameters('flowTimeoutInMinutes'), null())]",
                                "enableVmProtection": "[parameters('enableVmProtection')]"
                              }
                            },
                            "virtualNetwork_lock": {
                              "condition": "[and(not(empty(coalesce(parameters('lock'), createObject()))), not(equals(tryGet(parameters('lock'), 'kind'), 'None')))]",
                              "type": "Microsoft.Authorization/locks",
                              "apiVersion": "2020-05-01",
                              "scope": "[format('Microsoft.Network/virtualNetworks/{0}', parameters('name'))]",
                              "name": "[coalesce(tryGet(parameters('lock'), 'name'), format('lock-{0}', parameters('name')))]",
                              "properties": {
                                "level": "[coalesce(tryGet(parameters('lock'), 'kind'), '')]",
                                "notes": "[coalesce(tryGet(parameters('lock'), 'notes'), if(equals(tryGet(parameters('lock'), 'kind'), 'CanNotDelete'), 'Cannot delete resource or child resources.', 'Cannot delete or modify the resource or child resources.'))]"
                              },
                              "dependsOn": [
                                "virtualNetwork"
                              ]
                            },
                            "virtualNetwork_diagnosticSettings": {
                              "copy": {
                                "name": "virtualNetwork_diagnosticSettings",
                                "count": "[length(coalesce(parameters('diagnosticSettings'), createArray()))]"
                              },
                              "type": "Microsoft.Insights/diagnosticSettings",
                              "apiVersion": "2021-05-01-preview",
                              "scope": "[format('Microsoft.Network/virtualNetworks/{0}', parameters('name'))]",
                              "name": "[coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'name'), format('{0}-diagnosticSettings', parameters('name')))]",
                              "properties": {
                                "copy": [
                                  {
                                    "name": "metrics",
                                    "count": "[length(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'metricCategories'), createArray(createObject('category', 'AllMetrics'))))]",
                                    "input": {
                                      "category": "[coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'metricCategories'), createArray(createObject('category', 'AllMetrics')))[copyIndex('metrics')].category]",
                                      "enabled": "[coalesce(tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'metricCategories'), createArray(createObject('category', 'AllMetrics')))[copyIndex('metrics')], 'enabled'), true())]",
                                      "timeGrain": null
                                    }
                                  },
                                  {
                                    "name": "logs",
                                    "count": "[length(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs'))))]",
                                    "input": {
                                      "categoryGroup": "[tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs')))[copyIndex('logs')], 'categoryGroup')]",
                                      "category": "[tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs')))[copyIndex('logs')], 'category')]",
                                      "enabled": "[coalesce(tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs')))[copyIndex('logs')], 'enabled'), true())]"
                                    }
                                  }
                                ],
                                "storageAccountId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'storageAccountResourceId')]",
                                "workspaceId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'workspaceResourceId')]",
                                "eventHubAuthorizationRuleId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'eventHubAuthorizationRuleResourceId')]",
                                "eventHubName": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'eventHubName')]",
                                "marketplacePartnerId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'marketplacePartnerResourceId')]",
                                "logAnalyticsDestinationType": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logAnalyticsDestinationType')]"
                              },
                              "dependsOn": [
                                "virtualNetwork"
                              ]
                            },
                            "virtualNetwork_roleAssignments": {
                              "copy": {
                                "name": "virtualNetwork_roleAssignments",
                                "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                              },
                              "type": "Microsoft.Authorization/roleAssignments",
                              "apiVersion": "2022-04-01",
                              "scope": "[format('Microsoft.Network/virtualNetworks/{0}', parameters('name'))]",
                              "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/virtualNetworks', parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                              "properties": {
                                "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                              },
                              "dependsOn": [
                                "virtualNetwork"
                              ]
                            },
                            "virtualNetwork_subnets": {
                              "copy": {
                                "name": "virtualNetwork_subnets",
                                "count": "[length(coalesce(parameters('subnets'), createArray()))]",
                                "mode": "serial",
                                "batchSize": 1
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2025-04-01",
                              "name": "[format('{0}-subnet-{1}', uniqueString(subscription().id, resourceGroup().id, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "virtualNetworkName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('subnets'), createArray())[copyIndex()].name]"
                                  },
                                  "addressPrefix": {
                                    "value": "[tryGet(coalesce(parameters('subnets'), createArray())[copyIndex()], 'addressPrefix')]"
                                  },
                                  "addressPrefixes": {
                                    "value": "[tryGet(coalesce(parameters('subnets'), createArray())[copyIndex()], 'addressPrefixes')]"
                                  },
                                  "ipamPoolPrefixAllocations": {
                                    "value": "[tryGet(coalesce(parameters('subnets'), createArray())[copyIndex()], 'ipamPoolPrefixAllocations')]"
                                  },
                                  "applicationGatewayIPConfigurations": {
                                    "value": "[tryGet(coalesce(parameters('subnets'), createArray())[copyIndex()], 'applicationGatewayIPConfigurations')]"
                                  },
                                  "delegation": {
                                    "value": "[tryGet(coalesce(parameters('subnets'), createArray())[copyIndex()], 'delegation')]"
                                  },
                                  "natGatewayResourceId": {
                                    "value": "[tryGet(coalesce(parameters('subnets'), createArray())[copyIndex()], 'natGatewayResourceId')]"
                                  },
                                  "networkSecurityGroupResourceId": {
                                    "value": "[tryGet(coalesce(parameters('subnets'), createArray())[copyIndex()], 'networkSecurityGroupResourceId')]"
                                  },
                                  "privateEndpointNetworkPolicies": {
                                    "value": "[tryGet(coalesce(parameters('subnets'), createArray())[copyIndex()], 'privateEndpointNetworkPolicies')]"
                                  },
                                  "privateLinkServiceNetworkPolicies": {
                                    "value": "[tryGet(coalesce(parameters('subnets'), createArray())[copyIndex()], 'privateLinkServiceNetworkPolicies')]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('subnets'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "routeTableResourceId": {
                                    "value": "[tryGet(coalesce(parameters('subnets'), createArray())[copyIndex()], 'routeTableResourceId')]"
                                  },
                                  "serviceEndpointPolicies": {
                                    "value": "[tryGet(coalesce(parameters('subnets'), createArray())[copyIndex()], 'serviceEndpointPolicies')]"
                                  },
                                  "serviceEndpoints": {
                                    "value": "[tryGet(coalesce(parameters('subnets'), createArray())[copyIndex()], 'serviceEndpoints')]"
                                  },
                                  "defaultOutboundAccess": {
                                    "value": "[tryGet(coalesce(parameters('subnets'), createArray())[copyIndex()], 'defaultOutboundAccess')]"
                                  },
                                  "sharingScope": {
                                    "value": "[tryGet(coalesce(parameters('subnets'), createArray())[copyIndex()], 'sharingScope')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.39.26.7824",
                                      "templateHash": "11087937906182478872"
                                    },
                                    "name": "Virtual Network Subnets",
                                    "description": "This module deploys a Virtual Network Subnet."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.2.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The Name of the subnet resource."
                                      }
                                    },
                                    "virtualNetworkName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent virtual network. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "addressPrefix": {
                                      "type": "string",
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Conditional. The address prefix for the subnet. Required if `addressPrefixes` is empty."
                                      }
                                    },
                                    "ipamPoolPrefixAllocations": {
                                      "type": "array",
                                      "items": {
                                        "type": "object"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Conditional. The address space for the subnet, deployed from IPAM Pool. Required if `addressPrefixes` and `addressPrefix` is empty."
                                      }
                                    },
                                    "networkSecurityGroupResourceId": {
                                      "type": "string",
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. The resource ID of the network security group to assign to the subnet."
                                      }
                                    },
                                    "routeTableResourceId": {
                                      "type": "string",
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. The resource ID of the route table to assign to the subnet."
                                      }
                                    },
                                    "serviceEndpoints": {
                                      "type": "array",
                                      "items": {
                                        "type": "string"
                                      },
                                      "defaultValue": [],
                                      "metadata": {
                                        "description": "Optional. The service endpoints to enable on the subnet."
                                      }
                                    },
                                    "delegation": {
                                      "type": "string",
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. The delegation to enable on the subnet."
                                      }
                                    },
                                    "natGatewayResourceId": {
                                      "type": "string",
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. The resource ID of the NAT Gateway to use for the subnet."
                                      }
                                    },
                                    "privateEndpointNetworkPolicies": {
                                      "type": "string",
                                      "nullable": true,
                                      "allowedValues": [
                                        "Disabled",
                                        "Enabled",
                                        "NetworkSecurityGroupEnabled",
                                        "RouteTableEnabled"
                                      ],
                                      "metadata": {
                                        "description": "Optional. Enable or disable apply network policies on private endpoint in the subnet."
                                      }
                                    },
                                    "privateLinkServiceNetworkPolicies": {
                                      "type": "string",
                                      "nullable": true,
                                      "allowedValues": [
                                        "Disabled",
                                        "Enabled"
                                      ],
                                      "metadata": {
                                        "description": "Optional. Enable or disable apply network policies on private link service in the subnet."
                                      }
                                    },
                                    "addressPrefixes": {
                                      "type": "array",
                                      "items": {
                                        "type": "string"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Conditional. List of address prefixes for the subnet. Required if `addressPrefix` is empty."
                                      }
                                    },
                                    "defaultOutboundAccess": {
                                      "type": "bool",
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Set this property to false to disable default outbound connectivity for all VMs in the subnet. This property can only be set at the time of subnet creation and cannot be updated for an existing subnet."
                                      }
                                    },
                                    "sharingScope": {
                                      "type": "string",
                                      "allowedValues": [
                                        "DelegatedServices",
                                        "Tenant"
                                      ],
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Set this property to Tenant to allow sharing the subnet with other subscriptions in your AAD tenant. This property can only be set if defaultOutboundAccess is set to false, both properties can only be set if the subnet is empty."
                                      }
                                    },
                                    "applicationGatewayIPConfigurations": {
                                      "type": "array",
                                      "defaultValue": [],
                                      "metadata": {
                                        "description": "Optional. Application gateway IP configurations of virtual network resource."
                                      }
                                    },
                                    "serviceEndpointPolicies": {
                                      "type": "array",
                                      "defaultValue": [],
                                      "metadata": {
                                        "description": "Optional. An array of service endpoint policies."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.network-virtualnetworksubnet.{0}.{1}', replace('-..--..-', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "virtualNetwork": {
                                      "existing": true,
                                      "type": "Microsoft.Network/virtualNetworks",
                                      "apiVersion": "2024-01-01",
                                      "name": "[parameters('virtualNetworkName')]"
                                    },
                                    "subnet": {
                                      "type": "Microsoft.Network/virtualNetworks/subnets",
                                      "apiVersion": "2024-05-01",
                                      "name": "[format('{0}/{1}', parameters('virtualNetworkName'), parameters('name'))]",
                                      "properties": {
                                        "copy": [
                                          {
                                            "name": "serviceEndpoints",
                                            "count": "[length(parameters('serviceEndpoints'))]",
                                            "input": {
                                              "service": "[parameters('serviceEndpoints')[copyIndex('serviceEndpoints')]]"
                                            }
                                          }
                                        ],
                                        "addressPrefix": "[parameters('addressPrefix')]",
                                        "addressPrefixes": "[parameters('addressPrefixes')]",
                                        "ipamPoolPrefixAllocations": "[parameters('ipamPoolPrefixAllocations')]",
                                        "networkSecurityGroup": "[if(not(empty(parameters('networkSecurityGroupResourceId'))), createObject('id', parameters('networkSecurityGroupResourceId')), null())]",
                                        "routeTable": "[if(not(empty(parameters('routeTableResourceId'))), createObject('id', parameters('routeTableResourceId')), null())]",
                                        "natGateway": "[if(not(empty(parameters('natGatewayResourceId'))), createObject('id', parameters('natGatewayResourceId')), null())]",
                                        "delegations": "[if(not(empty(parameters('delegation'))), createArray(createObject('name', parameters('delegation'), 'properties', createObject('serviceName', parameters('delegation')))), createArray())]",
                                        "privateEndpointNetworkPolicies": "[parameters('privateEndpointNetworkPolicies')]",
                                        "privateLinkServiceNetworkPolicies": "[parameters('privateLinkServiceNetworkPolicies')]",
                                        "applicationGatewayIPConfigurations": "[parameters('applicationGatewayIPConfigurations')]",
                                        "serviceEndpointPolicies": "[parameters('serviceEndpointPolicies')]",
                                        "defaultOutboundAccess": "[parameters('defaultOutboundAccess')]",
                                        "sharingScope": "[parameters('sharingScope')]"
                                      }
                                    },
                                    "subnet_roleAssignments": {
                                      "copy": {
                                        "name": "subnet_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/virtualNetworks/{0}/subnets/{1}', parameters('virtualNetworkName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('virtualNetworkName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "subnet"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group the virtual network peering was deployed into."
                                      },
                                      "value": "[resourceGroup().name]"
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the virtual network peering."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the virtual network peering."
                                      },
                                      "value": "[resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('virtualNetworkName'), parameters('name'))]"
                                    },
                                    "addressPrefix": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The address prefix for the subnet."
                                      },
                                      "value": "[coalesce(tryGet(reference('subnet'), 'addressPrefix'), '')]"
                                    },
                                    "addressPrefixes": {
                                      "type": "array",
                                      "metadata": {
                                        "description": "List of address prefixes for the subnet."
                                      },
                                      "value": "[coalesce(tryGet(reference('subnet'), 'addressPrefixes'), createArray())]"
                                    },
                                    "ipamPoolPrefixAllocations": {
                                      "type": "array",
                                      "metadata": {
                                        "description": "The IPAM pool prefix allocations for the subnet."
                                      },
                                      "value": "[coalesce(tryGet(reference('subnet'), 'ipamPoolPrefixAllocations'), createArray())]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "virtualNetwork"
                              ]
                            },
                            "virtualNetwork_peering_local": {
                              "copy": {
                                "name": "virtualNetwork_peering_local",
                                "count": "[length(coalesce(parameters('peerings'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2025-04-01",
                              "name": "[format('{0}-virtualNetworkPeering-local-{1}', uniqueString(subscription().id, resourceGroup().id, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "localVnetName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "remoteVirtualNetworkResourceId": {
                                    "value": "[coalesce(parameters('peerings'), createArray())[copyIndex()].remoteVirtualNetworkResourceId]"
                                  },
                                  "name": {
                                    "value": "[tryGet(coalesce(parameters('peerings'), createArray())[copyIndex()], 'name')]"
                                  },
                                  "allowForwardedTraffic": {
                                    "value": "[tryGet(coalesce(parameters('peerings'), createArray())[copyIndex()], 'allowForwardedTraffic')]"
                                  },
                                  "allowGatewayTransit": {
                                    "value": "[tryGet(coalesce(parameters('peerings'), createArray())[copyIndex()], 'allowGatewayTransit')]"
                                  },
                                  "allowVirtualNetworkAccess": {
                                    "value": "[tryGet(coalesce(parameters('peerings'), createArray())[copyIndex()], 'allowVirtualNetworkAccess')]"
                                  },
                                  "doNotVerifyRemoteGateways": {
                                    "value": "[tryGet(coalesce(parameters('peerings'), createArray())[copyIndex()], 'doNotVerifyRemoteGateways')]"
                                  },
                                  "useRemoteGateways": {
                                    "value": "[tryGet(coalesce(parameters('peerings'), createArray())[copyIndex()], 'useRemoteGateways')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.39.26.7824",
                                      "templateHash": "4173704498931603856"
                                    },
                                    "name": "Virtual Network Peerings",
                                    "description": "This module deploys a Virtual Network Peering."
                                  },
                                  "parameters": {
                                    "name": {
                                      "type": "string",
                                      "defaultValue": "[format('peer-{0}-{1}', parameters('localVnetName'), last(split(parameters('remoteVirtualNetworkResourceId'), '/')))]",
                                      "metadata": {
                                        "description": "Optional. The Name of VNET Peering resource. If not provided, default value will be localVnetName-remoteVnetName."
                                      }
                                    },
                                    "localVnetName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Virtual Network to add the peering to. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "remoteVirtualNetworkResourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The Resource ID of the VNet that is this Local VNet is being peered to. Should be in the format of a Resource ID."
                                      }
                                    },
                                    "allowForwardedTraffic": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Whether the forwarded traffic from the VMs in the local virtual network will be allowed/disallowed in remote virtual network. Default is true."
                                      }
                                    },
                                    "allowGatewayTransit": {
                                      "type": "bool",
                                      "defaultValue": false,
                                      "metadata": {
                                        "description": "Optional. If gateway links can be used in remote virtual networking to link to this virtual network. Default is false."
                                      }
                                    },
                                    "allowVirtualNetworkAccess": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Whether the VMs in the local virtual network space would be able to access the VMs in remote virtual network space. Default is true."
                                      }
                                    },
                                    "doNotVerifyRemoteGateways": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. If we need to verify the provisioning state of the remote gateway. Default is true."
                                      }
                                    },
                                    "useRemoteGateways": {
                                      "type": "bool",
                                      "defaultValue": false,
                                      "metadata": {
                                        "description": "Optional. If remote gateways can be used on this virtual network. If the flag is set to true, and allowGatewayTransit on remote peering is also true, virtual network will use gateways of remote virtual network for transit. Only one peering can have this flag set to true. This flag cannot be set if virtual network already has a gateway. Default is false."
                                      }
                                    }
                                  },
                                  "resources": [
                                    {
                                      "type": "Microsoft.Network/virtualNetworks/virtualNetworkPeerings",
                                      "apiVersion": "2024-01-01",
                                      "name": "[format('{0}/{1}', parameters('localVnetName'), parameters('name'))]",
                                      "properties": {
                                        "allowForwardedTraffic": "[parameters('allowForwardedTraffic')]",
                                        "allowGatewayTransit": "[parameters('allowGatewayTransit')]",
                                        "allowVirtualNetworkAccess": "[parameters('allowVirtualNetworkAccess')]",
                                        "doNotVerifyRemoteGateways": "[parameters('doNotVerifyRemoteGateways')]",
                                        "useRemoteGateways": "[parameters('useRemoteGateways')]",
                                        "remoteVirtualNetwork": {
                                          "id": "[parameters('remoteVirtualNetworkResourceId')]"
                                        }
                                      }
                                    }
                                  ],
                                  "outputs": {
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group the virtual network peering was deployed into."
                                      },
                                      "value": "[resourceGroup().name]"
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the virtual network peering."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the virtual network peering."
                                      },
                                      "value": "[resourceId('Microsoft.Network/virtualNetworks/virtualNetworkPeerings', parameters('localVnetName'), parameters('name'))]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "virtualNetwork",
                                "virtualNetwork_subnets"
                              ]
                            },
                            "virtualNetwork_peering_remote": {
                              "copy": {
                                "name": "virtualNetwork_peering_remote",
                                "count": "[length(coalesce(parameters('peerings'), createArray()))]"
                              },
                              "condition": "[coalesce(tryGet(coalesce(parameters('peerings'), createArray())[copyIndex()], 'remotePeeringEnabled'), false())]",
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2025-04-01",
                              "name": "[format('{0}-virtualNetworkPeering-remote-{1}', uniqueString(subscription().id, resourceGroup().id, parameters('location')), copyIndex())]",
                              "subscriptionId": "[split(coalesce(parameters('peerings'), createArray())[copyIndex()].remoteVirtualNetworkResourceId, '/')[2]]",
                              "resourceGroup": "[split(coalesce(parameters('peerings'), createArray())[copyIndex()].remoteVirtualNetworkResourceId, '/')[4]]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "localVnetName": {
                                    "value": "[last(split(coalesce(parameters('peerings'), createArray())[copyIndex()].remoteVirtualNetworkResourceId, '/'))]"
                                  },
                                  "remoteVirtualNetworkResourceId": {
                                    "value": "[resourceId('Microsoft.Network/virtualNetworks', parameters('name'))]"
                                  },
                                  "name": {
                                    "value": "[tryGet(coalesce(parameters('peerings'), createArray())[copyIndex()], 'remotePeeringName')]"
                                  },
                                  "allowForwardedTraffic": {
                                    "value": "[tryGet(coalesce(parameters('peerings'), createArray())[copyIndex()], 'remotePeeringAllowForwardedTraffic')]"
                                  },
                                  "allowGatewayTransit": {
                                    "value": "[tryGet(coalesce(parameters('peerings'), createArray())[copyIndex()], 'remotePeeringAllowGatewayTransit')]"
                                  },
                                  "allowVirtualNetworkAccess": {
                                    "value": "[tryGet(coalesce(parameters('peerings'), createArray())[copyIndex()], 'remotePeeringAllowVirtualNetworkAccess')]"
                                  },
                                  "doNotVerifyRemoteGateways": {
                                    "value": "[tryGet(coalesce(parameters('peerings'), createArray())[copyIndex()], 'remotePeeringDoNotVerifyRemoteGateways')]"
                                  },
                                  "useRemoteGateways": {
                                    "value": "[tryGet(coalesce(parameters('peerings'), createArray())[copyIndex()], 'remotePeeringUseRemoteGateways')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.39.26.7824",
                                      "templateHash": "4173704498931603856"
                                    },
                                    "name": "Virtual Network Peerings",
                                    "description": "This module deploys a Virtual Network Peering."
                                  },
                                  "parameters": {
                                    "name": {
                                      "type": "string",
                                      "defaultValue": "[format('peer-{0}-{1}', parameters('localVnetName'), last(split(parameters('remoteVirtualNetworkResourceId'), '/')))]",
                                      "metadata": {
                                        "description": "Optional. The Name of VNET Peering resource. If not provided, default value will be localVnetName-remoteVnetName."
                                      }
                                    },
                                    "localVnetName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Virtual Network to add the peering to. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "remoteVirtualNetworkResourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The Resource ID of the VNet that is this Local VNet is being peered to. Should be in the format of a Resource ID."
                                      }
                                    },
                                    "allowForwardedTraffic": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Whether the forwarded traffic from the VMs in the local virtual network will be allowed/disallowed in remote virtual network. Default is true."
                                      }
                                    },
                                    "allowGatewayTransit": {
                                      "type": "bool",
                                      "defaultValue": false,
                                      "metadata": {
                                        "description": "Optional. If gateway links can be used in remote virtual networking to link to this virtual network. Default is false."
                                      }
                                    },
                                    "allowVirtualNetworkAccess": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Whether the VMs in the local virtual network space would be able to access the VMs in remote virtual network space. Default is true."
                                      }
                                    },
                                    "doNotVerifyRemoteGateways": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. If we need to verify the provisioning state of the remote gateway. Default is true."
                                      }
                                    },
                                    "useRemoteGateways": {
                                      "type": "bool",
                                      "defaultValue": false,
                                      "metadata": {
                                        "description": "Optional. If remote gateways can be used on this virtual network. If the flag is set to true, and allowGatewayTransit on remote peering is also true, virtual network will use gateways of remote virtual network for transit. Only one peering can have this flag set to true. This flag cannot be set if virtual network already has a gateway. Default is false."
                                      }
                                    }
                                  },
                                  "resources": [
                                    {
                                      "type": "Microsoft.Network/virtualNetworks/virtualNetworkPeerings",
                                      "apiVersion": "2024-01-01",
                                      "name": "[format('{0}/{1}', parameters('localVnetName'), parameters('name'))]",
                                      "properties": {
                                        "allowForwardedTraffic": "[parameters('allowForwardedTraffic')]",
                                        "allowGatewayTransit": "[parameters('allowGatewayTransit')]",
                                        "allowVirtualNetworkAccess": "[parameters('allowVirtualNetworkAccess')]",
                                        "doNotVerifyRemoteGateways": "[parameters('doNotVerifyRemoteGateways')]",
                                        "useRemoteGateways": "[parameters('useRemoteGateways')]",
                                        "remoteVirtualNetwork": {
                                          "id": "[parameters('remoteVirtualNetworkResourceId')]"
                                        }
                                      }
                                    }
                                  ],
                                  "outputs": {
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group the virtual network peering was deployed into."
                                      },
                                      "value": "[resourceGroup().name]"
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the virtual network peering."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the virtual network peering."
                                      },
                                      "value": "[resourceId('Microsoft.Network/virtualNetworks/virtualNetworkPeerings', parameters('localVnetName'), parameters('name'))]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "virtualNetwork",
                                "virtualNetwork_subnets"
                              ]
                            }
                          },
                          "outputs": {
                            "resourceGroupName": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource group the virtual network was deployed into."
                              },
                              "value": "[resourceGroup().name]"
                            },
                            "resourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource ID of the virtual network."
                              },
                              "value": "[resourceId('Microsoft.Network/virtualNetworks', parameters('name'))]"
                            },
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the virtual network."
                              },
                              "value": "[parameters('name')]"
                            },
                            "subnetNames": {
                              "type": "array",
                              "metadata": {
                                "description": "The names of the deployed subnets."
                              },
                              "copy": {
                                "count": "[length(coalesce(parameters('subnets'), createArray()))]",
                                "input": "[reference(format('virtualNetwork_subnets[{0}]', copyIndex())).outputs.name.value]"
                              }
                            },
                            "subnetResourceIds": {
                              "type": "array",
                              "metadata": {
                                "description": "The resource IDs of the deployed subnets."
                              },
                              "copy": {
                                "count": "[length(coalesce(parameters('subnets'), createArray()))]",
                                "input": "[reference(format('virtualNetwork_subnets[{0}]', copyIndex())).outputs.resourceId.value]"
                              }
                            },
                            "location": {
                              "type": "string",
                              "metadata": {
                                "description": "The location the resource was deployed into."
                              },
                              "value": "[reference('virtualNetwork', '2024-05-01', 'full').location]"
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Resources/deployments', format('{0}-nsg', uniqueString(deployment().name, parameters('location'))))]"
                      ]
                    },
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "[format('{0}-dns-blob', uniqueString(deployment().name, parameters('location')))]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "name": {
                            "value": "[variables('dnsZoneNames').blob]"
                          },
                          "tags": {
                            "value": "[parameters('tags')]"
                          },
                          "enableTelemetry": {
                            "value": "[parameters('enableTelemetry')]"
                          },
                          "virtualNetworkLinks": {
                            "value": [
                              {
                                "virtualNetworkResourceId": "[reference(resourceId('Microsoft.Resources/deployments', format('{0}-vnet', uniqueString(deployment().name, parameters('location')))), '2025-04-01').outputs.resourceId.value]",
                                "registrationEnabled": false
                              }
                            ]
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.37.4.10188",
                              "templateHash": "17921343070314002065"
                            },
                            "name": "Private DNS Zones",
                            "description": "This module deploys a Private DNS zone."
                          },
                          "definitions": {
                            "aType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/A@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "aRecords": {
                                  "type": "array",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/A@2024-06-01#properties/properties/properties/aRecords"
                                    },
                                    "description": "Optional. The list of A records in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the A record."
                              }
                            },
                            "aaaaType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/AAAA@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "aaaaRecords": {
                                  "type": "array",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/AAAA@2024-06-01#properties/properties/properties/aaaaRecords"
                                    },
                                    "description": "Optional. The list of AAAA records in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the AAAA record."
                              }
                            },
                            "cnameType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/CNAME@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "cnameRecord": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/CNAME@2024-06-01#properties/properties/properties/cnameRecord"
                                    },
                                    "description": "Optional. The CNAME record in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the CNAME record."
                              }
                            },
                            "mxType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/MX@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "mxRecords": {
                                  "type": "array",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/MX@2024-06-01#properties/properties/properties/mxRecords"
                                    },
                                    "description": "Optional. The list of MX records in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the MX record."
                              }
                            },
                            "ptrType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/PTR@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "ptrRecords": {
                                  "type": "array",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/PTR@2024-06-01#properties/properties/properties/ptrRecords"
                                    },
                                    "description": "Optional. The list of PTR records in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the PTR record."
                              }
                            },
                            "soaType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/SOA@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "soaRecord": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/SOA@2024-06-01#properties/properties/properties/soaRecord"
                                    },
                                    "description": "Optional. The SOA record in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the SOA record."
                              }
                            },
                            "srvType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/SRV@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "srvRecords": {
                                  "type": "array",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/SRV@2024-06-01#properties/properties/properties/srvRecords"
                                    },
                                    "description": "Optional. The list of SRV records in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the SRV record."
                              }
                            },
                            "txtType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/TXT@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "txtRecords": {
                                  "type": "array",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/TXT@2024-06-01#properties/properties/properties/txtRecords"
                                    },
                                    "description": "Optional. The list of TXT records in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the TXT record."
                              }
                            },
                            "virtualNetworkLinkType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "minLength": 1,
                                  "maxLength": 80,
                                  "metadata": {
                                    "description": "Optional. The resource name."
                                  }
                                },
                                "virtualNetworkResourceId": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The resource ID of the virtual network to link."
                                  }
                                },
                                "location": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The Azure Region where the resource lives."
                                  }
                                },
                                "registrationEnabled": {
                                  "type": "bool",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Is auto-registration of virtual machine records in the virtual network in the Private DNS zone enabled?."
                                  }
                                },
                                "tags": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/virtualNetworkLinks@2024-06-01#properties/tags"
                                    },
                                    "description": "Optional. Resource tags."
                                  },
                                  "nullable": true
                                },
                                "resolutionPolicy": {
                                  "type": "string",
                                  "allowedValues": [
                                    "Default",
                                    "NxDomainRedirect"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The resolution type of the private-dns-zone fallback machanism."
                                  }
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the virtual network link."
                              }
                            },
                            "lockType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Specify the name of lock."
                                  }
                                },
                                "kind": {
                                  "type": "string",
                                  "allowedValues": [
                                    "CanNotDelete",
                                    "None",
                                    "ReadOnly"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Specify the type of lock."
                                  }
                                },
                                "notes": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Specify the notes of the lock."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for a lock.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.0"
                                }
                              }
                            },
                            "roleAssignmentType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                  }
                                },
                                "roleDefinitionIdOrName": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                  }
                                },
                                "principalId": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                  }
                                },
                                "principalType": {
                                  "type": "string",
                                  "allowedValues": [
                                    "Device",
                                    "ForeignGroup",
                                    "Group",
                                    "ServicePrincipal",
                                    "User"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The principal type of the assigned principal ID."
                                  }
                                },
                                "description": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The description of the role assignment."
                                  }
                                },
                                "condition": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                  }
                                },
                                "conditionVersion": {
                                  "type": "string",
                                  "allowedValues": [
                                    "2.0"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Version of the condition."
                                  }
                                },
                                "delegatedManagedIdentityResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The Resource Id of the delegated managed identity resource."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for a role assignment.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                }
                              }
                            }
                          },
                          "parameters": {
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. Private DNS zone name."
                              }
                            },
                            "a": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/aType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of A records."
                              }
                            },
                            "aaaa": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/aaaaType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of AAAA records."
                              }
                            },
                            "cname": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/cnameType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of CNAME records."
                              }
                            },
                            "mx": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/mxType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of MX records."
                              }
                            },
                            "ptr": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/ptrType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of PTR records."
                              }
                            },
                            "soa": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/soaType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of SOA records."
                              }
                            },
                            "srv": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/srvType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of SRV records."
                              }
                            },
                            "txt": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/txtType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of TXT records."
                              }
                            },
                            "virtualNetworkLinks": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/virtualNetworkLinkType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of custom objects describing vNet links of the DNS zone. Each object should contain properties 'virtualNetworkResourceId' and 'registrationEnabled'. The 'vnetResourceId' is a resource ID of a vNet to link, 'registrationEnabled' (bool) enables automatic DNS registration in the zone for the linked vNet."
                              }
                            },
                            "location": {
                              "type": "string",
                              "defaultValue": "global",
                              "metadata": {
                                "description": "Optional. The location of the PrivateDNSZone. Should be global."
                              }
                            },
                            "roleAssignments": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/roleAssignmentType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of role assignments to create."
                              }
                            },
                            "tags": {
                              "type": "object",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Tags of the resource."
                              }
                            },
                            "lock": {
                              "$ref": "#/definitions/lockType",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The lock settings of the service."
                              }
                            },
                            "enableTelemetry": {
                              "type": "bool",
                              "defaultValue": true,
                              "metadata": {
                                "description": "Optional. Enable/Disable usage telemetry for module."
                              }
                            }
                          },
                          "variables": {
                            "copy": [
                              {
                                "name": "formattedRoleAssignments",
                                "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                              }
                            ],
                            "builtInRoleNames": {
                              "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                              "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                              "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                              "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                              "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                              "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]"
                            },
                            "enableReferencedModulesTelemetry": false
                          },
                          "resources": {
                            "avmTelemetry": {
                              "condition": "[parameters('enableTelemetry')]",
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2024-03-01",
                              "name": "[format('46d3xbcp.res.network-privatednszone.{0}.{1}', replace('0.8.0', '.', '-'), substring(uniqueString(deployment().name, parameters('location')), 0, 4))]",
                              "properties": {
                                "mode": "Incremental",
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "contentVersion": "1.0.0.0",
                                  "resources": [],
                                  "outputs": {
                                    "telemetry": {
                                      "type": "String",
                                      "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                    }
                                  }
                                }
                              }
                            },
                            "privateDnsZone": {
                              "type": "Microsoft.Network/privateDnsZones",
                              "apiVersion": "2020-06-01",
                              "name": "[parameters('name')]",
                              "location": "[parameters('location')]",
                              "tags": "[parameters('tags')]"
                            },
                            "privateDnsZone_lock": {
                              "condition": "[and(not(empty(coalesce(parameters('lock'), createObject()))), not(equals(tryGet(parameters('lock'), 'kind'), 'None')))]",
                              "type": "Microsoft.Authorization/locks",
                              "apiVersion": "2020-05-01",
                              "scope": "[format('Microsoft.Network/privateDnsZones/{0}', parameters('name'))]",
                              "name": "[coalesce(tryGet(parameters('lock'), 'name'), format('lock-{0}', parameters('name')))]",
                              "properties": {
                                "level": "[coalesce(tryGet(parameters('lock'), 'kind'), '')]",
                                "notes": "[coalesce(tryGet(parameters('lock'), 'notes'), if(equals(tryGet(parameters('lock'), 'kind'), 'CanNotDelete'), 'Cannot delete resource or child resources.', 'Cannot delete or modify the resource or child resources.'))]"
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_roleAssignments": {
                              "copy": {
                                "name": "privateDnsZone_roleAssignments",
                                "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                              },
                              "type": "Microsoft.Authorization/roleAssignments",
                              "apiVersion": "2022-04-01",
                              "scope": "[format('Microsoft.Network/privateDnsZones/{0}', parameters('name'))]",
                              "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones', parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                              "properties": {
                                "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_A": {
                              "copy": {
                                "name": "privateDnsZone_A",
                                "count": "[length(coalesce(parameters('a'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-ARecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('a'), createArray())[copyIndex()].name]"
                                  },
                                  "aRecords": {
                                    "value": "[tryGet(coalesce(parameters('a'), createArray())[copyIndex()], 'aRecords')]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('a'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('a'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('a'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "12608084563401365743"
                                    },
                                    "name": "Private DNS Zone A record",
                                    "description": "This module deploys a Private DNS Zone A record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the A record."
                                      }
                                    },
                                    "aRecords": {
                                      "type": "array",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/A@2024-06-01#properties/properties/properties/aRecords"
                                        },
                                        "description": "Optional. The list of A records in the record set."
                                      },
                                      "nullable": true
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/A@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszonea.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "A": {
                                      "type": "Microsoft.Network/privateDnsZones/A",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "aRecords": "[parameters('aRecords')]",
                                        "metadata": "[parameters('metadata')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "A_roleAssignments": {
                                      "copy": {
                                        "name": "A_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/A/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/A', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "A"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed A record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed A record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/A', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed A record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_AAAA": {
                              "copy": {
                                "name": "privateDnsZone_AAAA",
                                "count": "[length(coalesce(parameters('aaaa'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-AAAARecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('aaaa'), createArray())[copyIndex()].name]"
                                  },
                                  "aaaaRecords": {
                                    "value": "[tryGet(coalesce(parameters('aaaa'), createArray())[copyIndex()], 'aaaaRecords')]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('aaaa'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('aaaa'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('aaaa'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "4881696097088567452"
                                    },
                                    "name": "Private DNS Zone AAAA record",
                                    "description": "This module deploys a Private DNS Zone AAAA record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the AAAA record."
                                      }
                                    },
                                    "aaaaRecords": {
                                      "type": "array",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/AAAA@2024-06-01#properties/properties/properties/aaaaRecords"
                                        },
                                        "description": "Optional. The list of AAAA records in the record set."
                                      },
                                      "nullable": true
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/AAAA@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszoneaaaa.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "AAAA": {
                                      "type": "Microsoft.Network/privateDnsZones/AAAA",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "aaaaRecords": "[parameters('aaaaRecords')]",
                                        "metadata": "[parameters('metadata')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "AAAA_roleAssignments": {
                                      "copy": {
                                        "name": "AAAA_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/AAAA/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/AAAA', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "AAAA"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed AAAA record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed AAAA record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/AAAA', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed AAAA record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_CNAME": {
                              "copy": {
                                "name": "privateDnsZone_CNAME",
                                "count": "[length(coalesce(parameters('cname'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-CNAMERecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('cname'), createArray())[copyIndex()].name]"
                                  },
                                  "cnameRecord": {
                                    "value": "[tryGet(coalesce(parameters('cname'), createArray())[copyIndex()], 'cnameRecord')]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('cname'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('cname'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('cname'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "13307906270868460967"
                                    },
                                    "name": "Private DNS Zone CNAME record",
                                    "description": "This module deploys a Private DNS Zone CNAME record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the CNAME record."
                                      }
                                    },
                                    "cnameRecord": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/CNAME@2024-06-01#properties/properties/properties/cnameRecord"
                                        },
                                        "description": "Optional. A CNAME record."
                                      },
                                      "nullable": true
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/CNAME@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszonecname.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "CNAME": {
                                      "type": "Microsoft.Network/privateDnsZones/CNAME",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "cnameRecord": "[parameters('cnameRecord')]",
                                        "metadata": "[parameters('metadata')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "CNAME_roleAssignments": {
                                      "copy": {
                                        "name": "CNAME_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/CNAME/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/CNAME', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "CNAME"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed CNAME record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed CNAME record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/CNAME', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed CNAME record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_MX": {
                              "copy": {
                                "name": "privateDnsZone_MX",
                                "count": "[length(coalesce(parameters('mx'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-MXRecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('mx'), createArray())[copyIndex()].name]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('mx'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "mxRecords": {
                                    "value": "[tryGet(coalesce(parameters('mx'), createArray())[copyIndex()], 'mxRecords')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('mx'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('mx'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "7946896598573056688"
                                    },
                                    "name": "Private DNS Zone MX record",
                                    "description": "This module deploys a Private DNS Zone MX record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the MX record."
                                      }
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/MX@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "mxRecords": {
                                      "type": "array",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/MX@2024-06-01#properties/properties/properties/mxRecords"
                                        },
                                        "description": "Optional. The list of MX records in the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszonemx.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "MX": {
                                      "type": "Microsoft.Network/privateDnsZones/MX",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "metadata": "[parameters('metadata')]",
                                        "mxRecords": "[parameters('mxRecords')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "MX_roleAssignments": {
                                      "copy": {
                                        "name": "MX_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/MX/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/MX', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "MX"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed MX record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed MX record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/MX', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed MX record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_PTR": {
                              "copy": {
                                "name": "privateDnsZone_PTR",
                                "count": "[length(coalesce(parameters('ptr'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-PTRRecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('ptr'), createArray())[copyIndex()].name]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('ptr'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "ptrRecords": {
                                    "value": "[tryGet(coalesce(parameters('ptr'), createArray())[copyIndex()], 'ptrRecords')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('ptr'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('ptr'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "7627375510490151870"
                                    },
                                    "name": "Private DNS Zone PTR record",
                                    "description": "This module deploys a Private DNS Zone PTR record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the PTR record."
                                      }
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/PTR@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ptrRecords": {
                                      "type": "array",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/PTR@2024-06-01#properties/properties/properties/ptrRecords"
                                        },
                                        "description": "Optional. The list of PTR records in the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszoneptr.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "PTR": {
                                      "type": "Microsoft.Network/privateDnsZones/PTR",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "metadata": "[parameters('metadata')]",
                                        "ptrRecords": "[parameters('ptrRecords')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "PTR_roleAssignments": {
                                      "copy": {
                                        "name": "PTR_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/PTR/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/PTR', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "PTR"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed PTR record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed PTR record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/PTR', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed PTR record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_SOA": {
                              "copy": {
                                "name": "privateDnsZone_SOA",
                                "count": "[length(coalesce(parameters('soa'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-SOARecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('soa'), createArray())[copyIndex()].name]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('soa'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "soaRecord": {
                                    "value": "[tryGet(coalesce(parameters('soa'), createArray())[copyIndex()], 'soaRecord')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('soa'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('soa'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "16709883266329935583"
                                    },
                                    "name": "Private DNS Zone SOA record",
                                    "description": "This module deploys a Private DNS Zone SOA record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the SOA record."
                                      }
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/SOA@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "soaRecord": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/SOA@2024-06-01#properties/properties/properties/soaRecord"
                                        },
                                        "description": "Optional. A SOA record."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszonesoa.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "SOA": {
                                      "type": "Microsoft.Network/privateDnsZones/SOA",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "metadata": "[parameters('metadata')]",
                                        "soaRecord": "[parameters('soaRecord')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "SOA_roleAssignments": {
                                      "copy": {
                                        "name": "SOA_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/SOA/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/SOA', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "SOA"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed SOA record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed SOA record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/SOA', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed SOA record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_SRV": {
                              "copy": {
                                "name": "privateDnsZone_SRV",
                                "count": "[length(coalesce(parameters('srv'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-SRVRecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('srv'), createArray())[copyIndex()].name]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('srv'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "srvRecords": {
                                    "value": "[tryGet(coalesce(parameters('srv'), createArray())[copyIndex()], 'srvRecords')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('srv'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('srv'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "8123422724272920495"
                                    },
                                    "name": "Private DNS Zone SRV record",
                                    "description": "This module deploys a Private DNS Zone SRV record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the SRV record."
                                      }
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/SRV@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "srvRecords": {
                                      "type": "array",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/SRV@2024-06-01#properties/properties/properties/srvRecords"
                                        },
                                        "description": "Optional. The list of SRV records in the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszonesrv.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "SRV": {
                                      "type": "Microsoft.Network/privateDnsZones/SRV",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "metadata": "[parameters('metadata')]",
                                        "srvRecords": "[parameters('srvRecords')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "SRV_roleAssignments": {
                                      "copy": {
                                        "name": "SRV_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/SRV/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/SRV', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "SRV"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed SRV record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed SRV record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/SRV', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed SRV record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_TXT": {
                              "copy": {
                                "name": "privateDnsZone_TXT",
                                "count": "[length(coalesce(parameters('txt'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-TXTRecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('txt'), createArray())[copyIndex()].name]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('txt'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "txtRecords": {
                                    "value": "[tryGet(coalesce(parameters('txt'), createArray())[copyIndex()], 'txtRecords')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('txt'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('txt'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "17170531000135004092"
                                    },
                                    "name": "Private DNS Zone TXT record",
                                    "description": "This module deploys a Private DNS Zone TXT record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the TXT record."
                                      }
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/TXT@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "txtRecords": {
                                      "type": "array",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/TXT@2024-06-01#properties/properties/properties/txtRecords"
                                        },
                                        "description": "Optional. The list of TXT records in the record set."
                                      },
                                      "nullable": true
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszonetxt.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "TXT": {
                                      "type": "Microsoft.Network/privateDnsZones/TXT",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "metadata": "[parameters('metadata')]",
                                        "ttl": "[parameters('ttl')]",
                                        "txtRecords": "[parameters('txtRecords')]"
                                      }
                                    },
                                    "TXT_roleAssignments": {
                                      "copy": {
                                        "name": "TXT_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/TXT/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/TXT', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "TXT"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed TXT record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed TXT record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/TXT', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed TXT record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_virtualNetworkLinks": {
                              "copy": {
                                "name": "privateDnsZone_virtualNetworkLinks",
                                "count": "[length(coalesce(parameters('virtualNetworkLinks'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-VNetLink-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()], 'name'), format('{0}-vnetlink', last(split(coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()].virtualNetworkResourceId, '/'))))]"
                                  },
                                  "virtualNetworkResourceId": {
                                    "value": "[coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()].virtualNetworkResourceId]"
                                  },
                                  "location": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()], 'location'), 'global')]"
                                  },
                                  "registrationEnabled": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()], 'registrationEnabled'), false())]"
                                  },
                                  "tags": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()], 'tags'), parameters('tags'))]"
                                  },
                                  "resolutionPolicy": {
                                    "value": "[tryGet(coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()], 'resolutionPolicy')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "517173107480898390"
                                    },
                                    "name": "Private DNS Zone Virtual Network Link",
                                    "description": "This module deploys a Private DNS Zone Virtual Network Link."
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "defaultValue": "[format('{0}-vnetlink', last(split(parameters('virtualNetworkResourceId'), '/')))]",
                                      "metadata": {
                                        "description": "Optional. The name of the virtual network link."
                                      }
                                    },
                                    "location": {
                                      "type": "string",
                                      "defaultValue": "global",
                                      "metadata": {
                                        "description": "Optional. The location of the PrivateDNSZone. Should be global."
                                      }
                                    },
                                    "tags": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/virtualNetworkLinks@2024-06-01#properties/tags"
                                        },
                                        "description": "Optional. Tags of the resource."
                                      },
                                      "nullable": true
                                    },
                                    "registrationEnabled": {
                                      "type": "bool",
                                      "defaultValue": false,
                                      "metadata": {
                                        "description": "Optional. Is auto-registration of virtual machine records in the virtual network in the Private DNS zone enabled?."
                                      }
                                    },
                                    "virtualNetworkResourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. Link to another virtual network resource ID."
                                      }
                                    },
                                    "resolutionPolicy": {
                                      "type": "string",
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. The resolution policy on the virtual network link. Only applicable for virtual network links to privatelink zones, and for A,AAAA,CNAME queries. When set to `NxDomainRedirect`, Azure DNS resolver falls back to public resolution if private dns query resolution results in non-existent domain response. `Default` is configured as the default option."
                                      }
                                    }
                                  },
                                  "resources": {
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "virtualNetworkLink": {
                                      "type": "Microsoft.Network/privateDnsZones/virtualNetworkLinks",
                                      "apiVersion": "2024-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "location": "[parameters('location')]",
                                      "tags": "[parameters('tags')]",
                                      "properties": {
                                        "registrationEnabled": "[parameters('registrationEnabled')]",
                                        "virtualNetwork": {
                                          "id": "[parameters('virtualNetworkResourceId')]"
                                        },
                                        "resolutionPolicy": "[parameters('resolutionPolicy')]"
                                      }
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed virtual network link."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed virtual network link."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/virtualNetworkLinks', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed virtual network link."
                                      },
                                      "value": "[resourceGroup().name]"
                                    },
                                    "location": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The location the resource was deployed into."
                                      },
                                      "value": "[reference('virtualNetworkLink', '2024-06-01', 'full').location]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            }
                          },
                          "outputs": {
                            "resourceGroupName": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource group the private DNS zone was deployed into."
                              },
                              "value": "[resourceGroup().name]"
                            },
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the private DNS zone."
                              },
                              "value": "[parameters('name')]"
                            },
                            "resourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource ID of the private DNS zone."
                              },
                              "value": "[resourceId('Microsoft.Network/privateDnsZones', parameters('name'))]"
                            },
                            "location": {
                              "type": "string",
                              "metadata": {
                                "description": "The location the resource was deployed into."
                              },
                              "value": "[reference('privateDnsZone', '2020-06-01', 'full').location]"
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Resources/deployments', format('{0}-vnet', uniqueString(deployment().name, parameters('location'))))]"
                      ]
                    },
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "[format('{0}-dns-dfs', uniqueString(deployment().name, parameters('location')))]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "name": {
                            "value": "[variables('dnsZoneNames').dfs]"
                          },
                          "tags": {
                            "value": "[parameters('tags')]"
                          },
                          "enableTelemetry": {
                            "value": "[parameters('enableTelemetry')]"
                          },
                          "virtualNetworkLinks": {
                            "value": [
                              {
                                "virtualNetworkResourceId": "[reference(resourceId('Microsoft.Resources/deployments', format('{0}-vnet', uniqueString(deployment().name, parameters('location')))), '2025-04-01').outputs.resourceId.value]",
                                "registrationEnabled": false
                              }
                            ]
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.37.4.10188",
                              "templateHash": "17921343070314002065"
                            },
                            "name": "Private DNS Zones",
                            "description": "This module deploys a Private DNS zone."
                          },
                          "definitions": {
                            "aType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/A@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "aRecords": {
                                  "type": "array",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/A@2024-06-01#properties/properties/properties/aRecords"
                                    },
                                    "description": "Optional. The list of A records in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the A record."
                              }
                            },
                            "aaaaType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/AAAA@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "aaaaRecords": {
                                  "type": "array",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/AAAA@2024-06-01#properties/properties/properties/aaaaRecords"
                                    },
                                    "description": "Optional. The list of AAAA records in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the AAAA record."
                              }
                            },
                            "cnameType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/CNAME@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "cnameRecord": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/CNAME@2024-06-01#properties/properties/properties/cnameRecord"
                                    },
                                    "description": "Optional. The CNAME record in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the CNAME record."
                              }
                            },
                            "mxType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/MX@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "mxRecords": {
                                  "type": "array",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/MX@2024-06-01#properties/properties/properties/mxRecords"
                                    },
                                    "description": "Optional. The list of MX records in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the MX record."
                              }
                            },
                            "ptrType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/PTR@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "ptrRecords": {
                                  "type": "array",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/PTR@2024-06-01#properties/properties/properties/ptrRecords"
                                    },
                                    "description": "Optional. The list of PTR records in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the PTR record."
                              }
                            },
                            "soaType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/SOA@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "soaRecord": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/SOA@2024-06-01#properties/properties/properties/soaRecord"
                                    },
                                    "description": "Optional. The SOA record in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the SOA record."
                              }
                            },
                            "srvType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/SRV@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "srvRecords": {
                                  "type": "array",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/SRV@2024-06-01#properties/properties/properties/srvRecords"
                                    },
                                    "description": "Optional. The list of SRV records in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the SRV record."
                              }
                            },
                            "txtType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/TXT@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "txtRecords": {
                                  "type": "array",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/TXT@2024-06-01#properties/properties/properties/txtRecords"
                                    },
                                    "description": "Optional. The list of TXT records in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the TXT record."
                              }
                            },
                            "virtualNetworkLinkType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "minLength": 1,
                                  "maxLength": 80,
                                  "metadata": {
                                    "description": "Optional. The resource name."
                                  }
                                },
                                "virtualNetworkResourceId": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The resource ID of the virtual network to link."
                                  }
                                },
                                "location": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The Azure Region where the resource lives."
                                  }
                                },
                                "registrationEnabled": {
                                  "type": "bool",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Is auto-registration of virtual machine records in the virtual network in the Private DNS zone enabled?."
                                  }
                                },
                                "tags": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/virtualNetworkLinks@2024-06-01#properties/tags"
                                    },
                                    "description": "Optional. Resource tags."
                                  },
                                  "nullable": true
                                },
                                "resolutionPolicy": {
                                  "type": "string",
                                  "allowedValues": [
                                    "Default",
                                    "NxDomainRedirect"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The resolution type of the private-dns-zone fallback machanism."
                                  }
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the virtual network link."
                              }
                            },
                            "lockType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Specify the name of lock."
                                  }
                                },
                                "kind": {
                                  "type": "string",
                                  "allowedValues": [
                                    "CanNotDelete",
                                    "None",
                                    "ReadOnly"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Specify the type of lock."
                                  }
                                },
                                "notes": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Specify the notes of the lock."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for a lock.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.0"
                                }
                              }
                            },
                            "roleAssignmentType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                  }
                                },
                                "roleDefinitionIdOrName": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                  }
                                },
                                "principalId": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                  }
                                },
                                "principalType": {
                                  "type": "string",
                                  "allowedValues": [
                                    "Device",
                                    "ForeignGroup",
                                    "Group",
                                    "ServicePrincipal",
                                    "User"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The principal type of the assigned principal ID."
                                  }
                                },
                                "description": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The description of the role assignment."
                                  }
                                },
                                "condition": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                  }
                                },
                                "conditionVersion": {
                                  "type": "string",
                                  "allowedValues": [
                                    "2.0"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Version of the condition."
                                  }
                                },
                                "delegatedManagedIdentityResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The Resource Id of the delegated managed identity resource."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for a role assignment.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                }
                              }
                            }
                          },
                          "parameters": {
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. Private DNS zone name."
                              }
                            },
                            "a": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/aType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of A records."
                              }
                            },
                            "aaaa": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/aaaaType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of AAAA records."
                              }
                            },
                            "cname": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/cnameType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of CNAME records."
                              }
                            },
                            "mx": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/mxType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of MX records."
                              }
                            },
                            "ptr": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/ptrType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of PTR records."
                              }
                            },
                            "soa": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/soaType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of SOA records."
                              }
                            },
                            "srv": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/srvType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of SRV records."
                              }
                            },
                            "txt": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/txtType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of TXT records."
                              }
                            },
                            "virtualNetworkLinks": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/virtualNetworkLinkType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of custom objects describing vNet links of the DNS zone. Each object should contain properties 'virtualNetworkResourceId' and 'registrationEnabled'. The 'vnetResourceId' is a resource ID of a vNet to link, 'registrationEnabled' (bool) enables automatic DNS registration in the zone for the linked vNet."
                              }
                            },
                            "location": {
                              "type": "string",
                              "defaultValue": "global",
                              "metadata": {
                                "description": "Optional. The location of the PrivateDNSZone. Should be global."
                              }
                            },
                            "roleAssignments": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/roleAssignmentType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of role assignments to create."
                              }
                            },
                            "tags": {
                              "type": "object",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Tags of the resource."
                              }
                            },
                            "lock": {
                              "$ref": "#/definitions/lockType",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The lock settings of the service."
                              }
                            },
                            "enableTelemetry": {
                              "type": "bool",
                              "defaultValue": true,
                              "metadata": {
                                "description": "Optional. Enable/Disable usage telemetry for module."
                              }
                            }
                          },
                          "variables": {
                            "copy": [
                              {
                                "name": "formattedRoleAssignments",
                                "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                              }
                            ],
                            "builtInRoleNames": {
                              "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                              "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                              "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                              "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                              "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                              "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]"
                            },
                            "enableReferencedModulesTelemetry": false
                          },
                          "resources": {
                            "avmTelemetry": {
                              "condition": "[parameters('enableTelemetry')]",
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2024-03-01",
                              "name": "[format('46d3xbcp.res.network-privatednszone.{0}.{1}', replace('0.8.0', '.', '-'), substring(uniqueString(deployment().name, parameters('location')), 0, 4))]",
                              "properties": {
                                "mode": "Incremental",
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "contentVersion": "1.0.0.0",
                                  "resources": [],
                                  "outputs": {
                                    "telemetry": {
                                      "type": "String",
                                      "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                    }
                                  }
                                }
                              }
                            },
                            "privateDnsZone": {
                              "type": "Microsoft.Network/privateDnsZones",
                              "apiVersion": "2020-06-01",
                              "name": "[parameters('name')]",
                              "location": "[parameters('location')]",
                              "tags": "[parameters('tags')]"
                            },
                            "privateDnsZone_lock": {
                              "condition": "[and(not(empty(coalesce(parameters('lock'), createObject()))), not(equals(tryGet(parameters('lock'), 'kind'), 'None')))]",
                              "type": "Microsoft.Authorization/locks",
                              "apiVersion": "2020-05-01",
                              "scope": "[format('Microsoft.Network/privateDnsZones/{0}', parameters('name'))]",
                              "name": "[coalesce(tryGet(parameters('lock'), 'name'), format('lock-{0}', parameters('name')))]",
                              "properties": {
                                "level": "[coalesce(tryGet(parameters('lock'), 'kind'), '')]",
                                "notes": "[coalesce(tryGet(parameters('lock'), 'notes'), if(equals(tryGet(parameters('lock'), 'kind'), 'CanNotDelete'), 'Cannot delete resource or child resources.', 'Cannot delete or modify the resource or child resources.'))]"
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_roleAssignments": {
                              "copy": {
                                "name": "privateDnsZone_roleAssignments",
                                "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                              },
                              "type": "Microsoft.Authorization/roleAssignments",
                              "apiVersion": "2022-04-01",
                              "scope": "[format('Microsoft.Network/privateDnsZones/{0}', parameters('name'))]",
                              "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones', parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                              "properties": {
                                "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_A": {
                              "copy": {
                                "name": "privateDnsZone_A",
                                "count": "[length(coalesce(parameters('a'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-ARecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('a'), createArray())[copyIndex()].name]"
                                  },
                                  "aRecords": {
                                    "value": "[tryGet(coalesce(parameters('a'), createArray())[copyIndex()], 'aRecords')]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('a'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('a'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('a'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "12608084563401365743"
                                    },
                                    "name": "Private DNS Zone A record",
                                    "description": "This module deploys a Private DNS Zone A record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the A record."
                                      }
                                    },
                                    "aRecords": {
                                      "type": "array",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/A@2024-06-01#properties/properties/properties/aRecords"
                                        },
                                        "description": "Optional. The list of A records in the record set."
                                      },
                                      "nullable": true
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/A@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszonea.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "A": {
                                      "type": "Microsoft.Network/privateDnsZones/A",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "aRecords": "[parameters('aRecords')]",
                                        "metadata": "[parameters('metadata')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "A_roleAssignments": {
                                      "copy": {
                                        "name": "A_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/A/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/A', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "A"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed A record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed A record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/A', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed A record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_AAAA": {
                              "copy": {
                                "name": "privateDnsZone_AAAA",
                                "count": "[length(coalesce(parameters('aaaa'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-AAAARecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('aaaa'), createArray())[copyIndex()].name]"
                                  },
                                  "aaaaRecords": {
                                    "value": "[tryGet(coalesce(parameters('aaaa'), createArray())[copyIndex()], 'aaaaRecords')]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('aaaa'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('aaaa'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('aaaa'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "4881696097088567452"
                                    },
                                    "name": "Private DNS Zone AAAA record",
                                    "description": "This module deploys a Private DNS Zone AAAA record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the AAAA record."
                                      }
                                    },
                                    "aaaaRecords": {
                                      "type": "array",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/AAAA@2024-06-01#properties/properties/properties/aaaaRecords"
                                        },
                                        "description": "Optional. The list of AAAA records in the record set."
                                      },
                                      "nullable": true
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/AAAA@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszoneaaaa.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "AAAA": {
                                      "type": "Microsoft.Network/privateDnsZones/AAAA",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "aaaaRecords": "[parameters('aaaaRecords')]",
                                        "metadata": "[parameters('metadata')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "AAAA_roleAssignments": {
                                      "copy": {
                                        "name": "AAAA_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/AAAA/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/AAAA', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "AAAA"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed AAAA record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed AAAA record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/AAAA', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed AAAA record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_CNAME": {
                              "copy": {
                                "name": "privateDnsZone_CNAME",
                                "count": "[length(coalesce(parameters('cname'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-CNAMERecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('cname'), createArray())[copyIndex()].name]"
                                  },
                                  "cnameRecord": {
                                    "value": "[tryGet(coalesce(parameters('cname'), createArray())[copyIndex()], 'cnameRecord')]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('cname'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('cname'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('cname'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "13307906270868460967"
                                    },
                                    "name": "Private DNS Zone CNAME record",
                                    "description": "This module deploys a Private DNS Zone CNAME record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the CNAME record."
                                      }
                                    },
                                    "cnameRecord": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/CNAME@2024-06-01#properties/properties/properties/cnameRecord"
                                        },
                                        "description": "Optional. A CNAME record."
                                      },
                                      "nullable": true
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/CNAME@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszonecname.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "CNAME": {
                                      "type": "Microsoft.Network/privateDnsZones/CNAME",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "cnameRecord": "[parameters('cnameRecord')]",
                                        "metadata": "[parameters('metadata')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "CNAME_roleAssignments": {
                                      "copy": {
                                        "name": "CNAME_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/CNAME/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/CNAME', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "CNAME"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed CNAME record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed CNAME record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/CNAME', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed CNAME record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_MX": {
                              "copy": {
                                "name": "privateDnsZone_MX",
                                "count": "[length(coalesce(parameters('mx'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-MXRecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('mx'), createArray())[copyIndex()].name]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('mx'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "mxRecords": {
                                    "value": "[tryGet(coalesce(parameters('mx'), createArray())[copyIndex()], 'mxRecords')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('mx'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('mx'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "7946896598573056688"
                                    },
                                    "name": "Private DNS Zone MX record",
                                    "description": "This module deploys a Private DNS Zone MX record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the MX record."
                                      }
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/MX@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "mxRecords": {
                                      "type": "array",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/MX@2024-06-01#properties/properties/properties/mxRecords"
                                        },
                                        "description": "Optional. The list of MX records in the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszonemx.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "MX": {
                                      "type": "Microsoft.Network/privateDnsZones/MX",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "metadata": "[parameters('metadata')]",
                                        "mxRecords": "[parameters('mxRecords')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "MX_roleAssignments": {
                                      "copy": {
                                        "name": "MX_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/MX/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/MX', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "MX"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed MX record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed MX record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/MX', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed MX record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_PTR": {
                              "copy": {
                                "name": "privateDnsZone_PTR",
                                "count": "[length(coalesce(parameters('ptr'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-PTRRecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('ptr'), createArray())[copyIndex()].name]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('ptr'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "ptrRecords": {
                                    "value": "[tryGet(coalesce(parameters('ptr'), createArray())[copyIndex()], 'ptrRecords')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('ptr'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('ptr'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "7627375510490151870"
                                    },
                                    "name": "Private DNS Zone PTR record",
                                    "description": "This module deploys a Private DNS Zone PTR record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the PTR record."
                                      }
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/PTR@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ptrRecords": {
                                      "type": "array",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/PTR@2024-06-01#properties/properties/properties/ptrRecords"
                                        },
                                        "description": "Optional. The list of PTR records in the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszoneptr.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "PTR": {
                                      "type": "Microsoft.Network/privateDnsZones/PTR",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "metadata": "[parameters('metadata')]",
                                        "ptrRecords": "[parameters('ptrRecords')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "PTR_roleAssignments": {
                                      "copy": {
                                        "name": "PTR_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/PTR/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/PTR', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "PTR"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed PTR record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed PTR record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/PTR', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed PTR record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_SOA": {
                              "copy": {
                                "name": "privateDnsZone_SOA",
                                "count": "[length(coalesce(parameters('soa'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-SOARecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('soa'), createArray())[copyIndex()].name]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('soa'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "soaRecord": {
                                    "value": "[tryGet(coalesce(parameters('soa'), createArray())[copyIndex()], 'soaRecord')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('soa'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('soa'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "16709883266329935583"
                                    },
                                    "name": "Private DNS Zone SOA record",
                                    "description": "This module deploys a Private DNS Zone SOA record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the SOA record."
                                      }
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/SOA@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "soaRecord": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/SOA@2024-06-01#properties/properties/properties/soaRecord"
                                        },
                                        "description": "Optional. A SOA record."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszonesoa.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "SOA": {
                                      "type": "Microsoft.Network/privateDnsZones/SOA",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "metadata": "[parameters('metadata')]",
                                        "soaRecord": "[parameters('soaRecord')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "SOA_roleAssignments": {
                                      "copy": {
                                        "name": "SOA_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/SOA/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/SOA', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "SOA"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed SOA record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed SOA record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/SOA', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed SOA record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_SRV": {
                              "copy": {
                                "name": "privateDnsZone_SRV",
                                "count": "[length(coalesce(parameters('srv'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-SRVRecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('srv'), createArray())[copyIndex()].name]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('srv'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "srvRecords": {
                                    "value": "[tryGet(coalesce(parameters('srv'), createArray())[copyIndex()], 'srvRecords')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('srv'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('srv'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "8123422724272920495"
                                    },
                                    "name": "Private DNS Zone SRV record",
                                    "description": "This module deploys a Private DNS Zone SRV record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the SRV record."
                                      }
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/SRV@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "srvRecords": {
                                      "type": "array",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/SRV@2024-06-01#properties/properties/properties/srvRecords"
                                        },
                                        "description": "Optional. The list of SRV records in the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszonesrv.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "SRV": {
                                      "type": "Microsoft.Network/privateDnsZones/SRV",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "metadata": "[parameters('metadata')]",
                                        "srvRecords": "[parameters('srvRecords')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "SRV_roleAssignments": {
                                      "copy": {
                                        "name": "SRV_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/SRV/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/SRV', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "SRV"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed SRV record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed SRV record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/SRV', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed SRV record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_TXT": {
                              "copy": {
                                "name": "privateDnsZone_TXT",
                                "count": "[length(coalesce(parameters('txt'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-TXTRecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('txt'), createArray())[copyIndex()].name]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('txt'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "txtRecords": {
                                    "value": "[tryGet(coalesce(parameters('txt'), createArray())[copyIndex()], 'txtRecords')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('txt'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('txt'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "17170531000135004092"
                                    },
                                    "name": "Private DNS Zone TXT record",
                                    "description": "This module deploys a Private DNS Zone TXT record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the TXT record."
                                      }
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/TXT@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "txtRecords": {
                                      "type": "array",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/TXT@2024-06-01#properties/properties/properties/txtRecords"
                                        },
                                        "description": "Optional. The list of TXT records in the record set."
                                      },
                                      "nullable": true
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszonetxt.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "TXT": {
                                      "type": "Microsoft.Network/privateDnsZones/TXT",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "metadata": "[parameters('metadata')]",
                                        "ttl": "[parameters('ttl')]",
                                        "txtRecords": "[parameters('txtRecords')]"
                                      }
                                    },
                                    "TXT_roleAssignments": {
                                      "copy": {
                                        "name": "TXT_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/TXT/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/TXT', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "TXT"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed TXT record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed TXT record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/TXT', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed TXT record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_virtualNetworkLinks": {
                              "copy": {
                                "name": "privateDnsZone_virtualNetworkLinks",
                                "count": "[length(coalesce(parameters('virtualNetworkLinks'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-VNetLink-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()], 'name'), format('{0}-vnetlink', last(split(coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()].virtualNetworkResourceId, '/'))))]"
                                  },
                                  "virtualNetworkResourceId": {
                                    "value": "[coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()].virtualNetworkResourceId]"
                                  },
                                  "location": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()], 'location'), 'global')]"
                                  },
                                  "registrationEnabled": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()], 'registrationEnabled'), false())]"
                                  },
                                  "tags": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()], 'tags'), parameters('tags'))]"
                                  },
                                  "resolutionPolicy": {
                                    "value": "[tryGet(coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()], 'resolutionPolicy')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "517173107480898390"
                                    },
                                    "name": "Private DNS Zone Virtual Network Link",
                                    "description": "This module deploys a Private DNS Zone Virtual Network Link."
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "defaultValue": "[format('{0}-vnetlink', last(split(parameters('virtualNetworkResourceId'), '/')))]",
                                      "metadata": {
                                        "description": "Optional. The name of the virtual network link."
                                      }
                                    },
                                    "location": {
                                      "type": "string",
                                      "defaultValue": "global",
                                      "metadata": {
                                        "description": "Optional. The location of the PrivateDNSZone. Should be global."
                                      }
                                    },
                                    "tags": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/virtualNetworkLinks@2024-06-01#properties/tags"
                                        },
                                        "description": "Optional. Tags of the resource."
                                      },
                                      "nullable": true
                                    },
                                    "registrationEnabled": {
                                      "type": "bool",
                                      "defaultValue": false,
                                      "metadata": {
                                        "description": "Optional. Is auto-registration of virtual machine records in the virtual network in the Private DNS zone enabled?."
                                      }
                                    },
                                    "virtualNetworkResourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. Link to another virtual network resource ID."
                                      }
                                    },
                                    "resolutionPolicy": {
                                      "type": "string",
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. The resolution policy on the virtual network link. Only applicable for virtual network links to privatelink zones, and for A,AAAA,CNAME queries. When set to `NxDomainRedirect`, Azure DNS resolver falls back to public resolution if private dns query resolution results in non-existent domain response. `Default` is configured as the default option."
                                      }
                                    }
                                  },
                                  "resources": {
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "virtualNetworkLink": {
                                      "type": "Microsoft.Network/privateDnsZones/virtualNetworkLinks",
                                      "apiVersion": "2024-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "location": "[parameters('location')]",
                                      "tags": "[parameters('tags')]",
                                      "properties": {
                                        "registrationEnabled": "[parameters('registrationEnabled')]",
                                        "virtualNetwork": {
                                          "id": "[parameters('virtualNetworkResourceId')]"
                                        },
                                        "resolutionPolicy": "[parameters('resolutionPolicy')]"
                                      }
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed virtual network link."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed virtual network link."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/virtualNetworkLinks', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed virtual network link."
                                      },
                                      "value": "[resourceGroup().name]"
                                    },
                                    "location": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The location the resource was deployed into."
                                      },
                                      "value": "[reference('virtualNetworkLink', '2024-06-01', 'full').location]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            }
                          },
                          "outputs": {
                            "resourceGroupName": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource group the private DNS zone was deployed into."
                              },
                              "value": "[resourceGroup().name]"
                            },
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the private DNS zone."
                              },
                              "value": "[parameters('name')]"
                            },
                            "resourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource ID of the private DNS zone."
                              },
                              "value": "[resourceId('Microsoft.Network/privateDnsZones', parameters('name'))]"
                            },
                            "location": {
                              "type": "string",
                              "metadata": {
                                "description": "The location the resource was deployed into."
                              },
                              "value": "[reference('privateDnsZone', '2020-06-01', 'full').location]"
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Resources/deployments', format('{0}-vnet', uniqueString(deployment().name, parameters('location'))))]"
                      ]
                    },
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "[format('{0}-dns-vault', uniqueString(deployment().name, parameters('location')))]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "name": {
                            "value": "[variables('dnsZoneNames').vault]"
                          },
                          "tags": {
                            "value": "[parameters('tags')]"
                          },
                          "enableTelemetry": {
                            "value": "[parameters('enableTelemetry')]"
                          },
                          "virtualNetworkLinks": {
                            "value": [
                              {
                                "virtualNetworkResourceId": "[reference(resourceId('Microsoft.Resources/deployments', format('{0}-vnet', uniqueString(deployment().name, parameters('location')))), '2025-04-01').outputs.resourceId.value]",
                                "registrationEnabled": false
                              }
                            ]
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.37.4.10188",
                              "templateHash": "17921343070314002065"
                            },
                            "name": "Private DNS Zones",
                            "description": "This module deploys a Private DNS zone."
                          },
                          "definitions": {
                            "aType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/A@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "aRecords": {
                                  "type": "array",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/A@2024-06-01#properties/properties/properties/aRecords"
                                    },
                                    "description": "Optional. The list of A records in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the A record."
                              }
                            },
                            "aaaaType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/AAAA@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "aaaaRecords": {
                                  "type": "array",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/AAAA@2024-06-01#properties/properties/properties/aaaaRecords"
                                    },
                                    "description": "Optional. The list of AAAA records in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the AAAA record."
                              }
                            },
                            "cnameType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/CNAME@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "cnameRecord": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/CNAME@2024-06-01#properties/properties/properties/cnameRecord"
                                    },
                                    "description": "Optional. The CNAME record in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the CNAME record."
                              }
                            },
                            "mxType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/MX@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "mxRecords": {
                                  "type": "array",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/MX@2024-06-01#properties/properties/properties/mxRecords"
                                    },
                                    "description": "Optional. The list of MX records in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the MX record."
                              }
                            },
                            "ptrType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/PTR@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "ptrRecords": {
                                  "type": "array",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/PTR@2024-06-01#properties/properties/properties/ptrRecords"
                                    },
                                    "description": "Optional. The list of PTR records in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the PTR record."
                              }
                            },
                            "soaType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/SOA@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "soaRecord": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/SOA@2024-06-01#properties/properties/properties/soaRecord"
                                    },
                                    "description": "Optional. The SOA record in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the SOA record."
                              }
                            },
                            "srvType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/SRV@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "srvRecords": {
                                  "type": "array",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/SRV@2024-06-01#properties/properties/properties/srvRecords"
                                    },
                                    "description": "Optional. The list of SRV records in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the SRV record."
                              }
                            },
                            "txtType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/TXT@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "txtRecords": {
                                  "type": "array",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/TXT@2024-06-01#properties/properties/properties/txtRecords"
                                    },
                                    "description": "Optional. The list of TXT records in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the TXT record."
                              }
                            },
                            "virtualNetworkLinkType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "minLength": 1,
                                  "maxLength": 80,
                                  "metadata": {
                                    "description": "Optional. The resource name."
                                  }
                                },
                                "virtualNetworkResourceId": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The resource ID of the virtual network to link."
                                  }
                                },
                                "location": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The Azure Region where the resource lives."
                                  }
                                },
                                "registrationEnabled": {
                                  "type": "bool",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Is auto-registration of virtual machine records in the virtual network in the Private DNS zone enabled?."
                                  }
                                },
                                "tags": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/virtualNetworkLinks@2024-06-01#properties/tags"
                                    },
                                    "description": "Optional. Resource tags."
                                  },
                                  "nullable": true
                                },
                                "resolutionPolicy": {
                                  "type": "string",
                                  "allowedValues": [
                                    "Default",
                                    "NxDomainRedirect"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The resolution type of the private-dns-zone fallback machanism."
                                  }
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the virtual network link."
                              }
                            },
                            "lockType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Specify the name of lock."
                                  }
                                },
                                "kind": {
                                  "type": "string",
                                  "allowedValues": [
                                    "CanNotDelete",
                                    "None",
                                    "ReadOnly"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Specify the type of lock."
                                  }
                                },
                                "notes": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Specify the notes of the lock."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for a lock.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.0"
                                }
                              }
                            },
                            "roleAssignmentType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                  }
                                },
                                "roleDefinitionIdOrName": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                  }
                                },
                                "principalId": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                  }
                                },
                                "principalType": {
                                  "type": "string",
                                  "allowedValues": [
                                    "Device",
                                    "ForeignGroup",
                                    "Group",
                                    "ServicePrincipal",
                                    "User"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The principal type of the assigned principal ID."
                                  }
                                },
                                "description": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The description of the role assignment."
                                  }
                                },
                                "condition": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                  }
                                },
                                "conditionVersion": {
                                  "type": "string",
                                  "allowedValues": [
                                    "2.0"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Version of the condition."
                                  }
                                },
                                "delegatedManagedIdentityResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The Resource Id of the delegated managed identity resource."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for a role assignment.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                }
                              }
                            }
                          },
                          "parameters": {
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. Private DNS zone name."
                              }
                            },
                            "a": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/aType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of A records."
                              }
                            },
                            "aaaa": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/aaaaType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of AAAA records."
                              }
                            },
                            "cname": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/cnameType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of CNAME records."
                              }
                            },
                            "mx": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/mxType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of MX records."
                              }
                            },
                            "ptr": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/ptrType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of PTR records."
                              }
                            },
                            "soa": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/soaType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of SOA records."
                              }
                            },
                            "srv": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/srvType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of SRV records."
                              }
                            },
                            "txt": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/txtType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of TXT records."
                              }
                            },
                            "virtualNetworkLinks": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/virtualNetworkLinkType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of custom objects describing vNet links of the DNS zone. Each object should contain properties 'virtualNetworkResourceId' and 'registrationEnabled'. The 'vnetResourceId' is a resource ID of a vNet to link, 'registrationEnabled' (bool) enables automatic DNS registration in the zone for the linked vNet."
                              }
                            },
                            "location": {
                              "type": "string",
                              "defaultValue": "global",
                              "metadata": {
                                "description": "Optional. The location of the PrivateDNSZone. Should be global."
                              }
                            },
                            "roleAssignments": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/roleAssignmentType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of role assignments to create."
                              }
                            },
                            "tags": {
                              "type": "object",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Tags of the resource."
                              }
                            },
                            "lock": {
                              "$ref": "#/definitions/lockType",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The lock settings of the service."
                              }
                            },
                            "enableTelemetry": {
                              "type": "bool",
                              "defaultValue": true,
                              "metadata": {
                                "description": "Optional. Enable/Disable usage telemetry for module."
                              }
                            }
                          },
                          "variables": {
                            "copy": [
                              {
                                "name": "formattedRoleAssignments",
                                "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                              }
                            ],
                            "builtInRoleNames": {
                              "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                              "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                              "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                              "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                              "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                              "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]"
                            },
                            "enableReferencedModulesTelemetry": false
                          },
                          "resources": {
                            "avmTelemetry": {
                              "condition": "[parameters('enableTelemetry')]",
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2024-03-01",
                              "name": "[format('46d3xbcp.res.network-privatednszone.{0}.{1}', replace('0.8.0', '.', '-'), substring(uniqueString(deployment().name, parameters('location')), 0, 4))]",
                              "properties": {
                                "mode": "Incremental",
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "contentVersion": "1.0.0.0",
                                  "resources": [],
                                  "outputs": {
                                    "telemetry": {
                                      "type": "String",
                                      "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                    }
                                  }
                                }
                              }
                            },
                            "privateDnsZone": {
                              "type": "Microsoft.Network/privateDnsZones",
                              "apiVersion": "2020-06-01",
                              "name": "[parameters('name')]",
                              "location": "[parameters('location')]",
                              "tags": "[parameters('tags')]"
                            },
                            "privateDnsZone_lock": {
                              "condition": "[and(not(empty(coalesce(parameters('lock'), createObject()))), not(equals(tryGet(parameters('lock'), 'kind'), 'None')))]",
                              "type": "Microsoft.Authorization/locks",
                              "apiVersion": "2020-05-01",
                              "scope": "[format('Microsoft.Network/privateDnsZones/{0}', parameters('name'))]",
                              "name": "[coalesce(tryGet(parameters('lock'), 'name'), format('lock-{0}', parameters('name')))]",
                              "properties": {
                                "level": "[coalesce(tryGet(parameters('lock'), 'kind'), '')]",
                                "notes": "[coalesce(tryGet(parameters('lock'), 'notes'), if(equals(tryGet(parameters('lock'), 'kind'), 'CanNotDelete'), 'Cannot delete resource or child resources.', 'Cannot delete or modify the resource or child resources.'))]"
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_roleAssignments": {
                              "copy": {
                                "name": "privateDnsZone_roleAssignments",
                                "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                              },
                              "type": "Microsoft.Authorization/roleAssignments",
                              "apiVersion": "2022-04-01",
                              "scope": "[format('Microsoft.Network/privateDnsZones/{0}', parameters('name'))]",
                              "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones', parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                              "properties": {
                                "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_A": {
                              "copy": {
                                "name": "privateDnsZone_A",
                                "count": "[length(coalesce(parameters('a'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-ARecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('a'), createArray())[copyIndex()].name]"
                                  },
                                  "aRecords": {
                                    "value": "[tryGet(coalesce(parameters('a'), createArray())[copyIndex()], 'aRecords')]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('a'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('a'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('a'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "12608084563401365743"
                                    },
                                    "name": "Private DNS Zone A record",
                                    "description": "This module deploys a Private DNS Zone A record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the A record."
                                      }
                                    },
                                    "aRecords": {
                                      "type": "array",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/A@2024-06-01#properties/properties/properties/aRecords"
                                        },
                                        "description": "Optional. The list of A records in the record set."
                                      },
                                      "nullable": true
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/A@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszonea.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "A": {
                                      "type": "Microsoft.Network/privateDnsZones/A",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "aRecords": "[parameters('aRecords')]",
                                        "metadata": "[parameters('metadata')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "A_roleAssignments": {
                                      "copy": {
                                        "name": "A_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/A/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/A', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "A"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed A record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed A record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/A', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed A record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_AAAA": {
                              "copy": {
                                "name": "privateDnsZone_AAAA",
                                "count": "[length(coalesce(parameters('aaaa'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-AAAARecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('aaaa'), createArray())[copyIndex()].name]"
                                  },
                                  "aaaaRecords": {
                                    "value": "[tryGet(coalesce(parameters('aaaa'), createArray())[copyIndex()], 'aaaaRecords')]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('aaaa'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('aaaa'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('aaaa'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "4881696097088567452"
                                    },
                                    "name": "Private DNS Zone AAAA record",
                                    "description": "This module deploys a Private DNS Zone AAAA record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the AAAA record."
                                      }
                                    },
                                    "aaaaRecords": {
                                      "type": "array",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/AAAA@2024-06-01#properties/properties/properties/aaaaRecords"
                                        },
                                        "description": "Optional. The list of AAAA records in the record set."
                                      },
                                      "nullable": true
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/AAAA@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszoneaaaa.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "AAAA": {
                                      "type": "Microsoft.Network/privateDnsZones/AAAA",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "aaaaRecords": "[parameters('aaaaRecords')]",
                                        "metadata": "[parameters('metadata')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "AAAA_roleAssignments": {
                                      "copy": {
                                        "name": "AAAA_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/AAAA/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/AAAA', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "AAAA"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed AAAA record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed AAAA record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/AAAA', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed AAAA record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_CNAME": {
                              "copy": {
                                "name": "privateDnsZone_CNAME",
                                "count": "[length(coalesce(parameters('cname'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-CNAMERecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('cname'), createArray())[copyIndex()].name]"
                                  },
                                  "cnameRecord": {
                                    "value": "[tryGet(coalesce(parameters('cname'), createArray())[copyIndex()], 'cnameRecord')]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('cname'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('cname'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('cname'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "13307906270868460967"
                                    },
                                    "name": "Private DNS Zone CNAME record",
                                    "description": "This module deploys a Private DNS Zone CNAME record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the CNAME record."
                                      }
                                    },
                                    "cnameRecord": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/CNAME@2024-06-01#properties/properties/properties/cnameRecord"
                                        },
                                        "description": "Optional. A CNAME record."
                                      },
                                      "nullable": true
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/CNAME@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszonecname.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "CNAME": {
                                      "type": "Microsoft.Network/privateDnsZones/CNAME",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "cnameRecord": "[parameters('cnameRecord')]",
                                        "metadata": "[parameters('metadata')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "CNAME_roleAssignments": {
                                      "copy": {
                                        "name": "CNAME_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/CNAME/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/CNAME', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "CNAME"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed CNAME record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed CNAME record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/CNAME', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed CNAME record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_MX": {
                              "copy": {
                                "name": "privateDnsZone_MX",
                                "count": "[length(coalesce(parameters('mx'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-MXRecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('mx'), createArray())[copyIndex()].name]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('mx'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "mxRecords": {
                                    "value": "[tryGet(coalesce(parameters('mx'), createArray())[copyIndex()], 'mxRecords')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('mx'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('mx'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "7946896598573056688"
                                    },
                                    "name": "Private DNS Zone MX record",
                                    "description": "This module deploys a Private DNS Zone MX record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the MX record."
                                      }
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/MX@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "mxRecords": {
                                      "type": "array",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/MX@2024-06-01#properties/properties/properties/mxRecords"
                                        },
                                        "description": "Optional. The list of MX records in the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszonemx.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "MX": {
                                      "type": "Microsoft.Network/privateDnsZones/MX",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "metadata": "[parameters('metadata')]",
                                        "mxRecords": "[parameters('mxRecords')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "MX_roleAssignments": {
                                      "copy": {
                                        "name": "MX_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/MX/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/MX', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "MX"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed MX record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed MX record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/MX', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed MX record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_PTR": {
                              "copy": {
                                "name": "privateDnsZone_PTR",
                                "count": "[length(coalesce(parameters('ptr'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-PTRRecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('ptr'), createArray())[copyIndex()].name]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('ptr'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "ptrRecords": {
                                    "value": "[tryGet(coalesce(parameters('ptr'), createArray())[copyIndex()], 'ptrRecords')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('ptr'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('ptr'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "7627375510490151870"
                                    },
                                    "name": "Private DNS Zone PTR record",
                                    "description": "This module deploys a Private DNS Zone PTR record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the PTR record."
                                      }
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/PTR@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ptrRecords": {
                                      "type": "array",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/PTR@2024-06-01#properties/properties/properties/ptrRecords"
                                        },
                                        "description": "Optional. The list of PTR records in the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszoneptr.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "PTR": {
                                      "type": "Microsoft.Network/privateDnsZones/PTR",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "metadata": "[parameters('metadata')]",
                                        "ptrRecords": "[parameters('ptrRecords')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "PTR_roleAssignments": {
                                      "copy": {
                                        "name": "PTR_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/PTR/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/PTR', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "PTR"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed PTR record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed PTR record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/PTR', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed PTR record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_SOA": {
                              "copy": {
                                "name": "privateDnsZone_SOA",
                                "count": "[length(coalesce(parameters('soa'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-SOARecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('soa'), createArray())[copyIndex()].name]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('soa'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "soaRecord": {
                                    "value": "[tryGet(coalesce(parameters('soa'), createArray())[copyIndex()], 'soaRecord')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('soa'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('soa'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "16709883266329935583"
                                    },
                                    "name": "Private DNS Zone SOA record",
                                    "description": "This module deploys a Private DNS Zone SOA record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the SOA record."
                                      }
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/SOA@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "soaRecord": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/SOA@2024-06-01#properties/properties/properties/soaRecord"
                                        },
                                        "description": "Optional. A SOA record."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszonesoa.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "SOA": {
                                      "type": "Microsoft.Network/privateDnsZones/SOA",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "metadata": "[parameters('metadata')]",
                                        "soaRecord": "[parameters('soaRecord')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "SOA_roleAssignments": {
                                      "copy": {
                                        "name": "SOA_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/SOA/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/SOA', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "SOA"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed SOA record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed SOA record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/SOA', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed SOA record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_SRV": {
                              "copy": {
                                "name": "privateDnsZone_SRV",
                                "count": "[length(coalesce(parameters('srv'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-SRVRecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('srv'), createArray())[copyIndex()].name]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('srv'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "srvRecords": {
                                    "value": "[tryGet(coalesce(parameters('srv'), createArray())[copyIndex()], 'srvRecords')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('srv'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('srv'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "8123422724272920495"
                                    },
                                    "name": "Private DNS Zone SRV record",
                                    "description": "This module deploys a Private DNS Zone SRV record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the SRV record."
                                      }
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/SRV@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "srvRecords": {
                                      "type": "array",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/SRV@2024-06-01#properties/properties/properties/srvRecords"
                                        },
                                        "description": "Optional. The list of SRV records in the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszonesrv.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "SRV": {
                                      "type": "Microsoft.Network/privateDnsZones/SRV",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "metadata": "[parameters('metadata')]",
                                        "srvRecords": "[parameters('srvRecords')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "SRV_roleAssignments": {
                                      "copy": {
                                        "name": "SRV_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/SRV/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/SRV', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "SRV"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed SRV record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed SRV record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/SRV', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed SRV record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_TXT": {
                              "copy": {
                                "name": "privateDnsZone_TXT",
                                "count": "[length(coalesce(parameters('txt'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-TXTRecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('txt'), createArray())[copyIndex()].name]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('txt'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "txtRecords": {
                                    "value": "[tryGet(coalesce(parameters('txt'), createArray())[copyIndex()], 'txtRecords')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('txt'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('txt'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "17170531000135004092"
                                    },
                                    "name": "Private DNS Zone TXT record",
                                    "description": "This module deploys a Private DNS Zone TXT record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the TXT record."
                                      }
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/TXT@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "txtRecords": {
                                      "type": "array",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/TXT@2024-06-01#properties/properties/properties/txtRecords"
                                        },
                                        "description": "Optional. The list of TXT records in the record set."
                                      },
                                      "nullable": true
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszonetxt.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "TXT": {
                                      "type": "Microsoft.Network/privateDnsZones/TXT",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "metadata": "[parameters('metadata')]",
                                        "ttl": "[parameters('ttl')]",
                                        "txtRecords": "[parameters('txtRecords')]"
                                      }
                                    },
                                    "TXT_roleAssignments": {
                                      "copy": {
                                        "name": "TXT_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/TXT/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/TXT', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "TXT"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed TXT record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed TXT record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/TXT', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed TXT record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_virtualNetworkLinks": {
                              "copy": {
                                "name": "privateDnsZone_virtualNetworkLinks",
                                "count": "[length(coalesce(parameters('virtualNetworkLinks'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-VNetLink-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()], 'name'), format('{0}-vnetlink', last(split(coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()].virtualNetworkResourceId, '/'))))]"
                                  },
                                  "virtualNetworkResourceId": {
                                    "value": "[coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()].virtualNetworkResourceId]"
                                  },
                                  "location": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()], 'location'), 'global')]"
                                  },
                                  "registrationEnabled": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()], 'registrationEnabled'), false())]"
                                  },
                                  "tags": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()], 'tags'), parameters('tags'))]"
                                  },
                                  "resolutionPolicy": {
                                    "value": "[tryGet(coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()], 'resolutionPolicy')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "517173107480898390"
                                    },
                                    "name": "Private DNS Zone Virtual Network Link",
                                    "description": "This module deploys a Private DNS Zone Virtual Network Link."
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "defaultValue": "[format('{0}-vnetlink', last(split(parameters('virtualNetworkResourceId'), '/')))]",
                                      "metadata": {
                                        "description": "Optional. The name of the virtual network link."
                                      }
                                    },
                                    "location": {
                                      "type": "string",
                                      "defaultValue": "global",
                                      "metadata": {
                                        "description": "Optional. The location of the PrivateDNSZone. Should be global."
                                      }
                                    },
                                    "tags": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/virtualNetworkLinks@2024-06-01#properties/tags"
                                        },
                                        "description": "Optional. Tags of the resource."
                                      },
                                      "nullable": true
                                    },
                                    "registrationEnabled": {
                                      "type": "bool",
                                      "defaultValue": false,
                                      "metadata": {
                                        "description": "Optional. Is auto-registration of virtual machine records in the virtual network in the Private DNS zone enabled?."
                                      }
                                    },
                                    "virtualNetworkResourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. Link to another virtual network resource ID."
                                      }
                                    },
                                    "resolutionPolicy": {
                                      "type": "string",
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. The resolution policy on the virtual network link. Only applicable for virtual network links to privatelink zones, and for A,AAAA,CNAME queries. When set to `NxDomainRedirect`, Azure DNS resolver falls back to public resolution if private dns query resolution results in non-existent domain response. `Default` is configured as the default option."
                                      }
                                    }
                                  },
                                  "resources": {
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "virtualNetworkLink": {
                                      "type": "Microsoft.Network/privateDnsZones/virtualNetworkLinks",
                                      "apiVersion": "2024-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "location": "[parameters('location')]",
                                      "tags": "[parameters('tags')]",
                                      "properties": {
                                        "registrationEnabled": "[parameters('registrationEnabled')]",
                                        "virtualNetwork": {
                                          "id": "[parameters('virtualNetworkResourceId')]"
                                        },
                                        "resolutionPolicy": "[parameters('resolutionPolicy')]"
                                      }
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed virtual network link."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed virtual network link."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/virtualNetworkLinks', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed virtual network link."
                                      },
                                      "value": "[resourceGroup().name]"
                                    },
                                    "location": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The location the resource was deployed into."
                                      },
                                      "value": "[reference('virtualNetworkLink', '2024-06-01', 'full').location]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            }
                          },
                          "outputs": {
                            "resourceGroupName": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource group the private DNS zone was deployed into."
                              },
                              "value": "[resourceGroup().name]"
                            },
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the private DNS zone."
                              },
                              "value": "[parameters('name')]"
                            },
                            "resourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource ID of the private DNS zone."
                              },
                              "value": "[resourceId('Microsoft.Network/privateDnsZones', parameters('name'))]"
                            },
                            "location": {
                              "type": "string",
                              "metadata": {
                                "description": "The location the resource was deployed into."
                              },
                              "value": "[reference('privateDnsZone', '2020-06-01', 'full').location]"
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Resources/deployments', format('{0}-vnet', uniqueString(deployment().name, parameters('location'))))]"
                      ]
                    },
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "[format('{0}-dns-adf', uniqueString(deployment().name, parameters('location')))]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "name": {
                            "value": "[variables('dnsZoneNames').dataFactory]"
                          },
                          "tags": {
                            "value": "[parameters('tags')]"
                          },
                          "enableTelemetry": {
                            "value": "[parameters('enableTelemetry')]"
                          },
                          "virtualNetworkLinks": {
                            "value": [
                              {
                                "virtualNetworkResourceId": "[reference(resourceId('Microsoft.Resources/deployments', format('{0}-vnet', uniqueString(deployment().name, parameters('location')))), '2025-04-01').outputs.resourceId.value]",
                                "registrationEnabled": false
                              }
                            ]
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.37.4.10188",
                              "templateHash": "17921343070314002065"
                            },
                            "name": "Private DNS Zones",
                            "description": "This module deploys a Private DNS zone."
                          },
                          "definitions": {
                            "aType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/A@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "aRecords": {
                                  "type": "array",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/A@2024-06-01#properties/properties/properties/aRecords"
                                    },
                                    "description": "Optional. The list of A records in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the A record."
                              }
                            },
                            "aaaaType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/AAAA@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "aaaaRecords": {
                                  "type": "array",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/AAAA@2024-06-01#properties/properties/properties/aaaaRecords"
                                    },
                                    "description": "Optional. The list of AAAA records in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the AAAA record."
                              }
                            },
                            "cnameType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/CNAME@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "cnameRecord": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/CNAME@2024-06-01#properties/properties/properties/cnameRecord"
                                    },
                                    "description": "Optional. The CNAME record in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the CNAME record."
                              }
                            },
                            "mxType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/MX@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "mxRecords": {
                                  "type": "array",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/MX@2024-06-01#properties/properties/properties/mxRecords"
                                    },
                                    "description": "Optional. The list of MX records in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the MX record."
                              }
                            },
                            "ptrType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/PTR@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "ptrRecords": {
                                  "type": "array",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/PTR@2024-06-01#properties/properties/properties/ptrRecords"
                                    },
                                    "description": "Optional. The list of PTR records in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the PTR record."
                              }
                            },
                            "soaType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/SOA@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "soaRecord": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/SOA@2024-06-01#properties/properties/properties/soaRecord"
                                    },
                                    "description": "Optional. The SOA record in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the SOA record."
                              }
                            },
                            "srvType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/SRV@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "srvRecords": {
                                  "type": "array",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/SRV@2024-06-01#properties/properties/properties/srvRecords"
                                    },
                                    "description": "Optional. The list of SRV records in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the SRV record."
                              }
                            },
                            "txtType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/TXT@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "txtRecords": {
                                  "type": "array",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/TXT@2024-06-01#properties/properties/properties/txtRecords"
                                    },
                                    "description": "Optional. The list of TXT records in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the TXT record."
                              }
                            },
                            "virtualNetworkLinkType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "minLength": 1,
                                  "maxLength": 80,
                                  "metadata": {
                                    "description": "Optional. The resource name."
                                  }
                                },
                                "virtualNetworkResourceId": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The resource ID of the virtual network to link."
                                  }
                                },
                                "location": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The Azure Region where the resource lives."
                                  }
                                },
                                "registrationEnabled": {
                                  "type": "bool",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Is auto-registration of virtual machine records in the virtual network in the Private DNS zone enabled?."
                                  }
                                },
                                "tags": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/virtualNetworkLinks@2024-06-01#properties/tags"
                                    },
                                    "description": "Optional. Resource tags."
                                  },
                                  "nullable": true
                                },
                                "resolutionPolicy": {
                                  "type": "string",
                                  "allowedValues": [
                                    "Default",
                                    "NxDomainRedirect"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The resolution type of the private-dns-zone fallback machanism."
                                  }
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the virtual network link."
                              }
                            },
                            "lockType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Specify the name of lock."
                                  }
                                },
                                "kind": {
                                  "type": "string",
                                  "allowedValues": [
                                    "CanNotDelete",
                                    "None",
                                    "ReadOnly"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Specify the type of lock."
                                  }
                                },
                                "notes": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Specify the notes of the lock."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for a lock.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.0"
                                }
                              }
                            },
                            "roleAssignmentType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                  }
                                },
                                "roleDefinitionIdOrName": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                  }
                                },
                                "principalId": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                  }
                                },
                                "principalType": {
                                  "type": "string",
                                  "allowedValues": [
                                    "Device",
                                    "ForeignGroup",
                                    "Group",
                                    "ServicePrincipal",
                                    "User"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The principal type of the assigned principal ID."
                                  }
                                },
                                "description": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The description of the role assignment."
                                  }
                                },
                                "condition": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                  }
                                },
                                "conditionVersion": {
                                  "type": "string",
                                  "allowedValues": [
                                    "2.0"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Version of the condition."
                                  }
                                },
                                "delegatedManagedIdentityResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The Resource Id of the delegated managed identity resource."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for a role assignment.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                }
                              }
                            }
                          },
                          "parameters": {
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. Private DNS zone name."
                              }
                            },
                            "a": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/aType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of A records."
                              }
                            },
                            "aaaa": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/aaaaType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of AAAA records."
                              }
                            },
                            "cname": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/cnameType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of CNAME records."
                              }
                            },
                            "mx": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/mxType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of MX records."
                              }
                            },
                            "ptr": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/ptrType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of PTR records."
                              }
                            },
                            "soa": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/soaType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of SOA records."
                              }
                            },
                            "srv": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/srvType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of SRV records."
                              }
                            },
                            "txt": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/txtType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of TXT records."
                              }
                            },
                            "virtualNetworkLinks": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/virtualNetworkLinkType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of custom objects describing vNet links of the DNS zone. Each object should contain properties 'virtualNetworkResourceId' and 'registrationEnabled'. The 'vnetResourceId' is a resource ID of a vNet to link, 'registrationEnabled' (bool) enables automatic DNS registration in the zone for the linked vNet."
                              }
                            },
                            "location": {
                              "type": "string",
                              "defaultValue": "global",
                              "metadata": {
                                "description": "Optional. The location of the PrivateDNSZone. Should be global."
                              }
                            },
                            "roleAssignments": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/roleAssignmentType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of role assignments to create."
                              }
                            },
                            "tags": {
                              "type": "object",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Tags of the resource."
                              }
                            },
                            "lock": {
                              "$ref": "#/definitions/lockType",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The lock settings of the service."
                              }
                            },
                            "enableTelemetry": {
                              "type": "bool",
                              "defaultValue": true,
                              "metadata": {
                                "description": "Optional. Enable/Disable usage telemetry for module."
                              }
                            }
                          },
                          "variables": {
                            "copy": [
                              {
                                "name": "formattedRoleAssignments",
                                "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                              }
                            ],
                            "builtInRoleNames": {
                              "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                              "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                              "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                              "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                              "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                              "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]"
                            },
                            "enableReferencedModulesTelemetry": false
                          },
                          "resources": {
                            "avmTelemetry": {
                              "condition": "[parameters('enableTelemetry')]",
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2024-03-01",
                              "name": "[format('46d3xbcp.res.network-privatednszone.{0}.{1}', replace('0.8.0', '.', '-'), substring(uniqueString(deployment().name, parameters('location')), 0, 4))]",
                              "properties": {
                                "mode": "Incremental",
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "contentVersion": "1.0.0.0",
                                  "resources": [],
                                  "outputs": {
                                    "telemetry": {
                                      "type": "String",
                                      "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                    }
                                  }
                                }
                              }
                            },
                            "privateDnsZone": {
                              "type": "Microsoft.Network/privateDnsZones",
                              "apiVersion": "2020-06-01",
                              "name": "[parameters('name')]",
                              "location": "[parameters('location')]",
                              "tags": "[parameters('tags')]"
                            },
                            "privateDnsZone_lock": {
                              "condition": "[and(not(empty(coalesce(parameters('lock'), createObject()))), not(equals(tryGet(parameters('lock'), 'kind'), 'None')))]",
                              "type": "Microsoft.Authorization/locks",
                              "apiVersion": "2020-05-01",
                              "scope": "[format('Microsoft.Network/privateDnsZones/{0}', parameters('name'))]",
                              "name": "[coalesce(tryGet(parameters('lock'), 'name'), format('lock-{0}', parameters('name')))]",
                              "properties": {
                                "level": "[coalesce(tryGet(parameters('lock'), 'kind'), '')]",
                                "notes": "[coalesce(tryGet(parameters('lock'), 'notes'), if(equals(tryGet(parameters('lock'), 'kind'), 'CanNotDelete'), 'Cannot delete resource or child resources.', 'Cannot delete or modify the resource or child resources.'))]"
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_roleAssignments": {
                              "copy": {
                                "name": "privateDnsZone_roleAssignments",
                                "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                              },
                              "type": "Microsoft.Authorization/roleAssignments",
                              "apiVersion": "2022-04-01",
                              "scope": "[format('Microsoft.Network/privateDnsZones/{0}', parameters('name'))]",
                              "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones', parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                              "properties": {
                                "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_A": {
                              "copy": {
                                "name": "privateDnsZone_A",
                                "count": "[length(coalesce(parameters('a'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-ARecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('a'), createArray())[copyIndex()].name]"
                                  },
                                  "aRecords": {
                                    "value": "[tryGet(coalesce(parameters('a'), createArray())[copyIndex()], 'aRecords')]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('a'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('a'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('a'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "12608084563401365743"
                                    },
                                    "name": "Private DNS Zone A record",
                                    "description": "This module deploys a Private DNS Zone A record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the A record."
                                      }
                                    },
                                    "aRecords": {
                                      "type": "array",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/A@2024-06-01#properties/properties/properties/aRecords"
                                        },
                                        "description": "Optional. The list of A records in the record set."
                                      },
                                      "nullable": true
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/A@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszonea.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "A": {
                                      "type": "Microsoft.Network/privateDnsZones/A",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "aRecords": "[parameters('aRecords')]",
                                        "metadata": "[parameters('metadata')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "A_roleAssignments": {
                                      "copy": {
                                        "name": "A_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/A/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/A', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "A"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed A record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed A record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/A', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed A record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_AAAA": {
                              "copy": {
                                "name": "privateDnsZone_AAAA",
                                "count": "[length(coalesce(parameters('aaaa'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-AAAARecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('aaaa'), createArray())[copyIndex()].name]"
                                  },
                                  "aaaaRecords": {
                                    "value": "[tryGet(coalesce(parameters('aaaa'), createArray())[copyIndex()], 'aaaaRecords')]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('aaaa'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('aaaa'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('aaaa'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "4881696097088567452"
                                    },
                                    "name": "Private DNS Zone AAAA record",
                                    "description": "This module deploys a Private DNS Zone AAAA record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the AAAA record."
                                      }
                                    },
                                    "aaaaRecords": {
                                      "type": "array",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/AAAA@2024-06-01#properties/properties/properties/aaaaRecords"
                                        },
                                        "description": "Optional. The list of AAAA records in the record set."
                                      },
                                      "nullable": true
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/AAAA@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszoneaaaa.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "AAAA": {
                                      "type": "Microsoft.Network/privateDnsZones/AAAA",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "aaaaRecords": "[parameters('aaaaRecords')]",
                                        "metadata": "[parameters('metadata')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "AAAA_roleAssignments": {
                                      "copy": {
                                        "name": "AAAA_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/AAAA/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/AAAA', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "AAAA"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed AAAA record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed AAAA record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/AAAA', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed AAAA record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_CNAME": {
                              "copy": {
                                "name": "privateDnsZone_CNAME",
                                "count": "[length(coalesce(parameters('cname'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-CNAMERecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('cname'), createArray())[copyIndex()].name]"
                                  },
                                  "cnameRecord": {
                                    "value": "[tryGet(coalesce(parameters('cname'), createArray())[copyIndex()], 'cnameRecord')]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('cname'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('cname'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('cname'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "13307906270868460967"
                                    },
                                    "name": "Private DNS Zone CNAME record",
                                    "description": "This module deploys a Private DNS Zone CNAME record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the CNAME record."
                                      }
                                    },
                                    "cnameRecord": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/CNAME@2024-06-01#properties/properties/properties/cnameRecord"
                                        },
                                        "description": "Optional. A CNAME record."
                                      },
                                      "nullable": true
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/CNAME@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszonecname.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "CNAME": {
                                      "type": "Microsoft.Network/privateDnsZones/CNAME",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "cnameRecord": "[parameters('cnameRecord')]",
                                        "metadata": "[parameters('metadata')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "CNAME_roleAssignments": {
                                      "copy": {
                                        "name": "CNAME_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/CNAME/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/CNAME', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "CNAME"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed CNAME record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed CNAME record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/CNAME', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed CNAME record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_MX": {
                              "copy": {
                                "name": "privateDnsZone_MX",
                                "count": "[length(coalesce(parameters('mx'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-MXRecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('mx'), createArray())[copyIndex()].name]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('mx'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "mxRecords": {
                                    "value": "[tryGet(coalesce(parameters('mx'), createArray())[copyIndex()], 'mxRecords')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('mx'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('mx'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "7946896598573056688"
                                    },
                                    "name": "Private DNS Zone MX record",
                                    "description": "This module deploys a Private DNS Zone MX record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the MX record."
                                      }
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/MX@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "mxRecords": {
                                      "type": "array",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/MX@2024-06-01#properties/properties/properties/mxRecords"
                                        },
                                        "description": "Optional. The list of MX records in the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszonemx.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "MX": {
                                      "type": "Microsoft.Network/privateDnsZones/MX",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "metadata": "[parameters('metadata')]",
                                        "mxRecords": "[parameters('mxRecords')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "MX_roleAssignments": {
                                      "copy": {
                                        "name": "MX_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/MX/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/MX', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "MX"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed MX record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed MX record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/MX', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed MX record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_PTR": {
                              "copy": {
                                "name": "privateDnsZone_PTR",
                                "count": "[length(coalesce(parameters('ptr'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-PTRRecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('ptr'), createArray())[copyIndex()].name]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('ptr'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "ptrRecords": {
                                    "value": "[tryGet(coalesce(parameters('ptr'), createArray())[copyIndex()], 'ptrRecords')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('ptr'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('ptr'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "7627375510490151870"
                                    },
                                    "name": "Private DNS Zone PTR record",
                                    "description": "This module deploys a Private DNS Zone PTR record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the PTR record."
                                      }
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/PTR@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ptrRecords": {
                                      "type": "array",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/PTR@2024-06-01#properties/properties/properties/ptrRecords"
                                        },
                                        "description": "Optional. The list of PTR records in the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszoneptr.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "PTR": {
                                      "type": "Microsoft.Network/privateDnsZones/PTR",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "metadata": "[parameters('metadata')]",
                                        "ptrRecords": "[parameters('ptrRecords')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "PTR_roleAssignments": {
                                      "copy": {
                                        "name": "PTR_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/PTR/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/PTR', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "PTR"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed PTR record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed PTR record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/PTR', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed PTR record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_SOA": {
                              "copy": {
                                "name": "privateDnsZone_SOA",
                                "count": "[length(coalesce(parameters('soa'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-SOARecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('soa'), createArray())[copyIndex()].name]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('soa'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "soaRecord": {
                                    "value": "[tryGet(coalesce(parameters('soa'), createArray())[copyIndex()], 'soaRecord')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('soa'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('soa'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "16709883266329935583"
                                    },
                                    "name": "Private DNS Zone SOA record",
                                    "description": "This module deploys a Private DNS Zone SOA record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the SOA record."
                                      }
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/SOA@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "soaRecord": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/SOA@2024-06-01#properties/properties/properties/soaRecord"
                                        },
                                        "description": "Optional. A SOA record."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszonesoa.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "SOA": {
                                      "type": "Microsoft.Network/privateDnsZones/SOA",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "metadata": "[parameters('metadata')]",
                                        "soaRecord": "[parameters('soaRecord')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "SOA_roleAssignments": {
                                      "copy": {
                                        "name": "SOA_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/SOA/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/SOA', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "SOA"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed SOA record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed SOA record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/SOA', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed SOA record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_SRV": {
                              "copy": {
                                "name": "privateDnsZone_SRV",
                                "count": "[length(coalesce(parameters('srv'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-SRVRecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('srv'), createArray())[copyIndex()].name]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('srv'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "srvRecords": {
                                    "value": "[tryGet(coalesce(parameters('srv'), createArray())[copyIndex()], 'srvRecords')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('srv'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('srv'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "8123422724272920495"
                                    },
                                    "name": "Private DNS Zone SRV record",
                                    "description": "This module deploys a Private DNS Zone SRV record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the SRV record."
                                      }
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/SRV@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "srvRecords": {
                                      "type": "array",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/SRV@2024-06-01#properties/properties/properties/srvRecords"
                                        },
                                        "description": "Optional. The list of SRV records in the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszonesrv.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "SRV": {
                                      "type": "Microsoft.Network/privateDnsZones/SRV",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "metadata": "[parameters('metadata')]",
                                        "srvRecords": "[parameters('srvRecords')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "SRV_roleAssignments": {
                                      "copy": {
                                        "name": "SRV_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/SRV/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/SRV', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "SRV"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed SRV record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed SRV record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/SRV', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed SRV record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_TXT": {
                              "copy": {
                                "name": "privateDnsZone_TXT",
                                "count": "[length(coalesce(parameters('txt'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-TXTRecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('txt'), createArray())[copyIndex()].name]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('txt'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "txtRecords": {
                                    "value": "[tryGet(coalesce(parameters('txt'), createArray())[copyIndex()], 'txtRecords')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('txt'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('txt'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "17170531000135004092"
                                    },
                                    "name": "Private DNS Zone TXT record",
                                    "description": "This module deploys a Private DNS Zone TXT record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the TXT record."
                                      }
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/TXT@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "txtRecords": {
                                      "type": "array",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/TXT@2024-06-01#properties/properties/properties/txtRecords"
                                        },
                                        "description": "Optional. The list of TXT records in the record set."
                                      },
                                      "nullable": true
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszonetxt.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "TXT": {
                                      "type": "Microsoft.Network/privateDnsZones/TXT",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "metadata": "[parameters('metadata')]",
                                        "ttl": "[parameters('ttl')]",
                                        "txtRecords": "[parameters('txtRecords')]"
                                      }
                                    },
                                    "TXT_roleAssignments": {
                                      "copy": {
                                        "name": "TXT_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/TXT/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/TXT', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "TXT"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed TXT record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed TXT record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/TXT', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed TXT record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_virtualNetworkLinks": {
                              "copy": {
                                "name": "privateDnsZone_virtualNetworkLinks",
                                "count": "[length(coalesce(parameters('virtualNetworkLinks'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-VNetLink-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()], 'name'), format('{0}-vnetlink', last(split(coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()].virtualNetworkResourceId, '/'))))]"
                                  },
                                  "virtualNetworkResourceId": {
                                    "value": "[coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()].virtualNetworkResourceId]"
                                  },
                                  "location": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()], 'location'), 'global')]"
                                  },
                                  "registrationEnabled": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()], 'registrationEnabled'), false())]"
                                  },
                                  "tags": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()], 'tags'), parameters('tags'))]"
                                  },
                                  "resolutionPolicy": {
                                    "value": "[tryGet(coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()], 'resolutionPolicy')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "517173107480898390"
                                    },
                                    "name": "Private DNS Zone Virtual Network Link",
                                    "description": "This module deploys a Private DNS Zone Virtual Network Link."
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "defaultValue": "[format('{0}-vnetlink', last(split(parameters('virtualNetworkResourceId'), '/')))]",
                                      "metadata": {
                                        "description": "Optional. The name of the virtual network link."
                                      }
                                    },
                                    "location": {
                                      "type": "string",
                                      "defaultValue": "global",
                                      "metadata": {
                                        "description": "Optional. The location of the PrivateDNSZone. Should be global."
                                      }
                                    },
                                    "tags": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/virtualNetworkLinks@2024-06-01#properties/tags"
                                        },
                                        "description": "Optional. Tags of the resource."
                                      },
                                      "nullable": true
                                    },
                                    "registrationEnabled": {
                                      "type": "bool",
                                      "defaultValue": false,
                                      "metadata": {
                                        "description": "Optional. Is auto-registration of virtual machine records in the virtual network in the Private DNS zone enabled?."
                                      }
                                    },
                                    "virtualNetworkResourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. Link to another virtual network resource ID."
                                      }
                                    },
                                    "resolutionPolicy": {
                                      "type": "string",
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. The resolution policy on the virtual network link. Only applicable for virtual network links to privatelink zones, and for A,AAAA,CNAME queries. When set to `NxDomainRedirect`, Azure DNS resolver falls back to public resolution if private dns query resolution results in non-existent domain response. `Default` is configured as the default option."
                                      }
                                    }
                                  },
                                  "resources": {
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "virtualNetworkLink": {
                                      "type": "Microsoft.Network/privateDnsZones/virtualNetworkLinks",
                                      "apiVersion": "2024-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "location": "[parameters('location')]",
                                      "tags": "[parameters('tags')]",
                                      "properties": {
                                        "registrationEnabled": "[parameters('registrationEnabled')]",
                                        "virtualNetwork": {
                                          "id": "[parameters('virtualNetworkResourceId')]"
                                        },
                                        "resolutionPolicy": "[parameters('resolutionPolicy')]"
                                      }
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed virtual network link."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed virtual network link."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/virtualNetworkLinks', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed virtual network link."
                                      },
                                      "value": "[resourceGroup().name]"
                                    },
                                    "location": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The location the resource was deployed into."
                                      },
                                      "value": "[reference('virtualNetworkLink', '2024-06-01', 'full').location]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            }
                          },
                          "outputs": {
                            "resourceGroupName": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource group the private DNS zone was deployed into."
                              },
                              "value": "[resourceGroup().name]"
                            },
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the private DNS zone."
                              },
                              "value": "[parameters('name')]"
                            },
                            "resourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource ID of the private DNS zone."
                              },
                              "value": "[resourceId('Microsoft.Network/privateDnsZones', parameters('name'))]"
                            },
                            "location": {
                              "type": "string",
                              "metadata": {
                                "description": "The location the resource was deployed into."
                              },
                              "value": "[reference('privateDnsZone', '2020-06-01', 'full').location]"
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Resources/deployments', format('{0}-vnet', uniqueString(deployment().name, parameters('location'))))]"
                      ]
                    },
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "[format('{0}-dns-kusto', uniqueString(deployment().name, parameters('location')))]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "name": {
                            "value": "[variables('dnsZoneNames').kusto]"
                          },
                          "tags": {
                            "value": "[parameters('tags')]"
                          },
                          "enableTelemetry": {
                            "value": "[parameters('enableTelemetry')]"
                          },
                          "virtualNetworkLinks": {
                            "value": [
                              {
                                "virtualNetworkResourceId": "[reference(resourceId('Microsoft.Resources/deployments', format('{0}-vnet', uniqueString(deployment().name, parameters('location')))), '2025-04-01').outputs.resourceId.value]",
                                "registrationEnabled": false
                              }
                            ]
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.37.4.10188",
                              "templateHash": "17921343070314002065"
                            },
                            "name": "Private DNS Zones",
                            "description": "This module deploys a Private DNS zone."
                          },
                          "definitions": {
                            "aType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/A@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "aRecords": {
                                  "type": "array",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/A@2024-06-01#properties/properties/properties/aRecords"
                                    },
                                    "description": "Optional. The list of A records in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the A record."
                              }
                            },
                            "aaaaType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/AAAA@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "aaaaRecords": {
                                  "type": "array",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/AAAA@2024-06-01#properties/properties/properties/aaaaRecords"
                                    },
                                    "description": "Optional. The list of AAAA records in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the AAAA record."
                              }
                            },
                            "cnameType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/CNAME@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "cnameRecord": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/CNAME@2024-06-01#properties/properties/properties/cnameRecord"
                                    },
                                    "description": "Optional. The CNAME record in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the CNAME record."
                              }
                            },
                            "mxType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/MX@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "mxRecords": {
                                  "type": "array",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/MX@2024-06-01#properties/properties/properties/mxRecords"
                                    },
                                    "description": "Optional. The list of MX records in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the MX record."
                              }
                            },
                            "ptrType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/PTR@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "ptrRecords": {
                                  "type": "array",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/PTR@2024-06-01#properties/properties/properties/ptrRecords"
                                    },
                                    "description": "Optional. The list of PTR records in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the PTR record."
                              }
                            },
                            "soaType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/SOA@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "soaRecord": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/SOA@2024-06-01#properties/properties/properties/soaRecord"
                                    },
                                    "description": "Optional. The SOA record in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the SOA record."
                              }
                            },
                            "srvType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/SRV@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "srvRecords": {
                                  "type": "array",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/SRV@2024-06-01#properties/properties/properties/srvRecords"
                                    },
                                    "description": "Optional. The list of SRV records in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the SRV record."
                              }
                            },
                            "txtType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the record."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/TXT@2024-06-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. The metadata of the record."
                                  },
                                  "nullable": true
                                },
                                "ttl": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The TTL of the record."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                },
                                "txtRecords": {
                                  "type": "array",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/TXT@2024-06-01#properties/properties/properties/txtRecords"
                                    },
                                    "description": "Optional. The list of TXT records in the record set."
                                  },
                                  "nullable": true
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the TXT record."
                              }
                            },
                            "virtualNetworkLinkType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "minLength": 1,
                                  "maxLength": 80,
                                  "metadata": {
                                    "description": "Optional. The resource name."
                                  }
                                },
                                "virtualNetworkResourceId": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The resource ID of the virtual network to link."
                                  }
                                },
                                "location": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The Azure Region where the resource lives."
                                  }
                                },
                                "registrationEnabled": {
                                  "type": "bool",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Is auto-registration of virtual machine records in the virtual network in the Private DNS zone enabled?."
                                  }
                                },
                                "tags": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Network/privateDnsZones/virtualNetworkLinks@2024-06-01#properties/tags"
                                    },
                                    "description": "Optional. Resource tags."
                                  },
                                  "nullable": true
                                },
                                "resolutionPolicy": {
                                  "type": "string",
                                  "allowedValues": [
                                    "Default",
                                    "NxDomainRedirect"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The resolution type of the private-dns-zone fallback machanism."
                                  }
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for the virtual network link."
                              }
                            },
                            "lockType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Specify the name of lock."
                                  }
                                },
                                "kind": {
                                  "type": "string",
                                  "allowedValues": [
                                    "CanNotDelete",
                                    "None",
                                    "ReadOnly"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Specify the type of lock."
                                  }
                                },
                                "notes": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Specify the notes of the lock."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for a lock.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.0"
                                }
                              }
                            },
                            "roleAssignmentType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                  }
                                },
                                "roleDefinitionIdOrName": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                  }
                                },
                                "principalId": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                  }
                                },
                                "principalType": {
                                  "type": "string",
                                  "allowedValues": [
                                    "Device",
                                    "ForeignGroup",
                                    "Group",
                                    "ServicePrincipal",
                                    "User"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The principal type of the assigned principal ID."
                                  }
                                },
                                "description": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The description of the role assignment."
                                  }
                                },
                                "condition": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                  }
                                },
                                "conditionVersion": {
                                  "type": "string",
                                  "allowedValues": [
                                    "2.0"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Version of the condition."
                                  }
                                },
                                "delegatedManagedIdentityResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The Resource Id of the delegated managed identity resource."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for a role assignment.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                }
                              }
                            }
                          },
                          "parameters": {
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. Private DNS zone name."
                              }
                            },
                            "a": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/aType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of A records."
                              }
                            },
                            "aaaa": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/aaaaType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of AAAA records."
                              }
                            },
                            "cname": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/cnameType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of CNAME records."
                              }
                            },
                            "mx": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/mxType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of MX records."
                              }
                            },
                            "ptr": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/ptrType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of PTR records."
                              }
                            },
                            "soa": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/soaType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of SOA records."
                              }
                            },
                            "srv": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/srvType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of SRV records."
                              }
                            },
                            "txt": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/txtType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of TXT records."
                              }
                            },
                            "virtualNetworkLinks": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/virtualNetworkLinkType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of custom objects describing vNet links of the DNS zone. Each object should contain properties 'virtualNetworkResourceId' and 'registrationEnabled'. The 'vnetResourceId' is a resource ID of a vNet to link, 'registrationEnabled' (bool) enables automatic DNS registration in the zone for the linked vNet."
                              }
                            },
                            "location": {
                              "type": "string",
                              "defaultValue": "global",
                              "metadata": {
                                "description": "Optional. The location of the PrivateDNSZone. Should be global."
                              }
                            },
                            "roleAssignments": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/roleAssignmentType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of role assignments to create."
                              }
                            },
                            "tags": {
                              "type": "object",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Tags of the resource."
                              }
                            },
                            "lock": {
                              "$ref": "#/definitions/lockType",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The lock settings of the service."
                              }
                            },
                            "enableTelemetry": {
                              "type": "bool",
                              "defaultValue": true,
                              "metadata": {
                                "description": "Optional. Enable/Disable usage telemetry for module."
                              }
                            }
                          },
                          "variables": {
                            "copy": [
                              {
                                "name": "formattedRoleAssignments",
                                "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                              }
                            ],
                            "builtInRoleNames": {
                              "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                              "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                              "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                              "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                              "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                              "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]"
                            },
                            "enableReferencedModulesTelemetry": false
                          },
                          "resources": {
                            "avmTelemetry": {
                              "condition": "[parameters('enableTelemetry')]",
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2024-03-01",
                              "name": "[format('46d3xbcp.res.network-privatednszone.{0}.{1}', replace('0.8.0', '.', '-'), substring(uniqueString(deployment().name, parameters('location')), 0, 4))]",
                              "properties": {
                                "mode": "Incremental",
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "contentVersion": "1.0.0.0",
                                  "resources": [],
                                  "outputs": {
                                    "telemetry": {
                                      "type": "String",
                                      "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                    }
                                  }
                                }
                              }
                            },
                            "privateDnsZone": {
                              "type": "Microsoft.Network/privateDnsZones",
                              "apiVersion": "2020-06-01",
                              "name": "[parameters('name')]",
                              "location": "[parameters('location')]",
                              "tags": "[parameters('tags')]"
                            },
                            "privateDnsZone_lock": {
                              "condition": "[and(not(empty(coalesce(parameters('lock'), createObject()))), not(equals(tryGet(parameters('lock'), 'kind'), 'None')))]",
                              "type": "Microsoft.Authorization/locks",
                              "apiVersion": "2020-05-01",
                              "scope": "[format('Microsoft.Network/privateDnsZones/{0}', parameters('name'))]",
                              "name": "[coalesce(tryGet(parameters('lock'), 'name'), format('lock-{0}', parameters('name')))]",
                              "properties": {
                                "level": "[coalesce(tryGet(parameters('lock'), 'kind'), '')]",
                                "notes": "[coalesce(tryGet(parameters('lock'), 'notes'), if(equals(tryGet(parameters('lock'), 'kind'), 'CanNotDelete'), 'Cannot delete resource or child resources.', 'Cannot delete or modify the resource or child resources.'))]"
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_roleAssignments": {
                              "copy": {
                                "name": "privateDnsZone_roleAssignments",
                                "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                              },
                              "type": "Microsoft.Authorization/roleAssignments",
                              "apiVersion": "2022-04-01",
                              "scope": "[format('Microsoft.Network/privateDnsZones/{0}', parameters('name'))]",
                              "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones', parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                              "properties": {
                                "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_A": {
                              "copy": {
                                "name": "privateDnsZone_A",
                                "count": "[length(coalesce(parameters('a'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-ARecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('a'), createArray())[copyIndex()].name]"
                                  },
                                  "aRecords": {
                                    "value": "[tryGet(coalesce(parameters('a'), createArray())[copyIndex()], 'aRecords')]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('a'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('a'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('a'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "12608084563401365743"
                                    },
                                    "name": "Private DNS Zone A record",
                                    "description": "This module deploys a Private DNS Zone A record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the A record."
                                      }
                                    },
                                    "aRecords": {
                                      "type": "array",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/A@2024-06-01#properties/properties/properties/aRecords"
                                        },
                                        "description": "Optional. The list of A records in the record set."
                                      },
                                      "nullable": true
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/A@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszonea.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "A": {
                                      "type": "Microsoft.Network/privateDnsZones/A",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "aRecords": "[parameters('aRecords')]",
                                        "metadata": "[parameters('metadata')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "A_roleAssignments": {
                                      "copy": {
                                        "name": "A_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/A/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/A', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "A"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed A record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed A record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/A', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed A record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_AAAA": {
                              "copy": {
                                "name": "privateDnsZone_AAAA",
                                "count": "[length(coalesce(parameters('aaaa'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-AAAARecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('aaaa'), createArray())[copyIndex()].name]"
                                  },
                                  "aaaaRecords": {
                                    "value": "[tryGet(coalesce(parameters('aaaa'), createArray())[copyIndex()], 'aaaaRecords')]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('aaaa'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('aaaa'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('aaaa'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "4881696097088567452"
                                    },
                                    "name": "Private DNS Zone AAAA record",
                                    "description": "This module deploys a Private DNS Zone AAAA record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the AAAA record."
                                      }
                                    },
                                    "aaaaRecords": {
                                      "type": "array",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/AAAA@2024-06-01#properties/properties/properties/aaaaRecords"
                                        },
                                        "description": "Optional. The list of AAAA records in the record set."
                                      },
                                      "nullable": true
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/AAAA@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszoneaaaa.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "AAAA": {
                                      "type": "Microsoft.Network/privateDnsZones/AAAA",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "aaaaRecords": "[parameters('aaaaRecords')]",
                                        "metadata": "[parameters('metadata')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "AAAA_roleAssignments": {
                                      "copy": {
                                        "name": "AAAA_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/AAAA/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/AAAA', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "AAAA"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed AAAA record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed AAAA record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/AAAA', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed AAAA record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_CNAME": {
                              "copy": {
                                "name": "privateDnsZone_CNAME",
                                "count": "[length(coalesce(parameters('cname'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-CNAMERecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('cname'), createArray())[copyIndex()].name]"
                                  },
                                  "cnameRecord": {
                                    "value": "[tryGet(coalesce(parameters('cname'), createArray())[copyIndex()], 'cnameRecord')]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('cname'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('cname'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('cname'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "13307906270868460967"
                                    },
                                    "name": "Private DNS Zone CNAME record",
                                    "description": "This module deploys a Private DNS Zone CNAME record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the CNAME record."
                                      }
                                    },
                                    "cnameRecord": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/CNAME@2024-06-01#properties/properties/properties/cnameRecord"
                                        },
                                        "description": "Optional. A CNAME record."
                                      },
                                      "nullable": true
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/CNAME@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszonecname.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "CNAME": {
                                      "type": "Microsoft.Network/privateDnsZones/CNAME",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "cnameRecord": "[parameters('cnameRecord')]",
                                        "metadata": "[parameters('metadata')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "CNAME_roleAssignments": {
                                      "copy": {
                                        "name": "CNAME_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/CNAME/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/CNAME', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "CNAME"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed CNAME record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed CNAME record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/CNAME', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed CNAME record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_MX": {
                              "copy": {
                                "name": "privateDnsZone_MX",
                                "count": "[length(coalesce(parameters('mx'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-MXRecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('mx'), createArray())[copyIndex()].name]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('mx'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "mxRecords": {
                                    "value": "[tryGet(coalesce(parameters('mx'), createArray())[copyIndex()], 'mxRecords')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('mx'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('mx'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "7946896598573056688"
                                    },
                                    "name": "Private DNS Zone MX record",
                                    "description": "This module deploys a Private DNS Zone MX record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the MX record."
                                      }
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/MX@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "mxRecords": {
                                      "type": "array",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/MX@2024-06-01#properties/properties/properties/mxRecords"
                                        },
                                        "description": "Optional. The list of MX records in the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszonemx.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "MX": {
                                      "type": "Microsoft.Network/privateDnsZones/MX",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "metadata": "[parameters('metadata')]",
                                        "mxRecords": "[parameters('mxRecords')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "MX_roleAssignments": {
                                      "copy": {
                                        "name": "MX_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/MX/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/MX', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "MX"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed MX record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed MX record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/MX', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed MX record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_PTR": {
                              "copy": {
                                "name": "privateDnsZone_PTR",
                                "count": "[length(coalesce(parameters('ptr'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-PTRRecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('ptr'), createArray())[copyIndex()].name]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('ptr'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "ptrRecords": {
                                    "value": "[tryGet(coalesce(parameters('ptr'), createArray())[copyIndex()], 'ptrRecords')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('ptr'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('ptr'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "7627375510490151870"
                                    },
                                    "name": "Private DNS Zone PTR record",
                                    "description": "This module deploys a Private DNS Zone PTR record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the PTR record."
                                      }
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/PTR@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ptrRecords": {
                                      "type": "array",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/PTR@2024-06-01#properties/properties/properties/ptrRecords"
                                        },
                                        "description": "Optional. The list of PTR records in the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszoneptr.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "PTR": {
                                      "type": "Microsoft.Network/privateDnsZones/PTR",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "metadata": "[parameters('metadata')]",
                                        "ptrRecords": "[parameters('ptrRecords')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "PTR_roleAssignments": {
                                      "copy": {
                                        "name": "PTR_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/PTR/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/PTR', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "PTR"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed PTR record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed PTR record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/PTR', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed PTR record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_SOA": {
                              "copy": {
                                "name": "privateDnsZone_SOA",
                                "count": "[length(coalesce(parameters('soa'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-SOARecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('soa'), createArray())[copyIndex()].name]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('soa'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "soaRecord": {
                                    "value": "[tryGet(coalesce(parameters('soa'), createArray())[copyIndex()], 'soaRecord')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('soa'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('soa'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "16709883266329935583"
                                    },
                                    "name": "Private DNS Zone SOA record",
                                    "description": "This module deploys a Private DNS Zone SOA record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the SOA record."
                                      }
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/SOA@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "soaRecord": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/SOA@2024-06-01#properties/properties/properties/soaRecord"
                                        },
                                        "description": "Optional. A SOA record."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszonesoa.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "SOA": {
                                      "type": "Microsoft.Network/privateDnsZones/SOA",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "metadata": "[parameters('metadata')]",
                                        "soaRecord": "[parameters('soaRecord')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "SOA_roleAssignments": {
                                      "copy": {
                                        "name": "SOA_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/SOA/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/SOA', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "SOA"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed SOA record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed SOA record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/SOA', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed SOA record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_SRV": {
                              "copy": {
                                "name": "privateDnsZone_SRV",
                                "count": "[length(coalesce(parameters('srv'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-SRVRecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('srv'), createArray())[copyIndex()].name]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('srv'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "srvRecords": {
                                    "value": "[tryGet(coalesce(parameters('srv'), createArray())[copyIndex()], 'srvRecords')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('srv'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('srv'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "8123422724272920495"
                                    },
                                    "name": "Private DNS Zone SRV record",
                                    "description": "This module deploys a Private DNS Zone SRV record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the SRV record."
                                      }
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/SRV@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "srvRecords": {
                                      "type": "array",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/SRV@2024-06-01#properties/properties/properties/srvRecords"
                                        },
                                        "description": "Optional. The list of SRV records in the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszonesrv.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "SRV": {
                                      "type": "Microsoft.Network/privateDnsZones/SRV",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "metadata": "[parameters('metadata')]",
                                        "srvRecords": "[parameters('srvRecords')]",
                                        "ttl": "[parameters('ttl')]"
                                      }
                                    },
                                    "SRV_roleAssignments": {
                                      "copy": {
                                        "name": "SRV_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/SRV/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/SRV', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "SRV"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed SRV record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed SRV record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/SRV', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed SRV record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_TXT": {
                              "copy": {
                                "name": "privateDnsZone_TXT",
                                "count": "[length(coalesce(parameters('txt'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-TXTRecord-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('txt'), createArray())[copyIndex()].name]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('txt'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "txtRecords": {
                                    "value": "[tryGet(coalesce(parameters('txt'), createArray())[copyIndex()], 'txtRecords')]"
                                  },
                                  "ttl": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('txt'), createArray())[copyIndex()], 'ttl'), 3600)]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('txt'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "17170531000135004092"
                                    },
                                    "name": "Private DNS Zone TXT record",
                                    "description": "This module deploys a Private DNS Zone TXT record."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the TXT record."
                                      }
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/TXT@2024-06-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. The metadata attached to the record set."
                                      },
                                      "nullable": true
                                    },
                                    "ttl": {
                                      "type": "int",
                                      "defaultValue": 3600,
                                      "metadata": {
                                        "description": "Optional. The TTL (time-to-live) of the records in the record set."
                                      }
                                    },
                                    "txtRecords": {
                                      "type": "array",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/TXT@2024-06-01#properties/properties/properties/txtRecords"
                                        },
                                        "description": "Optional. The list of TXT records in the record set."
                                      },
                                      "nullable": true
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                                      "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.nw-privdnszonetxt.{0}.{1}', replace('0.1.0', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "TXT": {
                                      "type": "Microsoft.Network/privateDnsZones/TXT",
                                      "apiVersion": "2020-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "properties": {
                                        "metadata": "[parameters('metadata')]",
                                        "ttl": "[parameters('ttl')]",
                                        "txtRecords": "[parameters('txtRecords')]"
                                      }
                                    },
                                    "TXT_roleAssignments": {
                                      "copy": {
                                        "name": "TXT_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Network/privateDnsZones/{0}/TXT/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateDnsZones/TXT', parameters('privateDnsZoneName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "TXT"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed TXT record."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed TXT record."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/TXT', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed TXT record."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            },
                            "privateDnsZone_virtualNetworkLinks": {
                              "copy": {
                                "name": "privateDnsZone_virtualNetworkLinks",
                                "count": "[length(coalesce(parameters('virtualNetworkLinks'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateDnsZone-VNetLink-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "privateDnsZoneName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()], 'name'), format('{0}-vnetlink', last(split(coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()].virtualNetworkResourceId, '/'))))]"
                                  },
                                  "virtualNetworkResourceId": {
                                    "value": "[coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()].virtualNetworkResourceId]"
                                  },
                                  "location": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()], 'location'), 'global')]"
                                  },
                                  "registrationEnabled": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()], 'registrationEnabled'), false())]"
                                  },
                                  "tags": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()], 'tags'), parameters('tags'))]"
                                  },
                                  "resolutionPolicy": {
                                    "value": "[tryGet(coalesce(parameters('virtualNetworkLinks'), createArray())[copyIndex()], 'resolutionPolicy')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.37.4.10188",
                                      "templateHash": "517173107480898390"
                                    },
                                    "name": "Private DNS Zone Virtual Network Link",
                                    "description": "This module deploys a Private DNS Zone Virtual Network Link."
                                  },
                                  "parameters": {
                                    "privateDnsZoneName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Private DNS zone. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "defaultValue": "[format('{0}-vnetlink', last(split(parameters('virtualNetworkResourceId'), '/')))]",
                                      "metadata": {
                                        "description": "Optional. The name of the virtual network link."
                                      }
                                    },
                                    "location": {
                                      "type": "string",
                                      "defaultValue": "global",
                                      "metadata": {
                                        "description": "Optional. The location of the PrivateDNSZone. Should be global."
                                      }
                                    },
                                    "tags": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Network/privateDnsZones/virtualNetworkLinks@2024-06-01#properties/tags"
                                        },
                                        "description": "Optional. Tags of the resource."
                                      },
                                      "nullable": true
                                    },
                                    "registrationEnabled": {
                                      "type": "bool",
                                      "defaultValue": false,
                                      "metadata": {
                                        "description": "Optional. Is auto-registration of virtual machine records in the virtual network in the Private DNS zone enabled?."
                                      }
                                    },
                                    "virtualNetworkResourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. Link to another virtual network resource ID."
                                      }
                                    },
                                    "resolutionPolicy": {
                                      "type": "string",
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. The resolution policy on the virtual network link. Only applicable for virtual network links to privatelink zones, and for A,AAAA,CNAME queries. When set to `NxDomainRedirect`, Azure DNS resolver falls back to public resolution if private dns query resolution results in non-existent domain response. `Default` is configured as the default option."
                                      }
                                    }
                                  },
                                  "resources": {
                                    "privateDnsZone": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateDnsZones",
                                      "apiVersion": "2020-06-01",
                                      "name": "[parameters('privateDnsZoneName')]"
                                    },
                                    "virtualNetworkLink": {
                                      "type": "Microsoft.Network/privateDnsZones/virtualNetworkLinks",
                                      "apiVersion": "2024-06-01",
                                      "name": "[format('{0}/{1}', parameters('privateDnsZoneName'), parameters('name'))]",
                                      "location": "[parameters('location')]",
                                      "tags": "[parameters('tags')]",
                                      "properties": {
                                        "registrationEnabled": "[parameters('registrationEnabled')]",
                                        "virtualNetwork": {
                                          "id": "[parameters('virtualNetworkResourceId')]"
                                        },
                                        "resolutionPolicy": "[parameters('resolutionPolicy')]"
                                      }
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed virtual network link."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed virtual network link."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateDnsZones/virtualNetworkLinks', parameters('privateDnsZoneName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed virtual network link."
                                      },
                                      "value": "[resourceGroup().name]"
                                    },
                                    "location": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The location the resource was deployed into."
                                      },
                                      "value": "[reference('virtualNetworkLink', '2024-06-01', 'full').location]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateDnsZone"
                              ]
                            }
                          },
                          "outputs": {
                            "resourceGroupName": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource group the private DNS zone was deployed into."
                              },
                              "value": "[resourceGroup().name]"
                            },
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the private DNS zone."
                              },
                              "value": "[parameters('name')]"
                            },
                            "resourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource ID of the private DNS zone."
                              },
                              "value": "[resourceId('Microsoft.Network/privateDnsZones', parameters('name'))]"
                            },
                            "location": {
                              "type": "string",
                              "metadata": {
                                "description": "The location the resource was deployed into."
                              },
                              "value": "[reference('privateDnsZone', '2020-06-01', 'full').location]"
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Resources/deployments', format('{0}-vnet', uniqueString(deployment().name, parameters('location'))))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "vnetResourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Resource ID of the created VNet."
                      },
                      "value": "[reference(resourceId('Microsoft.Resources/deployments', format('{0}-vnet', uniqueString(deployment().name, parameters('location')))), '2025-04-01').outputs.resourceId.value]"
                    },
                    "vnetName": {
                      "type": "string",
                      "metadata": {
                        "description": "Name of the created VNet."
                      },
                      "value": "[reference(resourceId('Microsoft.Resources/deployments', format('{0}-vnet', uniqueString(deployment().name, parameters('location')))), '2025-04-01').outputs.name.value]"
                    },
                    "subnetResourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Resource ID of the private endpoints subnet."
                      },
                      "value": "[reference(resourceId('Microsoft.Resources/deployments', format('{0}-vnet', uniqueString(deployment().name, parameters('location')))), '2025-04-01').outputs.subnetResourceIds.value[0]]"
                    },
                    "subnetName": {
                      "type": "string",
                      "metadata": {
                        "description": "Name of the private endpoints subnet."
                      },
                      "value": "[variables('subnetName')]"
                    },
                    "nsgResourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Resource ID of the NSG."
                      },
                      "value": "[reference(resourceId('Microsoft.Resources/deployments', format('{0}-nsg', uniqueString(deployment().name, parameters('location')))), '2025-04-01').outputs.resourceId.value]"
                    },
                    "blobDnsZoneId": {
                      "type": "string",
                      "metadata": {
                        "description": "Resource ID of the blob private DNS zone."
                      },
                      "value": "[reference(resourceId('Microsoft.Resources/deployments', format('{0}-dns-blob', uniqueString(deployment().name, parameters('location')))), '2025-04-01').outputs.resourceId.value]"
                    },
                    "dfsDnsZoneId": {
                      "type": "string",
                      "metadata": {
                        "description": "Resource ID of the DFS private DNS zone."
                      },
                      "value": "[reference(resourceId('Microsoft.Resources/deployments', format('{0}-dns-dfs', uniqueString(deployment().name, parameters('location')))), '2025-04-01').outputs.resourceId.value]"
                    },
                    "vaultDnsZoneId": {
                      "type": "string",
                      "metadata": {
                        "description": "Resource ID of the Key Vault private DNS zone."
                      },
                      "value": "[reference(resourceId('Microsoft.Resources/deployments', format('{0}-dns-vault', uniqueString(deployment().name, parameters('location')))), '2025-04-01').outputs.resourceId.value]"
                    },
                    "dataFactoryDnsZoneId": {
                      "type": "string",
                      "metadata": {
                        "description": "Resource ID of the Data Factory private DNS zone."
                      },
                      "value": "[reference(resourceId('Microsoft.Resources/deployments', format('{0}-dns-adf', uniqueString(deployment().name, parameters('location')))), '2025-04-01').outputs.resourceId.value]"
                    },
                    "kustoDnsZoneId": {
                      "type": "string",
                      "metadata": {
                        "description": "Resource ID of the Kusto private DNS zone."
                      },
                      "value": "[reference(resourceId('Microsoft.Resources/deployments', format('{0}-dns-kusto', uniqueString(deployment().name, parameters('location')))), '2025-04-01').outputs.resourceId.value]"
                    }
                  }
                }
              }
            },
            "managedIdentity": {
              "condition": "[not(variables('useExistingIdentity'))]",
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-managed-identity', uniqueString(deployment().name, parameters('location')))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "name": {
                    "value": "[variables('managedIdentityName')]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "tags": "[if(contains(parameters('tagsByResource'), 'Microsoft.ManagedIdentity/userAssignedIdentities'), createObject('value', union(variables('allTags'), parameters('tagsByResource')['Microsoft.ManagedIdentity/userAssignedIdentities'])), createObject('value', variables('allTags')))]",
                  "enableTelemetry": {
                    "value": "[parameters('enableTelemetry')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "languageVersion": "2.0",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.39.26.7824",
                      "templateHash": "7591858083424858339"
                    },
                    "name": "User Assigned Identities",
                    "description": "This module deploys a User Assigned Identity."
                  },
                  "definitions": {
                    "federatedIdentityCredentialType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The name of the federated identity credential."
                          }
                        },
                        "audiences": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "metadata": {
                            "description": "Required. The list of audiences that can appear in the issued token."
                          }
                        },
                        "issuer": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The URL of the issuer to be trusted."
                          }
                        },
                        "subject": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The identifier of the external identity."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_export!": true,
                        "description": "The type for the federated identity credential."
                      }
                    },
                    "lockType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Specify the name of lock."
                          }
                        },
                        "kind": {
                          "type": "string",
                          "allowedValues": [
                            "CanNotDelete",
                            "None",
                            "ReadOnly"
                          ],
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Specify the type of lock."
                          }
                        },
                        "notes": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Specify the notes of the lock."
                          }
                        }
                      },
                      "metadata": {
                        "description": "An AVM-aligned type for a lock.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.0"
                        }
                      }
                    },
                    "roleAssignmentType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                          }
                        },
                        "roleDefinitionIdOrName": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                          }
                        },
                        "principalId": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                          }
                        },
                        "principalType": {
                          "type": "string",
                          "allowedValues": [
                            "Device",
                            "ForeignGroup",
                            "Group",
                            "ServicePrincipal",
                            "User"
                          ],
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The principal type of the assigned principal ID."
                          }
                        },
                        "description": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The description of the role assignment."
                          }
                        },
                        "condition": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                          }
                        },
                        "conditionVersion": {
                          "type": "string",
                          "allowedValues": [
                            "2.0"
                          ],
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Version of the condition."
                          }
                        },
                        "delegatedManagedIdentityResourceId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                          }
                        }
                      },
                      "metadata": {
                        "description": "An AVM-aligned type for a role assignment.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                        }
                      }
                    }
                  },
                  "parameters": {
                    "name": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. Name of the User Assigned Identity."
                      }
                    },
                    "location": {
                      "type": "string",
                      "defaultValue": "[resourceGroup().location]",
                      "metadata": {
                        "description": "Optional. Location for all resources."
                      }
                    },
                    "federatedIdentityCredentials": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/federatedIdentityCredentialType"
                      },
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. The federated identity credentials list to indicate which token from the external IdP should be trusted by your application. Federated identity credentials are supported on applications only. A maximum of 20 federated identity credentials can be added per application object."
                      }
                    },
                    "lock": {
                      "$ref": "#/definitions/lockType",
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. The lock settings of the service."
                      }
                    },
                    "roleAssignments": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/roleAssignmentType"
                      },
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. Array of role assignments to create."
                      }
                    },
                    "tags": {
                      "type": "object",
                      "metadata": {
                        "__bicep_resource_derived_type!": {
                          "source": "Microsoft.ManagedIdentity/userAssignedIdentities@2024-11-30#properties/tags"
                        },
                        "description": "Optional. Tags of the resource."
                      },
                      "nullable": true
                    },
                    "enableTelemetry": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Optional. Enable/Disable usage telemetry for module."
                      }
                    },
                    "isolationScope": {
                      "type": "string",
                      "nullable": true,
                      "allowedValues": [
                        "None",
                        "Regional"
                      ],
                      "metadata": {
                        "description": "Optional. Enum to configure regional restrictions on identity assignment, as necessary. Allowed values: \"None\", \"Regional\"."
                      }
                    }
                  },
                  "variables": {
                    "copy": [
                      {
                        "name": "formattedRoleAssignments",
                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                      }
                    ],
                    "builtInRoleNames": {
                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                      "Managed Identity Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'e40ec5ca-96e0-45a2-b4ff-59039f2c2b59')]",
                      "Managed Identity Operator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f1a07417-d97a-45cb-824c-7a7467783830')]",
                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                    }
                  },
                  "resources": {
                    "avmTelemetry": {
                      "condition": "[parameters('enableTelemetry')]",
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2024-03-01",
                      "name": "[format('46d3xbcp.res.managedidentity-userassignedidentity.{0}.{1}', replace('0.5.0', '.', '-'), substring(uniqueString(deployment().name, parameters('location')), 0, 4))]",
                      "properties": {
                        "mode": "Incremental",
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "resources": [],
                          "outputs": {
                            "telemetry": {
                              "type": "String",
                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                            }
                          }
                        }
                      }
                    },
                    "userAssignedIdentity": {
                      "type": "Microsoft.ManagedIdentity/userAssignedIdentities",
                      "apiVersion": "2024-11-30",
                      "name": "[parameters('name')]",
                      "location": "[parameters('location')]",
                      "tags": "[parameters('tags')]",
                      "properties": "[if(not(equals(parameters('isolationScope'), null())), createObject('isolationScope', parameters('isolationScope')), createObject())]"
                    },
                    "userAssignedIdentity_lock": {
                      "condition": "[and(not(empty(coalesce(parameters('lock'), createObject()))), not(equals(tryGet(parameters('lock'), 'kind'), 'None')))]",
                      "type": "Microsoft.Authorization/locks",
                      "apiVersion": "2020-05-01",
                      "scope": "[format('Microsoft.ManagedIdentity/userAssignedIdentities/{0}', parameters('name'))]",
                      "name": "[coalesce(tryGet(parameters('lock'), 'name'), format('lock-{0}', parameters('name')))]",
                      "properties": {
                        "level": "[coalesce(tryGet(parameters('lock'), 'kind'), '')]",
                        "notes": "[coalesce(tryGet(parameters('lock'), 'notes'), if(equals(tryGet(parameters('lock'), 'kind'), 'CanNotDelete'), 'Cannot delete resource or child resources.', 'Cannot delete or modify the resource or child resources.'))]"
                      },
                      "dependsOn": [
                        "userAssignedIdentity"
                      ]
                    },
                    "userAssignedIdentity_roleAssignments": {
                      "copy": {
                        "name": "userAssignedIdentity_roleAssignments",
                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                      },
                      "type": "Microsoft.Authorization/roleAssignments",
                      "apiVersion": "2022-04-01",
                      "scope": "[format('Microsoft.ManagedIdentity/userAssignedIdentities/{0}', parameters('name'))]",
                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                      "properties": {
                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                      },
                      "dependsOn": [
                        "userAssignedIdentity"
                      ]
                    },
                    "userAssignedIdentity_federatedIdentityCredentials": {
                      "copy": {
                        "name": "userAssignedIdentity_federatedIdentityCredentials",
                        "count": "[length(coalesce(parameters('federatedIdentityCredentials'), createArray()))]",
                        "mode": "serial",
                        "batchSize": 1
                      },
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "[format('{0}-UserMSI-FederatedIdentityCred-{1}', uniqueString(subscription().id, resourceGroup().id, parameters('location')), copyIndex())]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "name": {
                            "value": "[coalesce(parameters('federatedIdentityCredentials'), createArray())[copyIndex()].name]"
                          },
                          "userAssignedIdentityName": {
                            "value": "[parameters('name')]"
                          },
                          "audiences": {
                            "value": "[coalesce(parameters('federatedIdentityCredentials'), createArray())[copyIndex()].audiences]"
                          },
                          "issuer": {
                            "value": "[coalesce(parameters('federatedIdentityCredentials'), createArray())[copyIndex()].issuer]"
                          },
                          "subject": {
                            "value": "[coalesce(parameters('federatedIdentityCredentials'), createArray())[copyIndex()].subject]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.39.26.7824",
                              "templateHash": "1387931959101373036"
                            },
                            "name": "User Assigned Identity Federated Identity Credential",
                            "description": "This module deploys a User Assigned Identity Federated Identity Credential."
                          },
                          "parameters": {
                            "userAssignedIdentityName": {
                              "type": "string",
                              "metadata": {
                                "description": "Conditional. The name of the parent user assigned identity. Required if the template is used in a standalone deployment."
                              }
                            },
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. The name of the secret."
                              }
                            },
                            "audiences": {
                              "type": "array",
                              "metadata": {
                                "description": "Required. The list of audiences that can appear in the issued token. Should be set to api://AzureADTokenExchange for Azure AD. It says what Microsoft identity platform should accept in the aud claim in the incoming token. This value represents Azure AD in your external identity provider and has no fixed value across identity providers - you might need to create a new application registration in your IdP to serve as the audience of this token."
                              }
                            },
                            "issuer": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. The URL of the issuer to be trusted. Must match the issuer claim of the external token being exchanged."
                              }
                            },
                            "subject": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. The identifier of the external software workload within the external identity provider. Like the audience value, it has no fixed format, as each IdP uses their own - sometimes a GUID, sometimes a colon delimited identifier, sometimes arbitrary strings. The value here must match the sub claim within the token presented to Azure AD."
                              }
                            }
                          },
                          "resources": [
                            {
                              "type": "Microsoft.ManagedIdentity/userAssignedIdentities/federatedIdentityCredentials",
                              "apiVersion": "2024-11-30",
                              "name": "[format('{0}/{1}', parameters('userAssignedIdentityName'), parameters('name'))]",
                              "properties": {
                                "audiences": "[parameters('audiences')]",
                                "issuer": "[parameters('issuer')]",
                                "subject": "[parameters('subject')]"
                              }
                            }
                          ],
                          "outputs": {
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the federated identity credential."
                              },
                              "value": "[parameters('name')]"
                            },
                            "resourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource ID of the federated identity credential."
                              },
                              "value": "[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities/federatedIdentityCredentials', parameters('userAssignedIdentityName'), parameters('name'))]"
                            },
                            "resourceGroupName": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the resource group the federated identity credential was created in."
                              },
                              "value": "[resourceGroup().name]"
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "userAssignedIdentity"
                      ]
                    }
                  },
                  "outputs": {
                    "name": {
                      "type": "string",
                      "metadata": {
                        "description": "The name of the user assigned identity."
                      },
                      "value": "[parameters('name')]"
                    },
                    "resourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "The resource ID of the user assigned identity."
                      },
                      "value": "[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('name'))]"
                    },
                    "principalId": {
                      "type": "string",
                      "metadata": {
                        "description": "The principal ID (object ID) of the user assigned identity."
                      },
                      "value": "[reference('userAssignedIdentity').principalId]"
                    },
                    "clientId": {
                      "type": "string",
                      "metadata": {
                        "description": "The client ID (application ID) of the user assigned identity."
                      },
                      "value": "[reference('userAssignedIdentity').clientId]"
                    },
                    "resourceGroupName": {
                      "type": "string",
                      "metadata": {
                        "description": "The resource group the user assigned identity was deployed into."
                      },
                      "value": "[resourceGroup().name]"
                    },
                    "location": {
                      "type": "string",
                      "metadata": {
                        "description": "The location the resource was deployed into."
                      },
                      "value": "[reference('userAssignedIdentity', '2024-11-30', 'full').location]"
                    }
                  }
                }
              }
            },
            "storageAccount": {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-storage', uniqueString(deployment().name, parameters('location')))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "name": {
                    "value": "[variables('storageAccountName')]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "tags": "[if(contains(parameters('tagsByResource'), 'Microsoft.Storage/storageAccounts'), createObject('value', union(variables('allTags'), parameters('tagsByResource')['Microsoft.Storage/storageAccounts'], createObject('SecurityControl', 'Ignore'))), createObject('value', union(variables('allTags'), createObject('SecurityControl', 'Ignore'))))]",
                  "enableTelemetry": {
                    "value": "[parameters('enableTelemetry')]"
                  },
                  "kind": {
                    "value": "[variables('storageKind')]"
                  },
                  "skuName": {
                    "value": "[variables('storageSku')]"
                  },
                  "enableHierarchicalNamespace": {
                    "value": true
                  },
                  "allowSharedKeyAccess": {
                    "value": true
                  },
                  "supportsHttpsTrafficOnly": {
                    "value": true
                  },
                  "minimumTlsVersion": {
                    "value": "TLS1_2"
                  },
                  "allowBlobPublicAccess": {
                    "value": false
                  },
                  "publicNetworkAccess": "[if(variables('effectivePublicAccess'), createObject('value', 'Enabled'), createObject('value', 'Disabled'))]",
                  "networkAcls": "[if(variables('enablePrivateEndpoints'), createObject('value', createObject('defaultAction', 'Deny', 'bypass', 'AzureServices')), createObject('value', createObject('defaultAction', 'Allow', 'bypass', 'AzureServices')))]",
                  "blobServices": {
                    "value": {
                      "copy": [
                        {
                          "name": "containers",
                          "count": "[length(variables('containers'))]",
                          "input": {
                            "name": "[variables('containers')[copyIndex('containers')]]",
                            "publicAccess": "None"
                          }
                        }
                      ],
                      "deleteRetentionPolicyDays": "[if(equals(parameters('deploymentConfiguration'), 'waf-aligned'), 7, 1)]",
                      "deleteRetentionPolicyEnabled": true
                    }
                  },
                  "roleAssignments": {
                    "value": [
                      {
                        "principalId": "[if(variables('useExistingIdentity'), reference('existingManagedIdentity').principalId, reference('managedIdentity').outputs.principalId.value)]",
                        "roleDefinitionIdOrName": "Storage Blob Data Reader",
                        "principalType": "ServicePrincipal"
                      }
                    ]
                  },
                  "privateEndpoints": "[if(variables('enablePrivateEndpoints'), createObject('value', createArray(createObject('name', format('{0}-blob-pe', variables('storageAccountName')), 'subnetResourceId', if(equals(variables('effectiveNetworkIsolationMode'), 'Managed'), reference('managedNetwork').outputs.subnetResourceId.value, if(equals(variables('effectiveNetworkIsolationMode'), 'BringYourOwn'), if(not(empty(parameters('byoSubnetResourceId'))), parameters('byoSubnetResourceId'), parameters('privateEndpointSubnetId')), '')), 'service', 'blob', 'privateDnsZoneGroup', if(and(parameters('enablePrivateDnsZoneGroups'), not(empty(if(equals(variables('effectiveNetworkIsolationMode'), 'Managed'), reference('managedNetwork').outputs.blobDnsZoneId.value, if(not(empty(parameters('byoBlobDnsZoneId'))), parameters('byoBlobDnsZoneId'), parameters('storageBlobPrivateDnsZoneId')))))), createObject('privateDnsZoneGroupConfigs', createArray(createObject('privateDnsZoneResourceId', if(equals(variables('effectiveNetworkIsolationMode'), 'Managed'), reference('managedNetwork').outputs.blobDnsZoneId.value, if(not(empty(parameters('byoBlobDnsZoneId'))), parameters('byoBlobDnsZoneId'), parameters('storageBlobPrivateDnsZoneId')))))), null())), createObject('name', format('{0}-dfs-pe', variables('storageAccountName')), 'subnetResourceId', if(equals(variables('effectiveNetworkIsolationMode'), 'Managed'), reference('managedNetwork').outputs.subnetResourceId.value, if(equals(variables('effectiveNetworkIsolationMode'), 'BringYourOwn'), if(not(empty(parameters('byoSubnetResourceId'))), parameters('byoSubnetResourceId'), parameters('privateEndpointSubnetId')), '')), 'service', 'dfs', 'privateDnsZoneGroup', if(and(parameters('enablePrivateDnsZoneGroups'), not(empty(if(equals(variables('effectiveNetworkIsolationMode'), 'Managed'), reference('managedNetwork').outputs.dfsDnsZoneId.value, if(not(empty(parameters('byoDfsDnsZoneId'))), parameters('byoDfsDnsZoneId'), parameters('storageDfsPrivateDnsZoneId')))))), createObject('privateDnsZoneGroupConfigs', createArray(createObject('privateDnsZoneResourceId', if(equals(variables('effectiveNetworkIsolationMode'), 'Managed'), reference('managedNetwork').outputs.dfsDnsZoneId.value, if(not(empty(parameters('byoDfsDnsZoneId'))), parameters('byoDfsDnsZoneId'), parameters('storageDfsPrivateDnsZoneId')))))), null())))), createObject('value', createArray()))]",
                  "lock": {
                    "value": "[parameters('lock')]"
                  },
                  "diagnosticSettings": {
                    "value": "[parameters('diagnosticSettings')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "languageVersion": "2.0",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.39.26.7824",
                      "templateHash": "3442580996358459494"
                    },
                    "name": "Storage Accounts",
                    "description": "This module deploys a Storage Account."
                  },
                  "definitions": {
                    "privateEndpointOutputType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "metadata": {
                            "description": "The name of the private endpoint."
                          }
                        },
                        "resourceId": {
                          "type": "string",
                          "metadata": {
                            "description": "The resource ID of the private endpoint."
                          }
                        },
                        "groupId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "The group Id for the private endpoint Group."
                          }
                        },
                        "customDnsConfigs": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "fqdn": {
                                "type": "string",
                                "nullable": true,
                                "metadata": {
                                  "description": "FQDN that resolves to private endpoint IP address."
                                }
                              },
                              "ipAddresses": {
                                "type": "array",
                                "items": {
                                  "type": "string"
                                },
                                "metadata": {
                                  "description": "A list of private IP addresses of the private endpoint."
                                }
                              }
                            }
                          },
                          "metadata": {
                            "description": "The custom DNS configurations of the private endpoint."
                          }
                        },
                        "networkInterfaceResourceIds": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "metadata": {
                            "description": "The IDs of the network interfaces associated with the private endpoint."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_export!": true,
                        "description": "The type for the private endpoints output."
                      }
                    },
                    "networkAclsType": {
                      "type": "object",
                      "properties": {
                        "resourceAccessRules": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "tenantId": {
                                "type": "string",
                                "metadata": {
                                  "description": "Required. The ID of the tenant in which the resource resides in."
                                }
                              },
                              "resourceId": {
                                "type": "string",
                                "metadata": {
                                  "description": "Required. The resource ID of the target service. Can also contain a wildcard, if multiple services e.g. in a resource group should be included."
                                }
                              }
                            }
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Sets the resource access rules. Array entries must consist of \"tenantId\" and \"resourceId\" fields only."
                          }
                        },
                        "bypass": {
                          "type": "string",
                          "allowedValues": [
                            "AzureServices",
                            "AzureServices, Logging",
                            "AzureServices, Logging, Metrics",
                            "AzureServices, Metrics",
                            "Logging",
                            "Logging, Metrics",
                            "Metrics",
                            "None"
                          ],
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Specifies whether traffic is bypassed for Logging/Metrics/AzureServices. Possible values are any combination of Logging,Metrics,AzureServices (For example, \"Logging, Metrics\"), or None to bypass none of those traffics."
                          }
                        },
                        "virtualNetworkRules": {
                          "type": "array",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Sets the virtual network rules."
                          }
                        },
                        "ipRules": {
                          "type": "array",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Sets the IP ACL rules."
                          }
                        },
                        "defaultAction": {
                          "type": "string",
                          "allowedValues": [
                            "Allow",
                            "Deny"
                          ],
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Specifies the default action of allow or deny when no other rules match."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_export!": true,
                        "description": "The type for the network configuration."
                      }
                    },
                    "secretsExportConfigurationType": {
                      "type": "object",
                      "properties": {
                        "keyVaultResourceId": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The key vault name where to store the keys and connection strings generated by the modules."
                          }
                        },
                        "accessKey1Name": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The accessKey1 secret name to create."
                          }
                        },
                        "connectionString1Name": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The connectionString1 secret name to create."
                          }
                        },
                        "accessKey2Name": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The accessKey2 secret name to create."
                          }
                        },
                        "connectionString2Name": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The connectionString2 secret name to create."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_export!": true,
                        "description": "The type of the exported secrets."
                      }
                    },
                    "localUserType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The name of the local user used for SFTP Authentication."
                          }
                        },
                        "hasSharedKey": {
                          "type": "bool",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Indicates whether shared key exists. Set it to false to remove existing shared key."
                          }
                        },
                        "hasSshKey": {
                          "type": "bool",
                          "metadata": {
                            "description": "Required. Indicates whether SSH key exists. Set it to false to remove existing SSH key."
                          }
                        },
                        "hasSshPassword": {
                          "type": "bool",
                          "metadata": {
                            "description": "Required. Indicates whether SSH password exists. Set it to false to remove existing SSH password."
                          }
                        },
                        "homeDirectory": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The local user home directory."
                          }
                        },
                        "permissionScopes": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/permissionScopeType"
                          },
                          "metadata": {
                            "description": "Required. The permission scopes of the local user."
                          }
                        },
                        "sshAuthorizedKeys": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/sshAuthorizedKeyType"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The local user SSH authorized keys for SFTP."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_export!": true,
                        "description": "The type of a local user."
                      }
                    },
                    "blobServiceType": {
                      "type": "object",
                      "properties": {
                        "automaticSnapshotPolicyEnabled": {
                          "type": "bool",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Automatic Snapshot is enabled if set to true."
                          }
                        },
                        "changeFeedEnabled": {
                          "type": "bool",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The blob service properties for change feed events. Indicates whether change feed event logging is enabled for the Blob service."
                          }
                        },
                        "changeFeedRetentionInDays": {
                          "type": "int",
                          "nullable": true,
                          "minValue": 1,
                          "maxValue": 146000,
                          "metadata": {
                            "description": "Optional. Indicates whether change feed event logging is enabled for the Blob service. Indicates the duration of changeFeed retention in days. If left blank, it indicates an infinite retention of the change feed."
                          }
                        },
                        "containerDeleteRetentionPolicyEnabled": {
                          "type": "bool",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The blob service properties for container soft delete. Indicates whether DeleteRetentionPolicy is enabled."
                          }
                        },
                        "containerDeleteRetentionPolicyDays": {
                          "type": "int",
                          "nullable": true,
                          "minValue": 1,
                          "maxValue": 365,
                          "metadata": {
                            "description": "Optional. Indicates the number of days that the deleted item should be retained."
                          }
                        },
                        "containerDeleteRetentionPolicyAllowPermanentDelete": {
                          "type": "bool",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. This property when set to true allows deletion of the soft deleted blob versions and snapshots. This property cannot be used with blob restore policy. This property only applies to blob service and does not apply to containers or file share."
                          }
                        },
                        "corsRules": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/blobCorsRuleType"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The List of CORS rules. You can include up to five CorsRule elements in the request."
                          }
                        },
                        "defaultServiceVersion": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Indicates the default version to use for requests to the Blob service if an incoming request's version is not specified. Possible values include version 2008-10-27 and all more recent versions."
                          }
                        },
                        "deleteRetentionPolicyEnabled": {
                          "type": "bool",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The blob service properties for blob soft delete."
                          }
                        },
                        "deleteRetentionPolicyDays": {
                          "type": "int",
                          "nullable": true,
                          "minValue": 1,
                          "maxValue": 365,
                          "metadata": {
                            "description": "Optional. Indicates the number of days that the deleted blob should be retained."
                          }
                        },
                        "deleteRetentionPolicyAllowPermanentDelete": {
                          "type": "bool",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. This property when set to true allows deletion of the soft deleted blob versions and snapshots. This property cannot be used with blob restore policy. This property only applies to blob service and does not apply to containers or file share."
                          }
                        },
                        "isVersioningEnabled": {
                          "type": "bool",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Use versioning to automatically maintain previous versions of your blobs. Cannot be enabled for ADLS Gen2 storage accounts."
                          }
                        },
                        "versionDeletePolicyDays": {
                          "type": "int",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Number of days to keep a version before deleting. If set, a lifecycle management policy will be created to handle deleting previous versions."
                          }
                        },
                        "lastAccessTimeTrackingPolicyEnabled": {
                          "type": "bool",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The blob service property to configure last access time based tracking policy. When set to true last access time based tracking is enabled."
                          }
                        },
                        "restorePolicyEnabled": {
                          "type": "bool",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The blob service properties for blob restore policy. If point-in-time restore is enabled, then versioning, change feed, and blob soft delete must also be enabled."
                          }
                        },
                        "restorePolicyDays": {
                          "type": "int",
                          "nullable": true,
                          "minValue": 1,
                          "metadata": {
                            "description": "Optional. How long this blob can be restored. It should be less than DeleteRetentionPolicy days."
                          }
                        },
                        "containers": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/containerType"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Blob containers to create."
                          }
                        },
                        "diagnosticSettings": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/diagnosticSettingFullType"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The diagnostic settings of the service."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_export!": true,
                        "description": "The type of a blob service."
                      }
                    },
                    "fileServiceType": {
                      "type": "object",
                      "properties": {
                        "protocolSettings": {
                          "type": "object",
                          "metadata": {
                            "__bicep_resource_derived_type!": {
                              "source": "Microsoft.Storage/storageAccounts/fileServices@2024-01-01#properties/properties/properties/protocolSettings"
                            },
                            "description": "Optional. Protocol settings for file service."
                          },
                          "nullable": true
                        },
                        "shareDeleteRetentionPolicy": {
                          "type": "object",
                          "metadata": {
                            "__bicep_resource_derived_type!": {
                              "source": "Microsoft.Storage/storageAccounts/fileServices@2024-01-01#properties/properties/properties/shareDeleteRetentionPolicy"
                            },
                            "description": "Optional. The service properties for soft delete."
                          },
                          "nullable": true
                        },
                        "shares": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/fileShareType"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. File shares to create."
                          }
                        },
                        "corsRules": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/fileCorsRuleType"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The List of CORS rules. You can include up to five CorsRule elements in the request."
                          }
                        },
                        "diagnosticSettings": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/diagnosticSettingFullType"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The diagnostic settings of the service."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_export!": true,
                        "description": "The type of a file service."
                      }
                    },
                    "queueServiceType": {
                      "type": "object",
                      "properties": {
                        "queues": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/queueType"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Queues to create."
                          }
                        },
                        "corsRules": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/queueCorsRuleType"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The List of CORS rules. You can include up to five CorsRule elements in the request."
                          }
                        },
                        "diagnosticSettings": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/diagnosticSettingFullType"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The diagnostic settings of the service."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_export!": true,
                        "description": "The type of a queue service."
                      }
                    },
                    "tableServiceType": {
                      "type": "object",
                      "properties": {
                        "tables": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/tableType"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Tables to create."
                          }
                        },
                        "corsRules": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/tableCorsRuleType"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The List of CORS rules. You can include up to five CorsRule elements in the request."
                          }
                        },
                        "diagnosticSettings": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/diagnosticSettingFullType"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The diagnostic settings of the service."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_export!": true,
                        "description": "The type of a table service."
                      }
                    },
                    "objectReplicationPolicyType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name of the object replication policy. If not provided, a GUID will be generated."
                          }
                        },
                        "destinationStorageAccountResourceId": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The resource ID of the destination storage account."
                          }
                        },
                        "enableMetrics": {
                          "type": "bool",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Indicates whether metrics are enabled for the object replication policy."
                          }
                        },
                        "rules": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/objectReplicationPolicyRuleType"
                          },
                          "metadata": {
                            "description": "Required. The storage account object replication rules."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_export!": true,
                        "description": "The type of an object replication policy."
                      }
                    },
                    "_1.immutabilityPolicyType": {
                      "type": "object",
                      "properties": {
                        "immutabilityPeriodSinceCreationInDays": {
                          "type": "int",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The immutability period for the blobs in the container since the policy creation, in days."
                          }
                        },
                        "allowProtectedAppendWrites": {
                          "type": "bool",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. This property can only be changed for unlocked time-based retention policies. When enabled, new blocks can be written to an append blob while maintaining immutability protection and compliance. Only new blocks can be added and any existing blocks cannot be modified or deleted. This property cannot be changed with ExtendImmutabilityPolicy API. Defaults to false."
                          }
                        },
                        "allowProtectedAppendWritesAll": {
                          "type": "bool",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. This property can only be changed for unlocked time-based retention policies. When enabled, new blocks can be written to both \"Append and Block Blobs\" while maintaining immutability protection and compliance. Only new blocks can be added and any existing blocks cannot be modified or deleted. This property cannot be changed with ExtendImmutabilityPolicy API. The \"allowProtectedAppendWrites\" and \"allowProtectedAppendWritesAll\" properties are mutually exclusive. Defaults to false."
                          }
                        }
                      },
                      "metadata": {
                        "description": "The type for an immutability policy.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "blob-service/container/main.bicep"
                        }
                      }
                    },
                    "_2.privateEndpointCustomDnsConfigType": {
                      "type": "object",
                      "properties": {
                        "fqdn": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. FQDN that resolves to private endpoint IP address."
                          }
                        },
                        "ipAddresses": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "metadata": {
                            "description": "Required. A list of private IP addresses of the private endpoint."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "_2.privateEndpointIpConfigurationType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The name of the resource that is unique within a resource group."
                          }
                        },
                        "properties": {
                          "type": "object",
                          "properties": {
                            "groupId": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. The ID of a group obtained from the remote resource that this private endpoint should connect to."
                              }
                            },
                            "memberName": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. The member name of a group obtained from the remote resource that this private endpoint should connect to."
                              }
                            },
                            "privateIPAddress": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. A private IP address obtained from the private endpoint's subnet."
                              }
                            }
                          },
                          "metadata": {
                            "description": "Required. Properties of private endpoint IP configurations."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "_2.privateEndpointPrivateDnsZoneGroupType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name of the Private DNS Zone Group."
                          }
                        },
                        "privateDnsZoneGroupConfigs": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "name": {
                                "type": "string",
                                "nullable": true,
                                "metadata": {
                                  "description": "Optional. The name of the private DNS Zone Group config."
                                }
                              },
                              "privateDnsZoneResourceId": {
                                "type": "string",
                                "metadata": {
                                  "description": "Required. The resource id of the private DNS zone."
                                }
                              }
                            }
                          },
                          "metadata": {
                            "description": "Required. The private DNS Zone Groups to associate the Private Endpoint. A DNS Zone Group can support up to 5 DNS zones."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "_2.secretSetOutputType": {
                      "type": "object",
                      "properties": {
                        "secretResourceId": {
                          "type": "string",
                          "metadata": {
                            "description": "The resourceId of the exported secret."
                          }
                        },
                        "secretUri": {
                          "type": "string",
                          "metadata": {
                            "description": "The secret URI of the exported secret."
                          }
                        },
                        "secretUriWithVersion": {
                          "type": "string",
                          "metadata": {
                            "description": "The secret URI with version of the exported secret."
                          }
                        }
                      },
                      "metadata": {
                        "description": "An AVM-aligned type for the output of the secret set via the secrets export feature.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "blobCorsRuleType": {
                      "type": "object",
                      "properties": {
                        "allowedHeaders": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "metadata": {
                            "description": "Required. A list of headers allowed to be part of the cross-origin request."
                          }
                        },
                        "allowedMethods": {
                          "type": "array",
                          "allowedValues": [
                            "CONNECT",
                            "DELETE",
                            "GET",
                            "HEAD",
                            "MERGE",
                            "OPTIONS",
                            "PATCH",
                            "POST",
                            "PUT",
                            "TRACE"
                          ],
                          "metadata": {
                            "description": "Required. A list of HTTP methods that are allowed to be executed by the origin."
                          }
                        },
                        "allowedOrigins": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "metadata": {
                            "description": "Required. A list of origin domains that will be allowed via CORS, or \"*\" to allow all domains."
                          }
                        },
                        "exposedHeaders": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "metadata": {
                            "description": "Required. A list of response headers to expose to CORS clients."
                          }
                        },
                        "maxAgeInSeconds": {
                          "type": "int",
                          "metadata": {
                            "description": "Required. The number of seconds that the client/browser should cache a preflight response."
                          }
                        }
                      },
                      "metadata": {
                        "description": "The type for a cors rule.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "blob-service/main.bicep",
                          "originalIdentifier": "corsRuleType"
                        }
                      }
                    },
                    "containerType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The name of the Storage Container to deploy."
                          }
                        },
                        "defaultEncryptionScope": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Default the container to use specified encryption scope for all writes."
                          }
                        },
                        "denyEncryptionScopeOverride": {
                          "type": "bool",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Block override of encryption scope from the container default."
                          }
                        },
                        "enableNfsV3AllSquash": {
                          "type": "bool",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Enable NFSv3 all squash on blob container."
                          }
                        },
                        "enableNfsV3RootSquash": {
                          "type": "bool",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Enable NFSv3 root squash on blob container."
                          }
                        },
                        "immutableStorageWithVersioningEnabled": {
                          "type": "bool",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. This is an immutable property, when set to true it enables object level immutability at the container level. The property is immutable and can only be set to true at the container creation time. Existing containers must undergo a migration process."
                          }
                        },
                        "immutabilityPolicy": {
                          "$ref": "#/definitions/_1.immutabilityPolicyType",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Configure immutability policy."
                          }
                        },
                        "metadata": {
                          "type": "object",
                          "metadata": {
                            "__bicep_resource_derived_type!": {
                              "source": "Microsoft.Storage/storageAccounts/blobServices/containers@2024-01-01#properties/properties/properties/metadata"
                            },
                            "description": "Optional. A name-value pair to associate with the container as metadata."
                          },
                          "nullable": true
                        },
                        "publicAccess": {
                          "type": "string",
                          "allowedValues": [
                            "Blob",
                            "Container",
                            "None"
                          ],
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Specifies whether data in the container may be accessed publicly and the level of access."
                          }
                        },
                        "roleAssignments": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/roleAssignmentType"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Array of role assignments to create."
                          }
                        }
                      },
                      "metadata": {
                        "description": "The type of a storage container.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "blob-service/main.bicep"
                        }
                      }
                    },
                    "customerManagedKeyWithAutoRotateType": {
                      "type": "object",
                      "properties": {
                        "keyVaultResourceId": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The resource ID of a key vault to reference a customer managed key for encryption from."
                          }
                        },
                        "keyName": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The name of the customer managed key to use for encryption."
                          }
                        },
                        "keyVersion": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The version of the customer managed key to reference for encryption. If not provided, using version as per 'autoRotationEnabled' setting."
                          }
                        },
                        "autoRotationEnabled": {
                          "type": "bool",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Enable or disable auto-rotating to the latest key version. Default is `true`. If set to `false`, the latest key version at the time of the deployment is used."
                          }
                        },
                        "userAssignedIdentityResourceId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. User assigned identity to use when fetching the customer managed key. Required if no system assigned identity is available for use."
                          }
                        }
                      },
                      "metadata": {
                        "description": "An AVM-aligned type for a customer-managed key. To be used if the resource type supports auto-rotation of the customer-managed key.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "diagnosticSettingFullType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name of the diagnostic setting."
                          }
                        },
                        "logCategoriesAndGroups": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "category": {
                                "type": "string",
                                "nullable": true,
                                "metadata": {
                                  "description": "Optional. Name of a Diagnostic Log category for a resource type this setting is applied to. Set the specific logs to collect here."
                                }
                              },
                              "categoryGroup": {
                                "type": "string",
                                "nullable": true,
                                "metadata": {
                                  "description": "Optional. Name of a Diagnostic Log category group for a resource type this setting is applied to. Set to `allLogs` to collect all logs."
                                }
                              },
                              "enabled": {
                                "type": "bool",
                                "nullable": true,
                                "metadata": {
                                  "description": "Optional. Enable or disable the category explicitly. Default is `true`."
                                }
                              }
                            }
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name of logs that will be streamed. \"allLogs\" includes all possible logs for the resource. Set to `[]` to disable log collection."
                          }
                        },
                        "metricCategories": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "category": {
                                "type": "string",
                                "metadata": {
                                  "description": "Required. Name of a Diagnostic Metric category for a resource type this setting is applied to. Set to `AllMetrics` to collect all metrics."
                                }
                              },
                              "enabled": {
                                "type": "bool",
                                "nullable": true,
                                "metadata": {
                                  "description": "Optional. Enable or disable the category explicitly. Default is `true`."
                                }
                              }
                            }
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name of metrics that will be streamed. \"allMetrics\" includes all possible metrics for the resource. Set to `[]` to disable metric collection."
                          }
                        },
                        "logAnalyticsDestinationType": {
                          "type": "string",
                          "allowedValues": [
                            "AzureDiagnostics",
                            "Dedicated"
                          ],
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. A string indicating whether the export to Log Analytics should use the default destination type, i.e. AzureDiagnostics, or use a destination type."
                          }
                        },
                        "workspaceResourceId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Resource ID of the diagnostic log analytics workspace. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                          }
                        },
                        "storageAccountResourceId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Resource ID of the diagnostic storage account. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                          }
                        },
                        "eventHubAuthorizationRuleResourceId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Resource ID of the diagnostic event hub authorization rule for the Event Hubs namespace in which the event hub should be created or streamed to."
                          }
                        },
                        "eventHubName": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Name of the diagnostic event hub within the namespace to which logs are streamed. Without this, an event hub is created for each log category. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                          }
                        },
                        "marketplacePartnerResourceId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The full ARM resource ID of the Marketplace resource to which you would like to send Diagnostic Logs."
                          }
                        }
                      },
                      "metadata": {
                        "description": "An AVM-aligned type for a diagnostic setting. To be used if both logs & metrics are supported by the resource provider.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "diagnosticSettingMetricsOnlyType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name of diagnostic setting."
                          }
                        },
                        "metricCategories": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "category": {
                                "type": "string",
                                "metadata": {
                                  "description": "Required. Name of a Diagnostic Metric category for a resource type this setting is applied to. Set to `AllMetrics` to collect all metrics."
                                }
                              },
                              "enabled": {
                                "type": "bool",
                                "nullable": true,
                                "metadata": {
                                  "description": "Optional. Enable or disable the category explicitly. Default is `true`."
                                }
                              }
                            }
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name of metrics that will be streamed. \"allMetrics\" includes all possible metrics for the resource. Set to `[]` to disable metric collection."
                          }
                        },
                        "logAnalyticsDestinationType": {
                          "type": "string",
                          "allowedValues": [
                            "AzureDiagnostics",
                            "Dedicated"
                          ],
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. A string indicating whether the export to Log Analytics should use the default destination type, i.e. AzureDiagnostics, or use a destination type."
                          }
                        },
                        "workspaceResourceId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Resource ID of the diagnostic log analytics workspace. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                          }
                        },
                        "storageAccountResourceId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Resource ID of the diagnostic storage account. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                          }
                        },
                        "eventHubAuthorizationRuleResourceId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Resource ID of the diagnostic event hub authorization rule for the Event Hubs namespace in which the event hub should be created or streamed to."
                          }
                        },
                        "eventHubName": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Name of the diagnostic event hub within the namespace to which logs are streamed. Without this, an event hub is created for each log category. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                          }
                        },
                        "marketplacePartnerResourceId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The full ARM resource ID of the Marketplace resource to which you would like to send Diagnostic Logs."
                          }
                        }
                      },
                      "metadata": {
                        "description": "An AVM-aligned type for a diagnostic setting. To be used if only metrics are supported by the resource provider.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "fileCorsRuleType": {
                      "type": "object",
                      "properties": {
                        "allowedHeaders": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "metadata": {
                            "description": "Required. A list of headers allowed to be part of the cross-origin request."
                          }
                        },
                        "allowedMethods": {
                          "type": "array",
                          "allowedValues": [
                            "CONNECT",
                            "DELETE",
                            "GET",
                            "HEAD",
                            "MERGE",
                            "OPTIONS",
                            "PATCH",
                            "POST",
                            "PUT",
                            "TRACE"
                          ],
                          "metadata": {
                            "description": "Required. A list of HTTP methods that are allowed to be executed by the origin."
                          }
                        },
                        "allowedOrigins": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "metadata": {
                            "description": "Required. A list of origin domains that will be allowed via CORS, or \"*\" to allow all domains."
                          }
                        },
                        "exposedHeaders": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "metadata": {
                            "description": "Required. A list of response headers to expose to CORS clients."
                          }
                        },
                        "maxAgeInSeconds": {
                          "type": "int",
                          "metadata": {
                            "description": "Required. The number of seconds that the client/browser should cache a preflight response."
                          }
                        }
                      },
                      "metadata": {
                        "description": "The type for a cors rule.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "file-service/main.bicep",
                          "originalIdentifier": "corsRuleType"
                        }
                      }
                    },
                    "fileShareType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The name of the file share."
                          }
                        },
                        "accessTier": {
                          "type": "string",
                          "allowedValues": [
                            "Cool",
                            "Hot",
                            "Premium",
                            "TransactionOptimized"
                          ],
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Access tier for specific share. Required if the Storage Account kind is set to FileStorage (should be set to \"Premium\"). GpV2 account can choose between TransactionOptimized (default), Hot, and Cool."
                          }
                        },
                        "enabledProtocols": {
                          "type": "string",
                          "allowedValues": [
                            "NFS",
                            "SMB"
                          ],
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The authentication protocol that is used for the file share. Can only be specified when creating a share."
                          }
                        },
                        "rootSquash": {
                          "type": "string",
                          "allowedValues": [
                            "AllSquash",
                            "NoRootSquash",
                            "RootSquash"
                          ],
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Permissions for NFS file shares are enforced by the client OS rather than the Azure Files service. Toggling the root squash behavior reduces the rights of the root user for NFS shares."
                          }
                        },
                        "shareQuota": {
                          "type": "int",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The maximum size of the share, in gigabytes. Must be greater than 0, and less than or equal to 5120 (5TB). For Large File Shares, the maximum size is 102400 (100TB)."
                          }
                        },
                        "roleAssignments": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/roleAssignmentType"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Array of role assignments to create."
                          }
                        }
                      },
                      "metadata": {
                        "description": "The type for a file share.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "file-service/main.bicep"
                        }
                      }
                    },
                    "lockType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Specify the name of lock."
                          }
                        },
                        "kind": {
                          "type": "string",
                          "allowedValues": [
                            "CanNotDelete",
                            "None",
                            "ReadOnly"
                          ],
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Specify the type of lock."
                          }
                        },
                        "notes": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Specify the notes of the lock."
                          }
                        }
                      },
                      "metadata": {
                        "description": "An AVM-aligned type for a lock.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "managedIdentityAllType": {
                      "type": "object",
                      "properties": {
                        "systemAssigned": {
                          "type": "bool",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Enables system assigned managed identity on the resource."
                          }
                        },
                        "userAssignedResourceIds": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The resource ID(s) to assign to the resource. Required if a user assigned identity is used for encryption."
                          }
                        }
                      },
                      "metadata": {
                        "description": "An AVM-aligned type for a managed identity configuration. To be used if both a system-assigned & user-assigned identities are supported by the resource provider.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "objectReplicationPolicyRuleType": {
                      "type": "object",
                      "properties": {
                        "ruleId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The ID of the rule. Auto-generated on destination account. Required for source account."
                          }
                        },
                        "containerName": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The name of the source container."
                          }
                        },
                        "destinationContainerName": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name of the destination container. If not provided, the same name as the source container will be used."
                          }
                        },
                        "filters": {
                          "type": "object",
                          "properties": {
                            "prefixMatch": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The prefix to match for the replication policy rule."
                              }
                            },
                            "minCreationTime": {
                              "type": "string",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The minimum creation time to match for the replication policy rule."
                              }
                            }
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The filters for the object replication policy rule."
                          }
                        }
                      },
                      "metadata": {
                        "description": "The type of an object replication policy rule.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "object-replication-policy/policy/main.bicep"
                        }
                      }
                    },
                    "permissionScopeType": {
                      "type": "object",
                      "properties": {
                        "permissions": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The permissions for the local user. Possible values include: Read (r), Write (w), Delete (d), List (l), and Create (c)."
                          }
                        },
                        "resourceName": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The name of resource, normally the container name or the file share name, used by the local user."
                          }
                        },
                        "service": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The service used by the local user, e.g. blob, file."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_imported_from!": {
                          "sourceTemplate": "local-user/main.bicep"
                        }
                      }
                    },
                    "privateEndpointMultiServiceType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name of the private endpoint."
                          }
                        },
                        "location": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The location to deploy the private endpoint to."
                          }
                        },
                        "privateLinkServiceConnectionName": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name of the private link connection to create."
                          }
                        },
                        "service": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The subresource to deploy the private endpoint for. For example \"blob\", \"table\", \"queue\" or \"file\" for a Storage Account's Private Endpoints."
                          }
                        },
                        "subnetResourceId": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. Resource ID of the subnet where the endpoint needs to be created."
                          }
                        },
                        "resourceGroupResourceId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The resource ID of the Resource Group the Private Endpoint will be created in. If not specified, the Resource Group of the provided Virtual Network Subnet is used."
                          }
                        },
                        "privateDnsZoneGroup": {
                          "$ref": "#/definitions/_2.privateEndpointPrivateDnsZoneGroupType",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The private DNS zone group to configure for the private endpoint."
                          }
                        },
                        "isManualConnection": {
                          "type": "bool",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. If Manual Private Link Connection is required."
                          }
                        },
                        "manualConnectionRequestMessage": {
                          "type": "string",
                          "nullable": true,
                          "maxLength": 140,
                          "metadata": {
                            "description": "Optional. A message passed to the owner of the remote resource with the manual connection request."
                          }
                        },
                        "customDnsConfigs": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/_2.privateEndpointCustomDnsConfigType"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Custom DNS configurations."
                          }
                        },
                        "ipConfigurations": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/_2.privateEndpointIpConfigurationType"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. A list of IP configurations of the private endpoint. This will be used to map to the First Party Service endpoints."
                          }
                        },
                        "applicationSecurityGroupResourceIds": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Application security groups in which the private endpoint IP configuration is included."
                          }
                        },
                        "customNetworkInterfaceName": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The custom name of the network interface attached to the private endpoint."
                          }
                        },
                        "lock": {
                          "$ref": "#/definitions/lockType",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Specify the type of lock."
                          }
                        },
                        "roleAssignments": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/roleAssignmentType"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Array of role assignments to create."
                          }
                        },
                        "tags": {
                          "type": "object",
                          "nullable": true,
                          "metadata": {
                            "__bicep_resource_derived_type!": {
                              "source": "Microsoft.Network/privateEndpoints@2024-07-01#properties/tags"
                            },
                            "description": "Optional. Tags to be applied on all resources/resource groups in this deployment."
                          }
                        },
                        "enableTelemetry": {
                          "type": "bool",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Enable/Disable usage telemetry for module."
                          }
                        }
                      },
                      "metadata": {
                        "description": "An AVM-aligned type for a private endpoint. To be used if the private endpoint's default service / groupId can NOT be assumed (i.e., for services that have more than one subresource, like Storage Account with Blob (blob, table, queue, file, ...).",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "queueCorsRuleType": {
                      "type": "object",
                      "properties": {
                        "allowedHeaders": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "metadata": {
                            "description": "Required. A list of headers allowed to be part of the cross-origin request."
                          }
                        },
                        "allowedMethods": {
                          "type": "array",
                          "allowedValues": [
                            "CONNECT",
                            "DELETE",
                            "GET",
                            "HEAD",
                            "MERGE",
                            "OPTIONS",
                            "PATCH",
                            "POST",
                            "PUT",
                            "TRACE"
                          ],
                          "metadata": {
                            "description": "Required. A list of HTTP methods that are allowed to be executed by the origin."
                          }
                        },
                        "allowedOrigins": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "metadata": {
                            "description": "Required. A list of origin domains that will be allowed via CORS, or \"*\" to allow all domains."
                          }
                        },
                        "exposedHeaders": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "metadata": {
                            "description": "Required. A list of response headers to expose to CORS clients."
                          }
                        },
                        "maxAgeInSeconds": {
                          "type": "int",
                          "metadata": {
                            "description": "Required. The number of seconds that the client/browser should cache a preflight response."
                          }
                        }
                      },
                      "metadata": {
                        "description": "The type for a cors rule.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "queue-service/main.bicep",
                          "originalIdentifier": "corsRuleType"
                        }
                      }
                    },
                    "queueType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The name of the queue."
                          }
                        },
                        "metadata": {
                          "type": "object",
                          "metadata": {
                            "__bicep_resource_derived_type!": {
                              "source": "Microsoft.Storage/storageAccounts/queueServices/queues@2024-01-01#properties/properties/properties/metadata"
                            },
                            "description": "Optional. Metadata to set on the queue."
                          },
                          "nullable": true
                        },
                        "roleAssignments": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/roleAssignmentType"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Array of role assignments to create."
                          }
                        }
                      },
                      "metadata": {
                        "description": "The type for a queue.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "queue-service/main.bicep"
                        }
                      }
                    },
                    "roleAssignmentType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                          }
                        },
                        "roleDefinitionIdOrName": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                          }
                        },
                        "principalId": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                          }
                        },
                        "principalType": {
                          "type": "string",
                          "allowedValues": [
                            "Device",
                            "ForeignGroup",
                            "Group",
                            "ServicePrincipal",
                            "User"
                          ],
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The principal type of the assigned principal ID."
                          }
                        },
                        "description": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The description of the role assignment."
                          }
                        },
                        "condition": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                          }
                        },
                        "conditionVersion": {
                          "type": "string",
                          "allowedValues": [
                            "2.0"
                          ],
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Version of the condition."
                          }
                        },
                        "delegatedManagedIdentityResourceId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                          }
                        }
                      },
                      "metadata": {
                        "description": "An AVM-aligned type for a role assignment.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "secretsOutputType": {
                      "type": "object",
                      "properties": {},
                      "additionalProperties": {
                        "$ref": "#/definitions/_2.secretSetOutputType",
                        "metadata": {
                          "description": "An exported secret's references."
                        }
                      },
                      "metadata": {
                        "description": "A map of the exported secrets",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "sshAuthorizedKeyType": {
                      "type": "object",
                      "properties": {
                        "description": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Description used to store the function/usage of the key."
                          }
                        },
                        "key": {
                          "type": "securestring",
                          "metadata": {
                            "description": "Required. SSH public key base64 encoded. The format should be: '{keyType} {keyData}', e.g. ssh-rsa AAAABBBB."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_imported_from!": {
                          "sourceTemplate": "local-user/main.bicep"
                        }
                      }
                    },
                    "tableCorsRuleType": {
                      "type": "object",
                      "properties": {
                        "allowedHeaders": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "metadata": {
                            "description": "Required. A list of headers allowed to be part of the cross-origin request."
                          }
                        },
                        "allowedMethods": {
                          "type": "array",
                          "allowedValues": [
                            "CONNECT",
                            "DELETE",
                            "GET",
                            "HEAD",
                            "MERGE",
                            "OPTIONS",
                            "PATCH",
                            "POST",
                            "PUT",
                            "TRACE"
                          ],
                          "metadata": {
                            "description": "Required. A list of HTTP methods that are allowed to be executed by the origin."
                          }
                        },
                        "allowedOrigins": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "metadata": {
                            "description": "Required. A list of origin domains that will be allowed via CORS, or \"*\" to allow all domains."
                          }
                        },
                        "exposedHeaders": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "metadata": {
                            "description": "Required. A list of response headers to expose to CORS clients."
                          }
                        },
                        "maxAgeInSeconds": {
                          "type": "int",
                          "metadata": {
                            "description": "Required. The number of seconds that the client/browser should cache a preflight response."
                          }
                        }
                      },
                      "metadata": {
                        "description": "The type for a cors rule.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "table-service/main.bicep",
                          "originalIdentifier": "corsRuleType"
                        }
                      }
                    },
                    "tableType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The name of the table."
                          }
                        },
                        "roleAssignments": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/roleAssignmentType"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Array of role assignments to create."
                          }
                        }
                      },
                      "metadata": {
                        "description": "The type for a table.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "table-service/main.bicep"
                        }
                      }
                    }
                  },
                  "parameters": {
                    "name": {
                      "type": "string",
                      "maxLength": 24,
                      "metadata": {
                        "description": "Required. Name of the Storage Account. Must be lower-case."
                      }
                    },
                    "location": {
                      "type": "string",
                      "defaultValue": "[resourceGroup().location]",
                      "metadata": {
                        "description": "Optional. Location for all resources."
                      }
                    },
                    "extendedLocationZone": {
                      "type": "string",
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. Extended Zone location (ex 'losangeles'). When supplied, the storage account will be created in the specified zone under the parent location. The extended zone must be available in the supplied parent location."
                      }
                    },
                    "roleAssignments": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/roleAssignmentType"
                      },
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. Array of role assignments to create."
                      }
                    },
                    "managedIdentities": {
                      "$ref": "#/definitions/managedIdentityAllType",
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. The managed identity definition for this resource."
                      }
                    },
                    "kind": {
                      "type": "string",
                      "defaultValue": "StorageV2",
                      "allowedValues": [
                        "Storage",
                        "StorageV2",
                        "BlobStorage",
                        "FileStorage",
                        "BlockBlobStorage"
                      ],
                      "metadata": {
                        "description": "Optional. Type of Storage Account to create."
                      }
                    },
                    "skuName": {
                      "type": "string",
                      "defaultValue": "Standard_GRS",
                      "allowedValues": [
                        "Standard_LRS",
                        "Standard_ZRS",
                        "Standard_GRS",
                        "Standard_GZRS",
                        "Standard_RAGRS",
                        "Standard_RAGZRS",
                        "StandardV2_LRS",
                        "StandardV2_ZRS",
                        "StandardV2_GRS",
                        "StandardV2_GZRS",
                        "Premium_LRS",
                        "Premium_ZRS",
                        "PremiumV2_LRS",
                        "PremiumV2_ZRS"
                      ],
                      "metadata": {
                        "description": "Optional. Storage Account Sku Name - note: certain V2 SKUs require the use of: kind = FileStorage."
                      }
                    },
                    "accessTier": {
                      "type": "string",
                      "defaultValue": "Hot",
                      "allowedValues": [
                        "Premium",
                        "Hot",
                        "Cool",
                        "Cold"
                      ],
                      "metadata": {
                        "description": "Conditional. Required if the Storage Account kind is set to BlobStorage. The access tier is used for billing. The \"Premium\" access tier is the default value for premium block blobs storage account type and it cannot be changed for the premium block blobs storage account type."
                      }
                    },
                    "largeFileSharesState": {
                      "type": "string",
                      "defaultValue": "Disabled",
                      "allowedValues": [
                        "Disabled",
                        "Enabled"
                      ],
                      "metadata": {
                        "description": "Optional. Allow large file shares if set to 'Enabled'. It cannot be disabled once it is enabled. Only supported on locally redundant and zone redundant file shares. It cannot be set on FileStorage storage accounts (storage accounts for premium file shares)."
                      }
                    },
                    "azureFilesIdentityBasedAuthentication": {
                      "type": "object",
                      "metadata": {
                        "__bicep_resource_derived_type!": {
                          "source": "Microsoft.Storage/storageAccounts@2025-01-01#properties/properties/properties/azureFilesIdentityBasedAuthentication"
                        },
                        "description": "Optional. Provides the identity based authentication settings for Azure Files."
                      },
                      "nullable": true
                    },
                    "defaultToOAuthAuthentication": {
                      "type": "bool",
                      "defaultValue": false,
                      "metadata": {
                        "description": "Optional. A boolean flag which indicates whether the default authentication is OAuth or not."
                      }
                    },
                    "allowSharedKeyAccess": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Optional. Indicates whether the storage account permits requests to be authorized with the account access key via Shared Key. If false, then all requests, including shared access signatures, must be authorized with Azure Active Directory (Azure AD). The default value is null, which is equivalent to true."
                      }
                    },
                    "privateEndpoints": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/privateEndpointMultiServiceType"
                      },
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. Configuration details for private endpoints. For security reasons, it is recommended to use private endpoints whenever possible."
                      }
                    },
                    "managementPolicyRules": {
                      "type": "array",
                      "metadata": {
                        "__bicep_resource_derived_type!": {
                          "source": "Microsoft.Storage/storageAccounts/managementPolicies@2025-01-01#properties/properties/properties/policy/properties/rules"
                        },
                        "description": "Optional. The Storage Account ManagementPolicies Rules."
                      },
                      "nullable": true
                    },
                    "networkAcls": {
                      "$ref": "#/definitions/networkAclsType",
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. Networks ACLs, this value contains IPs to whitelist and/or Subnet information. If in use, bypass needs to be supplied. For security reasons, it is recommended to set the DefaultAction Deny."
                      }
                    },
                    "requireInfrastructureEncryption": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Optional. A Boolean indicating whether or not the service applies a secondary layer of encryption with platform managed keys for data at rest. For security reasons, it is recommended to set it to true."
                      }
                    },
                    "allowCrossTenantReplication": {
                      "type": "bool",
                      "defaultValue": false,
                      "metadata": {
                        "description": "Optional. Allow or disallow cross AAD tenant object replication."
                      }
                    },
                    "customDomainName": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Optional. Sets the custom domain name assigned to the storage account. Name is the CNAME source."
                      }
                    },
                    "customDomainUseSubDomainName": {
                      "type": "bool",
                      "defaultValue": false,
                      "metadata": {
                        "description": "Optional. Indicates whether indirect CName validation is enabled. This should only be set on updates."
                      }
                    },
                    "dnsEndpointType": {
                      "type": "string",
                      "nullable": true,
                      "allowedValues": [
                        "AzureDnsZone",
                        "Standard"
                      ],
                      "metadata": {
                        "description": "Optional. Allows you to specify the type of endpoint. Set this to AzureDNSZone to create a large number of accounts in a single subscription, which creates accounts in an Azure DNS Zone and the endpoint URL will have an alphanumeric DNS Zone identifier."
                      }
                    },
                    "blobServices": {
                      "$ref": "#/definitions/blobServiceType",
                      "defaultValue": "[if(not(equals(parameters('kind'), 'FileStorage')), createObject('containerDeleteRetentionPolicyEnabled', true(), 'containerDeleteRetentionPolicyDays', 7, 'deleteRetentionPolicyEnabled', true(), 'deleteRetentionPolicyDays', 6), createObject())]",
                      "metadata": {
                        "description": "Optional. Blob service and containers to deploy."
                      }
                    },
                    "fileServices": {
                      "$ref": "#/definitions/fileServiceType",
                      "defaultValue": {},
                      "metadata": {
                        "description": "Optional. File service and shares to deploy."
                      }
                    },
                    "queueServices": {
                      "$ref": "#/definitions/queueServiceType",
                      "defaultValue": {},
                      "metadata": {
                        "description": "Optional. Queue service and queues to create."
                      }
                    },
                    "tableServices": {
                      "$ref": "#/definitions/tableServiceType",
                      "defaultValue": {},
                      "metadata": {
                        "description": "Optional. Table service and tables to create."
                      }
                    },
                    "allowBlobPublicAccess": {
                      "type": "bool",
                      "defaultValue": false,
                      "metadata": {
                        "description": "Optional. Indicates whether public access is enabled for all blobs or containers in the storage account. For security reasons, it is recommended to set it to false."
                      }
                    },
                    "minimumTlsVersion": {
                      "type": "string",
                      "defaultValue": "TLS1_2",
                      "allowedValues": [
                        "TLS1_2"
                      ],
                      "metadata": {
                        "description": "Optional. Set the minimum TLS version on request to storage. The TLS versions 1.0 and 1.1 are deprecated and not supported anymore."
                      }
                    },
                    "enableHierarchicalNamespace": {
                      "type": "bool",
                      "nullable": true,
                      "metadata": {
                        "description": "Conditional. If true, enables Hierarchical Namespace for the storage account. Required if enableSftp or enableNfsV3 is set to true."
                      }
                    },
                    "enableSftp": {
                      "type": "bool",
                      "defaultValue": false,
                      "metadata": {
                        "description": "Optional. If true, enables Secure File Transfer Protocol for the storage account. Requires enableHierarchicalNamespace to be true."
                      }
                    },
                    "localUsers": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/localUserType"
                      },
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. Local users to deploy for SFTP authentication."
                      }
                    },
                    "isLocalUserEnabled": {
                      "type": "bool",
                      "defaultValue": false,
                      "metadata": {
                        "description": "Optional. Enables local users feature, if set to true."
                      }
                    },
                    "enableNfsV3": {
                      "type": "bool",
                      "defaultValue": false,
                      "metadata": {
                        "description": "Optional. If true, enables NFS 3.0 support for the storage account. Requires enableHierarchicalNamespace to be true."
                      }
                    },
                    "diagnosticSettings": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/diagnosticSettingMetricsOnlyType"
                      },
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. The diagnostic settings of the service."
                      }
                    },
                    "lock": {
                      "$ref": "#/definitions/lockType",
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. The lock settings of the service."
                      }
                    },
                    "tags": {
                      "type": "object",
                      "metadata": {
                        "__bicep_resource_derived_type!": {
                          "source": "Microsoft.Storage/storageAccounts@2025-01-01#properties/tags"
                        },
                        "description": "Optional. Tags of the resource."
                      },
                      "nullable": true
                    },
                    "enableTelemetry": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Optional. Enable/Disable usage telemetry for module."
                      }
                    },
                    "allowedCopyScope": {
                      "type": "string",
                      "nullable": true,
                      "allowedValues": [
                        "AAD",
                        "PrivateLink"
                      ],
                      "metadata": {
                        "description": "Optional. Restrict copy to and from Storage Accounts within an AAD tenant or with Private Links to the same VNet."
                      }
                    },
                    "publicNetworkAccess": {
                      "type": "string",
                      "nullable": true,
                      "allowedValues": [
                        "Enabled",
                        "Disabled",
                        "SecuredByPerimeter"
                      ],
                      "metadata": {
                        "description": "Optional. Whether or not public network access is allowed for this resource. For security reasons it should be disabled. If not specified, it will be disabled by default if private endpoints are set and networkAcls are not set."
                      }
                    },
                    "supportsHttpsTrafficOnly": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Optional. Allows HTTPS traffic only to storage service if sets to true."
                      }
                    },
                    "customerManagedKey": {
                      "$ref": "#/definitions/customerManagedKeyWithAutoRotateType",
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. The customer managed key definition."
                      }
                    },
                    "sasExpirationPeriod": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Optional. The SAS expiration period. DD.HH:MM:SS."
                      }
                    },
                    "sasExpirationAction": {
                      "type": "string",
                      "defaultValue": "Log",
                      "allowedValues": [
                        "Block",
                        "Log"
                      ],
                      "metadata": {
                        "description": "Optional. The SAS expiration action. Allowed values are Block and Log."
                      }
                    },
                    "keyType": {
                      "type": "string",
                      "nullable": true,
                      "allowedValues": [
                        "Account",
                        "Service"
                      ],
                      "metadata": {
                        "description": "Optional. The keyType to use with Queue & Table services."
                      }
                    },
                    "secretsExportConfiguration": {
                      "$ref": "#/definitions/secretsExportConfigurationType",
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. Key vault reference and secret settings for the module's secrets export."
                      }
                    },
                    "immutableStorageWithVersioning": {
                      "type": "object",
                      "metadata": {
                        "__bicep_resource_derived_type!": {
                          "source": "Microsoft.Storage/storageAccounts@2025-01-01#properties/properties/properties/immutableStorageWithVersioning"
                        },
                        "description": "Optional. The property is immutable and can only be set to true at the account creation time. When set to true, it enables object level immutability for all the new containers in the account by default. Cannot be enabled for ADLS Gen2 storage accounts."
                      },
                      "nullable": true
                    },
                    "objectReplicationPolicies": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/objectReplicationPolicyType"
                      },
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. Object replication policies for the storage account."
                      }
                    }
                  },
                  "variables": {
                    "copy": [
                      {
                        "name": "formattedRoleAssignments",
                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                      }
                    ],
                    "enableReferencedModulesTelemetry": false,
                    "immutabilityValidation": "[if(and(equals(parameters('enableHierarchicalNamespace'), true()), not(empty(parameters('immutableStorageWithVersioning')))), fail('Configuration error: Immutable storage with versioning cannot be enabled when hierarchical namespace is enabled.'), null())]",
                    "supportsBlobService": "[or(or(or(equals(parameters('kind'), 'BlockBlobStorage'), equals(parameters('kind'), 'BlobStorage')), equals(parameters('kind'), 'StorageV2')), equals(parameters('kind'), 'Storage'))]",
                    "supportsFileService": "[or(or(equals(parameters('kind'), 'FileStorage'), equals(parameters('kind'), 'StorageV2')), equals(parameters('kind'), 'Storage'))]",
                    "formattedUserAssignedIdentities": "[reduce(map(coalesce(tryGet(parameters('managedIdentities'), 'userAssignedResourceIds'), createArray()), lambda('id', createObject(format('{0}', lambdaVariables('id')), createObject()))), createObject(), lambda('cur', 'next', union(lambdaVariables('cur'), lambdaVariables('next'))))]",
                    "identity": "[if(not(empty(parameters('managedIdentities'))), createObject('type', if(coalesce(tryGet(parameters('managedIdentities'), 'systemAssigned'), false()), if(not(empty(coalesce(tryGet(parameters('managedIdentities'), 'userAssignedResourceIds'), createObject()))), 'SystemAssigned,UserAssigned', 'SystemAssigned'), if(not(empty(coalesce(tryGet(parameters('managedIdentities'), 'userAssignedResourceIds'), createObject()))), 'UserAssigned', 'None')), 'userAssignedIdentities', if(not(empty(variables('formattedUserAssignedIdentities'))), variables('formattedUserAssignedIdentities'), null())), null())]",
                    "builtInRoleNames": {
                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                      "Reader and Data Access": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'c12c1c16-33a1-487b-954d-41c89c60f349')]",
                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                      "Storage Account Backup Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'e5e2a7ff-d759-4cd2-bb51-3152d37e2eb1')]",
                      "Storage Account Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '17d1049b-9a84-46fb-8f53-869881c3d3ab')]",
                      "Storage Account Key Operator Service Role": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '81a9662b-bebf-436f-a333-f67b29880f12')]",
                      "Storage Blob Data Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'ba92f5b4-2d11-453d-a403-e96b0029c9fe')]",
                      "Storage Blob Data Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b7e6dc6d-f1e8-4753-8033-0f276bb0955b')]",
                      "Storage Blob Data Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '2a2b9908-6ea1-4ae2-8e65-a410df84e7d1')]",
                      "Storage Blob Delegator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'db58b8e5-c6ad-4a2a-8342-4190687cbf4a')]",
                      "Storage File Data Privileged Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '69566ab7-960f-475b-8e7c-b3118f30c6bd')]",
                      "Storage File Data Privileged Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b8eda974-7b85-4f76-af95-65846b26df6d')]",
                      "Storage File Data SMB Share Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '0c867c2a-1d8c-454a-a3db-ab2ea1bdc8bb')]",
                      "Storage File Data SMB Share Elevated Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'a7264617-510b-434b-a828-9731dc254ea7')]",
                      "Storage File Data SMB Share Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'aba4ae5f-2193-4029-9191-0cb91df5e314')]",
                      "Storage Queue Data Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '974c5e8b-45b9-4653-ba55-5f855dd0fb88')]",
                      "Storage Queue Data Message Processor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8a0f0c08-91a1-4084-bc3d-661d67233fed')]",
                      "Storage Queue Data Message Sender": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'c6a89b2d-59bc-44d0-9896-0f6e12d7b80a')]",
                      "Storage Queue Data Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '19e7f393-937e-4f77-808e-94535e297925')]",
                      "Storage Table Data Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '0a9a7e1f-b9d0-4cc4-a60d-0319b160aaa3')]",
                      "Storage Table Data Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '76199698-9eea-4c19-bc75-cec21354c6b6')]",
                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                    },
                    "formattedManagementPolicies": "[union(coalesce(parameters('managementPolicyRules'), createArray()), if(and(and(not(empty(parameters('blobServices'))), coalesce(tryGet(parameters('blobServices'), 'isVersioningEnabled'), false())), not(equals(tryGet(parameters('blobServices'), 'versionDeletePolicyDays'), null()))), createArray(createObject('name', 'DeletePreviousVersions (auto-created)', 'enabled', true(), 'type', 'Lifecycle', 'definition', createObject('actions', createObject('version', createObject('delete', createObject('daysAfterCreationGreaterThan', parameters('blobServices').versionDeletePolicyDays))), 'filters', createObject('blobTypes', createArray('blockBlob', 'appendBlob'))))), createArray()))]",
                    "isHSMManagedCMK": "[equals(tryGet(split(coalesce(tryGet(parameters('customerManagedKey'), 'keyVaultResourceId'), ''), '/'), 7), 'managedHSMs')]"
                  },
                  "resources": {
                    "cMKKeyVault::cMKKey": {
                      "condition": "[and(and(not(variables('isHSMManagedCMK')), not(empty(tryGet(parameters('customerManagedKey'), 'keyVaultResourceId')))), and(not(empty(tryGet(parameters('customerManagedKey'), 'keyVaultResourceId'))), not(empty(tryGet(parameters('customerManagedKey'), 'keyName')))))]",
                      "existing": true,
                      "type": "Microsoft.KeyVault/vaults/keys",
                      "apiVersion": "2024-11-01",
                      "subscriptionId": "[split(tryGet(parameters('customerManagedKey'), 'keyVaultResourceId'), '/')[2]]",
                      "resourceGroup": "[split(tryGet(parameters('customerManagedKey'), 'keyVaultResourceId'), '/')[4]]",
                      "name": "[format('{0}/{1}', last(split(tryGet(parameters('customerManagedKey'), 'keyVaultResourceId'), '/')), tryGet(parameters('customerManagedKey'), 'keyName'))]"
                    },
                    "avmTelemetry": {
                      "condition": "[parameters('enableTelemetry')]",
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "[format('46d3xbcp.res.storage-storageaccount.{0}.{1}', replace('0.31.0', '.', '-'), substring(uniqueString(deployment().name, parameters('location')), 0, 4))]",
                      "properties": {
                        "mode": "Incremental",
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "resources": [],
                          "outputs": {
                            "telemetry": {
                              "type": "String",
                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                            }
                          }
                        }
                      }
                    },
                    "cMKKeyVault": {
                      "condition": "[and(not(variables('isHSMManagedCMK')), not(empty(tryGet(parameters('customerManagedKey'), 'keyVaultResourceId'))))]",
                      "existing": true,
                      "type": "Microsoft.KeyVault/vaults",
                      "apiVersion": "2025-05-01",
                      "subscriptionId": "[split(tryGet(parameters('customerManagedKey'), 'keyVaultResourceId'), '/')[2]]",
                      "resourceGroup": "[split(tryGet(parameters('customerManagedKey'), 'keyVaultResourceId'), '/')[4]]",
                      "name": "[last(split(tryGet(parameters('customerManagedKey'), 'keyVaultResourceId'), '/'))]"
                    },
                    "cMKUserAssignedIdentity": {
                      "condition": "[not(empty(tryGet(parameters('customerManagedKey'), 'userAssignedIdentityResourceId')))]",
                      "existing": true,
                      "type": "Microsoft.ManagedIdentity/userAssignedIdentities",
                      "apiVersion": "2024-11-30",
                      "subscriptionId": "[split(tryGet(parameters('customerManagedKey'), 'userAssignedIdentityResourceId'), '/')[2]]",
                      "resourceGroup": "[split(tryGet(parameters('customerManagedKey'), 'userAssignedIdentityResourceId'), '/')[4]]",
                      "name": "[last(split(tryGet(parameters('customerManagedKey'), 'userAssignedIdentityResourceId'), '/'))]"
                    },
                    "storageAccount": {
                      "type": "Microsoft.Storage/storageAccounts",
                      "apiVersion": "2025-01-01",
                      "name": "[parameters('name')]",
                      "location": "[parameters('location')]",
                      "extendedLocation": "[if(not(empty(parameters('extendedLocationZone'))), createObject('name', parameters('extendedLocationZone'), 'type', 'EdgeZone'), null())]",
                      "kind": "[parameters('kind')]",
                      "sku": {
                        "name": "[parameters('skuName')]"
                      },
                      "identity": "[variables('identity')]",
                      "tags": "[parameters('tags')]",
                      "properties": "[shallowMerge(createArray(createObject('allowSharedKeyAccess', parameters('allowSharedKeyAccess'), 'defaultToOAuthAuthentication', parameters('defaultToOAuthAuthentication'), 'allowCrossTenantReplication', parameters('allowCrossTenantReplication'), 'allowedCopyScope', parameters('allowedCopyScope'), 'customDomain', createObject('name', parameters('customDomainName'), 'useSubDomainName', parameters('customDomainUseSubDomainName')), 'dnsEndpointType', parameters('dnsEndpointType'), 'isLocalUserEnabled', parameters('isLocalUserEnabled'), 'encryption', union(createObject('keySource', if(not(empty(parameters('customerManagedKey'))), 'Microsoft.Keyvault', 'Microsoft.Storage'), 'services', createObject('blob', if(variables('supportsBlobService'), createObject('enabled', true()), null()), 'file', if(variables('supportsFileService'), createObject('enabled', true()), null()), 'table', createObject('enabled', true(), 'keyType', parameters('keyType')), 'queue', createObject('enabled', true(), 'keyType', parameters('keyType'))), 'keyvaultproperties', if(not(empty(parameters('customerManagedKey'))), createObject('keyname', parameters('customerManagedKey').keyName, 'keyvaulturi', if(not(variables('isHSMManagedCMK')), reference('cMKKeyVault').vaultUri, format('https://{0}.managedhsm.azure.net/', last(split(parameters('customerManagedKey').keyVaultResourceId, '/')))), 'keyversion', if(not(empty(tryGet(parameters('customerManagedKey'), 'keyVersion'))), parameters('customerManagedKey').keyVersion, if(coalesce(tryGet(parameters('customerManagedKey'), 'autoRotationEnabled'), true()), null(), if(not(variables('isHSMManagedCMK')), last(split(reference('cMKKeyVault::cMKKey').keyUriWithVersion, '/')), fail('Managed HSM CMK encryption requires either specifying the ''keyVersion'' or omitting the ''autoRotationEnabled'' property. Setting ''autoRotationEnabled'' to false without a ''keyVersion'' is not allowed.'))))), null()), 'identity', createObject('userAssignedIdentity', if(not(empty(tryGet(parameters('customerManagedKey'), 'userAssignedIdentityResourceId'))), extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', split(tryGet(parameters('customerManagedKey'), 'userAssignedIdentityResourceId'), '/')[2], split(tryGet(parameters('customerManagedKey'), 'userAssignedIdentityResourceId'), '/')[4]), 'Microsoft.ManagedIdentity/userAssignedIdentities', last(split(tryGet(parameters('customerManagedKey'), 'userAssignedIdentityResourceId'), '/'))), null()))), if(parameters('requireInfrastructureEncryption'), createObject('requireInfrastructureEncryption', if(not(equals(parameters('kind'), 'Storage')), parameters('requireInfrastructureEncryption'), null())), createObject())), 'accessTier', if(and(not(equals(parameters('kind'), 'Storage')), not(equals(parameters('kind'), 'BlockBlobStorage'))), parameters('accessTier'), null()), 'sasPolicy', if(not(empty(parameters('sasExpirationPeriod'))), createObject('expirationAction', parameters('sasExpirationAction'), 'sasExpirationPeriod', parameters('sasExpirationPeriod')), null()), 'supportsHttpsTrafficOnly', parameters('supportsHttpsTrafficOnly'), 'isSftpEnabled', parameters('enableSftp'), 'isNfsV3Enabled', if(parameters('enableNfsV3'), parameters('enableNfsV3'), ''), 'largeFileSharesState', if(or(equals(parameters('skuName'), 'Standard_LRS'), equals(parameters('skuName'), 'Standard_ZRS')), parameters('largeFileSharesState'), null()), 'minimumTlsVersion', parameters('minimumTlsVersion'), 'networkAcls', if(not(empty(parameters('networkAcls'))), union(createObject('resourceAccessRules', tryGet(parameters('networkAcls'), 'resourceAccessRules'), 'defaultAction', coalesce(tryGet(parameters('networkAcls'), 'defaultAction'), 'Deny'), 'virtualNetworkRules', tryGet(parameters('networkAcls'), 'virtualNetworkRules'), 'ipRules', tryGet(parameters('networkAcls'), 'ipRules')), if(contains(parameters('networkAcls'), 'bypass'), createObject('bypass', tryGet(parameters('networkAcls'), 'bypass')), createObject())), createObject('bypass', 'AzureServices', 'defaultAction', 'Deny')), 'allowBlobPublicAccess', parameters('allowBlobPublicAccess'), 'publicNetworkAccess', if(not(empty(parameters('publicNetworkAccess'))), parameters('publicNetworkAccess'), if(and(not(empty(parameters('privateEndpoints'))), empty(parameters('networkAcls'))), 'Disabled', null()))), if(not(empty(parameters('azureFilesIdentityBasedAuthentication'))), createObject('azureFilesIdentityBasedAuthentication', parameters('azureFilesIdentityBasedAuthentication')), createObject()), if(not(equals(parameters('enableHierarchicalNamespace'), null())), createObject('isHnsEnabled', parameters('enableHierarchicalNamespace')), createObject()), createObject('immutableStorageWithVersioning', parameters('immutableStorageWithVersioning'))))]",
                      "dependsOn": [
                        "cMKKeyVault",
                        "cMKKeyVault::cMKKey"
                      ]
                    },
                    "storageAccount_diagnosticSettings": {
                      "copy": {
                        "name": "storageAccount_diagnosticSettings",
                        "count": "[length(coalesce(parameters('diagnosticSettings'), createArray()))]"
                      },
                      "type": "Microsoft.Insights/diagnosticSettings",
                      "apiVersion": "2021-05-01-preview",
                      "scope": "[format('Microsoft.Storage/storageAccounts/{0}', parameters('name'))]",
                      "name": "[coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'name'), format('{0}-diagnosticSettings', parameters('name')))]",
                      "properties": {
                        "copy": [
                          {
                            "name": "metrics",
                            "count": "[length(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'metricCategories'), createArray(createObject('category', 'AllMetrics'))))]",
                            "input": {
                              "category": "[coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'metricCategories'), createArray(createObject('category', 'AllMetrics')))[copyIndex('metrics')].category]",
                              "enabled": "[coalesce(tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'metricCategories'), createArray(createObject('category', 'AllMetrics')))[copyIndex('metrics')], 'enabled'), true())]",
                              "timeGrain": null
                            }
                          }
                        ],
                        "storageAccountId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'storageAccountResourceId')]",
                        "workspaceId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'workspaceResourceId')]",
                        "eventHubAuthorizationRuleId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'eventHubAuthorizationRuleResourceId')]",
                        "eventHubName": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'eventHubName')]",
                        "marketplacePartnerId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'marketplacePartnerResourceId')]",
                        "logAnalyticsDestinationType": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logAnalyticsDestinationType')]"
                      },
                      "dependsOn": [
                        "storageAccount"
                      ]
                    },
                    "storageAccount_lock": {
                      "condition": "[and(not(empty(coalesce(parameters('lock'), createObject()))), not(equals(tryGet(parameters('lock'), 'kind'), 'None')))]",
                      "type": "Microsoft.Authorization/locks",
                      "apiVersion": "2020-05-01",
                      "scope": "[format('Microsoft.Storage/storageAccounts/{0}', parameters('name'))]",
                      "name": "[coalesce(tryGet(parameters('lock'), 'name'), format('lock-{0}', parameters('name')))]",
                      "properties": {
                        "level": "[coalesce(tryGet(parameters('lock'), 'kind'), '')]",
                        "notes": "[coalesce(tryGet(parameters('lock'), 'notes'), if(equals(tryGet(parameters('lock'), 'kind'), 'CanNotDelete'), 'Cannot delete resource or child resources.', 'Cannot delete or modify the resource or child resources.'))]"
                      },
                      "dependsOn": [
                        "storageAccount"
                      ]
                    },
                    "storageAccount_roleAssignments": {
                      "copy": {
                        "name": "storageAccount_roleAssignments",
                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                      },
                      "type": "Microsoft.Authorization/roleAssignments",
                      "apiVersion": "2022-04-01",
                      "scope": "[format('Microsoft.Storage/storageAccounts/{0}', parameters('name'))]",
                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Storage/storageAccounts', parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                      "properties": {
                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                      },
                      "dependsOn": [
                        "storageAccount"
                      ]
                    },
                    "storageAccount_privateEndpoints": {
                      "copy": {
                        "name": "storageAccount_privateEndpoints",
                        "count": "[length(coalesce(parameters('privateEndpoints'), createArray()))]"
                      },
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "[format('{0}-sa-PrivateEndpoint-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                      "subscriptionId": "[split(coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'resourceGroupResourceId'), resourceGroup().id), '/')[2]]",
                      "resourceGroup": "[split(coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'resourceGroupResourceId'), resourceGroup().id), '/')[4]]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "name": {
                            "value": "[coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'name'), format('pep-{0}-{1}-{2}', last(split(resourceId('Microsoft.Storage/storageAccounts', parameters('name')), '/')), coalesce(parameters('privateEndpoints'), createArray())[copyIndex()].service, copyIndex()))]"
                          },
                          "privateLinkServiceConnections": "[if(not(equals(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'isManualConnection'), true())), createObject('value', createArray(createObject('name', coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'privateLinkServiceConnectionName'), format('{0}-{1}-{2}', last(split(resourceId('Microsoft.Storage/storageAccounts', parameters('name')), '/')), coalesce(parameters('privateEndpoints'), createArray())[copyIndex()].service, copyIndex())), 'properties', createObject('privateLinkServiceId', resourceId('Microsoft.Storage/storageAccounts', parameters('name')), 'groupIds', createArray(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()].service))))), createObject('value', null()))]",
                          "manualPrivateLinkServiceConnections": "[if(equals(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'isManualConnection'), true()), createObject('value', createArray(createObject('name', coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'privateLinkServiceConnectionName'), format('{0}-{1}-{2}', last(split(resourceId('Microsoft.Storage/storageAccounts', parameters('name')), '/')), coalesce(parameters('privateEndpoints'), createArray())[copyIndex()].service, copyIndex())), 'properties', createObject('privateLinkServiceId', resourceId('Microsoft.Storage/storageAccounts', parameters('name')), 'groupIds', createArray(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()].service), 'requestMessage', coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'manualConnectionRequestMessage'), 'Manual approval required.'))))), createObject('value', null()))]",
                          "subnetResourceId": {
                            "value": "[coalesce(parameters('privateEndpoints'), createArray())[copyIndex()].subnetResourceId]"
                          },
                          "enableTelemetry": {
                            "value": "[variables('enableReferencedModulesTelemetry')]"
                          },
                          "location": {
                            "value": "[coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'location'), reference(split(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()].subnetResourceId, '/subnets/')[0], '2020-06-01', 'Full').location)]"
                          },
                          "lock": {
                            "value": "[coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'lock'), parameters('lock'))]"
                          },
                          "privateDnsZoneGroup": {
                            "value": "[tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'privateDnsZoneGroup')]"
                          },
                          "roleAssignments": {
                            "value": "[tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'roleAssignments')]"
                          },
                          "tags": {
                            "value": "[coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'tags'), parameters('tags'))]"
                          },
                          "customDnsConfigs": {
                            "value": "[tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'customDnsConfigs')]"
                          },
                          "ipConfigurations": {
                            "value": "[tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'ipConfigurations')]"
                          },
                          "applicationSecurityGroupResourceIds": {
                            "value": "[tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'applicationSecurityGroupResourceIds')]"
                          },
                          "customNetworkInterfaceName": {
                            "value": "[tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'customNetworkInterfaceName')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.38.5.1644",
                              "templateHash": "16604612898799598358"
                            },
                            "name": "Private Endpoints",
                            "description": "This module deploys a Private Endpoint."
                          },
                          "definitions": {
                            "privateDnsZoneGroupType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name of the Private DNS Zone Group."
                                  }
                                },
                                "privateDnsZoneGroupConfigs": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/privateDnsZoneGroupConfigType"
                                  },
                                  "metadata": {
                                    "description": "Required. The private DNS zone groups to associate the private endpoint. A DNS zone group can support up to 5 DNS zones."
                                  }
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type of a private dns zone group."
                              }
                            },
                            "lockType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Specify the name of lock."
                                  }
                                },
                                "kind": {
                                  "type": "string",
                                  "allowedValues": [
                                    "CanNotDelete",
                                    "None",
                                    "ReadOnly"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Specify the type of lock."
                                  }
                                },
                                "notes": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Specify the notes of the lock."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for a lock.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                                }
                              }
                            },
                            "privateDnsZoneGroupConfigType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name of the private DNS zone group config."
                                  }
                                },
                                "privateDnsZoneResourceId": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The resource id of the private DNS zone."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "The type of a private DNS zone group configuration.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "private-dns-zone-group/main.bicep"
                                }
                              }
                            },
                            "roleAssignmentType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                  }
                                },
                                "roleDefinitionIdOrName": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                  }
                                },
                                "principalId": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                  }
                                },
                                "principalType": {
                                  "type": "string",
                                  "allowedValues": [
                                    "Device",
                                    "ForeignGroup",
                                    "Group",
                                    "ServicePrincipal",
                                    "User"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The principal type of the assigned principal ID."
                                  }
                                },
                                "description": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The description of the role assignment."
                                  }
                                },
                                "condition": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                  }
                                },
                                "conditionVersion": {
                                  "type": "string",
                                  "allowedValues": [
                                    "2.0"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Version of the condition."
                                  }
                                },
                                "delegatedManagedIdentityResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The Resource Id of the delegated managed identity resource."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for a role assignment.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                                }
                              }
                            }
                          },
                          "parameters": {
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. Name of the private endpoint resource to create."
                              }
                            },
                            "subnetResourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. Resource ID of the subnet where the endpoint needs to be created."
                              }
                            },
                            "applicationSecurityGroupResourceIds": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Application security groups in which the private endpoint IP configuration is included."
                              }
                            },
                            "customNetworkInterfaceName": {
                              "type": "string",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The custom name of the network interface attached to the private endpoint."
                              }
                            },
                            "ipConfigurations": {
                              "type": "array",
                              "metadata": {
                                "__bicep_resource_derived_type!": {
                                  "source": "Microsoft.Network/privateEndpoints@2024-01-01#properties/properties/properties/ipConfigurations"
                                },
                                "description": "Optional. A list of IP configurations of the private endpoint. This will be used to map to the First Party Service endpoints."
                              },
                              "nullable": true
                            },
                            "privateDnsZoneGroup": {
                              "$ref": "#/definitions/privateDnsZoneGroupType",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The private DNS zone group to configure for the private endpoint."
                              }
                            },
                            "location": {
                              "type": "string",
                              "defaultValue": "[resourceGroup().location]",
                              "metadata": {
                                "description": "Optional. Location for all Resources."
                              }
                            },
                            "lock": {
                              "$ref": "#/definitions/lockType",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The lock settings of the service."
                              }
                            },
                            "roleAssignments": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/roleAssignmentType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of role assignments to create."
                              }
                            },
                            "tags": {
                              "type": "object",
                              "metadata": {
                                "__bicep_resource_derived_type!": {
                                  "source": "Microsoft.Network/privateEndpoints@2024-01-01#properties/tags"
                                },
                                "description": "Optional. Tags to be applied on all resources/resource groups in this deployment."
                              },
                              "nullable": true
                            },
                            "customDnsConfigs": {
                              "type": "array",
                              "metadata": {
                                "__bicep_resource_derived_type!": {
                                  "source": "Microsoft.Network/privateEndpoints@2024-01-01#properties/properties/properties/customDnsConfigs"
                                },
                                "description": "Optional. Custom DNS configurations."
                              },
                              "nullable": true
                            },
                            "manualPrivateLinkServiceConnections": {
                              "type": "array",
                              "metadata": {
                                "__bicep_resource_derived_type!": {
                                  "source": "Microsoft.Network/privateEndpoints@2024-01-01#properties/properties/properties/manualPrivateLinkServiceConnections"
                                },
                                "description": "Conditional. A grouping of information about the connection to the remote resource. Used when the network admin does not have access to approve connections to the remote resource. Required if `privateLinkServiceConnections` is empty."
                              },
                              "nullable": true
                            },
                            "privateLinkServiceConnections": {
                              "type": "array",
                              "metadata": {
                                "__bicep_resource_derived_type!": {
                                  "source": "Microsoft.Network/privateEndpoints@2024-01-01#properties/properties/properties/privateLinkServiceConnections"
                                },
                                "description": "Conditional. A grouping of information about the connection to the remote resource. Required if `manualPrivateLinkServiceConnections` is empty."
                              },
                              "nullable": true
                            },
                            "enableTelemetry": {
                              "type": "bool",
                              "defaultValue": true,
                              "metadata": {
                                "description": "Optional. Enable/Disable usage telemetry for module."
                              }
                            }
                          },
                          "variables": {
                            "copy": [
                              {
                                "name": "formattedRoleAssignments",
                                "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                              }
                            ],
                            "builtInRoleNames": {
                              "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                              "DNS Resolver Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '0f2ebee7-ffd4-4fc0-b3b7-664099fdad5d')]",
                              "DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'befefa01-2a29-4197-83a8-272ff33ce314')]",
                              "Domain Services Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'eeaeda52-9324-47f6-8069-5d5bade478b2')]",
                              "Domain Services Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '361898ef-9ed1-48c2-849c-a832951106bb')]",
                              "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                              "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                              "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                              "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                              "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]"
                            }
                          },
                          "resources": {
                            "avmTelemetry": {
                              "condition": "[parameters('enableTelemetry')]",
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2025-04-01",
                              "name": "[format('46d3xbcp.res.network-privateendpoint.{0}.{1}', replace('0.11.1', '.', '-'), substring(uniqueString(deployment().name, parameters('location')), 0, 4))]",
                              "properties": {
                                "mode": "Incremental",
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "contentVersion": "1.0.0.0",
                                  "resources": [],
                                  "outputs": {
                                    "telemetry": {
                                      "type": "String",
                                      "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                    }
                                  }
                                }
                              }
                            },
                            "privateEndpoint": {
                              "type": "Microsoft.Network/privateEndpoints",
                              "apiVersion": "2024-10-01",
                              "name": "[parameters('name')]",
                              "location": "[parameters('location')]",
                              "tags": "[parameters('tags')]",
                              "properties": {
                                "copy": [
                                  {
                                    "name": "applicationSecurityGroups",
                                    "count": "[length(coalesce(parameters('applicationSecurityGroupResourceIds'), createArray()))]",
                                    "input": {
                                      "id": "[coalesce(parameters('applicationSecurityGroupResourceIds'), createArray())[copyIndex('applicationSecurityGroups')]]"
                                    }
                                  }
                                ],
                                "customDnsConfigs": "[coalesce(parameters('customDnsConfigs'), createArray())]",
                                "customNetworkInterfaceName": "[coalesce(parameters('customNetworkInterfaceName'), '')]",
                                "ipConfigurations": "[coalesce(parameters('ipConfigurations'), createArray())]",
                                "manualPrivateLinkServiceConnections": "[coalesce(parameters('manualPrivateLinkServiceConnections'), createArray())]",
                                "privateLinkServiceConnections": "[coalesce(parameters('privateLinkServiceConnections'), createArray())]",
                                "subnet": {
                                  "id": "[parameters('subnetResourceId')]"
                                }
                              }
                            },
                            "privateEndpoint_lock": {
                              "condition": "[and(not(empty(coalesce(parameters('lock'), createObject()))), not(equals(tryGet(parameters('lock'), 'kind'), 'None')))]",
                              "type": "Microsoft.Authorization/locks",
                              "apiVersion": "2020-05-01",
                              "scope": "[format('Microsoft.Network/privateEndpoints/{0}', parameters('name'))]",
                              "name": "[coalesce(tryGet(parameters('lock'), 'name'), format('lock-{0}', parameters('name')))]",
                              "properties": {
                                "level": "[coalesce(tryGet(parameters('lock'), 'kind'), '')]",
                                "notes": "[coalesce(tryGet(parameters('lock'), 'notes'), if(equals(tryGet(parameters('lock'), 'kind'), 'CanNotDelete'), 'Cannot delete resource or child resources.', 'Cannot delete or modify the resource or child resources.'))]"
                              },
                              "dependsOn": [
                                "privateEndpoint"
                              ]
                            },
                            "privateEndpoint_roleAssignments": {
                              "copy": {
                                "name": "privateEndpoint_roleAssignments",
                                "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                              },
                              "type": "Microsoft.Authorization/roleAssignments",
                              "apiVersion": "2022-04-01",
                              "scope": "[format('Microsoft.Network/privateEndpoints/{0}', parameters('name'))]",
                              "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateEndpoints', parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                              "properties": {
                                "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                              },
                              "dependsOn": [
                                "privateEndpoint"
                              ]
                            },
                            "privateEndpoint_privateDnsZoneGroup": {
                              "condition": "[not(empty(parameters('privateDnsZoneGroup')))]",
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2025-04-01",
                              "name": "[format('{0}-PrivateEndpoint-PrivateDnsZoneGroup', uniqueString(deployment().name))]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "name": {
                                    "value": "[tryGet(parameters('privateDnsZoneGroup'), 'name')]"
                                  },
                                  "privateEndpointName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "privateDnsZoneConfigs": {
                                    "value": "[parameters('privateDnsZoneGroup').privateDnsZoneGroupConfigs]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.38.5.1644",
                                      "templateHash": "24141742673128945"
                                    },
                                    "name": "Private Endpoint Private DNS Zone Groups",
                                    "description": "This module deploys a Private Endpoint Private DNS Zone Group."
                                  },
                                  "definitions": {
                                    "privateDnsZoneGroupConfigType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name of the private DNS zone group config."
                                          }
                                        },
                                        "privateDnsZoneResourceId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The resource id of the private DNS zone."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "__bicep_export!": true,
                                        "description": "The type of a private DNS zone group configuration."
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateEndpointName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent private endpoint. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "privateDnsZoneConfigs": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/privateDnsZoneGroupConfigType"
                                      },
                                      "minLength": 1,
                                      "maxLength": 5,
                                      "metadata": {
                                        "description": "Required. Array of private DNS zone configurations of the private DNS zone group. A DNS zone group can support up to 5 DNS zones."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "defaultValue": "default",
                                      "metadata": {
                                        "description": "Optional. The name of the private DNS zone group."
                                      }
                                    }
                                  },
                                  "resources": {
                                    "privateEndpoint": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateEndpoints",
                                      "apiVersion": "2024-10-01",
                                      "name": "[parameters('privateEndpointName')]"
                                    },
                                    "privateDnsZoneGroup": {
                                      "type": "Microsoft.Network/privateEndpoints/privateDnsZoneGroups",
                                      "apiVersion": "2024-10-01",
                                      "name": "[format('{0}/{1}', parameters('privateEndpointName'), parameters('name'))]",
                                      "properties": {
                                        "copy": [
                                          {
                                            "name": "privateDnsZoneConfigs",
                                            "count": "[length(parameters('privateDnsZoneConfigs'))]",
                                            "input": {
                                              "name": "[coalesce(tryGet(parameters('privateDnsZoneConfigs')[copyIndex('privateDnsZoneConfigs')], 'name'), last(split(parameters('privateDnsZoneConfigs')[copyIndex('privateDnsZoneConfigs')].privateDnsZoneResourceId, '/')))]",
                                              "properties": {
                                                "privateDnsZoneId": "[parameters('privateDnsZoneConfigs')[copyIndex('privateDnsZoneConfigs')].privateDnsZoneResourceId]"
                                              }
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the private endpoint DNS zone group."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the private endpoint DNS zone group."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateEndpoints/privateDnsZoneGroups', parameters('privateEndpointName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group the private endpoint DNS zone group was deployed into."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateEndpoint"
                              ]
                            }
                          },
                          "outputs": {
                            "resourceGroupName": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource group the private endpoint was deployed into."
                              },
                              "value": "[resourceGroup().name]"
                            },
                            "resourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource ID of the private endpoint."
                              },
                              "value": "[resourceId('Microsoft.Network/privateEndpoints', parameters('name'))]"
                            },
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the private endpoint."
                              },
                              "value": "[parameters('name')]"
                            },
                            "location": {
                              "type": "string",
                              "metadata": {
                                "description": "The location the resource was deployed into."
                              },
                              "value": "[reference('privateEndpoint', '2024-10-01', 'full').location]"
                            },
                            "customDnsConfigs": {
                              "type": "array",
                              "metadata": {
                                "__bicep_resource_derived_type!": {
                                  "source": "Microsoft.Network/privateEndpoints@2024-01-01#properties/properties/properties/customDnsConfigs",
                                  "output": true
                                },
                                "description": "The custom DNS configurations of the private endpoint."
                              },
                              "value": "[reference('privateEndpoint').customDnsConfigs]"
                            },
                            "networkInterfaceResourceIds": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              },
                              "metadata": {
                                "description": "The resource IDs of the network interfaces associated with the private endpoint."
                              },
                              "value": "[map(reference('privateEndpoint').networkInterfaces, lambda('nic', lambdaVariables('nic').id))]"
                            },
                            "groupId": {
                              "type": "string",
                              "nullable": true,
                              "metadata": {
                                "description": "The group Id for the private endpoint Group."
                              },
                              "value": "[coalesce(tryGet(tryGet(tryGet(tryGet(reference('privateEndpoint'), 'manualPrivateLinkServiceConnections'), 0, 'properties'), 'groupIds'), 0), tryGet(tryGet(tryGet(tryGet(reference('privateEndpoint'), 'privateLinkServiceConnections'), 0, 'properties'), 'groupIds'), 0))]"
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "storageAccount"
                      ]
                    },
                    "storageAccount_managementPolicies": {
                      "condition": "[not(empty(coalesce(variables('formattedManagementPolicies'), createArray())))]",
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "[format('{0}-Storage-ManagementPolicies', uniqueString(deployment().name, parameters('location')))]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "storageAccountName": {
                            "value": "[parameters('name')]"
                          },
                          "rules": {
                            "value": "[variables('formattedManagementPolicies')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.39.26.7824",
                              "templateHash": "4538661605890101674"
                            },
                            "name": "Storage Account Management Policies",
                            "description": "This module deploys a Storage Account Management Policy."
                          },
                          "parameters": {
                            "storageAccountName": {
                              "type": "string",
                              "maxLength": 24,
                              "metadata": {
                                "description": "Conditional. The name of the parent Storage Account. Required if the template is used in a standalone deployment."
                              }
                            },
                            "rules": {
                              "type": "array",
                              "metadata": {
                                "__bicep_resource_derived_type!": {
                                  "source": "Microsoft.Storage/storageAccounts/managementPolicies@2024-01-01#properties/properties/properties/policy/properties/rules"
                                },
                                "description": "Required. The Storage Account ManagementPolicies Rules."
                              }
                            }
                          },
                          "resources": [
                            {
                              "type": "Microsoft.Storage/storageAccounts/managementPolicies",
                              "apiVersion": "2024-01-01",
                              "name": "[format('{0}/{1}', parameters('storageAccountName'), 'default')]",
                              "properties": {
                                "policy": {
                                  "rules": "[parameters('rules')]"
                                }
                              }
                            }
                          ],
                          "outputs": {
                            "resourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource ID of the deployed management policy."
                              },
                              "value": "default"
                            },
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the deployed management policy."
                              },
                              "value": "default"
                            },
                            "resourceGroupName": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource group of the deployed management policy."
                              },
                              "value": "[resourceGroup().name]"
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "storageAccount",
                        "storageAccount_blobServices"
                      ]
                    },
                    "storageAccount_localUsers": {
                      "copy": {
                        "name": "storageAccount_localUsers",
                        "count": "[length(coalesce(parameters('localUsers'), createArray()))]"
                      },
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "[format('{0}-Storage-LocalUsers-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "storageAccountName": {
                            "value": "[parameters('name')]"
                          },
                          "name": {
                            "value": "[coalesce(parameters('localUsers'), createArray())[copyIndex()].name]"
                          },
                          "hasSshKey": {
                            "value": "[coalesce(parameters('localUsers'), createArray())[copyIndex()].hasSshKey]"
                          },
                          "hasSshPassword": {
                            "value": "[coalesce(parameters('localUsers'), createArray())[copyIndex()].hasSshPassword]"
                          },
                          "permissionScopes": {
                            "value": "[coalesce(parameters('localUsers'), createArray())[copyIndex()].permissionScopes]"
                          },
                          "hasSharedKey": {
                            "value": "[tryGet(coalesce(parameters('localUsers'), createArray())[copyIndex()], 'hasSharedKey')]"
                          },
                          "homeDirectory": {
                            "value": "[tryGet(coalesce(parameters('localUsers'), createArray())[copyIndex()], 'homeDirectory')]"
                          },
                          "sshAuthorizedKeys": {
                            "value": "[tryGet(coalesce(parameters('localUsers'), createArray())[copyIndex()], 'sshAuthorizedKeys')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.39.26.7824",
                              "templateHash": "17421429164012186211"
                            },
                            "name": "Storage Account Local Users",
                            "description": "This module deploys a Storage Account Local User, which is used for SFTP authentication."
                          },
                          "definitions": {
                            "sshAuthorizedKeyType": {
                              "type": "object",
                              "properties": {
                                "description": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Description used to store the function/usage of the key."
                                  }
                                },
                                "key": {
                                  "type": "securestring",
                                  "metadata": {
                                    "description": "Required. SSH public key base64 encoded. The format should be: '{keyType} {keyData}', e.g. ssh-rsa AAAABBBB."
                                  }
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true
                              }
                            },
                            "permissionScopeType": {
                              "type": "object",
                              "properties": {
                                "permissions": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The permissions for the local user. Possible values include: Read (r), Write (w), Delete (d), List (l), and Create (c)."
                                  }
                                },
                                "resourceName": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of resource, normally the container name or the file share name, used by the local user."
                                  }
                                },
                                "service": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The service used by the local user, e.g. blob, file."
                                  }
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true
                              }
                            }
                          },
                          "parameters": {
                            "storageAccountName": {
                              "type": "string",
                              "maxLength": 24,
                              "metadata": {
                                "description": "Conditional. The name of the parent Storage Account. Required if the template is used in a standalone deployment."
                              }
                            },
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. The name of the local user used for SFTP Authentication."
                              }
                            },
                            "hasSharedKey": {
                              "type": "bool",
                              "defaultValue": false,
                              "metadata": {
                                "description": "Optional. Indicates whether shared key exists. Set it to false to remove existing shared key."
                              }
                            },
                            "hasSshKey": {
                              "type": "bool",
                              "metadata": {
                                "description": "Required. Indicates whether SSH key exists. Set it to false to remove existing SSH key."
                              }
                            },
                            "hasSshPassword": {
                              "type": "bool",
                              "metadata": {
                                "description": "Required. Indicates whether SSH password exists. Set it to false to remove existing SSH password."
                              }
                            },
                            "homeDirectory": {
                              "type": "string",
                              "defaultValue": "",
                              "metadata": {
                                "description": "Optional. The local user home directory."
                              }
                            },
                            "permissionScopes": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/permissionScopeType"
                              },
                              "metadata": {
                                "description": "Required. The permission scopes of the local user."
                              }
                            },
                            "sshAuthorizedKeys": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/sshAuthorizedKeyType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The local user SSH authorized keys for SFTP."
                              }
                            }
                          },
                          "resources": {
                            "storageAccount": {
                              "existing": true,
                              "type": "Microsoft.Storage/storageAccounts",
                              "apiVersion": "2024-01-01",
                              "name": "[parameters('storageAccountName')]"
                            },
                            "localUsers": {
                              "type": "Microsoft.Storage/storageAccounts/localUsers",
                              "apiVersion": "2024-01-01",
                              "name": "[format('{0}/{1}', parameters('storageAccountName'), parameters('name'))]",
                              "properties": {
                                "hasSharedKey": "[parameters('hasSharedKey')]",
                                "hasSshKey": "[parameters('hasSshKey')]",
                                "hasSshPassword": "[parameters('hasSshPassword')]",
                                "homeDirectory": "[parameters('homeDirectory')]",
                                "permissionScopes": "[parameters('permissionScopes')]",
                                "sshAuthorizedKeys": "[parameters('sshAuthorizedKeys')]"
                              }
                            }
                          },
                          "outputs": {
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the deployed local user."
                              },
                              "value": "[parameters('name')]"
                            },
                            "resourceGroupName": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource group of the deployed local user."
                              },
                              "value": "[resourceGroup().name]"
                            },
                            "resourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource ID of the deployed local user."
                              },
                              "value": "[resourceId('Microsoft.Storage/storageAccounts/localUsers', parameters('storageAccountName'), parameters('name'))]"
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "storageAccount"
                      ]
                    },
                    "storageAccount_blobServices": {
                      "condition": "[not(empty(parameters('blobServices')))]",
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "[format('{0}-Storage-BlobServices', uniqueString(deployment().name, parameters('location')))]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "storageAccountName": {
                            "value": "[parameters('name')]"
                          },
                          "containers": {
                            "value": "[tryGet(parameters('blobServices'), 'containers')]"
                          },
                          "automaticSnapshotPolicyEnabled": {
                            "value": "[tryGet(parameters('blobServices'), 'automaticSnapshotPolicyEnabled')]"
                          },
                          "changeFeedEnabled": {
                            "value": "[tryGet(parameters('blobServices'), 'changeFeedEnabled')]"
                          },
                          "changeFeedRetentionInDays": {
                            "value": "[tryGet(parameters('blobServices'), 'changeFeedRetentionInDays')]"
                          },
                          "containerDeleteRetentionPolicyEnabled": {
                            "value": "[tryGet(parameters('blobServices'), 'containerDeleteRetentionPolicyEnabled')]"
                          },
                          "containerDeleteRetentionPolicyDays": {
                            "value": "[tryGet(parameters('blobServices'), 'containerDeleteRetentionPolicyDays')]"
                          },
                          "containerDeleteRetentionPolicyAllowPermanentDelete": {
                            "value": "[tryGet(parameters('blobServices'), 'containerDeleteRetentionPolicyAllowPermanentDelete')]"
                          },
                          "corsRules": {
                            "value": "[tryGet(parameters('blobServices'), 'corsRules')]"
                          },
                          "defaultServiceVersion": {
                            "value": "[tryGet(parameters('blobServices'), 'defaultServiceVersion')]"
                          },
                          "deleteRetentionPolicyAllowPermanentDelete": {
                            "value": "[tryGet(parameters('blobServices'), 'deleteRetentionPolicyAllowPermanentDelete')]"
                          },
                          "deleteRetentionPolicyEnabled": {
                            "value": "[tryGet(parameters('blobServices'), 'deleteRetentionPolicyEnabled')]"
                          },
                          "deleteRetentionPolicyDays": {
                            "value": "[tryGet(parameters('blobServices'), 'deleteRetentionPolicyDays')]"
                          },
                          "isVersioningEnabled": {
                            "value": "[tryGet(parameters('blobServices'), 'isVersioningEnabled')]"
                          },
                          "lastAccessTimeTrackingPolicyEnabled": {
                            "value": "[tryGet(parameters('blobServices'), 'lastAccessTimeTrackingPolicyEnabled')]"
                          },
                          "restorePolicyEnabled": {
                            "value": "[tryGet(parameters('blobServices'), 'restorePolicyEnabled')]"
                          },
                          "restorePolicyDays": {
                            "value": "[tryGet(parameters('blobServices'), 'restorePolicyDays')]"
                          },
                          "diagnosticSettings": {
                            "value": "[tryGet(parameters('blobServices'), 'diagnosticSettings')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.39.26.7824",
                              "templateHash": "15800736613372553659"
                            },
                            "name": "Storage Account blob Services",
                            "description": "This module deploys a Storage Account Blob Service."
                          },
                          "definitions": {
                            "corsRuleType": {
                              "type": "object",
                              "properties": {
                                "allowedHeaders": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  },
                                  "metadata": {
                                    "description": "Required. A list of headers allowed to be part of the cross-origin request."
                                  }
                                },
                                "allowedMethods": {
                                  "type": "array",
                                  "allowedValues": [
                                    "CONNECT",
                                    "DELETE",
                                    "GET",
                                    "HEAD",
                                    "MERGE",
                                    "OPTIONS",
                                    "PATCH",
                                    "POST",
                                    "PUT",
                                    "TRACE"
                                  ],
                                  "metadata": {
                                    "description": "Required. A list of HTTP methods that are allowed to be executed by the origin."
                                  }
                                },
                                "allowedOrigins": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  },
                                  "metadata": {
                                    "description": "Required. A list of origin domains that will be allowed via CORS, or \"*\" to allow all domains."
                                  }
                                },
                                "exposedHeaders": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  },
                                  "metadata": {
                                    "description": "Required. A list of response headers to expose to CORS clients."
                                  }
                                },
                                "maxAgeInSeconds": {
                                  "type": "int",
                                  "metadata": {
                                    "description": "Required. The number of seconds that the client/browser should cache a preflight response."
                                  }
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for a cors rule."
                              }
                            },
                            "containerType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the Storage Container to deploy."
                                  }
                                },
                                "defaultEncryptionScope": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Default the container to use specified encryption scope for all writes."
                                  }
                                },
                                "denyEncryptionScopeOverride": {
                                  "type": "bool",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Block override of encryption scope from the container default."
                                  }
                                },
                                "enableNfsV3AllSquash": {
                                  "type": "bool",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Enable NFSv3 all squash on blob container."
                                  }
                                },
                                "enableNfsV3RootSquash": {
                                  "type": "bool",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Enable NFSv3 root squash on blob container."
                                  }
                                },
                                "immutableStorageWithVersioningEnabled": {
                                  "type": "bool",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. This is an immutable property, when set to true it enables object level immutability at the container level. The property is immutable and can only be set to true at the container creation time. Existing containers must undergo a migration process."
                                  }
                                },
                                "immutabilityPolicy": {
                                  "$ref": "#/definitions/immutabilityPolicyType",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Configure immutability policy."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Storage/storageAccounts/blobServices/containers@2024-01-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. A name-value pair to associate with the container as metadata."
                                  },
                                  "nullable": true
                                },
                                "publicAccess": {
                                  "type": "string",
                                  "allowedValues": [
                                    "Blob",
                                    "Container",
                                    "None"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Specifies whether data in the container may be accessed publicly and the level of access."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type of a storage container."
                              }
                            },
                            "diagnosticSettingFullType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name of the diagnostic setting."
                                  }
                                },
                                "logCategoriesAndGroups": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "category": {
                                        "type": "string",
                                        "nullable": true,
                                        "metadata": {
                                          "description": "Optional. Name of a Diagnostic Log category for a resource type this setting is applied to. Set the specific logs to collect here."
                                        }
                                      },
                                      "categoryGroup": {
                                        "type": "string",
                                        "nullable": true,
                                        "metadata": {
                                          "description": "Optional. Name of a Diagnostic Log category group for a resource type this setting is applied to. Set to `allLogs` to collect all logs."
                                        }
                                      },
                                      "enabled": {
                                        "type": "bool",
                                        "nullable": true,
                                        "metadata": {
                                          "description": "Optional. Enable or disable the category explicitly. Default is `true`."
                                        }
                                      }
                                    }
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name of logs that will be streamed. \"allLogs\" includes all possible logs for the resource. Set to `[]` to disable log collection."
                                  }
                                },
                                "metricCategories": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "category": {
                                        "type": "string",
                                        "metadata": {
                                          "description": "Required. Name of a Diagnostic Metric category for a resource type this setting is applied to. Set to `AllMetrics` to collect all metrics."
                                        }
                                      },
                                      "enabled": {
                                        "type": "bool",
                                        "nullable": true,
                                        "metadata": {
                                          "description": "Optional. Enable or disable the category explicitly. Default is `true`."
                                        }
                                      }
                                    }
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name of metrics that will be streamed. \"allMetrics\" includes all possible metrics for the resource. Set to `[]` to disable metric collection."
                                  }
                                },
                                "logAnalyticsDestinationType": {
                                  "type": "string",
                                  "allowedValues": [
                                    "AzureDiagnostics",
                                    "Dedicated"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. A string indicating whether the export to Log Analytics should use the default destination type, i.e. AzureDiagnostics, or use a destination type."
                                  }
                                },
                                "workspaceResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Resource ID of the diagnostic log analytics workspace. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                                  }
                                },
                                "storageAccountResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Resource ID of the diagnostic storage account. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                                  }
                                },
                                "eventHubAuthorizationRuleResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Resource ID of the diagnostic event hub authorization rule for the Event Hubs namespace in which the event hub should be created or streamed to."
                                  }
                                },
                                "eventHubName": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Name of the diagnostic event hub within the namespace to which logs are streamed. Without this, an event hub is created for each log category. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                                  }
                                },
                                "marketplacePartnerResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The full ARM resource ID of the Marketplace resource to which you would like to send Diagnostic Logs."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for a diagnostic setting. To be used if both logs & metrics are supported by the resource provider.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                                }
                              }
                            },
                            "immutabilityPolicyType": {
                              "type": "object",
                              "properties": {
                                "immutabilityPeriodSinceCreationInDays": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The immutability period for the blobs in the container since the policy creation, in days."
                                  }
                                },
                                "allowProtectedAppendWrites": {
                                  "type": "bool",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. This property can only be changed for unlocked time-based retention policies. When enabled, new blocks can be written to an append blob while maintaining immutability protection and compliance. Only new blocks can be added and any existing blocks cannot be modified or deleted. This property cannot be changed with ExtendImmutabilityPolicy API. Defaults to false."
                                  }
                                },
                                "allowProtectedAppendWritesAll": {
                                  "type": "bool",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. This property can only be changed for unlocked time-based retention policies. When enabled, new blocks can be written to both \"Append and Block Blobs\" while maintaining immutability protection and compliance. Only new blocks can be added and any existing blocks cannot be modified or deleted. This property cannot be changed with ExtendImmutabilityPolicy API. The \"allowProtectedAppendWrites\" and \"allowProtectedAppendWritesAll\" properties are mutually exclusive. Defaults to false."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "The type for an immutability policy.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "container/main.bicep"
                                }
                              }
                            },
                            "roleAssignmentType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                  }
                                },
                                "roleDefinitionIdOrName": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                  }
                                },
                                "principalId": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                  }
                                },
                                "principalType": {
                                  "type": "string",
                                  "allowedValues": [
                                    "Device",
                                    "ForeignGroup",
                                    "Group",
                                    "ServicePrincipal",
                                    "User"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The principal type of the assigned principal ID."
                                  }
                                },
                                "description": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The description of the role assignment."
                                  }
                                },
                                "condition": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                  }
                                },
                                "conditionVersion": {
                                  "type": "string",
                                  "allowedValues": [
                                    "2.0"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Version of the condition."
                                  }
                                },
                                "delegatedManagedIdentityResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The Resource Id of the delegated managed identity resource."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for a role assignment.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                                }
                              }
                            }
                          },
                          "parameters": {
                            "storageAccountName": {
                              "type": "string",
                              "maxLength": 24,
                              "metadata": {
                                "description": "Conditional. The name of the parent Storage Account. Required if the template is used in a standalone deployment."
                              }
                            },
                            "automaticSnapshotPolicyEnabled": {
                              "type": "bool",
                              "defaultValue": false,
                              "metadata": {
                                "description": "Optional. Automatic Snapshot is enabled if set to true."
                              }
                            },
                            "changeFeedEnabled": {
                              "type": "bool",
                              "defaultValue": false,
                              "metadata": {
                                "description": "Optional. The blob service properties for change feed events. Indicates whether change feed event logging is enabled for the Blob service."
                              }
                            },
                            "changeFeedRetentionInDays": {
                              "type": "int",
                              "nullable": true,
                              "minValue": 1,
                              "maxValue": 146000,
                              "metadata": {
                                "description": "Optional. Indicates whether change feed event logging is enabled for the Blob service. Indicates the duration of changeFeed retention in days. If left blank, it indicates an infinite retention of the change feed."
                              }
                            },
                            "containerDeleteRetentionPolicyEnabled": {
                              "type": "bool",
                              "defaultValue": true,
                              "metadata": {
                                "description": "Optional. The blob service properties for container soft delete. Indicates whether DeleteRetentionPolicy is enabled."
                              }
                            },
                            "containerDeleteRetentionPolicyDays": {
                              "type": "int",
                              "nullable": true,
                              "minValue": 1,
                              "maxValue": 365,
                              "metadata": {
                                "description": "Optional. Indicates the number of days that the deleted item should be retained."
                              }
                            },
                            "containerDeleteRetentionPolicyAllowPermanentDelete": {
                              "type": "bool",
                              "defaultValue": false,
                              "metadata": {
                                "description": "Optional. This property when set to true allows deletion of the soft deleted blob versions and snapshots. This property cannot be used with blob restore policy. This property only applies to blob service and does not apply to containers or file share."
                              }
                            },
                            "corsRules": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/corsRuleType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The List of CORS rules. You can include up to five CorsRule elements in the request."
                              }
                            },
                            "defaultServiceVersion": {
                              "type": "string",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Indicates the default version to use for requests to the Blob service if an incoming request's version is not specified. Possible values include version 2008-10-27 and all more recent versions."
                              }
                            },
                            "deleteRetentionPolicyEnabled": {
                              "type": "bool",
                              "defaultValue": true,
                              "metadata": {
                                "description": "Optional. The blob service properties for blob soft delete."
                              }
                            },
                            "deleteRetentionPolicyDays": {
                              "type": "int",
                              "defaultValue": 7,
                              "minValue": 1,
                              "maxValue": 365,
                              "metadata": {
                                "description": "Optional. Indicates the number of days that the deleted blob should be retained."
                              }
                            },
                            "deleteRetentionPolicyAllowPermanentDelete": {
                              "type": "bool",
                              "defaultValue": false,
                              "metadata": {
                                "description": "Optional. This property when set to true allows deletion of the soft deleted blob versions and snapshots. This property cannot be used with blob restore policy. This property only applies to blob service and does not apply to containers or file share."
                              }
                            },
                            "isVersioningEnabled": {
                              "type": "bool",
                              "defaultValue": false,
                              "metadata": {
                                "description": "Optional. Use versioning to automatically maintain previous versions of your blobs. Cannot be enabled for ADLS Gen2 storage accounts."
                              }
                            },
                            "lastAccessTimeTrackingPolicyEnabled": {
                              "type": "bool",
                              "defaultValue": false,
                              "metadata": {
                                "description": "Optional. The blob service property to configure last access time based tracking policy. When set to true last access time based tracking is enabled."
                              }
                            },
                            "restorePolicyEnabled": {
                              "type": "bool",
                              "defaultValue": false,
                              "metadata": {
                                "description": "Optional. The blob service properties for blob restore policy. If point-in-time restore is enabled, then versioning, change feed, and blob soft delete must also be enabled."
                              }
                            },
                            "restorePolicyDays": {
                              "type": "int",
                              "defaultValue": 7,
                              "minValue": 1,
                              "metadata": {
                                "description": "Optional. How long this blob can be restored. It should be less than DeleteRetentionPolicy days."
                              }
                            },
                            "containers": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/containerType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Blob containers to create."
                              }
                            },
                            "diagnosticSettings": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/diagnosticSettingFullType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The diagnostic settings of the service."
                              }
                            }
                          },
                          "variables": {
                            "enableReferencedModulesTelemetry": false,
                            "name": "default"
                          },
                          "resources": {
                            "storageAccount": {
                              "existing": true,
                              "type": "Microsoft.Storage/storageAccounts",
                              "apiVersion": "2025-01-01",
                              "name": "[parameters('storageAccountName')]"
                            },
                            "blobServices": {
                              "type": "Microsoft.Storage/storageAccounts/blobServices",
                              "apiVersion": "2025-01-01",
                              "name": "[format('{0}/{1}', parameters('storageAccountName'), variables('name'))]",
                              "properties": {
                                "automaticSnapshotPolicyEnabled": "[parameters('automaticSnapshotPolicyEnabled')]",
                                "changeFeed": "[if(parameters('changeFeedEnabled'), createObject('enabled', true(), 'retentionInDays', parameters('changeFeedRetentionInDays')), null())]",
                                "containerDeleteRetentionPolicy": {
                                  "enabled": "[parameters('containerDeleteRetentionPolicyEnabled')]",
                                  "days": "[parameters('containerDeleteRetentionPolicyDays')]",
                                  "allowPermanentDelete": "[if(equals(parameters('containerDeleteRetentionPolicyEnabled'), true()), parameters('containerDeleteRetentionPolicyAllowPermanentDelete'), null())]"
                                },
                                "cors": "[if(not(equals(parameters('corsRules'), null())), createObject('corsRules', parameters('corsRules')), null())]",
                                "defaultServiceVersion": "[parameters('defaultServiceVersion')]",
                                "deleteRetentionPolicy": {
                                  "enabled": "[parameters('deleteRetentionPolicyEnabled')]",
                                  "days": "[parameters('deleteRetentionPolicyDays')]",
                                  "allowPermanentDelete": "[if(and(parameters('deleteRetentionPolicyEnabled'), parameters('deleteRetentionPolicyAllowPermanentDelete')), true(), null())]"
                                },
                                "isVersioningEnabled": "[parameters('isVersioningEnabled')]",
                                "lastAccessTimeTrackingPolicy": "[if(and(not(equals(reference('storageAccount', '2025-01-01', 'full').kind, 'Storage')), empty(tryGet(reference('storageAccount', '2025-01-01', 'full'), 'extendedLocation'))), createObject('enable', parameters('lastAccessTimeTrackingPolicyEnabled'), 'name', if(equals(parameters('lastAccessTimeTrackingPolicyEnabled'), true()), 'AccessTimeTracking', null()), 'trackingGranularityInDays', if(equals(parameters('lastAccessTimeTrackingPolicyEnabled'), true()), 1, null())), null())]",
                                "restorePolicy": "[if(parameters('restorePolicyEnabled'), createObject('enabled', true(), 'days', parameters('restorePolicyDays')), null())]"
                              },
                              "dependsOn": [
                                "storageAccount"
                              ]
                            },
                            "blobServices_diagnosticSettings": {
                              "copy": {
                                "name": "blobServices_diagnosticSettings",
                                "count": "[length(coalesce(parameters('diagnosticSettings'), createArray()))]"
                              },
                              "type": "Microsoft.Insights/diagnosticSettings",
                              "apiVersion": "2021-05-01-preview",
                              "scope": "[format('Microsoft.Storage/storageAccounts/{0}/blobServices/{1}', parameters('storageAccountName'), variables('name'))]",
                              "name": "[coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'name'), format('{0}-diagnosticSettings', variables('name')))]",
                              "properties": {
                                "copy": [
                                  {
                                    "name": "metrics",
                                    "count": "[length(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'metricCategories'), createArray(createObject('category', 'AllMetrics'))))]",
                                    "input": {
                                      "category": "[coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'metricCategories'), createArray(createObject('category', 'AllMetrics')))[copyIndex('metrics')].category]",
                                      "enabled": "[coalesce(tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'metricCategories'), createArray(createObject('category', 'AllMetrics')))[copyIndex('metrics')], 'enabled'), true())]",
                                      "timeGrain": null
                                    }
                                  },
                                  {
                                    "name": "logs",
                                    "count": "[length(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs'))))]",
                                    "input": {
                                      "categoryGroup": "[tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs')))[copyIndex('logs')], 'categoryGroup')]",
                                      "category": "[tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs')))[copyIndex('logs')], 'category')]",
                                      "enabled": "[coalesce(tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs')))[copyIndex('logs')], 'enabled'), true())]"
                                    }
                                  }
                                ],
                                "storageAccountId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'storageAccountResourceId')]",
                                "workspaceId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'workspaceResourceId')]",
                                "eventHubAuthorizationRuleId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'eventHubAuthorizationRuleResourceId')]",
                                "eventHubName": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'eventHubName')]",
                                "marketplacePartnerId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'marketplacePartnerResourceId')]",
                                "logAnalyticsDestinationType": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logAnalyticsDestinationType')]"
                              },
                              "dependsOn": [
                                "blobServices"
                              ]
                            },
                            "blobServices_container": {
                              "copy": {
                                "name": "blobServices_container",
                                "count": "[length(coalesce(parameters('containers'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2025-04-01",
                              "name": "[format('{0}-Container-{1}', deployment().name, copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "storageAccountName": {
                                    "value": "[parameters('storageAccountName')]"
                                  },
                                  "blobServiceName": {
                                    "value": "[variables('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('containers'), createArray())[copyIndex()].name]"
                                  },
                                  "defaultEncryptionScope": {
                                    "value": "[tryGet(coalesce(parameters('containers'), createArray())[copyIndex()], 'defaultEncryptionScope')]"
                                  },
                                  "denyEncryptionScopeOverride": {
                                    "value": "[tryGet(coalesce(parameters('containers'), createArray())[copyIndex()], 'denyEncryptionScopeOverride')]"
                                  },
                                  "enableNfsV3AllSquash": {
                                    "value": "[tryGet(coalesce(parameters('containers'), createArray())[copyIndex()], 'enableNfsV3AllSquash')]"
                                  },
                                  "enableNfsV3RootSquash": {
                                    "value": "[tryGet(coalesce(parameters('containers'), createArray())[copyIndex()], 'enableNfsV3RootSquash')]"
                                  },
                                  "immutableStorageWithVersioningEnabled": {
                                    "value": "[tryGet(coalesce(parameters('containers'), createArray())[copyIndex()], 'immutableStorageWithVersioningEnabled')]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('containers'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "publicAccess": {
                                    "value": "[tryGet(coalesce(parameters('containers'), createArray())[copyIndex()], 'publicAccess')]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('containers'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "immutabilityPolicy": {
                                    "value": "[tryGet(coalesce(parameters('containers'), createArray())[copyIndex()], 'immutabilityPolicy')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.39.26.7824",
                                      "templateHash": "63105523847589801"
                                    },
                                    "name": "Storage Account Blob Containers",
                                    "description": "This module deploys a Storage Account Blob Container."
                                  },
                                  "definitions": {
                                    "immutabilityPolicyType": {
                                      "type": "object",
                                      "properties": {
                                        "immutabilityPeriodSinceCreationInDays": {
                                          "type": "int",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The immutability period for the blobs in the container since the policy creation, in days."
                                          }
                                        },
                                        "allowProtectedAppendWrites": {
                                          "type": "bool",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. This property can only be changed for unlocked time-based retention policies. When enabled, new blocks can be written to an append blob while maintaining immutability protection and compliance. Only new blocks can be added and any existing blocks cannot be modified or deleted. This property cannot be changed with ExtendImmutabilityPolicy API. Defaults to false."
                                          }
                                        },
                                        "allowProtectedAppendWritesAll": {
                                          "type": "bool",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. This property can only be changed for unlocked time-based retention policies. When enabled, new blocks can be written to both \"Append and Block Blobs\" while maintaining immutability protection and compliance. Only new blocks can be added and any existing blocks cannot be modified or deleted. This property cannot be changed with ExtendImmutabilityPolicy API. The \"allowProtectedAppendWrites\" and \"allowProtectedAppendWritesAll\" properties are mutually exclusive. Defaults to false."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "__bicep_export!": true,
                                        "description": "The type for an immutability policy."
                                      }
                                    },
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "storageAccountName": {
                                      "type": "string",
                                      "maxLength": 24,
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Storage Account. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "blobServiceName": {
                                      "type": "string",
                                      "defaultValue": "default",
                                      "metadata": {
                                        "description": "Optional. The name of the parent Blob Service. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the Storage Container to deploy."
                                      }
                                    },
                                    "defaultEncryptionScope": {
                                      "type": "string",
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Default the container to use specified encryption scope for all writes."
                                      }
                                    },
                                    "denyEncryptionScopeOverride": {
                                      "type": "bool",
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Block override of encryption scope from the container default."
                                      }
                                    },
                                    "enableNfsV3AllSquash": {
                                      "type": "bool",
                                      "defaultValue": false,
                                      "metadata": {
                                        "description": "Optional. Enable NFSv3 all squash on blob container."
                                      }
                                    },
                                    "enableNfsV3RootSquash": {
                                      "type": "bool",
                                      "defaultValue": false,
                                      "metadata": {
                                        "description": "Optional. Enable NFSv3 root squash on blob container."
                                      }
                                    },
                                    "immutableStorageWithVersioningEnabled": {
                                      "type": "bool",
                                      "defaultValue": false,
                                      "metadata": {
                                        "description": "Optional. This is an immutable property, when set to true it enables object level immutability at the container level. The property is immutable and can only be set to true at the container creation time. Existing containers must undergo a migration process."
                                      }
                                    },
                                    "immutabilityPolicy": {
                                      "$ref": "#/definitions/immutabilityPolicyType",
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Configure immutability policy."
                                      }
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Storage/storageAccounts/blobServices/containers@2024-01-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. A name-value pair to associate with the container as metadata."
                                      },
                                      "defaultValue": {}
                                    },
                                    "publicAccess": {
                                      "type": "string",
                                      "defaultValue": "None",
                                      "allowedValues": [
                                        "Container",
                                        "Blob",
                                        "None"
                                      ],
                                      "metadata": {
                                        "description": "Optional. Specifies whether data in the container may be accessed publicly and the level of access."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Reader and Data Access": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'c12c1c16-33a1-487b-954d-41c89c60f349')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "Storage Account Backup Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'e5e2a7ff-d759-4cd2-bb51-3152d37e2eb1')]",
                                      "Storage Account Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '17d1049b-9a84-46fb-8f53-869881c3d3ab')]",
                                      "Storage Account Key Operator Service Role": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '81a9662b-bebf-436f-a333-f67b29880f12')]",
                                      "Storage Blob Data Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'ba92f5b4-2d11-453d-a403-e96b0029c9fe')]",
                                      "Storage Blob Data Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b7e6dc6d-f1e8-4753-8033-0f276bb0955b')]",
                                      "Storage Blob Data Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '2a2b9908-6ea1-4ae2-8e65-a410df84e7d1')]",
                                      "Storage Blob Delegator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'db58b8e5-c6ad-4a2a-8342-4190687cbf4a')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "storageAccount::blobServices": {
                                      "existing": true,
                                      "type": "Microsoft.Storage/storageAccounts/blobServices",
                                      "apiVersion": "2025-01-01",
                                      "name": "[format('{0}/{1}', parameters('storageAccountName'), parameters('blobServiceName'))]"
                                    },
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.storage-blobcontainer.{0}.{1}', replace('0.3.2', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "storageAccount": {
                                      "existing": true,
                                      "type": "Microsoft.Storage/storageAccounts",
                                      "apiVersion": "2025-01-01",
                                      "name": "[parameters('storageAccountName')]"
                                    },
                                    "container": {
                                      "type": "Microsoft.Storage/storageAccounts/blobServices/containers",
                                      "apiVersion": "2025-01-01",
                                      "name": "[format('{0}/{1}/{2}', parameters('storageAccountName'), parameters('blobServiceName'), parameters('name'))]",
                                      "properties": {
                                        "defaultEncryptionScope": "[parameters('defaultEncryptionScope')]",
                                        "denyEncryptionScopeOverride": "[parameters('denyEncryptionScopeOverride')]",
                                        "enableNfsV3AllSquash": "[if(equals(parameters('enableNfsV3AllSquash'), true()), parameters('enableNfsV3AllSquash'), null())]",
                                        "enableNfsV3RootSquash": "[if(equals(parameters('enableNfsV3RootSquash'), true()), parameters('enableNfsV3RootSquash'), null())]",
                                        "immutableStorageWithVersioning": "[if(parameters('immutableStorageWithVersioningEnabled'), createObject('enabled', parameters('immutableStorageWithVersioningEnabled')), null())]",
                                        "metadata": "[parameters('metadata')]",
                                        "publicAccess": "[parameters('publicAccess')]"
                                      }
                                    },
                                    "container_roleAssignments": {
                                      "copy": {
                                        "name": "container_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Storage/storageAccounts/{0}/blobServices/{1}/containers/{2}', parameters('storageAccountName'), parameters('blobServiceName'), parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Storage/storageAccounts/blobServices/containers', parameters('storageAccountName'), parameters('blobServiceName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "container"
                                      ]
                                    },
                                    "container_immutabilityPolicy": {
                                      "condition": "[not(empty(coalesce(parameters('immutabilityPolicy'), createObject())))]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2025-04-01",
                                      "name": "[take(format('{0}-ImmutPol', deployment().name), 64)]",
                                      "properties": {
                                        "expressionEvaluationOptions": {
                                          "scope": "inner"
                                        },
                                        "mode": "Incremental",
                                        "parameters": {
                                          "storageAccountName": {
                                            "value": "[parameters('storageAccountName')]"
                                          },
                                          "containerName": {
                                            "value": "[parameters('name')]"
                                          },
                                          "immutabilityPeriodSinceCreationInDays": {
                                            "value": "[tryGet(parameters('immutabilityPolicy'), 'immutabilityPeriodSinceCreationInDays')]"
                                          },
                                          "allowProtectedAppendWrites": {
                                            "value": "[tryGet(parameters('immutabilityPolicy'), 'allowProtectedAppendWrites')]"
                                          },
                                          "allowProtectedAppendWritesAll": {
                                            "value": "[tryGet(parameters('immutabilityPolicy'), 'allowProtectedAppendWritesAll')]"
                                          }
                                        },
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "metadata": {
                                            "_generator": {
                                              "name": "bicep",
                                              "version": "0.39.26.7824",
                                              "templateHash": "9405311609774409339"
                                            },
                                            "name": "Storage Account Blob Container Immutability Policies",
                                            "description": "This module deploys a Storage Account Blob Container Immutability Policy."
                                          },
                                          "parameters": {
                                            "storageAccountName": {
                                              "type": "string",
                                              "maxLength": 24,
                                              "metadata": {
                                                "description": "Conditional. The name of the parent Storage Account. Required if the template is used in a standalone deployment."
                                              }
                                            },
                                            "containerName": {
                                              "type": "string",
                                              "metadata": {
                                                "description": "Conditional. The name of the parent container to apply the policy to. Required if the template is used in a standalone deployment."
                                              }
                                            },
                                            "immutabilityPeriodSinceCreationInDays": {
                                              "type": "int",
                                              "defaultValue": 365,
                                              "metadata": {
                                                "description": "Optional. The immutability period for the blobs in the container since the policy creation, in days."
                                              }
                                            },
                                            "allowProtectedAppendWrites": {
                                              "type": "bool",
                                              "defaultValue": false,
                                              "metadata": {
                                                "description": "Optional. This property can only be changed for unlocked time-based retention policies. When enabled, new blocks can be written to an append blob while maintaining immutability protection and compliance. Only new blocks can be added and any existing blocks cannot be modified or deleted. This property cannot be changed with ExtendImmutabilityPolicy API. The \"allowProtectedAppendWrites\" and \"allowProtectedAppendWritesAll\" properties are mutually exclusive. Defaults to false."
                                              }
                                            },
                                            "allowProtectedAppendWritesAll": {
                                              "type": "bool",
                                              "defaultValue": false,
                                              "metadata": {
                                                "description": "Optional. This property can only be changed for unlocked time-based retention policies. When enabled, new blocks can be written to both \"Append and Block Blobs\" while maintaining immutability protection and compliance. Only new blocks can be added and any existing blocks cannot be modified or deleted. This property cannot be changed with ExtendImmutabilityPolicy API. The \"allowProtectedAppendWrites\" and \"allowProtectedAppendWritesAll\" properties are mutually exclusive. Defaults to false."
                                              }
                                            }
                                          },
                                          "resources": [
                                            {
                                              "type": "Microsoft.Storage/storageAccounts/blobServices/containers/immutabilityPolicies",
                                              "apiVersion": "2025-01-01",
                                              "name": "[format('{0}/{1}/{2}/{3}', parameters('storageAccountName'), 'default', parameters('containerName'), 'default')]",
                                              "properties": {
                                                "immutabilityPeriodSinceCreationInDays": "[parameters('immutabilityPeriodSinceCreationInDays')]",
                                                "allowProtectedAppendWrites": "[parameters('allowProtectedAppendWrites')]",
                                                "allowProtectedAppendWritesAll": "[parameters('allowProtectedAppendWritesAll')]"
                                              }
                                            }
                                          ],
                                          "outputs": {
                                            "name": {
                                              "type": "string",
                                              "metadata": {
                                                "description": "The name of the deployed immutability policy."
                                              },
                                              "value": "default"
                                            },
                                            "resourceId": {
                                              "type": "string",
                                              "metadata": {
                                                "description": "The resource ID of the deployed immutability policy."
                                              },
                                              "value": "[resourceId('Microsoft.Storage/storageAccounts/blobServices/containers/immutabilityPolicies', parameters('storageAccountName'), 'default', parameters('containerName'), 'default')]"
                                            },
                                            "resourceGroupName": {
                                              "type": "string",
                                              "metadata": {
                                                "description": "The resource group of the deployed immutability policy."
                                              },
                                              "value": "[resourceGroup().name]"
                                            }
                                          }
                                        }
                                      },
                                      "dependsOn": [
                                        "container"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed container."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed container."
                                      },
                                      "value": "[resourceId('Microsoft.Storage/storageAccounts/blobServices/containers', parameters('storageAccountName'), parameters('blobServiceName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed container."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "blobServices"
                              ]
                            }
                          },
                          "outputs": {
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the deployed blob service."
                              },
                              "value": "[variables('name')]"
                            },
                            "resourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource ID of the deployed blob service."
                              },
                              "value": "[resourceId('Microsoft.Storage/storageAccounts/blobServices', parameters('storageAccountName'), variables('name'))]"
                            },
                            "resourceGroupName": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the deployed blob service."
                              },
                              "value": "[resourceGroup().name]"
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "storageAccount"
                      ]
                    },
                    "storageAccount_fileServices": {
                      "condition": "[not(empty(parameters('fileServices')))]",
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "[format('{0}-Storage-FileServices', uniqueString(deployment().name, parameters('location')))]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "storageAccountName": {
                            "value": "[parameters('name')]"
                          },
                          "diagnosticSettings": {
                            "value": "[tryGet(parameters('fileServices'), 'diagnosticSettings')]"
                          },
                          "protocolSettings": {
                            "value": "[tryGet(parameters('fileServices'), 'protocolSettings')]"
                          },
                          "shareDeleteRetentionPolicy": {
                            "value": "[tryGet(parameters('fileServices'), 'shareDeleteRetentionPolicy')]"
                          },
                          "shares": {
                            "value": "[tryGet(parameters('fileServices'), 'shares')]"
                          },
                          "corsRules": {
                            "value": "[tryGet(parameters('fileServices'), 'corsRules')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.39.26.7824",
                              "templateHash": "9213796824812470119"
                            },
                            "name": "Storage Account File Share Services",
                            "description": "This module deploys a Storage Account File Share Service."
                          },
                          "definitions": {
                            "corsRuleType": {
                              "type": "object",
                              "properties": {
                                "allowedHeaders": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  },
                                  "metadata": {
                                    "description": "Required. A list of headers allowed to be part of the cross-origin request."
                                  }
                                },
                                "allowedMethods": {
                                  "type": "array",
                                  "allowedValues": [
                                    "CONNECT",
                                    "DELETE",
                                    "GET",
                                    "HEAD",
                                    "MERGE",
                                    "OPTIONS",
                                    "PATCH",
                                    "POST",
                                    "PUT",
                                    "TRACE"
                                  ],
                                  "metadata": {
                                    "description": "Required. A list of HTTP methods that are allowed to be executed by the origin."
                                  }
                                },
                                "allowedOrigins": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  },
                                  "metadata": {
                                    "description": "Required. A list of origin domains that will be allowed via CORS, or \"*\" to allow all domains."
                                  }
                                },
                                "exposedHeaders": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  },
                                  "metadata": {
                                    "description": "Required. A list of response headers to expose to CORS clients."
                                  }
                                },
                                "maxAgeInSeconds": {
                                  "type": "int",
                                  "metadata": {
                                    "description": "Required. The number of seconds that the client/browser should cache a preflight response."
                                  }
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for a cors rule."
                              }
                            },
                            "fileShareType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the file share."
                                  }
                                },
                                "accessTier": {
                                  "type": "string",
                                  "allowedValues": [
                                    "Cool",
                                    "Hot",
                                    "Premium",
                                    "TransactionOptimized"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Access tier for specific share. Required if the Storage Account kind is set to FileStorage (should be set to \"Premium\"). GpV2 account can choose between TransactionOptimized (default), Hot, and Cool."
                                  }
                                },
                                "enabledProtocols": {
                                  "type": "string",
                                  "allowedValues": [
                                    "NFS",
                                    "SMB"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The authentication protocol that is used for the file share. Can only be specified when creating a share."
                                  }
                                },
                                "rootSquash": {
                                  "type": "string",
                                  "allowedValues": [
                                    "AllSquash",
                                    "NoRootSquash",
                                    "RootSquash"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Permissions for NFS file shares are enforced by the client OS rather than the Azure Files service. Toggling the root squash behavior reduces the rights of the root user for NFS shares."
                                  }
                                },
                                "shareQuota": {
                                  "type": "int",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The maximum size of the share, in gigabytes. Must be greater than 0, and less than or equal to 5120 (5TB). For Large File Shares, the maximum size is 102400 (100TB)."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for a file share."
                              }
                            },
                            "diagnosticSettingFullType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name of the diagnostic setting."
                                  }
                                },
                                "logCategoriesAndGroups": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "category": {
                                        "type": "string",
                                        "nullable": true,
                                        "metadata": {
                                          "description": "Optional. Name of a Diagnostic Log category for a resource type this setting is applied to. Set the specific logs to collect here."
                                        }
                                      },
                                      "categoryGroup": {
                                        "type": "string",
                                        "nullable": true,
                                        "metadata": {
                                          "description": "Optional. Name of a Diagnostic Log category group for a resource type this setting is applied to. Set to `allLogs` to collect all logs."
                                        }
                                      },
                                      "enabled": {
                                        "type": "bool",
                                        "nullable": true,
                                        "metadata": {
                                          "description": "Optional. Enable or disable the category explicitly. Default is `true`."
                                        }
                                      }
                                    }
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name of logs that will be streamed. \"allLogs\" includes all possible logs for the resource. Set to `[]` to disable log collection."
                                  }
                                },
                                "metricCategories": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "category": {
                                        "type": "string",
                                        "metadata": {
                                          "description": "Required. Name of a Diagnostic Metric category for a resource type this setting is applied to. Set to `AllMetrics` to collect all metrics."
                                        }
                                      },
                                      "enabled": {
                                        "type": "bool",
                                        "nullable": true,
                                        "metadata": {
                                          "description": "Optional. Enable or disable the category explicitly. Default is `true`."
                                        }
                                      }
                                    }
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name of metrics that will be streamed. \"allMetrics\" includes all possible metrics for the resource. Set to `[]` to disable metric collection."
                                  }
                                },
                                "logAnalyticsDestinationType": {
                                  "type": "string",
                                  "allowedValues": [
                                    "AzureDiagnostics",
                                    "Dedicated"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. A string indicating whether the export to Log Analytics should use the default destination type, i.e. AzureDiagnostics, or use a destination type."
                                  }
                                },
                                "workspaceResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Resource ID of the diagnostic log analytics workspace. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                                  }
                                },
                                "storageAccountResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Resource ID of the diagnostic storage account. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                                  }
                                },
                                "eventHubAuthorizationRuleResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Resource ID of the diagnostic event hub authorization rule for the Event Hubs namespace in which the event hub should be created or streamed to."
                                  }
                                },
                                "eventHubName": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Name of the diagnostic event hub within the namespace to which logs are streamed. Without this, an event hub is created for each log category. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                                  }
                                },
                                "marketplacePartnerResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The full ARM resource ID of the Marketplace resource to which you would like to send Diagnostic Logs."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for a diagnostic setting. To be used if both logs & metrics are supported by the resource provider.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.0"
                                }
                              }
                            },
                            "roleAssignmentType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                  }
                                },
                                "roleDefinitionIdOrName": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                  }
                                },
                                "principalId": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                  }
                                },
                                "principalType": {
                                  "type": "string",
                                  "allowedValues": [
                                    "Device",
                                    "ForeignGroup",
                                    "Group",
                                    "ServicePrincipal",
                                    "User"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The principal type of the assigned principal ID."
                                  }
                                },
                                "description": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The description of the role assignment."
                                  }
                                },
                                "condition": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                  }
                                },
                                "conditionVersion": {
                                  "type": "string",
                                  "allowedValues": [
                                    "2.0"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Version of the condition."
                                  }
                                },
                                "delegatedManagedIdentityResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The Resource Id of the delegated managed identity resource."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for a role assignment.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                                }
                              }
                            }
                          },
                          "parameters": {
                            "storageAccountName": {
                              "type": "string",
                              "maxLength": 24,
                              "metadata": {
                                "description": "Conditional. The name of the parent Storage Account. Required if the template is used in a standalone deployment."
                              }
                            },
                            "name": {
                              "type": "string",
                              "defaultValue": "default",
                              "metadata": {
                                "description": "Optional. The name of the file service."
                              }
                            },
                            "protocolSettings": {
                              "type": "object",
                              "metadata": {
                                "__bicep_resource_derived_type!": {
                                  "source": "Microsoft.Storage/storageAccounts/fileServices@2024-01-01#properties/properties/properties/protocolSettings"
                                },
                                "description": "Optional. Protocol settings for file service."
                              },
                              "defaultValue": {}
                            },
                            "shareDeleteRetentionPolicy": {
                              "type": "object",
                              "metadata": {
                                "__bicep_resource_derived_type!": {
                                  "source": "Microsoft.Storage/storageAccounts/fileServices@2024-01-01#properties/properties/properties/shareDeleteRetentionPolicy"
                                },
                                "description": "Optional. The service properties for soft delete."
                              },
                              "defaultValue": {
                                "enabled": true,
                                "days": 7
                              }
                            },
                            "corsRules": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/corsRuleType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The List of CORS rules. You can include up to five CorsRule elements in the request."
                              }
                            },
                            "diagnosticSettings": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/diagnosticSettingFullType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The diagnostic settings of the service."
                              }
                            },
                            "shares": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/fileShareType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. File shares to create."
                              }
                            }
                          },
                          "variables": {
                            "enableReferencedModulesTelemetry": false
                          },
                          "resources": {
                            "storageAccount": {
                              "existing": true,
                              "type": "Microsoft.Storage/storageAccounts",
                              "apiVersion": "2024-01-01",
                              "name": "[parameters('storageAccountName')]"
                            },
                            "fileServices": {
                              "type": "Microsoft.Storage/storageAccounts/fileServices",
                              "apiVersion": "2024-01-01",
                              "name": "[format('{0}/{1}', parameters('storageAccountName'), parameters('name'))]",
                              "properties": {
                                "cors": "[if(not(equals(parameters('corsRules'), null())), createObject('corsRules', parameters('corsRules')), null())]",
                                "protocolSettings": "[parameters('protocolSettings')]",
                                "shareDeleteRetentionPolicy": "[parameters('shareDeleteRetentionPolicy')]"
                              }
                            },
                            "fileServices_diagnosticSettings": {
                              "copy": {
                                "name": "fileServices_diagnosticSettings",
                                "count": "[length(coalesce(parameters('diagnosticSettings'), createArray()))]"
                              },
                              "type": "Microsoft.Insights/diagnosticSettings",
                              "apiVersion": "2021-05-01-preview",
                              "scope": "[format('Microsoft.Storage/storageAccounts/{0}/fileServices/{1}', parameters('storageAccountName'), parameters('name'))]",
                              "name": "[coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'name'), format('{0}-diagnosticSettings', parameters('name')))]",
                              "properties": {
                                "copy": [
                                  {
                                    "name": "metrics",
                                    "count": "[length(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'metricCategories'), createArray(createObject('category', 'AllMetrics'))))]",
                                    "input": {
                                      "category": "[coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'metricCategories'), createArray(createObject('category', 'AllMetrics')))[copyIndex('metrics')].category]",
                                      "enabled": "[coalesce(tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'metricCategories'), createArray(createObject('category', 'AllMetrics')))[copyIndex('metrics')], 'enabled'), true())]",
                                      "timeGrain": null
                                    }
                                  },
                                  {
                                    "name": "logs",
                                    "count": "[length(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs'))))]",
                                    "input": {
                                      "categoryGroup": "[tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs')))[copyIndex('logs')], 'categoryGroup')]",
                                      "category": "[tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs')))[copyIndex('logs')], 'category')]",
                                      "enabled": "[coalesce(tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs')))[copyIndex('logs')], 'enabled'), true())]"
                                    }
                                  }
                                ],
                                "storageAccountId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'storageAccountResourceId')]",
                                "workspaceId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'workspaceResourceId')]",
                                "eventHubAuthorizationRuleId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'eventHubAuthorizationRuleResourceId')]",
                                "eventHubName": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'eventHubName')]",
                                "marketplacePartnerId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'marketplacePartnerResourceId')]",
                                "logAnalyticsDestinationType": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logAnalyticsDestinationType')]"
                              },
                              "dependsOn": [
                                "fileServices"
                              ]
                            },
                            "fileServices_shares": {
                              "copy": {
                                "name": "fileServices_shares",
                                "count": "[length(coalesce(parameters('shares'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2025-04-01",
                              "name": "[format('{0}-FileShare-{1}', deployment().name, copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "storageAccountName": {
                                    "value": "[parameters('storageAccountName')]"
                                  },
                                  "fileServicesName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('shares'), createArray())[copyIndex()].name]"
                                  },
                                  "accessTier": {
                                    "value": "[coalesce(tryGet(coalesce(parameters('shares'), createArray())[copyIndex()], 'accessTier'), if(equals(reference('storageAccount', '2024-01-01', 'full').kind, 'FileStorage'), if(startsWith(reference('storageAccount', '2024-01-01', 'full').sku.name, 'PremiumV2_'), null(), 'Premium'), 'TransactionOptimized'))]"
                                  },
                                  "enabledProtocols": {
                                    "value": "[tryGet(coalesce(parameters('shares'), createArray())[copyIndex()], 'enabledProtocols')]"
                                  },
                                  "rootSquash": {
                                    "value": "[tryGet(coalesce(parameters('shares'), createArray())[copyIndex()], 'rootSquash')]"
                                  },
                                  "shareQuota": {
                                    "value": "[tryGet(coalesce(parameters('shares'), createArray())[copyIndex()], 'shareQuota')]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('shares'), createArray())[copyIndex()], 'roleAssignments')]"
                                  },
                                  "enableTelemetry": {
                                    "value": "[variables('enableReferencedModulesTelemetry')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.39.26.7824",
                                      "templateHash": "18417496053778592115"
                                    },
                                    "name": "Storage Account File Shares",
                                    "description": "This module deploys a Storage Account File Share."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "storageAccountName": {
                                      "type": "string",
                                      "maxLength": 24,
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Storage Account. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "fileServicesName": {
                                      "type": "string",
                                      "defaultValue": "default",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent file service. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the file share to create."
                                      }
                                    },
                                    "accessTier": {
                                      "type": "string",
                                      "nullable": true,
                                      "allowedValues": [
                                        "Premium",
                                        "Hot",
                                        "Cool",
                                        "TransactionOptimized"
                                      ],
                                      "metadata": {
                                        "description": "Conditional. Access tier for specific share. Required if the Storage Account kind is set to FileStorage (should be set to \"Premium\"). GpV2 account can choose between TransactionOptimized, Hot, and Cool."
                                      }
                                    },
                                    "shareQuota": {
                                      "type": "int",
                                      "defaultValue": 5120,
                                      "metadata": {
                                        "description": "Optional. The maximum size of the share, in gigabytes. Must be greater than 0, and less than or equal to 5120 (5TB). For Large File Shares, the maximum size is 102400 (100TB)."
                                      }
                                    },
                                    "enabledProtocols": {
                                      "type": "string",
                                      "defaultValue": "SMB",
                                      "allowedValues": [
                                        "NFS",
                                        "SMB"
                                      ],
                                      "metadata": {
                                        "description": "Optional. The authentication protocol that is used for the file share. Can only be specified when creating a share."
                                      }
                                    },
                                    "rootSquash": {
                                      "type": "string",
                                      "defaultValue": "NoRootSquash",
                                      "allowedValues": [
                                        "AllSquash",
                                        "NoRootSquash",
                                        "RootSquash"
                                      ],
                                      "metadata": {
                                        "description": "Optional. Permissions for NFS file shares are enforced by the client OS rather than the Azure Files service. Toggling the root squash behavior reduces the rights of the root user for NFS shares."
                                      }
                                    },
                                    "enableTelemetry": {
                                      "type": "bool",
                                      "defaultValue": true,
                                      "metadata": {
                                        "description": "Optional. Enable/Disable usage telemetry for module."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Reader and Data Access": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'c12c1c16-33a1-487b-954d-41c89c60f349')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "Storage Account Backup Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'e5e2a7ff-d759-4cd2-bb51-3152d37e2eb1')]",
                                      "Storage Account Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '17d1049b-9a84-46fb-8f53-869881c3d3ab')]",
                                      "Storage Account Key Operator Service Role": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '81a9662b-bebf-436f-a333-f67b29880f12')]",
                                      "Storage File Data SMB Share Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '0c867c2a-1d8c-454a-a3db-ab2ea1bdc8bb')]",
                                      "Storage File Data SMB Share Elevated Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'a7264617-510b-434b-a828-9731dc254ea7')]",
                                      "Storage File Data SMB Share Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'aba4ae5f-2193-4029-9191-0cb91df5e314')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "storageAccount::fileService": {
                                      "existing": true,
                                      "type": "Microsoft.Storage/storageAccounts/fileServices",
                                      "apiVersion": "2025-01-01",
                                      "name": "[format('{0}/{1}', parameters('storageAccountName'), parameters('fileServicesName'))]"
                                    },
                                    "avmTelemetry": {
                                      "condition": "[parameters('enableTelemetry')]",
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2024-03-01",
                                      "name": "[format('46d3xbcp.res.storage-fileshare.{0}.{1}', replace('0.1.2', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                                      "properties": {
                                        "mode": "Incremental",
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "resources": [],
                                          "outputs": {
                                            "telemetry": {
                                              "type": "String",
                                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "storageAccount": {
                                      "existing": true,
                                      "type": "Microsoft.Storage/storageAccounts",
                                      "apiVersion": "2025-01-01",
                                      "name": "[parameters('storageAccountName')]"
                                    },
                                    "fileShare": {
                                      "type": "Microsoft.Storage/storageAccounts/fileServices/shares",
                                      "apiVersion": "2025-01-01",
                                      "name": "[format('{0}/{1}/{2}', parameters('storageAccountName'), parameters('fileServicesName'), parameters('name'))]",
                                      "properties": {
                                        "accessTier": "[parameters('accessTier')]",
                                        "shareQuota": "[parameters('shareQuota')]",
                                        "rootSquash": "[if(equals(parameters('enabledProtocols'), 'NFS'), parameters('rootSquash'), null())]",
                                        "enabledProtocols": "[parameters('enabledProtocols')]"
                                      }
                                    },
                                    "fileShare_roleAssignments": {
                                      "copy": {
                                        "name": "fileShare_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2025-04-01",
                                      "name": "[format('{0}-Share-Rbac-{1}', uniqueString(deployment().name), copyIndex())]",
                                      "properties": {
                                        "expressionEvaluationOptions": {
                                          "scope": "inner"
                                        },
                                        "mode": "Incremental",
                                        "parameters": {
                                          "scope": {
                                            "value": "[replace(resourceId('Microsoft.Storage/storageAccounts/fileServices/shares', parameters('storageAccountName'), parameters('fileServicesName'), parameters('name')), '/shares/', '/fileshares/')]"
                                          },
                                          "name": {
                                            "value": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Storage/storageAccounts/fileServices/shares', parameters('storageAccountName'), parameters('fileServicesName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]"
                                          },
                                          "roleDefinitionId": {
                                            "value": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]"
                                          },
                                          "principalId": {
                                            "value": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]"
                                          },
                                          "principalType": {
                                            "value": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]"
                                          },
                                          "condition": {
                                            "value": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]"
                                          },
                                          "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), createObject('value', coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0')), createObject('value', null()))]",
                                          "delegatedManagedIdentityResourceId": {
                                            "value": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                          },
                                          "description": {
                                            "value": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]"
                                          }
                                        },
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "parameters": {
                                            "scope": {
                                              "type": "string",
                                              "metadata": {
                                                "description": "Required. The scope to deploy the role assignment to."
                                              }
                                            },
                                            "name": {
                                              "type": "string",
                                              "metadata": {
                                                "description": "Required. The name of the role assignment."
                                              }
                                            },
                                            "roleDefinitionId": {
                                              "type": "string",
                                              "metadata": {
                                                "description": "Required. The role definition Id to assign."
                                              }
                                            },
                                            "principalId": {
                                              "type": "string",
                                              "metadata": {
                                                "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                              }
                                            },
                                            "principalType": {
                                              "type": "string",
                                              "allowedValues": [
                                                "Device",
                                                "ForeignGroup",
                                                "Group",
                                                "ServicePrincipal",
                                                "User",
                                                ""
                                              ],
                                              "defaultValue": "",
                                              "metadata": {
                                                "description": "Optional. The principal type of the assigned principal ID."
                                              }
                                            },
                                            "description": {
                                              "type": "string",
                                              "defaultValue": "",
                                              "metadata": {
                                                "description": "Optional. The description of the role assignment."
                                              }
                                            },
                                            "condition": {
                                              "type": "string",
                                              "defaultValue": "",
                                              "metadata": {
                                                "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\""
                                              }
                                            },
                                            "conditionVersion": {
                                              "type": "string",
                                              "allowedValues": [
                                                "2.0"
                                              ],
                                              "defaultValue": "2.0",
                                              "metadata": {
                                                "description": "Optional. Version of the condition."
                                              }
                                            },
                                            "delegatedManagedIdentityResourceId": {
                                              "type": "string",
                                              "defaultValue": "",
                                              "metadata": {
                                                "description": "Optional. The Resource Id of the delegated managed identity resource."
                                              }
                                            }
                                          },
                                          "resources": [
                                            {
                                              "type": "Microsoft.Authorization/roleAssignments",
                                              "apiVersion": "2022-04-01",
                                              "scope": "[parameters('scope')]",
                                              "name": "[parameters('name')]",
                                              "properties": {
                                                "roleDefinitionId": "[parameters('roleDefinitionId')]",
                                                "principalId": "[parameters('principalId')]",
                                                "description": "[parameters('description')]",
                                                "principalType": "[if(not(empty(parameters('principalType'))), parameters('principalType'), null())]",
                                                "condition": "[if(not(empty(parameters('condition'))), parameters('condition'), null())]",
                                                "conditionVersion": "[if(and(not(empty(parameters('conditionVersion'))), not(empty(parameters('condition')))), parameters('conditionVersion'), null())]",
                                                "delegatedManagedIdentityResourceId": "[if(not(empty(parameters('delegatedManagedIdentityResourceId'))), parameters('delegatedManagedIdentityResourceId'), null())]"
                                              }
                                            }
                                          ]
                                        }
                                      },
                                      "dependsOn": [
                                        "fileShare"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed file share."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed file share."
                                      },
                                      "value": "[resourceId('Microsoft.Storage/storageAccounts/fileServices/shares', parameters('storageAccountName'), parameters('fileServicesName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed file share."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "fileServices",
                                "storageAccount"
                              ]
                            }
                          },
                          "outputs": {
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the deployed file share service."
                              },
                              "value": "[parameters('name')]"
                            },
                            "resourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource ID of the deployed file share service."
                              },
                              "value": "[resourceId('Microsoft.Storage/storageAccounts/fileServices', parameters('storageAccountName'), parameters('name'))]"
                            },
                            "resourceGroupName": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource group of the deployed file share service."
                              },
                              "value": "[resourceGroup().name]"
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "storageAccount"
                      ]
                    },
                    "storageAccount_queueServices": {
                      "condition": "[not(empty(parameters('queueServices')))]",
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "[format('{0}-Storage-QueueServices', uniqueString(deployment().name, parameters('location')))]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "storageAccountName": {
                            "value": "[parameters('name')]"
                          },
                          "diagnosticSettings": {
                            "value": "[tryGet(parameters('queueServices'), 'diagnosticSettings')]"
                          },
                          "queues": {
                            "value": "[tryGet(parameters('queueServices'), 'queues')]"
                          },
                          "corsRules": {
                            "value": "[tryGet(parameters('queueServices'), 'corsRules')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.39.26.7824",
                              "templateHash": "762865197442503763"
                            },
                            "name": "Storage Account Queue Services",
                            "description": "This module deploys a Storage Account Queue Service."
                          },
                          "definitions": {
                            "corsRuleType": {
                              "type": "object",
                              "properties": {
                                "allowedHeaders": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  },
                                  "metadata": {
                                    "description": "Required. A list of headers allowed to be part of the cross-origin request."
                                  }
                                },
                                "allowedMethods": {
                                  "type": "array",
                                  "allowedValues": [
                                    "CONNECT",
                                    "DELETE",
                                    "GET",
                                    "HEAD",
                                    "MERGE",
                                    "OPTIONS",
                                    "PATCH",
                                    "POST",
                                    "PUT",
                                    "TRACE"
                                  ],
                                  "metadata": {
                                    "description": "Required. A list of HTTP methods that are allowed to be executed by the origin."
                                  }
                                },
                                "allowedOrigins": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  },
                                  "metadata": {
                                    "description": "Required. A list of origin domains that will be allowed via CORS, or \"*\" to allow all domains."
                                  }
                                },
                                "exposedHeaders": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  },
                                  "metadata": {
                                    "description": "Required. A list of response headers to expose to CORS clients."
                                  }
                                },
                                "maxAgeInSeconds": {
                                  "type": "int",
                                  "metadata": {
                                    "description": "Required. The number of seconds that the client/browser should cache a preflight response."
                                  }
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for a cors rule."
                              }
                            },
                            "queueType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the queue."
                                  }
                                },
                                "metadata": {
                                  "type": "object",
                                  "metadata": {
                                    "__bicep_resource_derived_type!": {
                                      "source": "Microsoft.Storage/storageAccounts/queueServices/queues@2024-01-01#properties/properties/properties/metadata"
                                    },
                                    "description": "Optional. Metadata to set on the queue."
                                  },
                                  "nullable": true
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for a queue."
                              }
                            },
                            "diagnosticSettingFullType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name of the diagnostic setting."
                                  }
                                },
                                "logCategoriesAndGroups": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "category": {
                                        "type": "string",
                                        "nullable": true,
                                        "metadata": {
                                          "description": "Optional. Name of a Diagnostic Log category for a resource type this setting is applied to. Set the specific logs to collect here."
                                        }
                                      },
                                      "categoryGroup": {
                                        "type": "string",
                                        "nullable": true,
                                        "metadata": {
                                          "description": "Optional. Name of a Diagnostic Log category group for a resource type this setting is applied to. Set to `allLogs` to collect all logs."
                                        }
                                      },
                                      "enabled": {
                                        "type": "bool",
                                        "nullable": true,
                                        "metadata": {
                                          "description": "Optional. Enable or disable the category explicitly. Default is `true`."
                                        }
                                      }
                                    }
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name of logs that will be streamed. \"allLogs\" includes all possible logs for the resource. Set to `[]` to disable log collection."
                                  }
                                },
                                "metricCategories": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "category": {
                                        "type": "string",
                                        "metadata": {
                                          "description": "Required. Name of a Diagnostic Metric category for a resource type this setting is applied to. Set to `AllMetrics` to collect all metrics."
                                        }
                                      },
                                      "enabled": {
                                        "type": "bool",
                                        "nullable": true,
                                        "metadata": {
                                          "description": "Optional. Enable or disable the category explicitly. Default is `true`."
                                        }
                                      }
                                    }
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name of metrics that will be streamed. \"allMetrics\" includes all possible metrics for the resource. Set to `[]` to disable metric collection."
                                  }
                                },
                                "logAnalyticsDestinationType": {
                                  "type": "string",
                                  "allowedValues": [
                                    "AzureDiagnostics",
                                    "Dedicated"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. A string indicating whether the export to Log Analytics should use the default destination type, i.e. AzureDiagnostics, or use a destination type."
                                  }
                                },
                                "workspaceResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Resource ID of the diagnostic log analytics workspace. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                                  }
                                },
                                "storageAccountResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Resource ID of the diagnostic storage account. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                                  }
                                },
                                "eventHubAuthorizationRuleResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Resource ID of the diagnostic event hub authorization rule for the Event Hubs namespace in which the event hub should be created or streamed to."
                                  }
                                },
                                "eventHubName": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Name of the diagnostic event hub within the namespace to which logs are streamed. Without this, an event hub is created for each log category. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                                  }
                                },
                                "marketplacePartnerResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The full ARM resource ID of the Marketplace resource to which you would like to send Diagnostic Logs."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for a diagnostic setting. To be used if both logs & metrics are supported by the resource provider.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                                }
                              }
                            },
                            "roleAssignmentType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                  }
                                },
                                "roleDefinitionIdOrName": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                  }
                                },
                                "principalId": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                  }
                                },
                                "principalType": {
                                  "type": "string",
                                  "allowedValues": [
                                    "Device",
                                    "ForeignGroup",
                                    "Group",
                                    "ServicePrincipal",
                                    "User"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The principal type of the assigned principal ID."
                                  }
                                },
                                "description": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The description of the role assignment."
                                  }
                                },
                                "condition": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                  }
                                },
                                "conditionVersion": {
                                  "type": "string",
                                  "allowedValues": [
                                    "2.0"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Version of the condition."
                                  }
                                },
                                "delegatedManagedIdentityResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The Resource Id of the delegated managed identity resource."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for a role assignment.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                                }
                              }
                            }
                          },
                          "parameters": {
                            "storageAccountName": {
                              "type": "string",
                              "maxLength": 24,
                              "metadata": {
                                "description": "Conditional. The name of the parent Storage Account. Required if the template is used in a standalone deployment."
                              }
                            },
                            "queues": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/queueType"
                              },
                              "defaultValue": [],
                              "metadata": {
                                "description": "Optional. Queues to create."
                              }
                            },
                            "corsRules": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/corsRuleType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The List of CORS rules. You can include up to five CorsRule elements in the request."
                              }
                            },
                            "diagnosticSettings": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/diagnosticSettingFullType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The diagnostic settings of the service."
                              }
                            }
                          },
                          "variables": {
                            "name": "default"
                          },
                          "resources": {
                            "storageAccount": {
                              "existing": true,
                              "type": "Microsoft.Storage/storageAccounts",
                              "apiVersion": "2024-01-01",
                              "name": "[parameters('storageAccountName')]"
                            },
                            "queueServices": {
                              "type": "Microsoft.Storage/storageAccounts/queueServices",
                              "apiVersion": "2024-01-01",
                              "name": "[format('{0}/{1}', parameters('storageAccountName'), variables('name'))]",
                              "properties": {
                                "cors": "[if(not(equals(parameters('corsRules'), null())), createObject('corsRules', parameters('corsRules')), null())]"
                              }
                            },
                            "queueServices_diagnosticSettings": {
                              "copy": {
                                "name": "queueServices_diagnosticSettings",
                                "count": "[length(coalesce(parameters('diagnosticSettings'), createArray()))]"
                              },
                              "type": "Microsoft.Insights/diagnosticSettings",
                              "apiVersion": "2021-05-01-preview",
                              "scope": "[format('Microsoft.Storage/storageAccounts/{0}/queueServices/{1}', parameters('storageAccountName'), variables('name'))]",
                              "name": "[coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'name'), format('{0}-diagnosticSettings', variables('name')))]",
                              "properties": {
                                "copy": [
                                  {
                                    "name": "metrics",
                                    "count": "[length(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'metricCategories'), createArray(createObject('category', 'AllMetrics'))))]",
                                    "input": {
                                      "category": "[coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'metricCategories'), createArray(createObject('category', 'AllMetrics')))[copyIndex('metrics')].category]",
                                      "enabled": "[coalesce(tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'metricCategories'), createArray(createObject('category', 'AllMetrics')))[copyIndex('metrics')], 'enabled'), true())]",
                                      "timeGrain": null
                                    }
                                  },
                                  {
                                    "name": "logs",
                                    "count": "[length(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs'))))]",
                                    "input": {
                                      "categoryGroup": "[tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs')))[copyIndex('logs')], 'categoryGroup')]",
                                      "category": "[tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs')))[copyIndex('logs')], 'category')]",
                                      "enabled": "[coalesce(tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs')))[copyIndex('logs')], 'enabled'), true())]"
                                    }
                                  }
                                ],
                                "storageAccountId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'storageAccountResourceId')]",
                                "workspaceId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'workspaceResourceId')]",
                                "eventHubAuthorizationRuleId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'eventHubAuthorizationRuleResourceId')]",
                                "eventHubName": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'eventHubName')]",
                                "marketplacePartnerId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'marketplacePartnerResourceId')]",
                                "logAnalyticsDestinationType": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logAnalyticsDestinationType')]"
                              },
                              "dependsOn": [
                                "queueServices"
                              ]
                            },
                            "queueServices_queues": {
                              "copy": {
                                "name": "queueServices_queues",
                                "count": "[length(coalesce(parameters('queues'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2025-04-01",
                              "name": "[format('{0}-Queue-{1}', deployment().name, copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "storageAccountName": {
                                    "value": "[parameters('storageAccountName')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('queues'), createArray())[copyIndex()].name]"
                                  },
                                  "metadata": {
                                    "value": "[tryGet(coalesce(parameters('queues'), createArray())[copyIndex()], 'metadata')]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('queues'), createArray())[copyIndex()], 'roleAssignments')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.39.26.7824",
                                      "templateHash": "2653192815476217627"
                                    },
                                    "name": "Storage Account Queues",
                                    "description": "This module deploys a Storage Account Queue."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "storageAccountName": {
                                      "type": "string",
                                      "maxLength": 24,
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Storage Account. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the storage queue to deploy."
                                      }
                                    },
                                    "metadata": {
                                      "type": "object",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Storage/storageAccounts/queueServices/queues@2024-01-01#properties/properties/properties/metadata"
                                        },
                                        "description": "Optional. A name-value pair that represents queue metadata."
                                      },
                                      "defaultValue": {}
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Reader and Data Access": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'c12c1c16-33a1-487b-954d-41c89c60f349')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "Storage Account Backup Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'e5e2a7ff-d759-4cd2-bb51-3152d37e2eb1')]",
                                      "Storage Account Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '17d1049b-9a84-46fb-8f53-869881c3d3ab')]",
                                      "Storage Account Key Operator Service Role": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '81a9662b-bebf-436f-a333-f67b29880f12')]",
                                      "Storage Queue Data Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '974c5e8b-45b9-4653-ba55-5f855dd0fb88')]",
                                      "Storage Queue Data Message Processor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8a0f0c08-91a1-4084-bc3d-661d67233fed')]",
                                      "Storage Queue Data Message Sender": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'c6a89b2d-59bc-44d0-9896-0f6e12d7b80a')]",
                                      "Storage Queue Data Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '19e7f393-937e-4f77-808e-94535e297925')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "storageAccount::queueServices": {
                                      "existing": true,
                                      "type": "Microsoft.Storage/storageAccounts/queueServices",
                                      "apiVersion": "2024-01-01",
                                      "name": "[format('{0}/{1}', parameters('storageAccountName'), 'default')]"
                                    },
                                    "storageAccount": {
                                      "existing": true,
                                      "type": "Microsoft.Storage/storageAccounts",
                                      "apiVersion": "2024-01-01",
                                      "name": "[parameters('storageAccountName')]"
                                    },
                                    "queue": {
                                      "type": "Microsoft.Storage/storageAccounts/queueServices/queues",
                                      "apiVersion": "2024-01-01",
                                      "name": "[format('{0}/{1}/{2}', parameters('storageAccountName'), 'default', parameters('name'))]",
                                      "properties": {
                                        "metadata": "[parameters('metadata')]"
                                      }
                                    },
                                    "queue_roleAssignments": {
                                      "copy": {
                                        "name": "queue_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Storage/storageAccounts/{0}/queueServices/{1}/queues/{2}', parameters('storageAccountName'), 'default', parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Storage/storageAccounts/queueServices/queues', parameters('storageAccountName'), 'default', parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "queue"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed queue."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed queue."
                                      },
                                      "value": "[resourceId('Microsoft.Storage/storageAccounts/queueServices/queues', parameters('storageAccountName'), 'default', parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed queue."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              }
                            }
                          },
                          "outputs": {
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the deployed queue service."
                              },
                              "value": "[variables('name')]"
                            },
                            "resourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource ID of the deployed queue service."
                              },
                              "value": "[resourceId('Microsoft.Storage/storageAccounts/queueServices', parameters('storageAccountName'), variables('name'))]"
                            },
                            "resourceGroupName": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource group of the deployed queue service."
                              },
                              "value": "[resourceGroup().name]"
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "storageAccount"
                      ]
                    },
                    "storageAccount_tableServices": {
                      "condition": "[not(empty(parameters('tableServices')))]",
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "[format('{0}-Storage-TableServices', uniqueString(deployment().name, parameters('location')))]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "storageAccountName": {
                            "value": "[parameters('name')]"
                          },
                          "diagnosticSettings": {
                            "value": "[tryGet(parameters('tableServices'), 'diagnosticSettings')]"
                          },
                          "tables": {
                            "value": "[tryGet(parameters('tableServices'), 'tables')]"
                          },
                          "corsRules": {
                            "value": "[tryGet(parameters('tableServices'), 'corsRules')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.39.26.7824",
                              "templateHash": "17140438874562378925"
                            },
                            "name": "Storage Account Table Services",
                            "description": "This module deploys a Storage Account Table Service."
                          },
                          "definitions": {
                            "corsRuleType": {
                              "type": "object",
                              "properties": {
                                "allowedHeaders": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  },
                                  "metadata": {
                                    "description": "Required. A list of headers allowed to be part of the cross-origin request."
                                  }
                                },
                                "allowedMethods": {
                                  "type": "array",
                                  "allowedValues": [
                                    "CONNECT",
                                    "DELETE",
                                    "GET",
                                    "HEAD",
                                    "MERGE",
                                    "OPTIONS",
                                    "PATCH",
                                    "POST",
                                    "PUT",
                                    "TRACE"
                                  ],
                                  "metadata": {
                                    "description": "Required. A list of HTTP methods that are allowed to be executed by the origin."
                                  }
                                },
                                "allowedOrigins": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  },
                                  "metadata": {
                                    "description": "Required. A list of origin domains that will be allowed via CORS, or \"*\" to allow all domains."
                                  }
                                },
                                "exposedHeaders": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  },
                                  "metadata": {
                                    "description": "Required. A list of response headers to expose to CORS clients."
                                  }
                                },
                                "maxAgeInSeconds": {
                                  "type": "int",
                                  "metadata": {
                                    "description": "Required. The number of seconds that the client/browser should cache a preflight response."
                                  }
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for a cors rule."
                              }
                            },
                            "tableType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the table."
                                  }
                                },
                                "roleAssignments": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/roleAssignmentType"
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Array of role assignments to create."
                                  }
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for a table."
                              }
                            },
                            "diagnosticSettingFullType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name of the diagnostic setting."
                                  }
                                },
                                "logCategoriesAndGroups": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "category": {
                                        "type": "string",
                                        "nullable": true,
                                        "metadata": {
                                          "description": "Optional. Name of a Diagnostic Log category for a resource type this setting is applied to. Set the specific logs to collect here."
                                        }
                                      },
                                      "categoryGroup": {
                                        "type": "string",
                                        "nullable": true,
                                        "metadata": {
                                          "description": "Optional. Name of a Diagnostic Log category group for a resource type this setting is applied to. Set to `allLogs` to collect all logs."
                                        }
                                      },
                                      "enabled": {
                                        "type": "bool",
                                        "nullable": true,
                                        "metadata": {
                                          "description": "Optional. Enable or disable the category explicitly. Default is `true`."
                                        }
                                      }
                                    }
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name of logs that will be streamed. \"allLogs\" includes all possible logs for the resource. Set to `[]` to disable log collection."
                                  }
                                },
                                "metricCategories": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "category": {
                                        "type": "string",
                                        "metadata": {
                                          "description": "Required. Name of a Diagnostic Metric category for a resource type this setting is applied to. Set to `AllMetrics` to collect all metrics."
                                        }
                                      },
                                      "enabled": {
                                        "type": "bool",
                                        "nullable": true,
                                        "metadata": {
                                          "description": "Optional. Enable or disable the category explicitly. Default is `true`."
                                        }
                                      }
                                    }
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name of metrics that will be streamed. \"allMetrics\" includes all possible metrics for the resource. Set to `[]` to disable metric collection."
                                  }
                                },
                                "logAnalyticsDestinationType": {
                                  "type": "string",
                                  "allowedValues": [
                                    "AzureDiagnostics",
                                    "Dedicated"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. A string indicating whether the export to Log Analytics should use the default destination type, i.e. AzureDiagnostics, or use a destination type."
                                  }
                                },
                                "workspaceResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Resource ID of the diagnostic log analytics workspace. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                                  }
                                },
                                "storageAccountResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Resource ID of the diagnostic storage account. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                                  }
                                },
                                "eventHubAuthorizationRuleResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Resource ID of the diagnostic event hub authorization rule for the Event Hubs namespace in which the event hub should be created or streamed to."
                                  }
                                },
                                "eventHubName": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Name of the diagnostic event hub within the namespace to which logs are streamed. Without this, an event hub is created for each log category. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                                  }
                                },
                                "marketplacePartnerResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The full ARM resource ID of the Marketplace resource to which you would like to send Diagnostic Logs."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for a diagnostic setting. To be used if both logs & metrics are supported by the resource provider.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                                }
                              }
                            },
                            "roleAssignmentType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                  }
                                },
                                "roleDefinitionIdOrName": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                  }
                                },
                                "principalId": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                  }
                                },
                                "principalType": {
                                  "type": "string",
                                  "allowedValues": [
                                    "Device",
                                    "ForeignGroup",
                                    "Group",
                                    "ServicePrincipal",
                                    "User"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The principal type of the assigned principal ID."
                                  }
                                },
                                "description": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The description of the role assignment."
                                  }
                                },
                                "condition": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                  }
                                },
                                "conditionVersion": {
                                  "type": "string",
                                  "allowedValues": [
                                    "2.0"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Version of the condition."
                                  }
                                },
                                "delegatedManagedIdentityResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The Resource Id of the delegated managed identity resource."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for a role assignment.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                                }
                              }
                            }
                          },
                          "parameters": {
                            "storageAccountName": {
                              "type": "string",
                              "maxLength": 24,
                              "metadata": {
                                "description": "Conditional. The name of the parent Storage Account. Required if the template is used in a standalone deployment."
                              }
                            },
                            "tables": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/tableType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Tables to create."
                              }
                            },
                            "corsRules": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/corsRuleType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The List of CORS rules. You can include up to five CorsRule elements in the request."
                              }
                            },
                            "diagnosticSettings": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/diagnosticSettingFullType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The diagnostic settings of the service."
                              }
                            }
                          },
                          "variables": {
                            "name": "default"
                          },
                          "resources": {
                            "storageAccount": {
                              "existing": true,
                              "type": "Microsoft.Storage/storageAccounts",
                              "apiVersion": "2024-01-01",
                              "name": "[parameters('storageAccountName')]"
                            },
                            "tableServices": {
                              "type": "Microsoft.Storage/storageAccounts/tableServices",
                              "apiVersion": "2024-01-01",
                              "name": "[format('{0}/{1}', parameters('storageAccountName'), variables('name'))]",
                              "properties": {
                                "cors": "[if(not(equals(parameters('corsRules'), null())), createObject('corsRules', parameters('corsRules')), null())]"
                              }
                            },
                            "tableServices_diagnosticSettings": {
                              "copy": {
                                "name": "tableServices_diagnosticSettings",
                                "count": "[length(coalesce(parameters('diagnosticSettings'), createArray()))]"
                              },
                              "type": "Microsoft.Insights/diagnosticSettings",
                              "apiVersion": "2021-05-01-preview",
                              "scope": "[format('Microsoft.Storage/storageAccounts/{0}/tableServices/{1}', parameters('storageAccountName'), variables('name'))]",
                              "name": "[coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'name'), format('{0}-diagnosticSettings', variables('name')))]",
                              "properties": {
                                "copy": [
                                  {
                                    "name": "metrics",
                                    "count": "[length(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'metricCategories'), createArray(createObject('category', 'AllMetrics'))))]",
                                    "input": {
                                      "category": "[coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'metricCategories'), createArray(createObject('category', 'AllMetrics')))[copyIndex('metrics')].category]",
                                      "enabled": "[coalesce(tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'metricCategories'), createArray(createObject('category', 'AllMetrics')))[copyIndex('metrics')], 'enabled'), true())]",
                                      "timeGrain": null
                                    }
                                  },
                                  {
                                    "name": "logs",
                                    "count": "[length(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs'))))]",
                                    "input": {
                                      "categoryGroup": "[tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs')))[copyIndex('logs')], 'categoryGroup')]",
                                      "category": "[tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs')))[copyIndex('logs')], 'category')]",
                                      "enabled": "[coalesce(tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs')))[copyIndex('logs')], 'enabled'), true())]"
                                    }
                                  }
                                ],
                                "storageAccountId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'storageAccountResourceId')]",
                                "workspaceId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'workspaceResourceId')]",
                                "eventHubAuthorizationRuleId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'eventHubAuthorizationRuleResourceId')]",
                                "eventHubName": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'eventHubName')]",
                                "marketplacePartnerId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'marketplacePartnerResourceId')]",
                                "logAnalyticsDestinationType": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logAnalyticsDestinationType')]"
                              },
                              "dependsOn": [
                                "tableServices"
                              ]
                            },
                            "tableServices_tables": {
                              "copy": {
                                "name": "tableServices_tables",
                                "count": "[length(coalesce(parameters('tables'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2025-04-01",
                              "name": "[format('{0}-Table-{1}', deployment().name, copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "name": {
                                    "value": "[coalesce(parameters('tables'), createArray())[copyIndex()].name]"
                                  },
                                  "storageAccountName": {
                                    "value": "[parameters('storageAccountName')]"
                                  },
                                  "roleAssignments": {
                                    "value": "[tryGet(coalesce(parameters('tables'), createArray())[copyIndex()], 'roleAssignments')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.39.26.7824",
                                      "templateHash": "11466809443516053137"
                                    },
                                    "name": "Storage Account Table",
                                    "description": "This module deploys a Storage Account Table."
                                  },
                                  "definitions": {
                                    "roleAssignmentType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                          }
                                        },
                                        "roleDefinitionIdOrName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                          }
                                        },
                                        "principalId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                          }
                                        },
                                        "principalType": {
                                          "type": "string",
                                          "allowedValues": [
                                            "Device",
                                            "ForeignGroup",
                                            "Group",
                                            "ServicePrincipal",
                                            "User"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The principal type of the assigned principal ID."
                                          }
                                        },
                                        "description": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The description of the role assignment."
                                          }
                                        },
                                        "condition": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                          }
                                        },
                                        "conditionVersion": {
                                          "type": "string",
                                          "allowedValues": [
                                            "2.0"
                                          ],
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. Version of the condition."
                                          }
                                        },
                                        "delegatedManagedIdentityResourceId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "description": "An AVM-aligned type for a role assignment.",
                                        "__bicep_imported_from!": {
                                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                                        }
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "storageAccountName": {
                                      "type": "string",
                                      "maxLength": 24,
                                      "metadata": {
                                        "description": "Conditional. The name of the parent Storage Account. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "roleAssignments": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/roleAssignmentType"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Array of role assignments to create."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. Name of the table."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "formattedRoleAssignments",
                                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                                      }
                                    ],
                                    "builtInRoleNames": {
                                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                                      "Reader and Data Access": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'c12c1c16-33a1-487b-954d-41c89c60f349')]",
                                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                                      "Storage Account Backup Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'e5e2a7ff-d759-4cd2-bb51-3152d37e2eb1')]",
                                      "Storage Account Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '17d1049b-9a84-46fb-8f53-869881c3d3ab')]",
                                      "Storage Account Key Operator Service Role": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '81a9662b-bebf-436f-a333-f67b29880f12')]",
                                      "Storage Table Data Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '0a9a7e1f-b9d0-4cc4-a60d-0319b160aaa3')]",
                                      "Storage Table Data Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '76199698-9eea-4c19-bc75-cec21354c6b6')]",
                                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                                    }
                                  },
                                  "resources": {
                                    "storageAccount::tableServices": {
                                      "existing": true,
                                      "type": "Microsoft.Storage/storageAccounts/tableServices",
                                      "apiVersion": "2024-01-01",
                                      "name": "[format('{0}/{1}', parameters('storageAccountName'), 'default')]"
                                    },
                                    "storageAccount": {
                                      "existing": true,
                                      "type": "Microsoft.Storage/storageAccounts",
                                      "apiVersion": "2024-01-01",
                                      "name": "[parameters('storageAccountName')]"
                                    },
                                    "table": {
                                      "type": "Microsoft.Storage/storageAccounts/tableServices/tables",
                                      "apiVersion": "2024-01-01",
                                      "name": "[format('{0}/{1}/{2}', parameters('storageAccountName'), 'default', parameters('name'))]"
                                    },
                                    "table_roleAssignments": {
                                      "copy": {
                                        "name": "table_roleAssignments",
                                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                                      },
                                      "type": "Microsoft.Authorization/roleAssignments",
                                      "apiVersion": "2022-04-01",
                                      "scope": "[format('Microsoft.Storage/storageAccounts/{0}/tableServices/{1}/tables/{2}', parameters('storageAccountName'), 'default', parameters('name'))]",
                                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Storage/storageAccounts/tableServices/tables', parameters('storageAccountName'), 'default', parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                                      "properties": {
                                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                                      },
                                      "dependsOn": [
                                        "table"
                                      ]
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed table."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed table."
                                      },
                                      "value": "[resourceId('Microsoft.Storage/storageAccounts/tableServices/tables', parameters('storageAccountName'), 'default', parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed table."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              }
                            }
                          },
                          "outputs": {
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the deployed table service."
                              },
                              "value": "[variables('name')]"
                            },
                            "resourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource ID of the deployed table service."
                              },
                              "value": "[resourceId('Microsoft.Storage/storageAccounts/tableServices', parameters('storageAccountName'), variables('name'))]"
                            },
                            "resourceGroupName": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource group of the deployed table service."
                              },
                              "value": "[resourceGroup().name]"
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "storageAccount"
                      ]
                    },
                    "secretsExport": {
                      "condition": "[not(equals(parameters('secretsExportConfiguration'), null()))]",
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "[format('{0}-secrets-kv', uniqueString(deployment().name, parameters('location')))]",
                      "subscriptionId": "[split(tryGet(parameters('secretsExportConfiguration'), 'keyVaultResourceId'), '/')[2]]",
                      "resourceGroup": "[split(tryGet(parameters('secretsExportConfiguration'), 'keyVaultResourceId'), '/')[4]]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "keyVaultName": {
                            "value": "[last(split(tryGet(parameters('secretsExportConfiguration'), 'keyVaultResourceId'), '/'))]"
                          },
                          "secretsToSet": {
                            "value": "[union(createArray(), if(contains(parameters('secretsExportConfiguration'), 'accessKey1Name'), createArray(createObject('name', tryGet(parameters('secretsExportConfiguration'), 'accessKey1Name'), 'value', listKeys('storageAccount', '2025-01-01').keys[0].value)), createArray()), if(contains(parameters('secretsExportConfiguration'), 'connectionString1Name'), createArray(createObject('name', tryGet(parameters('secretsExportConfiguration'), 'connectionString1Name'), 'value', format('DefaultEndpointsProtocol=https;AccountName={0};AccountKey={1};EndpointSuffix={2}', parameters('name'), listKeys('storageAccount', '2025-01-01').keys[0].value, environment().suffixes.storage))), createArray()), if(contains(parameters('secretsExportConfiguration'), 'accessKey2Name'), createArray(createObject('name', tryGet(parameters('secretsExportConfiguration'), 'accessKey2Name'), 'value', listKeys('storageAccount', '2025-01-01').keys[1].value)), createArray()), if(contains(parameters('secretsExportConfiguration'), 'connectionString2Name'), createArray(createObject('name', tryGet(parameters('secretsExportConfiguration'), 'connectionString2Name'), 'value', format('DefaultEndpointsProtocol=https;AccountName={0};AccountKey={1};EndpointSuffix={2}', parameters('name'), listKeys('storageAccount', '2025-01-01').keys[1].value, environment().suffixes.storage))), createArray()))]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.39.26.7824",
                              "templateHash": "13614544361780789643"
                            }
                          },
                          "definitions": {
                            "secretSetOutputType": {
                              "type": "object",
                              "properties": {
                                "secretResourceId": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "The resourceId of the exported secret."
                                  }
                                },
                                "secretUri": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "The secret URI of the exported secret."
                                  }
                                },
                                "secretUriWithVersion": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "The secret URI with version of the exported secret."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for the output of the secret set via the secrets export feature.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.0"
                                }
                              }
                            },
                            "secretToSetType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the secret to set."
                                  }
                                },
                                "value": {
                                  "type": "securestring",
                                  "metadata": {
                                    "description": "Required. The value of the secret to set."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for the secret to set via the secrets export feature.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.0"
                                }
                              }
                            }
                          },
                          "parameters": {
                            "keyVaultName": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. The name of the Key Vault to set the ecrets in."
                              }
                            },
                            "secretsToSet": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/secretToSetType"
                              },
                              "metadata": {
                                "description": "Required. The secrets to set in the Key Vault."
                              }
                            }
                          },
                          "resources": {
                            "keyVault": {
                              "existing": true,
                              "type": "Microsoft.KeyVault/vaults",
                              "apiVersion": "2024-11-01",
                              "name": "[parameters('keyVaultName')]"
                            },
                            "secrets": {
                              "copy": {
                                "name": "secrets",
                                "count": "[length(parameters('secretsToSet'))]"
                              },
                              "type": "Microsoft.KeyVault/vaults/secrets",
                              "apiVersion": "2024-11-01",
                              "name": "[format('{0}/{1}', parameters('keyVaultName'), parameters('secretsToSet')[copyIndex()].name)]",
                              "properties": {
                                "value": "[parameters('secretsToSet')[copyIndex()].value]"
                              }
                            }
                          },
                          "outputs": {
                            "secretsSet": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/secretSetOutputType"
                              },
                              "metadata": {
                                "description": "The references to the secrets exported to the provided Key Vault."
                              },
                              "copy": {
                                "count": "[length(range(0, length(coalesce(parameters('secretsToSet'), createArray()))))]",
                                "input": {
                                  "secretResourceId": "[resourceId('Microsoft.KeyVault/vaults/secrets', parameters('keyVaultName'), parameters('secretsToSet')[range(0, length(coalesce(parameters('secretsToSet'), createArray())))[copyIndex()]].name)]",
                                  "secretUri": "[reference(format('secrets[{0}]', range(0, length(coalesce(parameters('secretsToSet'), createArray())))[copyIndex()])).secretUri]",
                                  "secretUriWithVersion": "[reference(format('secrets[{0}]', range(0, length(coalesce(parameters('secretsToSet'), createArray())))[copyIndex()])).secretUriWithVersion]"
                                }
                              }
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "storageAccount"
                      ]
                    },
                    "storageAccount_objectReplicationPolicies": {
                      "copy": {
                        "name": "storageAccount_objectReplicationPolicies",
                        "count": "[length(coalesce(parameters('objectReplicationPolicies'), createArray()))]"
                      },
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "[format('{0}-Storage-ObjRepPolicy-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "storageAccountName": {
                            "value": "[parameters('name')]"
                          },
                          "destinationAccountResourceId": {
                            "value": "[coalesce(parameters('objectReplicationPolicies'), createArray())[copyIndex()].destinationStorageAccountResourceId]"
                          },
                          "enableMetrics": {
                            "value": "[coalesce(tryGet(coalesce(parameters('objectReplicationPolicies'), createArray())[copyIndex()], 'enableMetrics'), false())]"
                          },
                          "rules": {
                            "value": "[tryGet(coalesce(parameters('objectReplicationPolicies'), createArray())[copyIndex()], 'rules')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.39.26.7824",
                              "templateHash": "3528396711847214833"
                            },
                            "name": "Storage Account Object Replication Policy",
                            "description": "This module deploys a Storage Account Object Replication Policy for both the source account and destination account."
                          },
                          "definitions": {
                            "objectReplicationPolicyRuleType": {
                              "type": "object",
                              "properties": {
                                "ruleId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The ID of the rule. Auto-generated on destination account. Required for source account."
                                  }
                                },
                                "containerName": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the source container."
                                  }
                                },
                                "destinationContainerName": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name of the destination container. If not provided, the same name as the source container will be used."
                                  }
                                },
                                "filters": {
                                  "type": "object",
                                  "properties": {
                                    "prefixMatch": {
                                      "type": "array",
                                      "items": {
                                        "type": "string"
                                      },
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. The prefix to match for the replication policy rule."
                                      }
                                    },
                                    "minCreationTime": {
                                      "type": "string",
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. The minimum creation time to match for the replication policy rule."
                                      }
                                    }
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The filters for the object replication policy rule."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "The type of an object replication policy rule.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "policy/main.bicep"
                                }
                              }
                            }
                          },
                          "parameters": {
                            "name": {
                              "type": "string",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Name of the policy."
                              }
                            },
                            "storageAccountName": {
                              "type": "string",
                              "maxLength": 24,
                              "metadata": {
                                "description": "Required. The name of the parent Storage Account."
                              }
                            },
                            "destinationAccountResourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. Resource ID of the destination storage account for replication."
                              }
                            },
                            "enableMetrics": {
                              "type": "bool",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Whether metrics are enabled for the object replication policy."
                              }
                            },
                            "rules": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/objectReplicationPolicyRuleType"
                              },
                              "metadata": {
                                "description": "Required. Rules for the object replication policy."
                              }
                            }
                          },
                          "variables": {
                            "destAccountResourceIdParts": "[split(parameters('destinationAccountResourceId'), '/')]",
                            "destAccountName": "[if(not(empty(variables('destAccountResourceIdParts'))), last(variables('destAccountResourceIdParts')), parameters('destinationAccountResourceId'))]",
                            "destAccountSubscription": "[if(greater(length(variables('destAccountResourceIdParts')), 2), variables('destAccountResourceIdParts')[2], subscription().subscriptionId)]",
                            "destAccountResourceGroupName": "[if(greater(length(variables('destAccountResourceIdParts')), 4), variables('destAccountResourceIdParts')[4], resourceGroup().name)]"
                          },
                          "resources": {
                            "storageAccount": {
                              "existing": true,
                              "type": "Microsoft.Storage/storageAccounts",
                              "apiVersion": "2025-01-01",
                              "name": "[parameters('storageAccountName')]"
                            },
                            "destinationPolicy": {
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2025-04-01",
                              "name": "[take(format('{0}-ObjRep-Policy-dest-{1}', deployment().name, variables('destAccountName')), 64)]",
                              "subscriptionId": "[variables('destAccountSubscription')]",
                              "resourceGroup": "[variables('destAccountResourceGroupName')]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "name": {
                                    "value": "[coalesce(parameters('name'), 'default')]"
                                  },
                                  "storageAccountName": {
                                    "value": "[variables('destAccountName')]"
                                  },
                                  "sourceStorageAccountResourceId": {
                                    "value": "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
                                  },
                                  "destinationAccountResourceId": {
                                    "value": "[parameters('destinationAccountResourceId')]"
                                  },
                                  "enableMetrics": {
                                    "value": "[parameters('enableMetrics')]"
                                  },
                                  "rules": {
                                    "value": "[parameters('rules')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.39.26.7824",
                                      "templateHash": "4325417308313318683"
                                    },
                                    "name": "Storage Account Object Replication Policy",
                                    "description": "This module deploys a Storage Account Object Replication Policy for a provided storage account."
                                  },
                                  "definitions": {
                                    "objectReplicationPolicyRuleType": {
                                      "type": "object",
                                      "properties": {
                                        "ruleId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The ID of the rule. Auto-generated on destination account. Required for source account."
                                          }
                                        },
                                        "containerName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The name of the source container."
                                          }
                                        },
                                        "destinationContainerName": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name of the destination container. If not provided, the same name as the source container will be used."
                                          }
                                        },
                                        "filters": {
                                          "type": "object",
                                          "properties": {
                                            "prefixMatch": {
                                              "type": "array",
                                              "items": {
                                                "type": "string"
                                              },
                                              "nullable": true,
                                              "metadata": {
                                                "description": "Optional. The prefix to match for the replication policy rule."
                                              }
                                            },
                                            "minCreationTime": {
                                              "type": "string",
                                              "nullable": true,
                                              "metadata": {
                                                "description": "Optional. The minimum creation time to match for the replication policy rule."
                                              }
                                            }
                                          },
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The filters for the object replication policy rule."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "__bicep_export!": true,
                                        "description": "The type of an object replication policy rule."
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. Name of the policy."
                                      }
                                    },
                                    "storageAccountName": {
                                      "type": "string",
                                      "maxLength": 24,
                                      "metadata": {
                                        "description": "Required. The name of the Storage Account on which to create the policy."
                                      }
                                    },
                                    "sourceStorageAccountResourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. Resource ID of the source storage account for replication."
                                      }
                                    },
                                    "destinationAccountResourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. Resource ID of the destination storage account for replication."
                                      }
                                    },
                                    "enableMetrics": {
                                      "type": "bool",
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Whether metrics are enabled for the object replication policy."
                                      }
                                    },
                                    "rules": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/objectReplicationPolicyRuleType"
                                      },
                                      "metadata": {
                                        "description": "Required. Rules for the object replication policy."
                                      }
                                    }
                                  },
                                  "resources": {
                                    "storageAccount": {
                                      "existing": true,
                                      "type": "Microsoft.Storage/storageAccounts",
                                      "apiVersion": "2025-01-01",
                                      "name": "[parameters('storageAccountName')]"
                                    },
                                    "objectReplicationPolicy": {
                                      "type": "Microsoft.Storage/storageAccounts/objectReplicationPolicies",
                                      "apiVersion": "2025-01-01",
                                      "name": "[format('{0}/{1}', parameters('storageAccountName'), parameters('name'))]",
                                      "properties": {
                                        "copy": [
                                          {
                                            "name": "rules",
                                            "count": "[length(parameters('rules'))]",
                                            "input": {
                                              "ruleId": "[tryGet(parameters('rules')[copyIndex('rules')], 'ruleId')]",
                                              "sourceContainer": "[parameters('rules')[copyIndex('rules')].containerName]",
                                              "destinationContainer": "[coalesce(tryGet(parameters('rules')[copyIndex('rules')], 'destinationContainerName'), parameters('rules')[copyIndex('rules')].containerName)]",
                                              "filters": "[if(not(equals(tryGet(parameters('rules')[copyIndex('rules')], 'filters'), null())), createObject('prefixMatch', tryGet(tryGet(parameters('rules')[copyIndex('rules')], 'filters'), 'prefixMatch'), 'minCreationTime', tryGet(tryGet(parameters('rules')[copyIndex('rules')], 'filters'), 'minCreationTime')), null())]"
                                            }
                                          }
                                        ],
                                        "destinationAccount": "[parameters('destinationAccountResourceId')]",
                                        "metrics": {
                                          "enabled": "[coalesce(parameters('enableMetrics'), false())]"
                                        },
                                        "sourceAccount": "[parameters('sourceStorageAccountResourceId')]"
                                      }
                                    }
                                  },
                                  "outputs": {
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Resource group name of the provisioned resources."
                                      },
                                      "value": "[resourceGroup().name]"
                                    },
                                    "objectReplicationPolicyId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Resource ID of the created Object Replication Policy."
                                      },
                                      "value": "[resourceId('Microsoft.Storage/storageAccounts/objectReplicationPolicies', parameters('storageAccountName'), parameters('name'))]"
                                    },
                                    "policyId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Policy ID of the created Object Replication Policy."
                                      },
                                      "value": "[reference('objectReplicationPolicy').policyId]"
                                    },
                                    "rules": {
                                      "type": "array",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Storage/storageAccounts/objectReplicationPolicies@2025-01-01#properties/properties/properties/rules",
                                          "output": true
                                        },
                                        "description": "Rules created Object Replication Policy."
                                      },
                                      "value": "[reference('objectReplicationPolicy').rules]"
                                    }
                                  }
                                }
                              }
                            },
                            "sourcePolicy": {
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2025-04-01",
                              "name": "[take(format('{0}-ObjRep-Policy-source-{1}', deployment().name, parameters('storageAccountName')), 64)]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "name": {
                                    "value": "[reference('destinationPolicy').outputs.policyId.value]"
                                  },
                                  "storageAccountName": {
                                    "value": "[parameters('storageAccountName')]"
                                  },
                                  "sourceStorageAccountResourceId": {
                                    "value": "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
                                  },
                                  "destinationAccountResourceId": {
                                    "value": "[parameters('destinationAccountResourceId')]"
                                  },
                                  "enableMetrics": {
                                    "value": "[parameters('enableMetrics')]"
                                  },
                                  "rules": {
                                    "copy": [
                                      {
                                        "name": "value",
                                        "count": "[length(parameters('rules'))]",
                                        "input": "[union(parameters('rules')[copyIndex('value')], createObject('ruleId', reference('destinationPolicy').outputs.rules.value[copyIndex('value')].ruleId))]"
                                      }
                                    ]
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.39.26.7824",
                                      "templateHash": "4325417308313318683"
                                    },
                                    "name": "Storage Account Object Replication Policy",
                                    "description": "This module deploys a Storage Account Object Replication Policy for a provided storage account."
                                  },
                                  "definitions": {
                                    "objectReplicationPolicyRuleType": {
                                      "type": "object",
                                      "properties": {
                                        "ruleId": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The ID of the rule. Auto-generated on destination account. Required for source account."
                                          }
                                        },
                                        "containerName": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The name of the source container."
                                          }
                                        },
                                        "destinationContainerName": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name of the destination container. If not provided, the same name as the source container will be used."
                                          }
                                        },
                                        "filters": {
                                          "type": "object",
                                          "properties": {
                                            "prefixMatch": {
                                              "type": "array",
                                              "items": {
                                                "type": "string"
                                              },
                                              "nullable": true,
                                              "metadata": {
                                                "description": "Optional. The prefix to match for the replication policy rule."
                                              }
                                            },
                                            "minCreationTime": {
                                              "type": "string",
                                              "nullable": true,
                                              "metadata": {
                                                "description": "Optional. The minimum creation time to match for the replication policy rule."
                                              }
                                            }
                                          },
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The filters for the object replication policy rule."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "__bicep_export!": true,
                                        "description": "The type of an object replication policy rule."
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. Name of the policy."
                                      }
                                    },
                                    "storageAccountName": {
                                      "type": "string",
                                      "maxLength": 24,
                                      "metadata": {
                                        "description": "Required. The name of the Storage Account on which to create the policy."
                                      }
                                    },
                                    "sourceStorageAccountResourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. Resource ID of the source storage account for replication."
                                      }
                                    },
                                    "destinationAccountResourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. Resource ID of the destination storage account for replication."
                                      }
                                    },
                                    "enableMetrics": {
                                      "type": "bool",
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Whether metrics are enabled for the object replication policy."
                                      }
                                    },
                                    "rules": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/objectReplicationPolicyRuleType"
                                      },
                                      "metadata": {
                                        "description": "Required. Rules for the object replication policy."
                                      }
                                    }
                                  },
                                  "resources": {
                                    "storageAccount": {
                                      "existing": true,
                                      "type": "Microsoft.Storage/storageAccounts",
                                      "apiVersion": "2025-01-01",
                                      "name": "[parameters('storageAccountName')]"
                                    },
                                    "objectReplicationPolicy": {
                                      "type": "Microsoft.Storage/storageAccounts/objectReplicationPolicies",
                                      "apiVersion": "2025-01-01",
                                      "name": "[format('{0}/{1}', parameters('storageAccountName'), parameters('name'))]",
                                      "properties": {
                                        "copy": [
                                          {
                                            "name": "rules",
                                            "count": "[length(parameters('rules'))]",
                                            "input": {
                                              "ruleId": "[tryGet(parameters('rules')[copyIndex('rules')], 'ruleId')]",
                                              "sourceContainer": "[parameters('rules')[copyIndex('rules')].containerName]",
                                              "destinationContainer": "[coalesce(tryGet(parameters('rules')[copyIndex('rules')], 'destinationContainerName'), parameters('rules')[copyIndex('rules')].containerName)]",
                                              "filters": "[if(not(equals(tryGet(parameters('rules')[copyIndex('rules')], 'filters'), null())), createObject('prefixMatch', tryGet(tryGet(parameters('rules')[copyIndex('rules')], 'filters'), 'prefixMatch'), 'minCreationTime', tryGet(tryGet(parameters('rules')[copyIndex('rules')], 'filters'), 'minCreationTime')), null())]"
                                            }
                                          }
                                        ],
                                        "destinationAccount": "[parameters('destinationAccountResourceId')]",
                                        "metrics": {
                                          "enabled": "[coalesce(parameters('enableMetrics'), false())]"
                                        },
                                        "sourceAccount": "[parameters('sourceStorageAccountResourceId')]"
                                      }
                                    }
                                  },
                                  "outputs": {
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Resource group name of the provisioned resources."
                                      },
                                      "value": "[resourceGroup().name]"
                                    },
                                    "objectReplicationPolicyId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Resource ID of the created Object Replication Policy."
                                      },
                                      "value": "[resourceId('Microsoft.Storage/storageAccounts/objectReplicationPolicies', parameters('storageAccountName'), parameters('name'))]"
                                    },
                                    "policyId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Policy ID of the created Object Replication Policy."
                                      },
                                      "value": "[reference('objectReplicationPolicy').policyId]"
                                    },
                                    "rules": {
                                      "type": "array",
                                      "metadata": {
                                        "__bicep_resource_derived_type!": {
                                          "source": "Microsoft.Storage/storageAccounts/objectReplicationPolicies@2025-01-01#properties/properties/properties/rules",
                                          "output": true
                                        },
                                        "description": "Rules created Object Replication Policy."
                                      },
                                      "value": "[reference('objectReplicationPolicy').rules]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "destinationPolicy"
                              ]
                            }
                          },
                          "outputs": {
                            "resourceGroupName": {
                              "type": "string",
                              "metadata": {
                                "description": "Resource group name of the provisioned resources."
                              },
                              "value": "[resourceGroup().name]"
                            },
                            "objectReplicationPolicyId": {
                              "type": "string",
                              "metadata": {
                                "description": "Resource ID of the created Object Replication Policy in the source account."
                              },
                              "value": "[reference('sourcePolicy').outputs.objectReplicationPolicyId.value]"
                            },
                            "policyId": {
                              "type": "string",
                              "metadata": {
                                "description": "Policy ID of the created Object Replication Policy in the source account."
                              },
                              "value": "[reference('sourcePolicy').outputs.policyId.value]"
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "storageAccount",
                        "storageAccount_blobServices"
                      ]
                    }
                  },
                  "outputs": {
                    "resourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "The resource ID of the deployed storage account."
                      },
                      "value": "[resourceId('Microsoft.Storage/storageAccounts', parameters('name'))]"
                    },
                    "name": {
                      "type": "string",
                      "metadata": {
                        "description": "The name of the deployed storage account."
                      },
                      "value": "[parameters('name')]"
                    },
                    "resourceGroupName": {
                      "type": "string",
                      "metadata": {
                        "description": "The resource group of the deployed storage account."
                      },
                      "value": "[resourceGroup().name]"
                    },
                    "primaryBlobEndpoint": {
                      "type": "string",
                      "metadata": {
                        "description": "The primary blob endpoint reference if blob services are deployed."
                      },
                      "value": "[if(and(not(empty(parameters('blobServices'))), contains(parameters('blobServices'), 'containers')), reference(format('Microsoft.Storage/storageAccounts/{0}', parameters('name')), '2019-04-01').primaryEndpoints.blob, '')]"
                    },
                    "systemAssignedMIPrincipalId": {
                      "type": "string",
                      "nullable": true,
                      "metadata": {
                        "description": "The principal ID of the system assigned identity."
                      },
                      "value": "[tryGet(tryGet(reference('storageAccount', '2025-01-01', 'full'), 'identity'), 'principalId')]"
                    },
                    "location": {
                      "type": "string",
                      "metadata": {
                        "description": "The location the resource was deployed into."
                      },
                      "value": "[reference('storageAccount', '2025-01-01', 'full').location]"
                    },
                    "serviceEndpoints": {
                      "type": "object",
                      "metadata": {
                        "description": "All service endpoints of the deployed storage account, Note Standard_LRS and Standard_ZRS accounts only have a blob service endpoint."
                      },
                      "value": "[reference('storageAccount').primaryEndpoints]"
                    },
                    "privateEndpoints": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/privateEndpointOutputType"
                      },
                      "metadata": {
                        "description": "The private endpoints of the Storage Account."
                      },
                      "copy": {
                        "count": "[length(coalesce(parameters('privateEndpoints'), createArray()))]",
                        "input": {
                          "name": "[reference(format('storageAccount_privateEndpoints[{0}]', copyIndex())).outputs.name.value]",
                          "resourceId": "[reference(format('storageAccount_privateEndpoints[{0}]', copyIndex())).outputs.resourceId.value]",
                          "groupId": "[tryGet(tryGet(reference(format('storageAccount_privateEndpoints[{0}]', copyIndex())).outputs, 'groupId'), 'value')]",
                          "customDnsConfigs": "[reference(format('storageAccount_privateEndpoints[{0}]', copyIndex())).outputs.customDnsConfigs.value]",
                          "networkInterfaceResourceIds": "[reference(format('storageAccount_privateEndpoints[{0}]', copyIndex())).outputs.networkInterfaceResourceIds.value]"
                        }
                      }
                    },
                    "exportedSecrets": {
                      "$ref": "#/definitions/secretsOutputType",
                      "metadata": {
                        "description": "A hashtable of references to the secrets exported to the provided Key Vault. The key of each reference is each secret's name."
                      },
                      "value": "[if(not(equals(parameters('secretsExportConfiguration'), null())), toObject(reference('secretsExport').outputs.secretsSet.value, lambda('secret', last(split(lambdaVariables('secret').secretResourceId, '/'))), lambda('secret', lambdaVariables('secret'))), createObject())]"
                    },
                    "primaryAccessKey": {
                      "type": "securestring",
                      "metadata": {
                        "description": "The primary access key of the storage account."
                      },
                      "value": "[listKeys('storageAccount', '2025-01-01').keys[0].value]"
                    },
                    "secondaryAccessKey": {
                      "type": "securestring",
                      "metadata": {
                        "description": "The secondary access key of the storage account."
                      },
                      "value": "[listKeys('storageAccount', '2025-01-01').keys[1].value]"
                    },
                    "primaryConnectionString": {
                      "type": "securestring",
                      "metadata": {
                        "description": "The primary connection string of the storage account."
                      },
                      "value": "[format('DefaultEndpointsProtocol=https;AccountName={0};AccountKey={1};EndpointSuffix={2}', parameters('name'), listKeys('storageAccount', '2025-01-01').keys[0].value, environment().suffixes.storage)]"
                    },
                    "secondaryConnectionString": {
                      "type": "securestring",
                      "metadata": {
                        "description": "The secondary connection string of the storage account."
                      },
                      "value": "[format('DefaultEndpointsProtocol=https;AccountName={0};AccountKey={1};EndpointSuffix={2}', parameters('name'), listKeys('storageAccount', '2025-01-01').keys[1].value, environment().suffixes.storage)]"
                    }
                  }
                }
              },
              "dependsOn": [
                "existingManagedIdentity",
                "managedIdentity",
                "managedNetwork"
              ]
            },
            "keyVault": {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-keyvault', uniqueString(deployment().name, parameters('location')))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "name": {
                    "value": "[variables('keyVaultName')]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "tags": "[if(contains(parameters('tagsByResource'), 'Microsoft.KeyVault/vaults'), createObject('value', union(variables('allTags'), parameters('tagsByResource')['Microsoft.KeyVault/vaults'])), createObject('value', variables('allTags')))]",
                  "enableTelemetry": {
                    "value": "[parameters('enableTelemetry')]"
                  },
                  "enableRbacAuthorization": {
                    "value": "[parameters('enableRbacAuthorization')]"
                  },
                  "enablePurgeProtection": {
                    "value": "[variables('effectivePurgeProtection')]"
                  },
                  "enableSoftDelete": {
                    "value": true
                  },
                  "softDeleteRetentionInDays": {
                    "value": 90
                  },
                  "publicNetworkAccess": "[if(variables('effectivePublicAccess'), createObject('value', 'Enabled'), createObject('value', 'Disabled'))]",
                  "sku": {
                    "value": "standard"
                  },
                  "roleAssignments": "[if(parameters('enableRbacAuthorization'), createObject('value', createArray(createObject('principalId', if(variables('useExistingIdentity'), reference('existingManagedIdentity').principalId, reference('managedIdentity').outputs.principalId.value), 'roleDefinitionIdOrName', 'Key Vault Secrets User', 'principalType', 'ServicePrincipal'))), createObject('value', createArray()))]",
                  "accessPolicies": "[if(not(parameters('enableRbacAuthorization')), createObject('value', createArray(createObject('objectId', if(variables('useExistingIdentity'), reference('existingManagedIdentity').principalId, reference('managedIdentity').outputs.principalId.value), 'permissions', createObject('secrets', createArray('get', 'list'))))), createObject('value', createArray()))]",
                  "privateEndpoints": "[if(variables('enablePrivateEndpoints'), createObject('value', createArray(createObject('name', format('{0}-pe', variables('keyVaultName')), 'subnetResourceId', if(equals(variables('effectiveNetworkIsolationMode'), 'Managed'), reference('managedNetwork').outputs.subnetResourceId.value, if(equals(variables('effectiveNetworkIsolationMode'), 'BringYourOwn'), if(not(empty(parameters('byoSubnetResourceId'))), parameters('byoSubnetResourceId'), parameters('privateEndpointSubnetId')), '')), 'service', 'vault', 'privateDnsZoneGroup', if(and(parameters('enablePrivateDnsZoneGroups'), not(empty(if(equals(variables('effectiveNetworkIsolationMode'), 'Managed'), reference('managedNetwork').outputs.vaultDnsZoneId.value, if(not(empty(parameters('byoVaultDnsZoneId'))), parameters('byoVaultDnsZoneId'), parameters('keyVaultPrivateDnsZoneId')))))), createObject('privateDnsZoneGroupConfigs', createArray(createObject('privateDnsZoneResourceId', if(equals(variables('effectiveNetworkIsolationMode'), 'Managed'), reference('managedNetwork').outputs.vaultDnsZoneId.value, if(not(empty(parameters('byoVaultDnsZoneId'))), parameters('byoVaultDnsZoneId'), parameters('keyVaultPrivateDnsZoneId')))))), null())))), createObject('value', createArray()))]",
                  "lock": {
                    "value": "[parameters('lock')]"
                  },
                  "diagnosticSettings": {
                    "value": "[parameters('diagnosticSettings')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "languageVersion": "2.0",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.37.4.10188",
                      "templateHash": "8811577289487069918"
                    },
                    "name": "Key Vaults",
                    "description": "This module deploys a Key Vault."
                  },
                  "definitions": {
                    "networkAclsType": {
                      "type": "object",
                      "properties": {
                        "bypass": {
                          "type": "string",
                          "allowedValues": [
                            "AzureServices",
                            "None"
                          ],
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The bypass options for traffic for the network ACLs."
                          }
                        },
                        "defaultAction": {
                          "type": "string",
                          "allowedValues": [
                            "Allow",
                            "Deny"
                          ],
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The default action for the network ACLs, when no rule matches."
                          }
                        },
                        "ipRules": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "value": {
                                "type": "string",
                                "metadata": {
                                  "description": "Required. An IPv4 address range in CIDR notation, such as \"124.56.78.91\" (simple IP address) or \"124.56.78.0/24\"."
                                }
                              }
                            }
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. A list of IP rules."
                          }
                        },
                        "virtualNetworkRules": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string",
                                "metadata": {
                                  "description": "Required. The resource ID of the virtual network subnet."
                                }
                              },
                              "ignoreMissingVnetServiceEndpoint": {
                                "type": "bool",
                                "nullable": true,
                                "metadata": {
                                  "description": "Optional. Whether NRP will ignore the check if parent subnet has serviceEndpoints configured."
                                }
                              }
                            }
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. A list of virtual network rules."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_export!": true,
                        "description": "The type for rules governing the accessibility of the key vault from specific network locations."
                      }
                    },
                    "privateEndpointOutputType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "metadata": {
                            "description": "The name of the private endpoint."
                          }
                        },
                        "resourceId": {
                          "type": "string",
                          "metadata": {
                            "description": "The resource ID of the private endpoint."
                          }
                        },
                        "groupId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "The group Id for the private endpoint Group."
                          }
                        },
                        "customDnsConfigs": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "fqdn": {
                                "type": "string",
                                "nullable": true,
                                "metadata": {
                                  "description": "FQDN that resolves to private endpoint IP address."
                                }
                              },
                              "ipAddresses": {
                                "type": "array",
                                "items": {
                                  "type": "string"
                                },
                                "metadata": {
                                  "description": "A list of private IP addresses of the private endpoint."
                                }
                              }
                            }
                          },
                          "metadata": {
                            "description": "The custom DNS configurations of the private endpoint."
                          }
                        },
                        "networkInterfaceResourceIds": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "metadata": {
                            "description": "The IDs of the network interfaces associated with the private endpoint."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_export!": true
                      }
                    },
                    "credentialOutputType": {
                      "type": "object",
                      "properties": {
                        "resourceId": {
                          "type": "string",
                          "metadata": {
                            "description": "The item's resourceId."
                          }
                        },
                        "uri": {
                          "type": "string",
                          "metadata": {
                            "description": "The item's uri."
                          }
                        },
                        "uriWithVersion": {
                          "type": "string",
                          "metadata": {
                            "description": "The item's uri with version."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_export!": true,
                        "description": "The type for a credential output."
                      }
                    },
                    "accessPolicyType": {
                      "type": "object",
                      "properties": {
                        "tenantId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The tenant ID that is used for authenticating requests to the key vault."
                          }
                        },
                        "objectId": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The object ID of a user, service principal or security group in the tenant for the vault."
                          }
                        },
                        "applicationId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Application ID of the client making request on behalf of a principal."
                          }
                        },
                        "permissions": {
                          "type": "object",
                          "properties": {
                            "keys": {
                              "type": "array",
                              "allowedValues": [
                                "all",
                                "backup",
                                "create",
                                "decrypt",
                                "delete",
                                "encrypt",
                                "get",
                                "getrotationpolicy",
                                "import",
                                "list",
                                "purge",
                                "recover",
                                "release",
                                "restore",
                                "rotate",
                                "setrotationpolicy",
                                "sign",
                                "unwrapKey",
                                "update",
                                "verify",
                                "wrapKey"
                              ],
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Permissions to keys."
                              }
                            },
                            "secrets": {
                              "type": "array",
                              "allowedValues": [
                                "all",
                                "backup",
                                "delete",
                                "get",
                                "list",
                                "purge",
                                "recover",
                                "restore",
                                "set"
                              ],
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Permissions to secrets."
                              }
                            },
                            "certificates": {
                              "type": "array",
                              "allowedValues": [
                                "all",
                                "backup",
                                "create",
                                "delete",
                                "deleteissuers",
                                "get",
                                "getissuers",
                                "import",
                                "list",
                                "listissuers",
                                "managecontacts",
                                "manageissuers",
                                "purge",
                                "recover",
                                "restore",
                                "setissuers",
                                "update"
                              ],
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Permissions to certificates."
                              }
                            },
                            "storage": {
                              "type": "array",
                              "allowedValues": [
                                "all",
                                "backup",
                                "delete",
                                "deletesas",
                                "get",
                                "getsas",
                                "list",
                                "listsas",
                                "purge",
                                "recover",
                                "regeneratekey",
                                "restore",
                                "set",
                                "setsas",
                                "update"
                              ],
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Permissions to storage accounts."
                              }
                            }
                          },
                          "metadata": {
                            "description": "Required. Permissions the identity has for keys, secrets and certificates."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_export!": true,
                        "description": "The type for an access policy."
                      }
                    },
                    "secretType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The name of the secret."
                          }
                        },
                        "tags": {
                          "type": "object",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Resource tags."
                          }
                        },
                        "attributes": {
                          "type": "object",
                          "properties": {
                            "enabled": {
                              "type": "bool",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Defines whether the secret is enabled or disabled."
                              }
                            },
                            "exp": {
                              "type": "int",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Defines when the secret will become invalid. Defined in seconds since 1970-01-01T00:00:00Z."
                              }
                            },
                            "nbf": {
                              "type": "int",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. If set, defines the date from which onwards the secret becomes valid. Defined in seconds since 1970-01-01T00:00:00Z."
                              }
                            }
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Contains attributes of the secret."
                          }
                        },
                        "contentType": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The content type of the secret."
                          }
                        },
                        "value": {
                          "type": "securestring",
                          "metadata": {
                            "description": "Required. The value of the secret. NOTE: \"value\" will never be returned from the service, as APIs using this model are is intended for internal use in ARM deployments. Users should use the data-plane REST service for interaction with vault secrets."
                          }
                        },
                        "roleAssignments": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/roleAssignmentType"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Array of role assignments to create."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_export!": true,
                        "description": "The type for a secret output."
                      }
                    },
                    "keyType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The name of the key."
                          }
                        },
                        "tags": {
                          "type": "object",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Resource tags."
                          }
                        },
                        "attributes": {
                          "type": "object",
                          "properties": {
                            "enabled": {
                              "type": "bool",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Defines whether the key is enabled or disabled."
                              }
                            },
                            "exp": {
                              "type": "int",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Defines when the key will become invalid. Defined in seconds since 1970-01-01T00:00:00Z."
                              }
                            },
                            "nbf": {
                              "type": "int",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. If set, defines the date from which onwards the key becomes valid. Defined in seconds since 1970-01-01T00:00:00Z."
                              }
                            }
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Contains attributes of the key."
                          }
                        },
                        "curveName": {
                          "type": "string",
                          "allowedValues": [
                            "P-256",
                            "P-256K",
                            "P-384",
                            "P-521"
                          ],
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The elliptic curve name. Only works if \"keySize\" equals \"EC\" or \"EC-HSM\". Default is \"P-256\"."
                          }
                        },
                        "keyOps": {
                          "type": "array",
                          "allowedValues": [
                            "decrypt",
                            "encrypt",
                            "import",
                            "release",
                            "sign",
                            "unwrapKey",
                            "verify",
                            "wrapKey"
                          ],
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The allowed operations on this key."
                          }
                        },
                        "keySize": {
                          "type": "int",
                          "allowedValues": [
                            2048,
                            3072,
                            4096
                          ],
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The key size in bits. Only works if \"keySize\" equals \"RSA\" or \"RSA-HSM\". Default is \"4096\"."
                          }
                        },
                        "kty": {
                          "type": "string",
                          "allowedValues": [
                            "EC",
                            "EC-HSM",
                            "RSA",
                            "RSA-HSM"
                          ],
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The type of the key. Default is \"EC\"."
                          }
                        },
                        "releasePolicy": {
                          "type": "object",
                          "properties": {
                            "contentType": {
                              "type": "string",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Content type and version of key release policy."
                              }
                            },
                            "data": {
                              "type": "string",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Blob encoding the policy rules under which the key can be released."
                              }
                            }
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Key release policy."
                          }
                        },
                        "rotationPolicy": {
                          "$ref": "#/definitions/rotationPolicyType",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Key rotation policy."
                          }
                        },
                        "roleAssignments": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/roleAssignmentType"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Array of role assignments to create."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_export!": true,
                        "description": "The type for a key."
                      }
                    },
                    "_1.privateEndpointCustomDnsConfigType": {
                      "type": "object",
                      "properties": {
                        "fqdn": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. FQDN that resolves to private endpoint IP address."
                          }
                        },
                        "ipAddresses": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "metadata": {
                            "description": "Required. A list of private IP addresses of the private endpoint."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "_1.privateEndpointIpConfigurationType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The name of the resource that is unique within a resource group."
                          }
                        },
                        "properties": {
                          "type": "object",
                          "properties": {
                            "groupId": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. The ID of a group obtained from the remote resource that this private endpoint should connect to."
                              }
                            },
                            "memberName": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. The member name of a group obtained from the remote resource that this private endpoint should connect to."
                              }
                            },
                            "privateIPAddress": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. A private IP address obtained from the private endpoint's subnet."
                              }
                            }
                          },
                          "metadata": {
                            "description": "Required. Properties of private endpoint IP configurations."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "_1.privateEndpointPrivateDnsZoneGroupType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name of the Private DNS Zone Group."
                          }
                        },
                        "privateDnsZoneGroupConfigs": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "name": {
                                "type": "string",
                                "nullable": true,
                                "metadata": {
                                  "description": "Optional. The name of the private DNS Zone Group config."
                                }
                              },
                              "privateDnsZoneResourceId": {
                                "type": "string",
                                "metadata": {
                                  "description": "Required. The resource id of the private DNS zone."
                                }
                              }
                            }
                          },
                          "metadata": {
                            "description": "Required. The private DNS Zone Groups to associate the Private Endpoint. A DNS Zone Group can support up to 5 DNS zones."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "diagnosticSettingFullType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name of the diagnostic setting."
                          }
                        },
                        "logCategoriesAndGroups": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "category": {
                                "type": "string",
                                "nullable": true,
                                "metadata": {
                                  "description": "Optional. Name of a Diagnostic Log category for a resource type this setting is applied to. Set the specific logs to collect here."
                                }
                              },
                              "categoryGroup": {
                                "type": "string",
                                "nullable": true,
                                "metadata": {
                                  "description": "Optional. Name of a Diagnostic Log category group for a resource type this setting is applied to. Set to `allLogs` to collect all logs."
                                }
                              },
                              "enabled": {
                                "type": "bool",
                                "nullable": true,
                                "metadata": {
                                  "description": "Optional. Enable or disable the category explicitly. Default is `true`."
                                }
                              }
                            }
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name of logs that will be streamed. \"allLogs\" includes all possible logs for the resource. Set to `[]` to disable log collection."
                          }
                        },
                        "metricCategories": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "category": {
                                "type": "string",
                                "metadata": {
                                  "description": "Required. Name of a Diagnostic Metric category for a resource type this setting is applied to. Set to `AllMetrics` to collect all metrics."
                                }
                              },
                              "enabled": {
                                "type": "bool",
                                "nullable": true,
                                "metadata": {
                                  "description": "Optional. Enable or disable the category explicitly. Default is `true`."
                                }
                              }
                            }
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name of metrics that will be streamed. \"allMetrics\" includes all possible metrics for the resource. Set to `[]` to disable metric collection."
                          }
                        },
                        "logAnalyticsDestinationType": {
                          "type": "string",
                          "allowedValues": [
                            "AzureDiagnostics",
                            "Dedicated"
                          ],
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. A string indicating whether the export to Log Analytics should use the default destination type, i.e. AzureDiagnostics, or use a destination type."
                          }
                        },
                        "workspaceResourceId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Resource ID of the diagnostic log analytics workspace. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                          }
                        },
                        "storageAccountResourceId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Resource ID of the diagnostic storage account. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                          }
                        },
                        "eventHubAuthorizationRuleResourceId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Resource ID of the diagnostic event hub authorization rule for the Event Hubs namespace in which the event hub should be created or streamed to."
                          }
                        },
                        "eventHubName": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Name of the diagnostic event hub within the namespace to which logs are streamed. Without this, an event hub is created for each log category. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                          }
                        },
                        "marketplacePartnerResourceId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The full ARM resource ID of the Marketplace resource to which you would like to send Diagnostic Logs."
                          }
                        }
                      },
                      "metadata": {
                        "description": "An AVM-aligned type for a diagnostic setting. To be used if both logs & metrics are supported by the resource provider.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "lockType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Specify the name of lock."
                          }
                        },
                        "kind": {
                          "type": "string",
                          "allowedValues": [
                            "CanNotDelete",
                            "None",
                            "ReadOnly"
                          ],
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Specify the type of lock."
                          }
                        },
                        "notes": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Specify the notes of the lock."
                          }
                        }
                      },
                      "metadata": {
                        "description": "An AVM-aligned type for a lock.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "privateEndpointSingleServiceType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name of the Private Endpoint."
                          }
                        },
                        "location": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The location to deploy the Private Endpoint to."
                          }
                        },
                        "privateLinkServiceConnectionName": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name of the private link connection to create."
                          }
                        },
                        "service": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The subresource to deploy the Private Endpoint for. For example \"vault\" for a Key Vault Private Endpoint."
                          }
                        },
                        "subnetResourceId": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. Resource ID of the subnet where the endpoint needs to be created."
                          }
                        },
                        "resourceGroupResourceId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The resource ID of the Resource Group the Private Endpoint will be created in. If not specified, the Resource Group of the provided Virtual Network Subnet is used."
                          }
                        },
                        "privateDnsZoneGroup": {
                          "$ref": "#/definitions/_1.privateEndpointPrivateDnsZoneGroupType",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The private DNS Zone Group to configure for the Private Endpoint."
                          }
                        },
                        "isManualConnection": {
                          "type": "bool",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. If Manual Private Link Connection is required."
                          }
                        },
                        "manualConnectionRequestMessage": {
                          "type": "string",
                          "nullable": true,
                          "maxLength": 140,
                          "metadata": {
                            "description": "Optional. A message passed to the owner of the remote resource with the manual connection request."
                          }
                        },
                        "customDnsConfigs": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/_1.privateEndpointCustomDnsConfigType"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Custom DNS configurations."
                          }
                        },
                        "ipConfigurations": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/_1.privateEndpointIpConfigurationType"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. A list of IP configurations of the Private Endpoint. This will be used to map to the first-party Service endpoints."
                          }
                        },
                        "applicationSecurityGroupResourceIds": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Application security groups in which the Private Endpoint IP configuration is included."
                          }
                        },
                        "customNetworkInterfaceName": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The custom name of the network interface attached to the Private Endpoint."
                          }
                        },
                        "lock": {
                          "$ref": "#/definitions/lockType",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Specify the type of lock."
                          }
                        },
                        "roleAssignments": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/roleAssignmentType"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Array of role assignments to create."
                          }
                        },
                        "tags": {
                          "type": "object",
                          "nullable": true,
                          "metadata": {
                            "__bicep_resource_derived_type!": {
                              "source": "Microsoft.Network/privateEndpoints@2024-07-01#properties/tags"
                            },
                            "description": "Optional. Tags to be applied on all resources/Resource Groups in this deployment."
                          }
                        },
                        "enableTelemetry": {
                          "type": "bool",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Enable/Disable usage telemetry for module."
                          }
                        }
                      },
                      "metadata": {
                        "description": "An AVM-aligned type for a private endpoint. To be used if the private endpoint's default service / groupId can be assumed (i.e., for services that only have one Private Endpoint type like 'vault' for key vault).",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "roleAssignmentType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                          }
                        },
                        "roleDefinitionIdOrName": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                          }
                        },
                        "principalId": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                          }
                        },
                        "principalType": {
                          "type": "string",
                          "allowedValues": [
                            "Device",
                            "ForeignGroup",
                            "Group",
                            "ServicePrincipal",
                            "User"
                          ],
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The principal type of the assigned principal ID."
                          }
                        },
                        "description": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The description of the role assignment."
                          }
                        },
                        "condition": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                          }
                        },
                        "conditionVersion": {
                          "type": "string",
                          "allowedValues": [
                            "2.0"
                          ],
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Version of the condition."
                          }
                        },
                        "delegatedManagedIdentityResourceId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                          }
                        }
                      },
                      "metadata": {
                        "description": "An AVM-aligned type for a role assignment.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "rotationPolicyType": {
                      "type": "object",
                      "properties": {
                        "attributes": {
                          "type": "object",
                          "properties": {
                            "expiryTime": {
                              "type": "string",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The expiration time for the new key version. It should be in ISO8601 format. Eg: \"P90D\", \"P1Y\"."
                              }
                            }
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The attributes of key rotation policy."
                          }
                        },
                        "lifetimeActions": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "action": {
                                "type": "object",
                                "properties": {
                                  "type": {
                                    "type": "string",
                                    "allowedValues": [
                                      "notify",
                                      "rotate"
                                    ],
                                    "nullable": true,
                                    "metadata": {
                                      "description": "Optional. The type of the action."
                                    }
                                  }
                                },
                                "nullable": true,
                                "metadata": {
                                  "description": "Optional. The type of the action."
                                }
                              },
                              "trigger": {
                                "type": "object",
                                "properties": {
                                  "timeAfterCreate": {
                                    "type": "string",
                                    "nullable": true,
                                    "metadata": {
                                      "description": "Optional. The time duration after key creation to rotate the key. It only applies to rotate. It will be in ISO 8601 duration format. Eg: \"P90D\", \"P1Y\"."
                                    }
                                  },
                                  "timeBeforeExpiry": {
                                    "type": "string",
                                    "nullable": true,
                                    "metadata": {
                                      "description": "Optional. The time duration before key expiring to rotate or notify. It will be in ISO 8601 duration format. Eg: \"P90D\", \"P1Y\"."
                                    }
                                  }
                                },
                                "nullable": true,
                                "metadata": {
                                  "description": "Optional. The time duration for rotating the key."
                                }
                              }
                            }
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The key rotation policy lifetime actions."
                          }
                        }
                      },
                      "metadata": {
                        "description": "The type for a rotation policy.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "key/main.bicep"
                        }
                      }
                    }
                  },
                  "parameters": {
                    "name": {
                      "type": "string",
                      "maxLength": 24,
                      "metadata": {
                        "description": "Required. Name of the Key Vault. Must be globally unique."
                      }
                    },
                    "location": {
                      "type": "string",
                      "defaultValue": "[resourceGroup().location]",
                      "metadata": {
                        "description": "Optional. Location for all resources."
                      }
                    },
                    "accessPolicies": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/accessPolicyType"
                      },
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. All access policies to create."
                      }
                    },
                    "secrets": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/secretType"
                      },
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. All secrets to create."
                      }
                    },
                    "keys": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/keyType"
                      },
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. All keys to create."
                      }
                    },
                    "enableVaultForDeployment": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Optional. Specifies if the vault is enabled for deployment by script or compute."
                      }
                    },
                    "enableVaultForTemplateDeployment": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Optional. Specifies if the vault is enabled for a template deployment."
                      }
                    },
                    "enableVaultForDiskEncryption": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Optional. Specifies if the azure platform has access to the vault for enabling disk encryption scenarios."
                      }
                    },
                    "enableSoftDelete": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Optional. Switch to enable/disable Key Vault's soft delete feature."
                      }
                    },
                    "softDeleteRetentionInDays": {
                      "type": "int",
                      "defaultValue": 90,
                      "metadata": {
                        "description": "Optional. softDelete data retention days. It accepts >=7 and <=90."
                      }
                    },
                    "enableRbacAuthorization": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Optional. Property that controls how data actions are authorized. When true, the key vault will use Role Based Access Control (RBAC) for authorization of data actions, and the access policies specified in vault properties will be ignored. When false, the key vault will use the access policies specified in vault properties, and any policy stored on Azure Resource Manager will be ignored. Note that management actions are always authorized with RBAC."
                      }
                    },
                    "createMode": {
                      "type": "string",
                      "defaultValue": "default",
                      "allowedValues": [
                        "default",
                        "recover"
                      ],
                      "metadata": {
                        "description": "Optional. The vault's create mode to indicate whether the vault need to be recovered or not."
                      }
                    },
                    "enablePurgeProtection": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Optional. Provide 'true' to enable Key Vault's purge protection feature."
                      }
                    },
                    "sku": {
                      "type": "string",
                      "defaultValue": "premium",
                      "allowedValues": [
                        "premium",
                        "standard"
                      ],
                      "metadata": {
                        "description": "Optional. Specifies the SKU for the vault."
                      }
                    },
                    "networkAcls": {
                      "$ref": "#/definitions/networkAclsType",
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. Rules governing the accessibility of the resource from specific network locations."
                      }
                    },
                    "publicNetworkAccess": {
                      "type": "string",
                      "defaultValue": "",
                      "allowedValues": [
                        "",
                        "Enabled",
                        "Disabled"
                      ],
                      "metadata": {
                        "description": "Optional. Whether or not public network access is allowed for this resource. For security reasons it should be disabled. If not specified, it will be disabled by default if private endpoints are set and networkAcls are not set."
                      }
                    },
                    "lock": {
                      "$ref": "#/definitions/lockType",
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. The lock settings of the service."
                      }
                    },
                    "roleAssignments": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/roleAssignmentType"
                      },
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. Array of role assignments to create."
                      }
                    },
                    "privateEndpoints": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/privateEndpointSingleServiceType"
                      },
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. Configuration details for private endpoints. For security reasons, it is recommended to use private endpoints whenever possible."
                      }
                    },
                    "tags": {
                      "type": "object",
                      "metadata": {
                        "__bicep_resource_derived_type!": {
                          "source": "Microsoft.KeyVault/vaults@2024-11-01#properties/tags"
                        },
                        "description": "Optional. Resource tags."
                      },
                      "nullable": true
                    },
                    "diagnosticSettings": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/diagnosticSettingFullType"
                      },
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. The diagnostic settings of the service."
                      }
                    },
                    "enableTelemetry": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Optional. Enable/Disable usage telemetry for module."
                      }
                    }
                  },
                  "variables": {
                    "copy": [
                      {
                        "name": "formattedRoleAssignments",
                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                      },
                      {
                        "name": "formattedAccessPolicies",
                        "count": "[length(coalesce(parameters('accessPolicies'), createArray()))]",
                        "input": {
                          "applicationId": "[coalesce(tryGet(coalesce(parameters('accessPolicies'), createArray())[copyIndex('formattedAccessPolicies')], 'applicationId'), '')]",
                          "objectId": "[coalesce(parameters('accessPolicies'), createArray())[copyIndex('formattedAccessPolicies')].objectId]",
                          "permissions": "[coalesce(parameters('accessPolicies'), createArray())[copyIndex('formattedAccessPolicies')].permissions]",
                          "tenantId": "[coalesce(tryGet(coalesce(parameters('accessPolicies'), createArray())[copyIndex('formattedAccessPolicies')], 'tenantId'), tenant().tenantId)]"
                        }
                      }
                    ],
                    "enableReferencedModulesTelemetry": false,
                    "builtInRoleNames": {
                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                      "Key Vault Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '00482a5a-887f-4fb3-b363-3b7fe8e74483')]",
                      "Key Vault Certificates Officer": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'a4417e6f-fecd-4de8-b567-7b0420556985')]",
                      "Key Vault Certificate User": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'db79e9a7-68ee-4b58-9aeb-b90e7c24fcba')]",
                      "Key Vault Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f25e0fa2-a7c8-4377-a976-54943a77a395')]",
                      "Key Vault Crypto Officer": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '14b46e9e-c2b7-41b4-b07b-48a6ebf60603')]",
                      "Key Vault Crypto Service Encryption User": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'e147488a-f6f5-4113-8e2d-b22465e65bf6')]",
                      "Key Vault Crypto User": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '12338af0-0e69-4776-bea7-57ae8d297424')]",
                      "Key Vault Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '21090545-7ca7-4776-b22c-e363652d74d2')]",
                      "Key Vault Secrets Officer": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b86a8fe4-44ce-4948-aee5-eccb2c155cd7')]",
                      "Key Vault Secrets User": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4633458b-17de-408a-b874-0445c86b69e6')]",
                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                    }
                  },
                  "resources": {
                    "avmTelemetry": {
                      "condition": "[parameters('enableTelemetry')]",
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2024-03-01",
                      "name": "[format('46d3xbcp.res.keyvault-vault.{0}.{1}', replace('0.13.3', '.', '-'), substring(uniqueString(deployment().name, parameters('location')), 0, 4))]",
                      "properties": {
                        "mode": "Incremental",
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "resources": [],
                          "outputs": {
                            "telemetry": {
                              "type": "String",
                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                            }
                          }
                        }
                      }
                    },
                    "keyVault": {
                      "type": "Microsoft.KeyVault/vaults",
                      "apiVersion": "2024-11-01",
                      "name": "[parameters('name')]",
                      "location": "[parameters('location')]",
                      "tags": "[parameters('tags')]",
                      "properties": {
                        "enabledForDeployment": "[parameters('enableVaultForDeployment')]",
                        "enabledForTemplateDeployment": "[parameters('enableVaultForTemplateDeployment')]",
                        "enabledForDiskEncryption": "[parameters('enableVaultForDiskEncryption')]",
                        "enableSoftDelete": "[parameters('enableSoftDelete')]",
                        "softDeleteRetentionInDays": "[parameters('softDeleteRetentionInDays')]",
                        "enableRbacAuthorization": "[parameters('enableRbacAuthorization')]",
                        "createMode": "[parameters('createMode')]",
                        "enablePurgeProtection": "[if(parameters('enablePurgeProtection'), parameters('enablePurgeProtection'), null())]",
                        "tenantId": "[subscription().tenantId]",
                        "accessPolicies": "[variables('formattedAccessPolicies')]",
                        "sku": {
                          "name": "[parameters('sku')]",
                          "family": "A"
                        },
                        "networkAcls": "[if(not(empty(coalesce(parameters('networkAcls'), createObject()))), createObject('bypass', tryGet(parameters('networkAcls'), 'bypass'), 'defaultAction', tryGet(parameters('networkAcls'), 'defaultAction'), 'virtualNetworkRules', coalesce(tryGet(parameters('networkAcls'), 'virtualNetworkRules'), createArray()), 'ipRules', coalesce(tryGet(parameters('networkAcls'), 'ipRules'), createArray())), null())]",
                        "publicNetworkAccess": "[if(not(empty(parameters('publicNetworkAccess'))), parameters('publicNetworkAccess'), if(and(not(empty(coalesce(parameters('privateEndpoints'), createArray()))), empty(coalesce(parameters('networkAcls'), createObject()))), 'Disabled', null()))]"
                      }
                    },
                    "keyVault_lock": {
                      "condition": "[and(not(empty(coalesce(parameters('lock'), createObject()))), not(equals(tryGet(parameters('lock'), 'kind'), 'None')))]",
                      "type": "Microsoft.Authorization/locks",
                      "apiVersion": "2020-05-01",
                      "scope": "[format('Microsoft.KeyVault/vaults/{0}', parameters('name'))]",
                      "name": "[coalesce(tryGet(parameters('lock'), 'name'), format('lock-{0}', parameters('name')))]",
                      "properties": {
                        "level": "[coalesce(tryGet(parameters('lock'), 'kind'), '')]",
                        "notes": "[coalesce(tryGet(parameters('lock'), 'notes'), if(equals(tryGet(parameters('lock'), 'kind'), 'CanNotDelete'), 'Cannot delete resource or child resources.', 'Cannot delete or modify the resource or child resources.'))]"
                      },
                      "dependsOn": [
                        "keyVault"
                      ]
                    },
                    "keyVault_diagnosticSettings": {
                      "copy": {
                        "name": "keyVault_diagnosticSettings",
                        "count": "[length(coalesce(parameters('diagnosticSettings'), createArray()))]"
                      },
                      "type": "Microsoft.Insights/diagnosticSettings",
                      "apiVersion": "2021-05-01-preview",
                      "scope": "[format('Microsoft.KeyVault/vaults/{0}', parameters('name'))]",
                      "name": "[coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'name'), format('{0}-diagnosticSettings', parameters('name')))]",
                      "properties": {
                        "copy": [
                          {
                            "name": "metrics",
                            "count": "[length(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'metricCategories'), createArray(createObject('category', 'AllMetrics'))))]",
                            "input": {
                              "category": "[coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'metricCategories'), createArray(createObject('category', 'AllMetrics')))[copyIndex('metrics')].category]",
                              "enabled": "[coalesce(tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'metricCategories'), createArray(createObject('category', 'AllMetrics')))[copyIndex('metrics')], 'enabled'), true())]",
                              "timeGrain": null
                            }
                          },
                          {
                            "name": "logs",
                            "count": "[length(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs'))))]",
                            "input": {
                              "categoryGroup": "[tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs')))[copyIndex('logs')], 'categoryGroup')]",
                              "category": "[tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs')))[copyIndex('logs')], 'category')]",
                              "enabled": "[coalesce(tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs')))[copyIndex('logs')], 'enabled'), true())]"
                            }
                          }
                        ],
                        "storageAccountId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'storageAccountResourceId')]",
                        "workspaceId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'workspaceResourceId')]",
                        "eventHubAuthorizationRuleId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'eventHubAuthorizationRuleResourceId')]",
                        "eventHubName": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'eventHubName')]",
                        "marketplacePartnerId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'marketplacePartnerResourceId')]",
                        "logAnalyticsDestinationType": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logAnalyticsDestinationType')]"
                      },
                      "dependsOn": [
                        "keyVault"
                      ]
                    },
                    "keyVault_roleAssignments": {
                      "copy": {
                        "name": "keyVault_roleAssignments",
                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                      },
                      "type": "Microsoft.Authorization/roleAssignments",
                      "apiVersion": "2022-04-01",
                      "scope": "[format('Microsoft.KeyVault/vaults/{0}', parameters('name'))]",
                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.KeyVault/vaults', parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                      "properties": {
                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                      },
                      "dependsOn": [
                        "keyVault"
                      ]
                    },
                    "keyVault_accessPolicies": {
                      "condition": "[not(empty(parameters('accessPolicies')))]",
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('{0}-KeyVault-AccessPolicies', uniqueString(deployment().name, parameters('location')))]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "keyVaultName": {
                            "value": "[parameters('name')]"
                          },
                          "accessPolicies": {
                            "value": "[parameters('accessPolicies')]"
                          },
                          "enableTelemetry": {
                            "value": "[variables('enableReferencedModulesTelemetry')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.37.4.10188",
                              "templateHash": "8803020983329720581"
                            },
                            "name": "Key Vault Access Policies",
                            "description": "This module deploys a Key Vault Access Policy."
                          },
                          "definitions": {
                            "accessPoliciesType": {
                              "type": "object",
                              "properties": {
                                "tenantId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The tenant ID that is used for authenticating requests to the key vault."
                                  }
                                },
                                "objectId": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The object ID of a user, service principal or security group in the tenant for the vault."
                                  }
                                },
                                "applicationId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Application ID of the client making request on behalf of a principal."
                                  }
                                },
                                "permissions": {
                                  "type": "object",
                                  "properties": {
                                    "keys": {
                                      "type": "array",
                                      "allowedValues": [
                                        "all",
                                        "backup",
                                        "create",
                                        "decrypt",
                                        "delete",
                                        "encrypt",
                                        "get",
                                        "getrotationpolicy",
                                        "import",
                                        "list",
                                        "purge",
                                        "recover",
                                        "release",
                                        "restore",
                                        "rotate",
                                        "setrotationpolicy",
                                        "sign",
                                        "unwrapKey",
                                        "update",
                                        "verify",
                                        "wrapKey"
                                      ],
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Permissions to keys."
                                      }
                                    },
                                    "secrets": {
                                      "type": "array",
                                      "allowedValues": [
                                        "all",
                                        "backup",
                                        "delete",
                                        "get",
                                        "list",
                                        "purge",
                                        "recover",
                                        "restore",
                                        "set"
                                      ],
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Permissions to secrets."
                                      }
                                    },
                                    "certificates": {
                                      "type": "array",
                                      "allowedValues": [
                                        "all",
                                        "backup",
                                        "create",
                                        "delete",
                                        "deleteissuers",
                                        "get",
                                        "getissuers",
                                        "import",
                                        "list",
                                        "listissuers",
                                        "managecontacts",
                                        "manageissuers",
                                        "purge",
                                        "recover",
                                        "restore",
                                        "setissuers",
                                        "update"
                                      ],
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Permissions to certificates."
                                      }
                                    },
                                    "storage": {
                                      "type": "array",
                                      "allowedValues": [
                                        "all",
                                        "backup",
                                        "delete",
                                        "deletesas",
                                        "get",
                                        "getsas",
                                        "list",
                                        "listsas",
                                        "purge",
                                        "recover",
                                        "regeneratekey",
                                        "restore",
                                        "set",
                                        "setsas",
                                        "update"
                                      ],
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. Permissions to storage accounts."
                                      }
                                    }
                                  },
                                  "metadata": {
                                    "description": "Required. Permissions the identity has for keys, secrets and certificates."
                                  }
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for an access policy."
                              }
                            }
                          },
                          "parameters": {
                            "keyVaultName": {
                              "type": "string",
                              "metadata": {
                                "description": "Conditional. The name of the parent key vault. Required if the template is used in a standalone deployment."
                              }
                            },
                            "accessPolicies": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/accessPoliciesType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. An array of 0 to 16 identities that have access to the key vault. All identities in the array must use the same tenant ID as the key vault's tenant ID."
                              }
                            },
                            "enableTelemetry": {
                              "type": "bool",
                              "defaultValue": true,
                              "metadata": {
                                "description": "Optional. Enable/Disable usage telemetry for module."
                              }
                            }
                          },
                          "resources": {
                            "avmTelemetry": {
                              "condition": "[parameters('enableTelemetry')]",
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2024-03-01",
                              "name": "[format('46d3xbcp.res.keyvault-accesspolicy.{0}.{1}', replace('-..--..-', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                              "properties": {
                                "mode": "Incremental",
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "contentVersion": "1.0.0.0",
                                  "resources": [],
                                  "outputs": {
                                    "telemetry": {
                                      "type": "String",
                                      "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                    }
                                  }
                                }
                              }
                            },
                            "keyVault": {
                              "existing": true,
                              "type": "Microsoft.KeyVault/vaults",
                              "apiVersion": "2024-11-01",
                              "name": "[parameters('keyVaultName')]"
                            },
                            "policies": {
                              "type": "Microsoft.KeyVault/vaults/accessPolicies",
                              "apiVersion": "2024-11-01",
                              "name": "[format('{0}/{1}', parameters('keyVaultName'), 'add')]",
                              "properties": {
                                "copy": [
                                  {
                                    "name": "accessPolicies",
                                    "count": "[length(coalesce(parameters('accessPolicies'), createArray()))]",
                                    "input": {
                                      "applicationId": "[coalesce(tryGet(coalesce(parameters('accessPolicies'), createArray())[copyIndex('accessPolicies')], 'applicationId'), '')]",
                                      "objectId": "[coalesce(parameters('accessPolicies'), createArray())[copyIndex('accessPolicies')].objectId]",
                                      "permissions": "[coalesce(parameters('accessPolicies'), createArray())[copyIndex('accessPolicies')].permissions]",
                                      "tenantId": "[coalesce(tryGet(coalesce(parameters('accessPolicies'), createArray())[copyIndex('accessPolicies')], 'tenantId'), tenant().tenantId)]"
                                    }
                                  }
                                ]
                              }
                            }
                          },
                          "outputs": {
                            "resourceGroupName": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the resource group the access policies assignment was created in."
                              },
                              "value": "[resourceGroup().name]"
                            },
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the access policies assignment."
                              },
                              "value": "add"
                            },
                            "resourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource ID of the access policies assignment."
                              },
                              "value": "[resourceId('Microsoft.KeyVault/vaults/accessPolicies', parameters('keyVaultName'), 'add')]"
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "keyVault"
                      ]
                    },
                    "keyVault_secrets": {
                      "copy": {
                        "name": "keyVault_secrets",
                        "count": "[length(coalesce(parameters('secrets'), createArray()))]"
                      },
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('{0}-KeyVault-Secret-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "name": {
                            "value": "[coalesce(parameters('secrets'), createArray())[copyIndex()].name]"
                          },
                          "value": {
                            "value": "[coalesce(parameters('secrets'), createArray())[copyIndex()].value]"
                          },
                          "keyVaultName": {
                            "value": "[parameters('name')]"
                          },
                          "attributesEnabled": {
                            "value": "[tryGet(tryGet(coalesce(parameters('secrets'), createArray())[copyIndex()], 'attributes'), 'enabled')]"
                          },
                          "attributesExp": {
                            "value": "[tryGet(tryGet(coalesce(parameters('secrets'), createArray())[copyIndex()], 'attributes'), 'exp')]"
                          },
                          "attributesNbf": {
                            "value": "[tryGet(tryGet(coalesce(parameters('secrets'), createArray())[copyIndex()], 'attributes'), 'nbf')]"
                          },
                          "contentType": {
                            "value": "[tryGet(coalesce(parameters('secrets'), createArray())[copyIndex()], 'contentType')]"
                          },
                          "tags": {
                            "value": "[coalesce(tryGet(coalesce(parameters('secrets'), createArray())[copyIndex()], 'tags'), parameters('tags'))]"
                          },
                          "roleAssignments": {
                            "value": "[tryGet(coalesce(parameters('secrets'), createArray())[copyIndex()], 'roleAssignments')]"
                          },
                          "enableTelemetry": {
                            "value": "[variables('enableReferencedModulesTelemetry')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.37.4.10188",
                              "templateHash": "8701309639990049090"
                            },
                            "name": "Key Vault Secrets",
                            "description": "This module deploys a Key Vault Secret."
                          },
                          "definitions": {
                            "roleAssignmentType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                  }
                                },
                                "roleDefinitionIdOrName": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                  }
                                },
                                "principalId": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                  }
                                },
                                "principalType": {
                                  "type": "string",
                                  "allowedValues": [
                                    "Device",
                                    "ForeignGroup",
                                    "Group",
                                    "ServicePrincipal",
                                    "User"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The principal type of the assigned principal ID."
                                  }
                                },
                                "description": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The description of the role assignment."
                                  }
                                },
                                "condition": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                  }
                                },
                                "conditionVersion": {
                                  "type": "string",
                                  "allowedValues": [
                                    "2.0"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Version of the condition."
                                  }
                                },
                                "delegatedManagedIdentityResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The Resource Id of the delegated managed identity resource."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for a role assignment.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                                }
                              }
                            }
                          },
                          "parameters": {
                            "keyVaultName": {
                              "type": "string",
                              "metadata": {
                                "description": "Conditional. The name of the parent key vault. Required if the template is used in a standalone deployment."
                              }
                            },
                            "name": {
                              "type": "string",
                              "minLength": 1,
                              "maxLength": 127,
                              "metadata": {
                                "description": "Required. The name of the secret (letters (upper and lower case), numbers, -)."
                              }
                            },
                            "tags": {
                              "type": "object",
                              "metadata": {
                                "__bicep_resource_derived_type!": {
                                  "source": "Microsoft.KeyVault/vaults/secrets@2024-11-01#properties/tags"
                                },
                                "description": "Optional. Resource tags."
                              },
                              "nullable": true
                            },
                            "attributesEnabled": {
                              "type": "bool",
                              "defaultValue": true,
                              "metadata": {
                                "description": "Optional. Determines whether the object is enabled."
                              }
                            },
                            "attributesExp": {
                              "type": "int",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Expiry date in seconds since 1970-01-01T00:00:00Z. For security reasons, it is recommended to set an expiration date whenever possible."
                              }
                            },
                            "attributesNbf": {
                              "type": "int",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Not before date in seconds since 1970-01-01T00:00:00Z."
                              }
                            },
                            "contentType": {
                              "type": "securestring",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The content type of the secret."
                              }
                            },
                            "value": {
                              "type": "securestring",
                              "metadata": {
                                "description": "Required. The value of the secret. NOTE: \"value\" will never be returned from the service, as APIs using this model are is intended for internal use in ARM deployments. Users should use the data-plane REST service for interaction with vault secrets."
                              }
                            },
                            "roleAssignments": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/roleAssignmentType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of role assignments to create."
                              }
                            },
                            "enableTelemetry": {
                              "type": "bool",
                              "defaultValue": true,
                              "metadata": {
                                "description": "Optional. Enable/Disable usage telemetry for module."
                              }
                            }
                          },
                          "variables": {
                            "copy": [
                              {
                                "name": "formattedRoleAssignments",
                                "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                              }
                            ],
                            "builtInRoleNames": {
                              "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                              "Key Vault Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '00482a5a-887f-4fb3-b363-3b7fe8e74483')]",
                              "Key Vault Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f25e0fa2-a7c8-4377-a976-54943a77a395')]",
                              "Key Vault Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '21090545-7ca7-4776-b22c-e363652d74d2')]",
                              "Key Vault Secrets Officer": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b86a8fe4-44ce-4948-aee5-eccb2c155cd7')]",
                              "Key Vault Secrets User": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4633458b-17de-408a-b874-0445c86b69e6')]",
                              "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                              "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                              "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                              "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                            }
                          },
                          "resources": {
                            "avmTelemetry": {
                              "condition": "[parameters('enableTelemetry')]",
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2024-03-01",
                              "name": "[format('46d3xbcp.res.keyvault-secret.{0}.{1}', replace('-..--..-', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                              "properties": {
                                "mode": "Incremental",
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "contentVersion": "1.0.0.0",
                                  "resources": [],
                                  "outputs": {
                                    "telemetry": {
                                      "type": "String",
                                      "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                    }
                                  }
                                }
                              }
                            },
                            "keyVault": {
                              "existing": true,
                              "type": "Microsoft.KeyVault/vaults",
                              "apiVersion": "2024-11-01",
                              "name": "[parameters('keyVaultName')]"
                            },
                            "secret": {
                              "type": "Microsoft.KeyVault/vaults/secrets",
                              "apiVersion": "2024-11-01",
                              "name": "[format('{0}/{1}', parameters('keyVaultName'), parameters('name'))]",
                              "tags": "[parameters('tags')]",
                              "properties": {
                                "contentType": "[parameters('contentType')]",
                                "attributes": {
                                  "enabled": "[parameters('attributesEnabled')]",
                                  "exp": "[parameters('attributesExp')]",
                                  "nbf": "[parameters('attributesNbf')]"
                                },
                                "value": "[parameters('value')]"
                              }
                            },
                            "secret_roleAssignments": {
                              "copy": {
                                "name": "secret_roleAssignments",
                                "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                              },
                              "type": "Microsoft.Authorization/roleAssignments",
                              "apiVersion": "2022-04-01",
                              "scope": "[format('Microsoft.KeyVault/vaults/{0}/secrets/{1}', parameters('keyVaultName'), parameters('name'))]",
                              "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.KeyVault/vaults/secrets', parameters('keyVaultName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                              "properties": {
                                "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                              },
                              "dependsOn": [
                                "secret"
                              ]
                            }
                          },
                          "outputs": {
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the secret."
                              },
                              "value": "[parameters('name')]"
                            },
                            "resourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource ID of the secret."
                              },
                              "value": "[resourceId('Microsoft.KeyVault/vaults/secrets', parameters('keyVaultName'), parameters('name'))]"
                            },
                            "secretUri": {
                              "type": "string",
                              "metadata": {
                                "description": "The uri of the secret."
                              },
                              "value": "[reference('secret').secretUri]"
                            },
                            "secretUriWithVersion": {
                              "type": "string",
                              "metadata": {
                                "description": "The uri with version of the secret."
                              },
                              "value": "[reference('secret').secretUriWithVersion]"
                            },
                            "resourceGroupName": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the resource group the secret was created in."
                              },
                              "value": "[resourceGroup().name]"
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "keyVault"
                      ]
                    },
                    "keyVault_keys": {
                      "copy": {
                        "name": "keyVault_keys",
                        "count": "[length(coalesce(parameters('keys'), createArray()))]"
                      },
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('{0}-KeyVault-Key-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "name": {
                            "value": "[coalesce(parameters('keys'), createArray())[copyIndex()].name]"
                          },
                          "keyVaultName": {
                            "value": "[parameters('name')]"
                          },
                          "attributesEnabled": {
                            "value": "[tryGet(tryGet(coalesce(parameters('keys'), createArray())[copyIndex()], 'attributes'), 'enabled')]"
                          },
                          "attributesExp": {
                            "value": "[tryGet(tryGet(coalesce(parameters('keys'), createArray())[copyIndex()], 'attributes'), 'exp')]"
                          },
                          "attributesNbf": {
                            "value": "[tryGet(tryGet(coalesce(parameters('keys'), createArray())[copyIndex()], 'attributes'), 'nbf')]"
                          },
                          "curveName": "[if(and(not(equals(tryGet(coalesce(parameters('keys'), createArray())[copyIndex()], 'kty'), 'RSA')), not(equals(tryGet(coalesce(parameters('keys'), createArray())[copyIndex()], 'kty'), 'RSA-HSM'))), createObject('value', coalesce(tryGet(coalesce(parameters('keys'), createArray())[copyIndex()], 'curveName'), 'P-256')), createObject('value', null()))]",
                          "keyOps": {
                            "value": "[tryGet(coalesce(parameters('keys'), createArray())[copyIndex()], 'keyOps')]"
                          },
                          "keySize": "[if(or(equals(tryGet(coalesce(parameters('keys'), createArray())[copyIndex()], 'kty'), 'RSA'), equals(tryGet(coalesce(parameters('keys'), createArray())[copyIndex()], 'kty'), 'RSA-HSM')), createObject('value', coalesce(tryGet(coalesce(parameters('keys'), createArray())[copyIndex()], 'keySize'), 4096)), createObject('value', null()))]",
                          "releasePolicy": {
                            "value": "[coalesce(tryGet(coalesce(parameters('keys'), createArray())[copyIndex()], 'releasePolicy'), createObject())]"
                          },
                          "kty": {
                            "value": "[coalesce(tryGet(coalesce(parameters('keys'), createArray())[copyIndex()], 'kty'), 'EC')]"
                          },
                          "tags": {
                            "value": "[coalesce(tryGet(coalesce(parameters('keys'), createArray())[copyIndex()], 'tags'), parameters('tags'))]"
                          },
                          "roleAssignments": {
                            "value": "[tryGet(coalesce(parameters('keys'), createArray())[copyIndex()], 'roleAssignments')]"
                          },
                          "rotationPolicy": {
                            "value": "[tryGet(coalesce(parameters('keys'), createArray())[copyIndex()], 'rotationPolicy')]"
                          },
                          "enableTelemetry": {
                            "value": "[variables('enableReferencedModulesTelemetry')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.37.4.10188",
                              "templateHash": "1266219369073699726"
                            },
                            "name": "Key Vault Keys",
                            "description": "This module deploys a Key Vault Key."
                          },
                          "definitions": {
                            "rotationPolicyType": {
                              "type": "object",
                              "properties": {
                                "attributes": {
                                  "type": "object",
                                  "properties": {
                                    "expiryTime": {
                                      "type": "string",
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. The expiration time for the new key version. It should be in ISO8601 format. Eg: \"P90D\", \"P1Y\"."
                                      }
                                    }
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The attributes of key rotation policy."
                                  }
                                },
                                "lifetimeActions": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "action": {
                                        "type": "object",
                                        "properties": {
                                          "type": {
                                            "type": "string",
                                            "allowedValues": [
                                              "notify",
                                              "rotate"
                                            ],
                                            "nullable": true,
                                            "metadata": {
                                              "description": "Optional. The type of the action."
                                            }
                                          }
                                        },
                                        "nullable": true,
                                        "metadata": {
                                          "description": "Optional. The type of the action."
                                        }
                                      },
                                      "trigger": {
                                        "type": "object",
                                        "properties": {
                                          "timeAfterCreate": {
                                            "type": "string",
                                            "nullable": true,
                                            "metadata": {
                                              "description": "Optional. The time duration after key creation to rotate the key. It only applies to rotate. It will be in ISO 8601 duration format. Eg: \"P90D\", \"P1Y\"."
                                            }
                                          },
                                          "timeBeforeExpiry": {
                                            "type": "string",
                                            "nullable": true,
                                            "metadata": {
                                              "description": "Optional. The time duration before key expiring to rotate or notify. It will be in ISO 8601 duration format. Eg: \"P90D\", \"P1Y\"."
                                            }
                                          }
                                        },
                                        "nullable": true,
                                        "metadata": {
                                          "description": "Optional. The time duration for rotating the key."
                                        }
                                      }
                                    }
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The key rotation policy lifetime actions."
                                  }
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type for a rotation policy."
                              }
                            },
                            "roleAssignmentType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                  }
                                },
                                "roleDefinitionIdOrName": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                  }
                                },
                                "principalId": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                  }
                                },
                                "principalType": {
                                  "type": "string",
                                  "allowedValues": [
                                    "Device",
                                    "ForeignGroup",
                                    "Group",
                                    "ServicePrincipal",
                                    "User"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The principal type of the assigned principal ID."
                                  }
                                },
                                "description": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The description of the role assignment."
                                  }
                                },
                                "condition": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                  }
                                },
                                "conditionVersion": {
                                  "type": "string",
                                  "allowedValues": [
                                    "2.0"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Version of the condition."
                                  }
                                },
                                "delegatedManagedIdentityResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The Resource Id of the delegated managed identity resource."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for a role assignment.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                                }
                              }
                            }
                          },
                          "parameters": {
                            "keyVaultName": {
                              "type": "string",
                              "metadata": {
                                "description": "Conditional. The name of the parent key vault. Required if the template is used in a standalone deployment."
                              }
                            },
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. The name of the key."
                              }
                            },
                            "tags": {
                              "type": "object",
                              "metadata": {
                                "__bicep_resource_derived_type!": {
                                  "source": "Microsoft.KeyVault/vaults/keys@2024-11-01#properties/tags"
                                },
                                "description": "Optional. Resource tags."
                              },
                              "nullable": true
                            },
                            "attributesEnabled": {
                              "type": "bool",
                              "defaultValue": true,
                              "metadata": {
                                "description": "Optional. Determines whether the object is enabled."
                              }
                            },
                            "attributesExp": {
                              "type": "int",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Expiry date in seconds since 1970-01-01T00:00:00Z. For security reasons, it is recommended to set an expiration date whenever possible."
                              }
                            },
                            "attributesNbf": {
                              "type": "int",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Not before date in seconds since 1970-01-01T00:00:00Z."
                              }
                            },
                            "curveName": {
                              "type": "string",
                              "defaultValue": "P-256",
                              "allowedValues": [
                                "P-256",
                                "P-256K",
                                "P-384",
                                "P-521"
                              ],
                              "metadata": {
                                "description": "Optional. The elliptic curve name."
                              }
                            },
                            "keyOps": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              },
                              "nullable": true,
                              "allowedValues": [
                                "decrypt",
                                "encrypt",
                                "import",
                                "sign",
                                "unwrapKey",
                                "verify",
                                "wrapKey"
                              ],
                              "metadata": {
                                "description": "Optional. Array of JsonWebKeyOperation."
                              }
                            },
                            "keySize": {
                              "type": "int",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The key size in bits. For example: 2048, 3072, or 4096 for RSA."
                              }
                            },
                            "kty": {
                              "type": "string",
                              "defaultValue": "EC",
                              "allowedValues": [
                                "EC",
                                "EC-HSM",
                                "RSA",
                                "RSA-HSM"
                              ],
                              "metadata": {
                                "description": "Optional. The type of the key."
                              }
                            },
                            "releasePolicy": {
                              "type": "object",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Key release policy."
                              }
                            },
                            "roleAssignments": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/roleAssignmentType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of role assignments to create."
                              }
                            },
                            "rotationPolicy": {
                              "$ref": "#/definitions/rotationPolicyType",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Key rotation policy properties object."
                              }
                            },
                            "enableTelemetry": {
                              "type": "bool",
                              "defaultValue": true,
                              "metadata": {
                                "description": "Optional. Enable/Disable usage telemetry for module."
                              }
                            }
                          },
                          "variables": {
                            "copy": [
                              {
                                "name": "formattedRoleAssignments",
                                "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                              }
                            ],
                            "builtInRoleNames": {
                              "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                              "Key Vault Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '00482a5a-887f-4fb3-b363-3b7fe8e74483')]",
                              "Key Vault Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f25e0fa2-a7c8-4377-a976-54943a77a395')]",
                              "Key Vault Crypto Officer": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '14b46e9e-c2b7-41b4-b07b-48a6ebf60603')]",
                              "Key Vault Crypto Service Encryption User": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'e147488a-f6f5-4113-8e2d-b22465e65bf6')]",
                              "Key Vault Crypto User": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '12338af0-0e69-4776-bea7-57ae8d297424')]",
                              "Key Vault Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '21090545-7ca7-4776-b22c-e363652d74d2')]",
                              "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                              "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                              "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                              "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                            }
                          },
                          "resources": {
                            "avmTelemetry": {
                              "condition": "[parameters('enableTelemetry')]",
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2024-03-01",
                              "name": "[format('46d3xbcp.res.keyvault-key.{0}.{1}', replace('-..--..-', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                              "properties": {
                                "mode": "Incremental",
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "contentVersion": "1.0.0.0",
                                  "resources": [],
                                  "outputs": {
                                    "telemetry": {
                                      "type": "String",
                                      "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                    }
                                  }
                                }
                              }
                            },
                            "keyVault": {
                              "existing": true,
                              "type": "Microsoft.KeyVault/vaults",
                              "apiVersion": "2024-11-01",
                              "name": "[parameters('keyVaultName')]"
                            },
                            "key": {
                              "type": "Microsoft.KeyVault/vaults/keys",
                              "apiVersion": "2024-11-01",
                              "name": "[format('{0}/{1}', parameters('keyVaultName'), parameters('name'))]",
                              "tags": "[parameters('tags')]",
                              "properties": "[shallowMerge(createArray(createObject('attributes', createObject('enabled', parameters('attributesEnabled'), 'exp', parameters('attributesExp'), 'nbf', parameters('attributesNbf')), 'curveName', parameters('curveName'), 'keyOps', parameters('keyOps'), 'keySize', parameters('keySize'), 'kty', parameters('kty'), 'release_policy', coalesce(parameters('releasePolicy'), createObject())), if(not(empty(parameters('rotationPolicy'))), createObject('rotationPolicy', parameters('rotationPolicy')), createObject())))]"
                            },
                            "key_roleAssignments": {
                              "copy": {
                                "name": "key_roleAssignments",
                                "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                              },
                              "type": "Microsoft.Authorization/roleAssignments",
                              "apiVersion": "2022-04-01",
                              "scope": "[format('Microsoft.KeyVault/vaults/{0}/keys/{1}', parameters('keyVaultName'), parameters('name'))]",
                              "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.KeyVault/vaults/keys', parameters('keyVaultName'), parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                              "properties": {
                                "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                              },
                              "dependsOn": [
                                "key"
                              ]
                            }
                          },
                          "outputs": {
                            "keyUri": {
                              "type": "string",
                              "metadata": {
                                "description": "The uri of the key."
                              },
                              "value": "[reference('key').keyUri]"
                            },
                            "keyUriWithVersion": {
                              "type": "string",
                              "metadata": {
                                "description": "The uri with version of the key."
                              },
                              "value": "[reference('key').keyUriWithVersion]"
                            },
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the key."
                              },
                              "value": "[parameters('name')]"
                            },
                            "resourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource ID of the key."
                              },
                              "value": "[resourceId('Microsoft.KeyVault/vaults/keys', parameters('keyVaultName'), parameters('name'))]"
                            },
                            "resourceGroupName": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the resource group the key was created in."
                              },
                              "value": "[resourceGroup().name]"
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "keyVault"
                      ]
                    },
                    "keyVault_privateEndpoints": {
                      "copy": {
                        "name": "keyVault_privateEndpoints",
                        "count": "[length(coalesce(parameters('privateEndpoints'), createArray()))]"
                      },
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('{0}-keyVault-PrivateEndpoint-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                      "subscriptionId": "[split(coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'resourceGroupResourceId'), resourceGroup().id), '/')[2]]",
                      "resourceGroup": "[split(coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'resourceGroupResourceId'), resourceGroup().id), '/')[4]]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "name": {
                            "value": "[coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'name'), format('pep-{0}-{1}-{2}', last(split(resourceId('Microsoft.KeyVault/vaults', parameters('name')), '/')), coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'service'), 'vault'), copyIndex()))]"
                          },
                          "privateLinkServiceConnections": "[if(not(equals(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'isManualConnection'), true())), createObject('value', createArray(createObject('name', coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'privateLinkServiceConnectionName'), format('{0}-{1}-{2}', last(split(resourceId('Microsoft.KeyVault/vaults', parameters('name')), '/')), coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'service'), 'vault'), copyIndex())), 'properties', createObject('privateLinkServiceId', resourceId('Microsoft.KeyVault/vaults', parameters('name')), 'groupIds', createArray(coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'service'), 'vault')))))), createObject('value', null()))]",
                          "manualPrivateLinkServiceConnections": "[if(equals(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'isManualConnection'), true()), createObject('value', createArray(createObject('name', coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'privateLinkServiceConnectionName'), format('{0}-{1}-{2}', last(split(resourceId('Microsoft.KeyVault/vaults', parameters('name')), '/')), coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'service'), 'vault'), copyIndex())), 'properties', createObject('privateLinkServiceId', resourceId('Microsoft.KeyVault/vaults', parameters('name')), 'groupIds', createArray(coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'service'), 'vault')), 'requestMessage', coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'manualConnectionRequestMessage'), 'Manual approval required.'))))), createObject('value', null()))]",
                          "subnetResourceId": {
                            "value": "[coalesce(parameters('privateEndpoints'), createArray())[copyIndex()].subnetResourceId]"
                          },
                          "enableTelemetry": {
                            "value": "[variables('enableReferencedModulesTelemetry')]"
                          },
                          "location": {
                            "value": "[coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'location'), reference(split(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()].subnetResourceId, '/subnets/')[0], '2020-06-01', 'Full').location)]"
                          },
                          "lock": {
                            "value": "[coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'lock'), parameters('lock'))]"
                          },
                          "privateDnsZoneGroup": {
                            "value": "[tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'privateDnsZoneGroup')]"
                          },
                          "roleAssignments": {
                            "value": "[tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'roleAssignments')]"
                          },
                          "tags": {
                            "value": "[coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'tags'), parameters('tags'))]"
                          },
                          "customDnsConfigs": {
                            "value": "[tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'customDnsConfigs')]"
                          },
                          "ipConfigurations": {
                            "value": "[tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'ipConfigurations')]"
                          },
                          "applicationSecurityGroupResourceIds": {
                            "value": "[tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'applicationSecurityGroupResourceIds')]"
                          },
                          "customNetworkInterfaceName": {
                            "value": "[tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'customNetworkInterfaceName')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.34.44.8038",
                              "templateHash": "12389807800450456797"
                            },
                            "name": "Private Endpoints",
                            "description": "This module deploys a Private Endpoint."
                          },
                          "definitions": {
                            "privateDnsZoneGroupType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name of the Private DNS Zone Group."
                                  }
                                },
                                "privateDnsZoneGroupConfigs": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/privateDnsZoneGroupConfigType"
                                  },
                                  "metadata": {
                                    "description": "Required. The private DNS zone groups to associate the private endpoint. A DNS zone group can support up to 5 DNS zones."
                                  }
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true
                              }
                            },
                            "ipConfigurationType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the resource that is unique within a resource group."
                                  }
                                },
                                "properties": {
                                  "type": "object",
                                  "properties": {
                                    "groupId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The ID of a group obtained from the remote resource that this private endpoint should connect to. If used with private link service connection, this property must be defined as empty string."
                                      }
                                    },
                                    "memberName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The member name of a group obtained from the remote resource that this private endpoint should connect to. If used with private link service connection, this property must be defined as empty string."
                                      }
                                    },
                                    "privateIPAddress": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. A private IP address obtained from the private endpoint's subnet."
                                      }
                                    }
                                  },
                                  "metadata": {
                                    "description": "Required. Properties of private endpoint IP configurations."
                                  }
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true
                              }
                            },
                            "privateLinkServiceConnectionType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The name of the private link service connection."
                                  }
                                },
                                "properties": {
                                  "type": "object",
                                  "properties": {
                                    "groupIds": {
                                      "type": "array",
                                      "items": {
                                        "type": "string"
                                      },
                                      "metadata": {
                                        "description": "Required. The ID of a group obtained from the remote resource that this private endpoint should connect to. If used with private link service connection, this property must be defined as empty string array `[]`."
                                      }
                                    },
                                    "privateLinkServiceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The resource id of private link service."
                                      }
                                    },
                                    "requestMessage": {
                                      "type": "string",
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. A message passed to the owner of the remote resource with this connection request. Restricted to 140 chars."
                                      }
                                    }
                                  },
                                  "metadata": {
                                    "description": "Required. Properties of private link service connection."
                                  }
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true
                              }
                            },
                            "customDnsConfigType": {
                              "type": "object",
                              "properties": {
                                "fqdn": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. FQDN that resolves to private endpoint IP address."
                                  }
                                },
                                "ipAddresses": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  },
                                  "metadata": {
                                    "description": "Required. A list of private IP addresses of the private endpoint."
                                  }
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true
                              }
                            },
                            "lockType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Specify the name of lock."
                                  }
                                },
                                "kind": {
                                  "type": "string",
                                  "allowedValues": [
                                    "CanNotDelete",
                                    "None",
                                    "ReadOnly"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Specify the type of lock."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for a lock.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                }
                              }
                            },
                            "privateDnsZoneGroupConfigType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name of the private DNS zone group config."
                                  }
                                },
                                "privateDnsZoneResourceId": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The resource id of the private DNS zone."
                                  }
                                }
                              },
                              "metadata": {
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "private-dns-zone-group/main.bicep"
                                }
                              }
                            },
                            "roleAssignmentType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                  }
                                },
                                "roleDefinitionIdOrName": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                  }
                                },
                                "principalId": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                  }
                                },
                                "principalType": {
                                  "type": "string",
                                  "allowedValues": [
                                    "Device",
                                    "ForeignGroup",
                                    "Group",
                                    "ServicePrincipal",
                                    "User"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The principal type of the assigned principal ID."
                                  }
                                },
                                "description": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The description of the role assignment."
                                  }
                                },
                                "condition": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                  }
                                },
                                "conditionVersion": {
                                  "type": "string",
                                  "allowedValues": [
                                    "2.0"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Version of the condition."
                                  }
                                },
                                "delegatedManagedIdentityResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The Resource Id of the delegated managed identity resource."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for a role assignment.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.5.1"
                                }
                              }
                            }
                          },
                          "parameters": {
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. Name of the private endpoint resource to create."
                              }
                            },
                            "subnetResourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. Resource ID of the subnet where the endpoint needs to be created."
                              }
                            },
                            "applicationSecurityGroupResourceIds": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Application security groups in which the private endpoint IP configuration is included."
                              }
                            },
                            "customNetworkInterfaceName": {
                              "type": "string",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The custom name of the network interface attached to the private endpoint."
                              }
                            },
                            "ipConfigurations": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/ipConfigurationType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. A list of IP configurations of the private endpoint. This will be used to map to the First Party Service endpoints."
                              }
                            },
                            "privateDnsZoneGroup": {
                              "$ref": "#/definitions/privateDnsZoneGroupType",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The private DNS zone group to configure for the private endpoint."
                              }
                            },
                            "location": {
                              "type": "string",
                              "defaultValue": "[resourceGroup().location]",
                              "metadata": {
                                "description": "Optional. Location for all Resources."
                              }
                            },
                            "lock": {
                              "$ref": "#/definitions/lockType",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The lock settings of the service."
                              }
                            },
                            "roleAssignments": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/roleAssignmentType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of role assignments to create."
                              }
                            },
                            "tags": {
                              "type": "object",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Tags to be applied on all resources/resource groups in this deployment."
                              }
                            },
                            "customDnsConfigs": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/customDnsConfigType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Custom DNS configurations."
                              }
                            },
                            "manualPrivateLinkServiceConnections": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/privateLinkServiceConnectionType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Conditional. A grouping of information about the connection to the remote resource. Used when the network admin does not have access to approve connections to the remote resource. Required if `privateLinkServiceConnections` is empty."
                              }
                            },
                            "privateLinkServiceConnections": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/privateLinkServiceConnectionType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Conditional. A grouping of information about the connection to the remote resource. Required if `manualPrivateLinkServiceConnections` is empty."
                              }
                            },
                            "enableTelemetry": {
                              "type": "bool",
                              "defaultValue": true,
                              "metadata": {
                                "description": "Optional. Enable/Disable usage telemetry for module."
                              }
                            }
                          },
                          "variables": {
                            "copy": [
                              {
                                "name": "formattedRoleAssignments",
                                "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                              }
                            ],
                            "builtInRoleNames": {
                              "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                              "DNS Resolver Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '0f2ebee7-ffd4-4fc0-b3b7-664099fdad5d')]",
                              "DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'befefa01-2a29-4197-83a8-272ff33ce314')]",
                              "Domain Services Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'eeaeda52-9324-47f6-8069-5d5bade478b2')]",
                              "Domain Services Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '361898ef-9ed1-48c2-849c-a832951106bb')]",
                              "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                              "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                              "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                              "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                              "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]"
                            }
                          },
                          "resources": {
                            "avmTelemetry": {
                              "condition": "[parameters('enableTelemetry')]",
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2024-03-01",
                              "name": "[format('46d3xbcp.res.network-privateendpoint.{0}.{1}', replace('0.11.0', '.', '-'), substring(uniqueString(deployment().name, parameters('location')), 0, 4))]",
                              "properties": {
                                "mode": "Incremental",
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "contentVersion": "1.0.0.0",
                                  "resources": [],
                                  "outputs": {
                                    "telemetry": {
                                      "type": "String",
                                      "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                    }
                                  }
                                }
                              }
                            },
                            "privateEndpoint": {
                              "type": "Microsoft.Network/privateEndpoints",
                              "apiVersion": "2024-05-01",
                              "name": "[parameters('name')]",
                              "location": "[parameters('location')]",
                              "tags": "[parameters('tags')]",
                              "properties": {
                                "copy": [
                                  {
                                    "name": "applicationSecurityGroups",
                                    "count": "[length(coalesce(parameters('applicationSecurityGroupResourceIds'), createArray()))]",
                                    "input": {
                                      "id": "[coalesce(parameters('applicationSecurityGroupResourceIds'), createArray())[copyIndex('applicationSecurityGroups')]]"
                                    }
                                  }
                                ],
                                "customDnsConfigs": "[coalesce(parameters('customDnsConfigs'), createArray())]",
                                "customNetworkInterfaceName": "[coalesce(parameters('customNetworkInterfaceName'), '')]",
                                "ipConfigurations": "[coalesce(parameters('ipConfigurations'), createArray())]",
                                "manualPrivateLinkServiceConnections": "[coalesce(parameters('manualPrivateLinkServiceConnections'), createArray())]",
                                "privateLinkServiceConnections": "[coalesce(parameters('privateLinkServiceConnections'), createArray())]",
                                "subnet": {
                                  "id": "[parameters('subnetResourceId')]"
                                }
                              }
                            },
                            "privateEndpoint_lock": {
                              "condition": "[and(not(empty(coalesce(parameters('lock'), createObject()))), not(equals(tryGet(parameters('lock'), 'kind'), 'None')))]",
                              "type": "Microsoft.Authorization/locks",
                              "apiVersion": "2020-05-01",
                              "scope": "[format('Microsoft.Network/privateEndpoints/{0}', parameters('name'))]",
                              "name": "[coalesce(tryGet(parameters('lock'), 'name'), format('lock-{0}', parameters('name')))]",
                              "properties": {
                                "level": "[coalesce(tryGet(parameters('lock'), 'kind'), '')]",
                                "notes": "[if(equals(tryGet(parameters('lock'), 'kind'), 'CanNotDelete'), 'Cannot delete resource or child resources.', 'Cannot delete or modify the resource or child resources.')]"
                              },
                              "dependsOn": [
                                "privateEndpoint"
                              ]
                            },
                            "privateEndpoint_roleAssignments": {
                              "copy": {
                                "name": "privateEndpoint_roleAssignments",
                                "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                              },
                              "type": "Microsoft.Authorization/roleAssignments",
                              "apiVersion": "2022-04-01",
                              "scope": "[format('Microsoft.Network/privateEndpoints/{0}', parameters('name'))]",
                              "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateEndpoints', parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                              "properties": {
                                "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                              },
                              "dependsOn": [
                                "privateEndpoint"
                              ]
                            },
                            "privateEndpoint_privateDnsZoneGroup": {
                              "condition": "[not(empty(parameters('privateDnsZoneGroup')))]",
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-PrivateEndpoint-PrivateDnsZoneGroup', uniqueString(deployment().name))]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "name": {
                                    "value": "[tryGet(parameters('privateDnsZoneGroup'), 'name')]"
                                  },
                                  "privateEndpointName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "privateDnsZoneConfigs": {
                                    "value": "[parameters('privateDnsZoneGroup').privateDnsZoneGroupConfigs]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.34.44.8038",
                                      "templateHash": "13997305779829540948"
                                    },
                                    "name": "Private Endpoint Private DNS Zone Groups",
                                    "description": "This module deploys a Private Endpoint Private DNS Zone Group."
                                  },
                                  "definitions": {
                                    "privateDnsZoneGroupConfigType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name of the private DNS zone group config."
                                          }
                                        },
                                        "privateDnsZoneResourceId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The resource id of the private DNS zone."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "__bicep_export!": true
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateEndpointName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent private endpoint. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "privateDnsZoneConfigs": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/privateDnsZoneGroupConfigType"
                                      },
                                      "minLength": 1,
                                      "maxLength": 5,
                                      "metadata": {
                                        "description": "Required. Array of private DNS zone configurations of the private DNS zone group. A DNS zone group can support up to 5 DNS zones."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "defaultValue": "default",
                                      "metadata": {
                                        "description": "Optional. The name of the private DNS zone group."
                                      }
                                    }
                                  },
                                  "variables": {
                                    "copy": [
                                      {
                                        "name": "privateDnsZoneConfigsVar",
                                        "count": "[length(parameters('privateDnsZoneConfigs'))]",
                                        "input": {
                                          "name": "[coalesce(tryGet(parameters('privateDnsZoneConfigs')[copyIndex('privateDnsZoneConfigsVar')], 'name'), last(split(parameters('privateDnsZoneConfigs')[copyIndex('privateDnsZoneConfigsVar')].privateDnsZoneResourceId, '/')))]",
                                          "properties": {
                                            "privateDnsZoneId": "[parameters('privateDnsZoneConfigs')[copyIndex('privateDnsZoneConfigsVar')].privateDnsZoneResourceId]"
                                          }
                                        }
                                      }
                                    ]
                                  },
                                  "resources": {
                                    "privateEndpoint": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateEndpoints",
                                      "apiVersion": "2024-05-01",
                                      "name": "[parameters('privateEndpointName')]"
                                    },
                                    "privateDnsZoneGroup": {
                                      "type": "Microsoft.Network/privateEndpoints/privateDnsZoneGroups",
                                      "apiVersion": "2024-05-01",
                                      "name": "[format('{0}/{1}', parameters('privateEndpointName'), parameters('name'))]",
                                      "properties": {
                                        "privateDnsZoneConfigs": "[variables('privateDnsZoneConfigsVar')]"
                                      }
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the private endpoint DNS zone group."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the private endpoint DNS zone group."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateEndpoints/privateDnsZoneGroups', parameters('privateEndpointName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group the private endpoint DNS zone group was deployed into."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateEndpoint"
                              ]
                            }
                          },
                          "outputs": {
                            "resourceGroupName": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource group the private endpoint was deployed into."
                              },
                              "value": "[resourceGroup().name]"
                            },
                            "resourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource ID of the private endpoint."
                              },
                              "value": "[resourceId('Microsoft.Network/privateEndpoints', parameters('name'))]"
                            },
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the private endpoint."
                              },
                              "value": "[parameters('name')]"
                            },
                            "location": {
                              "type": "string",
                              "metadata": {
                                "description": "The location the resource was deployed into."
                              },
                              "value": "[reference('privateEndpoint', '2024-05-01', 'full').location]"
                            },
                            "customDnsConfigs": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/customDnsConfigType"
                              },
                              "metadata": {
                                "description": "The custom DNS configurations of the private endpoint."
                              },
                              "value": "[reference('privateEndpoint').customDnsConfigs]"
                            },
                            "networkInterfaceResourceIds": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              },
                              "metadata": {
                                "description": "The resource IDs of the network interfaces associated with the private endpoint."
                              },
                              "value": "[map(reference('privateEndpoint').networkInterfaces, lambda('nic', lambdaVariables('nic').id))]"
                            },
                            "groupId": {
                              "type": "string",
                              "nullable": true,
                              "metadata": {
                                "description": "The group Id for the private endpoint Group."
                              },
                              "value": "[coalesce(tryGet(tryGet(tryGet(tryGet(reference('privateEndpoint'), 'manualPrivateLinkServiceConnections'), 0, 'properties'), 'groupIds'), 0), tryGet(tryGet(tryGet(tryGet(reference('privateEndpoint'), 'privateLinkServiceConnections'), 0, 'properties'), 'groupIds'), 0))]"
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "keyVault"
                      ]
                    }
                  },
                  "outputs": {
                    "resourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "The resource ID of the key vault."
                      },
                      "value": "[resourceId('Microsoft.KeyVault/vaults', parameters('name'))]"
                    },
                    "resourceGroupName": {
                      "type": "string",
                      "metadata": {
                        "description": "The name of the resource group the key vault was created in."
                      },
                      "value": "[resourceGroup().name]"
                    },
                    "name": {
                      "type": "string",
                      "metadata": {
                        "description": "The name of the key vault."
                      },
                      "value": "[parameters('name')]"
                    },
                    "uri": {
                      "type": "string",
                      "metadata": {
                        "description": "The URI of the key vault."
                      },
                      "value": "[reference('keyVault').vaultUri]"
                    },
                    "location": {
                      "type": "string",
                      "metadata": {
                        "description": "The location the resource was deployed into."
                      },
                      "value": "[reference('keyVault', '2024-11-01', 'full').location]"
                    },
                    "privateEndpoints": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/privateEndpointOutputType"
                      },
                      "metadata": {
                        "description": "The private endpoints of the key vault."
                      },
                      "copy": {
                        "count": "[length(coalesce(parameters('privateEndpoints'), createArray()))]",
                        "input": {
                          "name": "[reference(format('keyVault_privateEndpoints[{0}]', copyIndex())).outputs.name.value]",
                          "resourceId": "[reference(format('keyVault_privateEndpoints[{0}]', copyIndex())).outputs.resourceId.value]",
                          "groupId": "[tryGet(tryGet(reference(format('keyVault_privateEndpoints[{0}]', copyIndex())).outputs, 'groupId'), 'value')]",
                          "customDnsConfigs": "[reference(format('keyVault_privateEndpoints[{0}]', copyIndex())).outputs.customDnsConfigs.value]",
                          "networkInterfaceResourceIds": "[reference(format('keyVault_privateEndpoints[{0}]', copyIndex())).outputs.networkInterfaceResourceIds.value]"
                        }
                      }
                    },
                    "secrets": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/credentialOutputType"
                      },
                      "metadata": {
                        "description": "The properties of the created secrets."
                      },
                      "copy": {
                        "count": "[length(range(0, length(coalesce(parameters('secrets'), createArray()))))]",
                        "input": {
                          "resourceId": "[reference(format('keyVault_secrets[{0}]', range(0, length(coalesce(parameters('secrets'), createArray())))[copyIndex()])).outputs.resourceId.value]",
                          "uri": "[reference(format('keyVault_secrets[{0}]', range(0, length(coalesce(parameters('secrets'), createArray())))[copyIndex()])).outputs.secretUri.value]",
                          "uriWithVersion": "[reference(format('keyVault_secrets[{0}]', range(0, length(coalesce(parameters('secrets'), createArray())))[copyIndex()])).outputs.secretUriWithVersion.value]"
                        }
                      }
                    },
                    "keys": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/credentialOutputType"
                      },
                      "metadata": {
                        "description": "The properties of the created keys."
                      },
                      "copy": {
                        "count": "[length(range(0, length(coalesce(parameters('keys'), createArray()))))]",
                        "input": {
                          "resourceId": "[reference(format('keyVault_keys[{0}]', range(0, length(coalesce(parameters('keys'), createArray())))[copyIndex()])).outputs.resourceId.value]",
                          "uri": "[reference(format('keyVault_keys[{0}]', range(0, length(coalesce(parameters('keys'), createArray())))[copyIndex()])).outputs.keyUri.value]",
                          "uriWithVersion": "[reference(format('keyVault_keys[{0}]', range(0, length(coalesce(parameters('keys'), createArray())))[copyIndex()])).outputs.keyUriWithVersion.value]"
                        }
                      }
                    }
                  }
                }
              },
              "dependsOn": [
                "existingManagedIdentity",
                "managedIdentity",
                "managedNetwork"
              ]
            },
            "dataFactory": {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-datafactory', uniqueString(deployment().name, parameters('location')))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "name": {
                    "value": "[variables('dataFactoryName')]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "tags": "[if(contains(parameters('tagsByResource'), 'Microsoft.DataFactory/factories'), createObject('value', union(variables('allTags'), parameters('tagsByResource')['Microsoft.DataFactory/factories'])), createObject('value', variables('allTags')))]",
                  "enableTelemetry": {
                    "value": "[parameters('enableTelemetry')]"
                  },
                  "publicNetworkAccess": "[if(variables('effectivePublicAccess'), createObject('value', 'Enabled'), createObject('value', 'Disabled'))]",
                  "managedIdentities": {
                    "value": {
                      "systemAssigned": true,
                      "userAssignedResourceIds": [
                        "[if(variables('useExistingIdentity'), parameters('existingManagedIdentityResourceId'), reference('managedIdentity').outputs.resourceId.value)]"
                      ]
                    }
                  },
                  "globalParameters": {
                    "value": {
                      "hubName": {
                        "type": "String",
                        "value": "[parameters('hubName')]"
                      },
                      "storageAccountName": {
                        "type": "String",
                        "value": "[variables('storageAccountName')]"
                      }
                    }
                  },
                  "privateEndpoints": "[if(variables('enablePrivateEndpoints'), createObject('value', createArray(createObject('name', format('{0}-pe', variables('dataFactoryName')), 'subnetResourceId', if(equals(variables('effectiveNetworkIsolationMode'), 'Managed'), reference('managedNetwork').outputs.subnetResourceId.value, if(equals(variables('effectiveNetworkIsolationMode'), 'BringYourOwn'), if(not(empty(parameters('byoSubnetResourceId'))), parameters('byoSubnetResourceId'), parameters('privateEndpointSubnetId')), '')), 'service', 'dataFactory', 'privateDnsZoneGroup', if(and(parameters('enablePrivateDnsZoneGroups'), not(empty(if(equals(variables('effectiveNetworkIsolationMode'), 'Managed'), reference('managedNetwork').outputs.dataFactoryDnsZoneId.value, if(not(empty(parameters('byoDataFactoryDnsZoneId'))), parameters('byoDataFactoryDnsZoneId'), parameters('dataFactoryPrivateDnsZoneId')))))), createObject('privateDnsZoneGroupConfigs', createArray(createObject('privateDnsZoneResourceId', if(equals(variables('effectiveNetworkIsolationMode'), 'Managed'), reference('managedNetwork').outputs.dataFactoryDnsZoneId.value, if(not(empty(parameters('byoDataFactoryDnsZoneId'))), parameters('byoDataFactoryDnsZoneId'), parameters('dataFactoryPrivateDnsZoneId')))))), null())))), createObject('value', createArray()))]",
                  "managedVirtualNetwork": "[if(variables('effectiveAdfManagedVnet'), createObject('value', createObject('name', 'default', 'managedPrivateEndpoints', createArray(createObject('name', format('{0}-blob-mpe', variables('storageAccountName')), 'groupId', 'blob', 'fqdns', createArray(format('{0}.blob.{1}', variables('storageAccountName'), environment().suffixes.storage)), 'privateLinkResourceId', reference('storageAccount').outputs.resourceId.value), createObject('name', format('{0}-vault-mpe', variables('keyVaultName')), 'groupId', 'vault', 'fqdns', createArray(format('{0}{1}', variables('keyVaultName'), environment().suffixes.keyvaultDns)), 'privateLinkResourceId', reference('keyVault').outputs.resourceId.value)))), createObject('value', null()))]",
                  "integrationRuntimes": "[if(variables('effectiveAdfManagedVnet'), createObject('value', createArray(createObject('name', 'FinOpsHubManagedIR', 'type', 'Managed', 'managedVirtualNetworkName', 'default', 'typeProperties', createObject('computeProperties', createObject('location', 'AutoResolve'))))), createObject('value', null()))]",
                  "lock": {
                    "value": "[parameters('lock')]"
                  },
                  "diagnosticSettings": {
                    "value": "[parameters('diagnosticSettings')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "languageVersion": "2.0",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.38.33.27573",
                      "templateHash": "4131022940050103757"
                    },
                    "name": "Data Factories",
                    "description": "This module deploys a Data Factory."
                  },
                  "definitions": {
                    "managedVirtualNetworkType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The name of the Managed Virtual Network."
                          }
                        },
                        "managedPrivateEndpoints": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/managedPrivateEndpointType"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. An array of managed private endpoints objects created in the Data Factory managed virtual network."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_export!": true,
                        "description": "The type for a managed virtual network."
                      }
                    },
                    "integrationRuntimesType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. Specify the name of integration runtime."
                          }
                        },
                        "type": {
                          "type": "string",
                          "allowedValues": [
                            "Managed",
                            "SelfHosted"
                          ],
                          "metadata": {
                            "description": "Required. Specify the type of the integration runtime."
                          }
                        },
                        "integrationRuntimeCustomDescription": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Specify custom description for the integration runtime."
                          }
                        },
                        "managedVirtualNetworkName": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Specify managed vritual network name for the integration runtime to link to."
                          }
                        },
                        "typeProperties": {
                          "type": "object",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Integration Runtime type properties. Required if type is \"Managed\"."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_export!": true
                      }
                    },
                    "linkedServicesType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The name of the Linked Service."
                          }
                        },
                        "type": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The type of Linked Service. See https://learn.microsoft.com/en-us/azure/templates/microsoft.datafactory/factories/linkedservices?pivots=deployment-language-bicep#linkedservice-objects for more information."
                          }
                        },
                        "typeProperties": {
                          "type": "object",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Used to add connection properties for your linked services."
                          }
                        },
                        "integrationRuntimeName": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name of the Integration Runtime to use."
                          }
                        },
                        "parameters": {
                          "type": "object",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Use this to add parameters for a linked service connection string."
                          }
                        },
                        "description": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The description of the Integration Runtime."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_export!": true
                      }
                    },
                    "privateEndpointOutputType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "metadata": {
                            "description": "The name of the private endpoint."
                          }
                        },
                        "resourceId": {
                          "type": "string",
                          "metadata": {
                            "description": "The resource ID of the private endpoint."
                          }
                        },
                        "groupId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "The group Id for the private endpoint Group."
                          }
                        },
                        "customDnsConfigs": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "fqdn": {
                                "type": "string",
                                "nullable": true,
                                "metadata": {
                                  "description": "FQDN that resolves to private endpoint IP address."
                                }
                              },
                              "ipAddresses": {
                                "type": "array",
                                "items": {
                                  "type": "string"
                                },
                                "metadata": {
                                  "description": "A list of private IP addresses of the private endpoint."
                                }
                              }
                            }
                          },
                          "metadata": {
                            "description": "The custom DNS configurations of the private endpoint."
                          }
                        },
                        "networkInterfaceResourceIds": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "metadata": {
                            "description": "The IDs of the network interfaces associated with the private endpoint."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_export!": true
                      }
                    },
                    "_1.privateEndpointCustomDnsConfigType": {
                      "type": "object",
                      "properties": {
                        "fqdn": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. FQDN that resolves to private endpoint IP address."
                          }
                        },
                        "ipAddresses": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "metadata": {
                            "description": "Required. A list of private IP addresses of the private endpoint."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "_1.privateEndpointIpConfigurationType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The name of the resource that is unique within a resource group."
                          }
                        },
                        "properties": {
                          "type": "object",
                          "properties": {
                            "groupId": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. The ID of a group obtained from the remote resource that this private endpoint should connect to."
                              }
                            },
                            "memberName": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. The member name of a group obtained from the remote resource that this private endpoint should connect to."
                              }
                            },
                            "privateIPAddress": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. A private IP address obtained from the private endpoint's subnet."
                              }
                            }
                          },
                          "metadata": {
                            "description": "Required. Properties of private endpoint IP configurations."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "_1.privateEndpointPrivateDnsZoneGroupType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name of the Private DNS Zone Group."
                          }
                        },
                        "privateDnsZoneGroupConfigs": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "name": {
                                "type": "string",
                                "nullable": true,
                                "metadata": {
                                  "description": "Optional. The name of the private DNS Zone Group config."
                                }
                              },
                              "privateDnsZoneResourceId": {
                                "type": "string",
                                "metadata": {
                                  "description": "Required. The resource id of the private DNS zone."
                                }
                              }
                            }
                          },
                          "metadata": {
                            "description": "Required. The private DNS Zone Groups to associate the Private Endpoint. A DNS Zone Group can support up to 5 DNS zones."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "customerManagedKeyWithAutoRotateType": {
                      "type": "object",
                      "properties": {
                        "keyVaultResourceId": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The resource ID of a key vault to reference a customer managed key for encryption from."
                          }
                        },
                        "keyName": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The name of the customer managed key to use for encryption."
                          }
                        },
                        "keyVersion": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The version of the customer managed key to reference for encryption. If not provided, using version as per 'autoRotationEnabled' setting."
                          }
                        },
                        "autoRotationEnabled": {
                          "type": "bool",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Enable or disable auto-rotating to the latest key version. Default is `true`. If set to `false`, the latest key version at the time of the deployment is used."
                          }
                        },
                        "userAssignedIdentityResourceId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. User assigned identity to use when fetching the customer managed key. Required if no system assigned identity is available for use."
                          }
                        }
                      },
                      "metadata": {
                        "description": "An AVM-aligned type for a customer-managed key. To be used if the resource type supports auto-rotation of the customer-managed key.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "diagnosticSettingFullType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name of the diagnostic setting."
                          }
                        },
                        "logCategoriesAndGroups": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "category": {
                                "type": "string",
                                "nullable": true,
                                "metadata": {
                                  "description": "Optional. Name of a Diagnostic Log category for a resource type this setting is applied to. Set the specific logs to collect here."
                                }
                              },
                              "categoryGroup": {
                                "type": "string",
                                "nullable": true,
                                "metadata": {
                                  "description": "Optional. Name of a Diagnostic Log category group for a resource type this setting is applied to. Set to `allLogs` to collect all logs."
                                }
                              },
                              "enabled": {
                                "type": "bool",
                                "nullable": true,
                                "metadata": {
                                  "description": "Optional. Enable or disable the category explicitly. Default is `true`."
                                }
                              }
                            }
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name of logs that will be streamed. \"allLogs\" includes all possible logs for the resource. Set to `[]` to disable log collection."
                          }
                        },
                        "metricCategories": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "category": {
                                "type": "string",
                                "metadata": {
                                  "description": "Required. Name of a Diagnostic Metric category for a resource type this setting is applied to. Set to `AllMetrics` to collect all metrics."
                                }
                              },
                              "enabled": {
                                "type": "bool",
                                "nullable": true,
                                "metadata": {
                                  "description": "Optional. Enable or disable the category explicitly. Default is `true`."
                                }
                              }
                            }
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name of metrics that will be streamed. \"allMetrics\" includes all possible metrics for the resource. Set to `[]` to disable metric collection."
                          }
                        },
                        "logAnalyticsDestinationType": {
                          "type": "string",
                          "allowedValues": [
                            "AzureDiagnostics",
                            "Dedicated"
                          ],
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. A string indicating whether the export to Log Analytics should use the default destination type, i.e. AzureDiagnostics, or use a destination type."
                          }
                        },
                        "workspaceResourceId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Resource ID of the diagnostic log analytics workspace. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                          }
                        },
                        "storageAccountResourceId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Resource ID of the diagnostic storage account. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                          }
                        },
                        "eventHubAuthorizationRuleResourceId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Resource ID of the diagnostic event hub authorization rule for the Event Hubs namespace in which the event hub should be created or streamed to."
                          }
                        },
                        "eventHubName": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Name of the diagnostic event hub within the namespace to which logs are streamed. Without this, an event hub is created for each log category. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                          }
                        },
                        "marketplacePartnerResourceId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The full ARM resource ID of the Marketplace resource to which you would like to send Diagnostic Logs."
                          }
                        }
                      },
                      "metadata": {
                        "description": "An AVM-aligned type for a diagnostic setting. To be used if both logs & metrics are supported by the resource provider.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "lockType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Specify the name of lock."
                          }
                        },
                        "kind": {
                          "type": "string",
                          "allowedValues": [
                            "CanNotDelete",
                            "None",
                            "ReadOnly"
                          ],
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Specify the type of lock."
                          }
                        },
                        "notes": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Specify the notes of the lock."
                          }
                        }
                      },
                      "metadata": {
                        "description": "An AVM-aligned type for a lock.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "managedIdentityAllType": {
                      "type": "object",
                      "properties": {
                        "systemAssigned": {
                          "type": "bool",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Enables system assigned managed identity on the resource."
                          }
                        },
                        "userAssignedResourceIds": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The resource ID(s) to assign to the resource. Required if a user assigned identity is used for encryption."
                          }
                        }
                      },
                      "metadata": {
                        "description": "An AVM-aligned type for a managed identity configuration. To be used if both a system-assigned & user-assigned identities are supported by the resource provider.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "managedPrivateEndpointType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The managed private endpoint resource name."
                          }
                        },
                        "groupId": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The groupId to which the managed private endpoint is created."
                          }
                        },
                        "fqdns": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "metadata": {
                            "description": "Required. Fully qualified domain names."
                          }
                        },
                        "privateLinkResourceId": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The ARM resource ID of the resource to which the managed private endpoint is created."
                          }
                        }
                      },
                      "metadata": {
                        "description": "Type definition for a Managed Private Endpoint.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "managed-virtual-network/main.bicep"
                        }
                      }
                    },
                    "privateEndpointMultiServiceType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name of the private endpoint."
                          }
                        },
                        "location": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The location to deploy the private endpoint to."
                          }
                        },
                        "privateLinkServiceConnectionName": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name of the private link connection to create."
                          }
                        },
                        "service": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The subresource to deploy the private endpoint for. For example \"blob\", \"table\", \"queue\" or \"file\" for a Storage Account's Private Endpoints."
                          }
                        },
                        "subnetResourceId": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. Resource ID of the subnet where the endpoint needs to be created."
                          }
                        },
                        "resourceGroupResourceId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The resource ID of the Resource Group the Private Endpoint will be created in. If not specified, the Resource Group of the provided Virtual Network Subnet is used."
                          }
                        },
                        "privateDnsZoneGroup": {
                          "$ref": "#/definitions/_1.privateEndpointPrivateDnsZoneGroupType",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The private DNS zone group to configure for the private endpoint."
                          }
                        },
                        "isManualConnection": {
                          "type": "bool",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. If Manual Private Link Connection is required."
                          }
                        },
                        "manualConnectionRequestMessage": {
                          "type": "string",
                          "nullable": true,
                          "maxLength": 140,
                          "metadata": {
                            "description": "Optional. A message passed to the owner of the remote resource with the manual connection request."
                          }
                        },
                        "customDnsConfigs": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/_1.privateEndpointCustomDnsConfigType"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Custom DNS configurations."
                          }
                        },
                        "ipConfigurations": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/_1.privateEndpointIpConfigurationType"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. A list of IP configurations of the private endpoint. This will be used to map to the First Party Service endpoints."
                          }
                        },
                        "applicationSecurityGroupResourceIds": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Application security groups in which the private endpoint IP configuration is included."
                          }
                        },
                        "customNetworkInterfaceName": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The custom name of the network interface attached to the private endpoint."
                          }
                        },
                        "lock": {
                          "$ref": "#/definitions/lockType",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Specify the type of lock."
                          }
                        },
                        "roleAssignments": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/roleAssignmentType"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Array of role assignments to create."
                          }
                        },
                        "tags": {
                          "type": "object",
                          "nullable": true,
                          "metadata": {
                            "__bicep_resource_derived_type!": {
                              "source": "Microsoft.Network/privateEndpoints@2024-07-01#properties/tags"
                            },
                            "description": "Optional. Tags to be applied on all resources/resource groups in this deployment."
                          }
                        },
                        "enableTelemetry": {
                          "type": "bool",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Enable/Disable usage telemetry for module."
                          }
                        }
                      },
                      "metadata": {
                        "description": "An AVM-aligned type for a private endpoint. To be used if the private endpoint's default service / groupId can NOT be assumed (i.e., for services that have more than one subresource, like Storage Account with Blob (blob, table, queue, file, ...).",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "roleAssignmentType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                          }
                        },
                        "roleDefinitionIdOrName": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                          }
                        },
                        "principalId": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                          }
                        },
                        "principalType": {
                          "type": "string",
                          "allowedValues": [
                            "Device",
                            "ForeignGroup",
                            "Group",
                            "ServicePrincipal",
                            "User"
                          ],
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The principal type of the assigned principal ID."
                          }
                        },
                        "description": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The description of the role assignment."
                          }
                        },
                        "condition": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                          }
                        },
                        "conditionVersion": {
                          "type": "string",
                          "allowedValues": [
                            "2.0"
                          ],
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Version of the condition."
                          }
                        },
                        "delegatedManagedIdentityResourceId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                          }
                        }
                      },
                      "metadata": {
                        "description": "An AVM-aligned type for a role assignment.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    }
                  },
                  "parameters": {
                    "name": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. The name of the Azure Factory to create."
                      }
                    },
                    "managedVirtualNetwork": {
                      "$ref": "#/definitions/managedVirtualNetworkType",
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. The Managed Virtual Network configuration."
                      }
                    },
                    "integrationRuntimes": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/integrationRuntimesType"
                      },
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. An array of objects for the configuration of an Integration Runtime."
                      }
                    },
                    "linkedServices": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/linkedServicesType"
                      },
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. An array of objects for the configuration of Linked Services."
                      }
                    },
                    "location": {
                      "type": "string",
                      "defaultValue": "[resourceGroup().location]",
                      "metadata": {
                        "description": "Optional. Location for all Resources."
                      }
                    },
                    "publicNetworkAccess": {
                      "type": "string",
                      "defaultValue": "",
                      "allowedValues": [
                        "",
                        "Enabled",
                        "Disabled"
                      ],
                      "metadata": {
                        "description": "Optional. Whether or not public network access is allowed for this resource. For security reasons it should be disabled. If not specified, it will be disabled by default if private endpoints are set."
                      }
                    },
                    "gitConfigureLater": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Optional. Boolean to define whether or not to configure git during template deployment."
                      }
                    },
                    "gitRepoType": {
                      "type": "string",
                      "defaultValue": "FactoryVSTSConfiguration",
                      "metadata": {
                        "description": "Optional. Repository type - can be 'FactoryVSTSConfiguration' or 'FactoryGitHubConfiguration'. Default is 'FactoryVSTSConfiguration'."
                      }
                    },
                    "gitAccountName": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Optional. The account name."
                      }
                    },
                    "gitProjectName": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Optional. The project name. Only relevant for 'FactoryVSTSConfiguration'."
                      }
                    },
                    "gitRepositoryName": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Optional. The repository name."
                      }
                    },
                    "gitCollaborationBranch": {
                      "type": "string",
                      "defaultValue": "main",
                      "metadata": {
                        "description": "Optional. The collaboration branch name. Default is 'main'."
                      }
                    },
                    "gitDisablePublish": {
                      "type": "bool",
                      "defaultValue": false,
                      "metadata": {
                        "description": "Optional. Disable manual publish operation in ADF studio to favor automated publish."
                      }
                    },
                    "gitRootFolder": {
                      "type": "string",
                      "defaultValue": "/",
                      "metadata": {
                        "description": "Optional. The root folder path name. Default is '/'."
                      }
                    },
                    "gitHostName": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Optional. The GitHub Enterprise Server host (prefixed with 'https://'). Only relevant for 'FactoryGitHubConfiguration'."
                      }
                    },
                    "gitLastCommitId": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Optional. Add the last commit id from your git repo."
                      }
                    },
                    "gitTenantId": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Optional. Add the tenantId of your Azure subscription."
                      }
                    },
                    "globalParameters": {
                      "type": "object",
                      "metadata": {
                        "__bicep_resource_derived_type!": {
                          "source": "Microsoft.DataFactory/factories@2018-06-01#properties/properties/properties/globalParameters"
                        },
                        "description": "Optional. List of Global Parameters for the factory."
                      },
                      "nullable": true
                    },
                    "purviewResourceId": {
                      "type": "string",
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. Purview Account resource identifier."
                      }
                    },
                    "diagnosticSettings": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/diagnosticSettingFullType"
                      },
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. The diagnostic settings of the service."
                      }
                    },
                    "lock": {
                      "$ref": "#/definitions/lockType",
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. The lock settings for all Resources in the solution."
                      }
                    },
                    "managedIdentities": {
                      "$ref": "#/definitions/managedIdentityAllType",
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. The managed identity definition for this resource."
                      }
                    },
                    "customerManagedKey": {
                      "$ref": "#/definitions/customerManagedKeyWithAutoRotateType",
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. The customer managed key definition."
                      }
                    },
                    "privateEndpoints": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/privateEndpointMultiServiceType"
                      },
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. Configuration details for private endpoints. For security reasons, it is recommended to use private endpoints whenever possible."
                      }
                    },
                    "roleAssignments": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/roleAssignmentType"
                      },
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. Array of role assignments to create."
                      }
                    },
                    "tags": {
                      "type": "object",
                      "metadata": {
                        "__bicep_resource_derived_type!": {
                          "source": "Microsoft.DataFactory/factories@2018-06-01#properties/tags"
                        },
                        "description": "Optional. Tags of the resource."
                      },
                      "nullable": true
                    },
                    "enableTelemetry": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Optional. Enable/Disable usage telemetry for module."
                      }
                    }
                  },
                  "variables": {
                    "copy": [
                      {
                        "name": "formattedRoleAssignments",
                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                      }
                    ],
                    "enableReferencedModulesTelemetry": false,
                    "formattedUserAssignedIdentities": "[reduce(map(coalesce(tryGet(parameters('managedIdentities'), 'userAssignedResourceIds'), createArray()), lambda('id', createObject(format('{0}', lambdaVariables('id')), createObject()))), createObject(), lambda('cur', 'next', union(lambdaVariables('cur'), lambdaVariables('next'))))]",
                    "identity": "[if(not(empty(parameters('managedIdentities'))), createObject('type', if(coalesce(tryGet(parameters('managedIdentities'), 'systemAssigned'), false()), if(not(empty(variables('formattedUserAssignedIdentities'))), 'SystemAssigned,UserAssigned', 'SystemAssigned'), if(not(empty(variables('formattedUserAssignedIdentities'))), 'UserAssigned', 'None')), 'userAssignedIdentities', if(not(empty(variables('formattedUserAssignedIdentities'))), variables('formattedUserAssignedIdentities'), null())), null())]",
                    "builtInRoleNames": {
                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                      "Data Factory Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '673868aa-7521-48a0-acc6-0f60742d39f5')]",
                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                      "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]",
                      "User Access Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '18d7d88d-d35e-4fb5-a5c3-7773c20a72d9')]"
                    },
                    "isHSMManagedCMK": "[equals(tryGet(split(coalesce(tryGet(parameters('customerManagedKey'), 'keyVaultResourceId'), ''), '/'), 7), 'managedHSMs')]"
                  },
                  "resources": {
                    "cMKKeyVault::cMKKey": {
                      "condition": "[and(and(not(empty(parameters('customerManagedKey'))), not(variables('isHSMManagedCMK'))), and(not(empty(parameters('customerManagedKey'))), not(variables('isHSMManagedCMK'))))]",
                      "existing": true,
                      "type": "Microsoft.KeyVault/vaults/keys",
                      "apiVersion": "2025-05-01",
                      "subscriptionId": "[split(tryGet(parameters('customerManagedKey'), 'keyVaultResourceId'), '/')[2]]",
                      "resourceGroup": "[split(tryGet(parameters('customerManagedKey'), 'keyVaultResourceId'), '/')[4]]",
                      "name": "[format('{0}/{1}', last(split(tryGet(parameters('customerManagedKey'), 'keyVaultResourceId'), '/')), tryGet(parameters('customerManagedKey'), 'keyName'))]"
                    },
                    "cMKKeyVault": {
                      "condition": "[and(not(empty(parameters('customerManagedKey'))), not(variables('isHSMManagedCMK')))]",
                      "existing": true,
                      "type": "Microsoft.KeyVault/vaults",
                      "apiVersion": "2024-11-01",
                      "subscriptionId": "[split(tryGet(parameters('customerManagedKey'), 'keyVaultResourceId'), '/')[2]]",
                      "resourceGroup": "[split(tryGet(parameters('customerManagedKey'), 'keyVaultResourceId'), '/')[4]]",
                      "name": "[last(split(tryGet(parameters('customerManagedKey'), 'keyVaultResourceId'), '/'))]"
                    },
                    "cMKUserAssignedIdentity": {
                      "condition": "[not(empty(tryGet(parameters('customerManagedKey'), 'userAssignedIdentityResourceId')))]",
                      "existing": true,
                      "type": "Microsoft.ManagedIdentity/userAssignedIdentities",
                      "apiVersion": "2024-11-30",
                      "subscriptionId": "[split(tryGet(parameters('customerManagedKey'), 'userAssignedIdentityResourceId'), '/')[2]]",
                      "resourceGroup": "[split(tryGet(parameters('customerManagedKey'), 'userAssignedIdentityResourceId'), '/')[4]]",
                      "name": "[last(split(tryGet(parameters('customerManagedKey'), 'userAssignedIdentityResourceId'), '/'))]"
                    },
                    "avmTelemetry": {
                      "condition": "[parameters('enableTelemetry')]",
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2024-11-01",
                      "name": "[format('46d3xbcp.res.datafactory-factory.{0}.{1}', replace('0.11.0', '.', '-'), substring(uniqueString(deployment().name, parameters('location')), 0, 4))]",
                      "properties": {
                        "mode": "Incremental",
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "resources": [],
                          "outputs": {
                            "telemetry": {
                              "type": "String",
                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                            }
                          }
                        }
                      }
                    },
                    "dataFactory": {
                      "type": "Microsoft.DataFactory/factories",
                      "apiVersion": "2018-06-01",
                      "name": "[parameters('name')]",
                      "location": "[parameters('location')]",
                      "tags": "[parameters('tags')]",
                      "identity": "[variables('identity')]",
                      "properties": {
                        "repoConfiguration": "[if(bool(parameters('gitConfigureLater')), null(), union(createObject('type', parameters('gitRepoType'), 'hostName', parameters('gitHostName'), 'accountName', parameters('gitAccountName'), 'repositoryName', parameters('gitRepositoryName'), 'collaborationBranch', parameters('gitCollaborationBranch'), 'rootFolder', parameters('gitRootFolder'), 'disablePublish', parameters('gitDisablePublish'), 'lastCommitId', parameters('gitLastCommitId'), 'tenantId', parameters('gitTenantId')), if(equals(parameters('gitRepoType'), 'FactoryVSTSConfiguration'), createObject('projectName', parameters('gitProjectName')), createObject()), createObject()))]",
                        "globalParameters": "[parameters('globalParameters')]",
                        "publicNetworkAccess": "[if(not(empty(parameters('publicNetworkAccess'))), parameters('publicNetworkAccess'), if(not(empty(parameters('privateEndpoints'))), 'Disabled', null()))]",
                        "encryption": "[if(not(empty(parameters('customerManagedKey'))), createObject('identity', if(not(empty(tryGet(parameters('customerManagedKey'), 'userAssignedIdentityResourceId'))), createObject('userAssignedIdentity', extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', split(tryGet(parameters('customerManagedKey'), 'userAssignedIdentityResourceId'), '/')[2], split(tryGet(parameters('customerManagedKey'), 'userAssignedIdentityResourceId'), '/')[4]), 'Microsoft.ManagedIdentity/userAssignedIdentities', last(split(tryGet(parameters('customerManagedKey'), 'userAssignedIdentityResourceId'), '/')))), null()), 'keyName', parameters('customerManagedKey').keyName, 'keyVersion', if(not(empty(tryGet(parameters('customerManagedKey'), 'keyVersion'))), parameters('customerManagedKey').keyVersion, if(coalesce(tryGet(parameters('customerManagedKey'), 'autoRotationEnabled'), true()), null(), if(not(variables('isHSMManagedCMK')), last(split(reference('cMKKeyVault::cMKKey').keyUriWithVersion, '/')), fail('Managed HSM CMK encryption requires either specifying the ''keyVersion'' or omitting the ''autoRotationEnabled'' property. Setting ''autoRotationEnabled'' to false without a ''keyVersion'' is not allowed.')))), 'vaultBaseUrl', if(not(variables('isHSMManagedCMK')), reference('cMKKeyVault').vaultUri, format('https://{0}.managedhsm.azure.net/', last(split(tryGet(parameters('customerManagedKey'), 'keyVaultResourceId'), '/'))))), null())]",
                        "purviewConfiguration": "[if(not(empty(parameters('purviewResourceId'))), createObject('purviewResourceId', parameters('purviewResourceId')), null())]"
                      },
                      "dependsOn": [
                        "cMKKeyVault",
                        "cMKKeyVault::cMKKey"
                      ]
                    },
                    "dataFactory_lock": {
                      "condition": "[and(not(empty(coalesce(parameters('lock'), createObject()))), not(equals(tryGet(parameters('lock'), 'kind'), 'None')))]",
                      "type": "Microsoft.Authorization/locks",
                      "apiVersion": "2020-05-01",
                      "scope": "[format('Microsoft.DataFactory/factories/{0}', parameters('name'))]",
                      "name": "[coalesce(tryGet(parameters('lock'), 'name'), format('lock-{0}', parameters('name')))]",
                      "properties": {
                        "level": "[coalesce(tryGet(parameters('lock'), 'kind'), '')]",
                        "notes": "[coalesce(tryGet(parameters('lock'), 'notes'), if(equals(tryGet(parameters('lock'), 'kind'), 'CanNotDelete'), 'Cannot delete resource or child resources.', 'Cannot delete or modify the resource or child resources.'))]"
                      },
                      "dependsOn": [
                        "dataFactory"
                      ]
                    },
                    "dataFactory_diagnosticSettings": {
                      "copy": {
                        "name": "dataFactory_diagnosticSettings",
                        "count": "[length(coalesce(parameters('diagnosticSettings'), createArray()))]"
                      },
                      "type": "Microsoft.Insights/diagnosticSettings",
                      "apiVersion": "2021-05-01-preview",
                      "scope": "[format('Microsoft.DataFactory/factories/{0}', parameters('name'))]",
                      "name": "[coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'name'), format('{0}-diagnosticSettings', parameters('name')))]",
                      "properties": {
                        "copy": [
                          {
                            "name": "metrics",
                            "count": "[length(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'metricCategories'), createArray(createObject('category', 'AllMetrics'))))]",
                            "input": {
                              "category": "[coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'metricCategories'), createArray(createObject('category', 'AllMetrics')))[copyIndex('metrics')].category]",
                              "enabled": "[coalesce(tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'metricCategories'), createArray(createObject('category', 'AllMetrics')))[copyIndex('metrics')], 'enabled'), true())]",
                              "timeGrain": null
                            }
                          },
                          {
                            "name": "logs",
                            "count": "[length(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs'))))]",
                            "input": {
                              "categoryGroup": "[tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs')))[copyIndex('logs')], 'categoryGroup')]",
                              "category": "[tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs')))[copyIndex('logs')], 'category')]",
                              "enabled": "[coalesce(tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs')))[copyIndex('logs')], 'enabled'), true())]"
                            }
                          }
                        ],
                        "storageAccountId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'storageAccountResourceId')]",
                        "workspaceId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'workspaceResourceId')]",
                        "eventHubAuthorizationRuleId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'eventHubAuthorizationRuleResourceId')]",
                        "eventHubName": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'eventHubName')]",
                        "marketplacePartnerId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'marketplacePartnerResourceId')]",
                        "logAnalyticsDestinationType": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logAnalyticsDestinationType')]"
                      },
                      "dependsOn": [
                        "dataFactory"
                      ]
                    },
                    "dataFactory_roleAssignments": {
                      "copy": {
                        "name": "dataFactory_roleAssignments",
                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                      },
                      "type": "Microsoft.Authorization/roleAssignments",
                      "apiVersion": "2022-04-01",
                      "scope": "[format('Microsoft.DataFactory/factories/{0}', parameters('name'))]",
                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.DataFactory/factories', parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                      "properties": {
                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                      },
                      "dependsOn": [
                        "dataFactory"
                      ]
                    },
                    "dataFactory_managedVirtualNetwork": {
                      "condition": "[not(empty(parameters('managedVirtualNetwork')))]",
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "[format('{0}-DataFactory-ManagedVNet', uniqueString(deployment().name, parameters('location')))]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "dataFactoryName": {
                            "value": "[parameters('name')]"
                          },
                          "name": {
                            "value": "[parameters('managedVirtualNetwork').name]"
                          },
                          "managedPrivateEndpoints": {
                            "value": "[tryGet(parameters('managedVirtualNetwork'), 'managedPrivateEndpoints')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.38.33.27573",
                              "templateHash": "10862604787894198331"
                            },
                            "name": "Data Factory Managed Virtual Networks",
                            "description": "This module deploys a Data Factory Managed Virtual Network."
                          },
                          "definitions": {
                            "managedPrivateEndpointType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The managed private endpoint resource name."
                                  }
                                },
                                "groupId": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The groupId to which the managed private endpoint is created."
                                  }
                                },
                                "fqdns": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  },
                                  "metadata": {
                                    "description": "Required. Fully qualified domain names."
                                  }
                                },
                                "privateLinkResourceId": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The ARM resource ID of the resource to which the managed private endpoint is created."
                                  }
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "Type definition for a Managed Private Endpoint."
                              }
                            }
                          },
                          "parameters": {
                            "dataFactoryName": {
                              "type": "string",
                              "metadata": {
                                "description": "Conditional. The name of the parent Azure Data Factory. Required if the template is used in a standalone deployment."
                              }
                            },
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. The name of the Managed Virtual Network."
                              }
                            },
                            "managedPrivateEndpoints": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/managedPrivateEndpointType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. An array of managed private endpoints objects created in the Data Factory managed virtual network."
                              }
                            }
                          },
                          "resources": {
                            "dataFactory": {
                              "existing": true,
                              "type": "Microsoft.DataFactory/factories",
                              "apiVersion": "2018-06-01",
                              "name": "[parameters('dataFactoryName')]"
                            },
                            "managedVirtualNetwork": {
                              "type": "Microsoft.DataFactory/factories/managedVirtualNetworks",
                              "apiVersion": "2018-06-01",
                              "name": "[format('{0}/{1}', parameters('dataFactoryName'), parameters('name'))]",
                              "properties": {}
                            },
                            "managedVirtualNetwork_managedPrivateEndpoint": {
                              "copy": {
                                "name": "managedVirtualNetwork_managedPrivateEndpoint",
                                "count": "[length(coalesce(parameters('managedPrivateEndpoints'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2025-04-01",
                              "name": "[format('{0}-managedPrivateEndpoint-{1}', deployment().name, copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "dataFactoryName": {
                                    "value": "[parameters('dataFactoryName')]"
                                  },
                                  "managedVirtualNetworkName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "name": {
                                    "value": "[coalesce(parameters('managedPrivateEndpoints'), createArray())[copyIndex()].name]"
                                  },
                                  "fqdns": {
                                    "value": "[coalesce(parameters('managedPrivateEndpoints'), createArray())[copyIndex()].fqdns]"
                                  },
                                  "groupId": {
                                    "value": "[coalesce(parameters('managedPrivateEndpoints'), createArray())[copyIndex()].groupId]"
                                  },
                                  "privateLinkResourceId": {
                                    "value": "[coalesce(parameters('managedPrivateEndpoints'), createArray())[copyIndex()].privateLinkResourceId]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.38.33.27573",
                                      "templateHash": "2828746739230020064"
                                    },
                                    "name": "Data Factory Managed Virtual Network Managed PrivateEndpoints",
                                    "description": "This module deploys a Data Factory Managed Virtual Network Managed Private Endpoint."
                                  },
                                  "parameters": {
                                    "dataFactoryName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent data factory. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "managedVirtualNetworkName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The name of the parent managed virtual network."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The managed private endpoint resource name."
                                      }
                                    },
                                    "groupId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The groupId to which the managed private endpoint is created."
                                      }
                                    },
                                    "fqdns": {
                                      "type": "array",
                                      "items": {
                                        "type": "string"
                                      },
                                      "metadata": {
                                        "description": "Required. Fully qualified domain names."
                                      }
                                    },
                                    "privateLinkResourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The ARM resource ID of the resource to which the managed private endpoint is created."
                                      }
                                    }
                                  },
                                  "resources": {
                                    "datafactory::managedVirtualNetwork": {
                                      "existing": true,
                                      "type": "Microsoft.DataFactory/factories/managedVirtualNetworks",
                                      "apiVersion": "2018-06-01",
                                      "name": "[format('{0}/{1}', parameters('dataFactoryName'), parameters('managedVirtualNetworkName'))]"
                                    },
                                    "datafactory": {
                                      "existing": true,
                                      "type": "Microsoft.DataFactory/factories",
                                      "apiVersion": "2018-06-01",
                                      "name": "[parameters('dataFactoryName')]"
                                    },
                                    "managedPrivateEndpoint": {
                                      "type": "Microsoft.DataFactory/factories/managedVirtualNetworks/managedPrivateEndpoints",
                                      "apiVersion": "2018-06-01",
                                      "name": "[format('{0}/{1}/{2}', parameters('dataFactoryName'), parameters('managedVirtualNetworkName'), parameters('name'))]",
                                      "properties": {
                                        "fqdns": "[parameters('fqdns')]",
                                        "groupId": "[parameters('groupId')]",
                                        "privateLinkResourceId": "[parameters('privateLinkResourceId')]"
                                      }
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed managed private endpoint."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the deployed managed private endpoint."
                                      },
                                      "value": "[resourceId('Microsoft.DataFactory/factories/managedVirtualNetworks/managedPrivateEndpoints', parameters('dataFactoryName'), parameters('managedVirtualNetworkName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group of the deployed managed private endpoint."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "managedVirtualNetwork"
                              ]
                            }
                          },
                          "outputs": {
                            "resourceGroupName": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the Resource Group the Managed Virtual Network was created in."
                              },
                              "value": "[resourceGroup().name]"
                            },
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the Managed Virtual Network."
                              },
                              "value": "[parameters('name')]"
                            },
                            "resourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource ID of the Managed Virtual Network."
                              },
                              "value": "[resourceId('Microsoft.DataFactory/factories/managedVirtualNetworks', parameters('dataFactoryName'), parameters('name'))]"
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "dataFactory"
                      ]
                    },
                    "dataFactory_integrationRuntimes": {
                      "copy": {
                        "name": "dataFactory_integrationRuntimes",
                        "count": "[length(coalesce(parameters('integrationRuntimes'), createArray()))]"
                      },
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "[format('{0}-DataFactory-IntegrationRuntime-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "dataFactoryName": {
                            "value": "[parameters('name')]"
                          },
                          "name": {
                            "value": "[coalesce(parameters('integrationRuntimes'), createArray())[copyIndex()].name]"
                          },
                          "type": {
                            "value": "[coalesce(parameters('integrationRuntimes'), createArray())[copyIndex()].type]"
                          },
                          "integrationRuntimeCustomDescription": {
                            "value": "[tryGet(coalesce(parameters('integrationRuntimes'), createArray())[copyIndex()], 'integrationRuntimeCustomDescription')]"
                          },
                          "managedVirtualNetworkName": {
                            "value": "[tryGet(coalesce(parameters('integrationRuntimes'), createArray())[copyIndex()], 'managedVirtualNetworkName')]"
                          },
                          "typeProperties": {
                            "value": "[tryGet(coalesce(parameters('integrationRuntimes'), createArray())[copyIndex()], 'typeProperties')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.38.33.27573",
                              "templateHash": "127419371745742377"
                            },
                            "name": "Data Factory Integration RunTimes",
                            "description": "This module deploys a Data Factory Managed or Self-Hosted Integration Runtime."
                          },
                          "parameters": {
                            "dataFactoryName": {
                              "type": "string",
                              "metadata": {
                                "description": "Conditional. The name of the parent Azure Data Factory. Required if the template is used in a standalone deployment."
                              }
                            },
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. The name of the Integration Runtime."
                              }
                            },
                            "type": {
                              "type": "string",
                              "allowedValues": [
                                "Managed",
                                "SelfHosted"
                              ],
                              "metadata": {
                                "description": "Required. The type of Integration Runtime."
                              }
                            },
                            "managedVirtualNetworkName": {
                              "type": "string",
                              "defaultValue": "",
                              "metadata": {
                                "description": "Optional. The name of the Managed Virtual Network if using type \"Managed\" ."
                              }
                            },
                            "typeProperties": {
                              "type": "object",
                              "defaultValue": {},
                              "metadata": {
                                "description": "Optional. Integration Runtime type properties. Required if type is \"Managed\"."
                              }
                            },
                            "integrationRuntimeCustomDescription": {
                              "type": "string",
                              "defaultValue": "Managed Integration Runtime created by avm-res-datafactory-factories",
                              "metadata": {
                                "description": "Optional. The description of the Integration Runtime."
                              }
                            }
                          },
                          "resources": [
                            {
                              "type": "Microsoft.DataFactory/factories/integrationRuntimes",
                              "apiVersion": "2018-06-01",
                              "name": "[format('{0}/{1}', parameters('dataFactoryName'), parameters('name'))]",
                              "properties": "[shallowMerge(createArray(createObject('type', parameters('type')), if(equals(parameters('type'), 'Managed'), createObject('description', parameters('integrationRuntimeCustomDescription'), 'managedVirtualNetwork', createObject('referenceName', parameters('managedVirtualNetworkName'), 'type', 'ManagedVirtualNetworkReference'), 'typeProperties', parameters('typeProperties')), createObject())))]"
                            }
                          ],
                          "outputs": {
                            "resourceGroupName": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the Resource Group the Integration Runtime was created in."
                              },
                              "value": "[resourceGroup().name]"
                            },
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the Integration Runtime."
                              },
                              "value": "[parameters('name')]"
                            },
                            "resourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource ID of the Integration Runtime."
                              },
                              "value": "[resourceId('Microsoft.DataFactory/factories/integrationRuntimes', parameters('dataFactoryName'), parameters('name'))]"
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "dataFactory",
                        "dataFactory_managedVirtualNetwork"
                      ]
                    },
                    "dataFactory_linkedServices": {
                      "copy": {
                        "name": "dataFactory_linkedServices",
                        "count": "[length(coalesce(parameters('linkedServices'), createArray()))]"
                      },
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "[format('{0}-DataFactory-LinkedServices-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "dataFactoryName": {
                            "value": "[parameters('name')]"
                          },
                          "name": {
                            "value": "[coalesce(parameters('linkedServices'), createArray())[copyIndex()].name]"
                          },
                          "type": {
                            "value": "[coalesce(parameters('linkedServices'), createArray())[copyIndex()].type]"
                          },
                          "typeProperties": {
                            "value": "[tryGet(coalesce(parameters('linkedServices'), createArray())[copyIndex()], 'typeProperties')]"
                          },
                          "integrationRuntimeName": {
                            "value": "[tryGet(coalesce(parameters('linkedServices'), createArray())[copyIndex()], 'integrationRuntimeName')]"
                          },
                          "parameters": {
                            "value": "[tryGet(coalesce(parameters('linkedServices'), createArray())[copyIndex()], 'parameters')]"
                          },
                          "description": {
                            "value": "[tryGet(coalesce(parameters('linkedServices'), createArray())[copyIndex()], 'description')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.38.33.27573",
                              "templateHash": "9499030178049388265"
                            },
                            "name": "Data Factory Linked Service",
                            "description": "This module deploys a Data Factory Linked Service."
                          },
                          "parameters": {
                            "dataFactoryName": {
                              "type": "string",
                              "metadata": {
                                "description": "Conditional. The name of the parent Azure Data Factory. Required if the template is used in a standalone deployment."
                              }
                            },
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. The name of the Linked Service."
                              }
                            },
                            "type": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. The type of Linked Service. See [ref](https://learn.microsoft.com/en-us/azure/templates/microsoft.datafactory/factories/linkedservices?pivots=deployment-language-bicep#linkedservice-objects) for more information."
                              }
                            },
                            "typeProperties": {
                              "type": "object",
                              "defaultValue": {},
                              "metadata": {
                                "description": "Optional. Used to add connection properties for your linked services."
                              }
                            },
                            "integrationRuntimeName": {
                              "type": "string",
                              "defaultValue": "none",
                              "metadata": {
                                "description": "Optional. The name of the Integration Runtime to use."
                              }
                            },
                            "parameters": {
                              "type": "object",
                              "defaultValue": {},
                              "metadata": {
                                "description": "Optional. Use this to add parameters for a linked service connection string."
                              }
                            },
                            "description": {
                              "type": "string",
                              "defaultValue": "Linked Service created by avm-res-datafactory-factories",
                              "metadata": {
                                "description": "Optional. The description of the Integration Runtime."
                              }
                            }
                          },
                          "resources": [
                            {
                              "type": "Microsoft.DataFactory/factories/linkedservices",
                              "apiVersion": "2018-06-01",
                              "name": "[format('{0}/{1}', parameters('dataFactoryName'), parameters('name'))]",
                              "properties": {
                                "annotations": [],
                                "description": "[parameters('description')]",
                                "connectVia": "[if(contains(parameters('integrationRuntimeName'), 'none'), null(), createObject('parameters', createObject(), 'referenceName', parameters('integrationRuntimeName'), 'type', 'IntegrationRuntimeReference'))]",
                                "type": "[parameters('type')]",
                                "typeProperties": "[parameters('typeProperties')]",
                                "parameters": "[parameters('parameters')]"
                              }
                            }
                          ],
                          "outputs": {
                            "resourceGroupName": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the Resource Group the Linked Service was created in."
                              },
                              "value": "[resourceGroup().name]"
                            },
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the Linked Service."
                              },
                              "value": "[parameters('name')]"
                            },
                            "resourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource ID of the Linked Service."
                              },
                              "value": "[resourceId('Microsoft.DataFactory/factories/linkedservices', parameters('dataFactoryName'), parameters('name'))]"
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "dataFactory",
                        "dataFactory_integrationRuntimes"
                      ]
                    },
                    "dataFactory_privateEndpoints": {
                      "copy": {
                        "name": "dataFactory_privateEndpoints",
                        "count": "[length(coalesce(parameters('privateEndpoints'), createArray()))]"
                      },
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "[format('{0}-dataFactory-PrivateEndpoint-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                      "subscriptionId": "[split(coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'resourceGroupResourceId'), resourceGroup().id), '/')[2]]",
                      "resourceGroup": "[split(coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'resourceGroupResourceId'), resourceGroup().id), '/')[4]]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "name": {
                            "value": "[coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'name'), format('pep-{0}-{1}-{2}', last(split(resourceId('Microsoft.DataFactory/factories', parameters('name')), '/')), coalesce(parameters('privateEndpoints'), createArray())[copyIndex()].service, copyIndex()))]"
                          },
                          "privateLinkServiceConnections": "[if(not(equals(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'isManualConnection'), true())), createObject('value', createArray(createObject('name', coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'privateLinkServiceConnectionName'), format('{0}-{1}-{2}', last(split(resourceId('Microsoft.DataFactory/factories', parameters('name')), '/')), coalesce(parameters('privateEndpoints'), createArray())[copyIndex()].service, copyIndex())), 'properties', createObject('privateLinkServiceId', resourceId('Microsoft.DataFactory/factories', parameters('name')), 'groupIds', createArray(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()].service))))), createObject('value', null()))]",
                          "manualPrivateLinkServiceConnections": "[if(equals(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'isManualConnection'), true()), createObject('value', createArray(createObject('name', coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'privateLinkServiceConnectionName'), format('{0}-{1}-{2}', last(split(resourceId('Microsoft.DataFactory/factories', parameters('name')), '/')), coalesce(parameters('privateEndpoints'), createArray())[copyIndex()].service, copyIndex())), 'properties', createObject('privateLinkServiceId', resourceId('Microsoft.DataFactory/factories', parameters('name')), 'groupIds', createArray(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()].service), 'requestMessage', coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'manualConnectionRequestMessage'), 'Manual approval required.'))))), createObject('value', null()))]",
                          "subnetResourceId": {
                            "value": "[coalesce(parameters('privateEndpoints'), createArray())[copyIndex()].subnetResourceId]"
                          },
                          "enableTelemetry": {
                            "value": "[variables('enableReferencedModulesTelemetry')]"
                          },
                          "location": {
                            "value": "[coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'location'), reference(split(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()].subnetResourceId, '/subnets/')[0], '2020-06-01', 'Full').location)]"
                          },
                          "lock": {
                            "value": "[coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'lock'), parameters('lock'))]"
                          },
                          "privateDnsZoneGroup": {
                            "value": "[tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'privateDnsZoneGroup')]"
                          },
                          "roleAssignments": {
                            "value": "[tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'roleAssignments')]"
                          },
                          "tags": {
                            "value": "[coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'tags'), parameters('tags'))]"
                          },
                          "customDnsConfigs": {
                            "value": "[tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'customDnsConfigs')]"
                          },
                          "ipConfigurations": {
                            "value": "[tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'ipConfigurations')]"
                          },
                          "applicationSecurityGroupResourceIds": {
                            "value": "[tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'applicationSecurityGroupResourceIds')]"
                          },
                          "customNetworkInterfaceName": {
                            "value": "[tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'customNetworkInterfaceName')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.38.5.1644",
                              "templateHash": "16604612898799598358"
                            },
                            "name": "Private Endpoints",
                            "description": "This module deploys a Private Endpoint."
                          },
                          "definitions": {
                            "privateDnsZoneGroupType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name of the Private DNS Zone Group."
                                  }
                                },
                                "privateDnsZoneGroupConfigs": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/privateDnsZoneGroupConfigType"
                                  },
                                  "metadata": {
                                    "description": "Required. The private DNS zone groups to associate the private endpoint. A DNS zone group can support up to 5 DNS zones."
                                  }
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type of a private dns zone group."
                              }
                            },
                            "lockType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Specify the name of lock."
                                  }
                                },
                                "kind": {
                                  "type": "string",
                                  "allowedValues": [
                                    "CanNotDelete",
                                    "None",
                                    "ReadOnly"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Specify the type of lock."
                                  }
                                },
                                "notes": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Specify the notes of the lock."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for a lock.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                                }
                              }
                            },
                            "privateDnsZoneGroupConfigType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name of the private DNS zone group config."
                                  }
                                },
                                "privateDnsZoneResourceId": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The resource id of the private DNS zone."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "The type of a private DNS zone group configuration.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "private-dns-zone-group/main.bicep"
                                }
                              }
                            },
                            "roleAssignmentType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                  }
                                },
                                "roleDefinitionIdOrName": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                  }
                                },
                                "principalId": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                  }
                                },
                                "principalType": {
                                  "type": "string",
                                  "allowedValues": [
                                    "Device",
                                    "ForeignGroup",
                                    "Group",
                                    "ServicePrincipal",
                                    "User"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The principal type of the assigned principal ID."
                                  }
                                },
                                "description": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The description of the role assignment."
                                  }
                                },
                                "condition": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                  }
                                },
                                "conditionVersion": {
                                  "type": "string",
                                  "allowedValues": [
                                    "2.0"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Version of the condition."
                                  }
                                },
                                "delegatedManagedIdentityResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The Resource Id of the delegated managed identity resource."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for a role assignment.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                                }
                              }
                            }
                          },
                          "parameters": {
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. Name of the private endpoint resource to create."
                              }
                            },
                            "subnetResourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. Resource ID of the subnet where the endpoint needs to be created."
                              }
                            },
                            "applicationSecurityGroupResourceIds": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Application security groups in which the private endpoint IP configuration is included."
                              }
                            },
                            "customNetworkInterfaceName": {
                              "type": "string",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The custom name of the network interface attached to the private endpoint."
                              }
                            },
                            "ipConfigurations": {
                              "type": "array",
                              "metadata": {
                                "__bicep_resource_derived_type!": {
                                  "source": "Microsoft.Network/privateEndpoints@2024-01-01#properties/properties/properties/ipConfigurations"
                                },
                                "description": "Optional. A list of IP configurations of the private endpoint. This will be used to map to the First Party Service endpoints."
                              },
                              "nullable": true
                            },
                            "privateDnsZoneGroup": {
                              "$ref": "#/definitions/privateDnsZoneGroupType",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The private DNS zone group to configure for the private endpoint."
                              }
                            },
                            "location": {
                              "type": "string",
                              "defaultValue": "[resourceGroup().location]",
                              "metadata": {
                                "description": "Optional. Location for all Resources."
                              }
                            },
                            "lock": {
                              "$ref": "#/definitions/lockType",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The lock settings of the service."
                              }
                            },
                            "roleAssignments": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/roleAssignmentType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of role assignments to create."
                              }
                            },
                            "tags": {
                              "type": "object",
                              "metadata": {
                                "__bicep_resource_derived_type!": {
                                  "source": "Microsoft.Network/privateEndpoints@2024-01-01#properties/tags"
                                },
                                "description": "Optional. Tags to be applied on all resources/resource groups in this deployment."
                              },
                              "nullable": true
                            },
                            "customDnsConfigs": {
                              "type": "array",
                              "metadata": {
                                "__bicep_resource_derived_type!": {
                                  "source": "Microsoft.Network/privateEndpoints@2024-01-01#properties/properties/properties/customDnsConfigs"
                                },
                                "description": "Optional. Custom DNS configurations."
                              },
                              "nullable": true
                            },
                            "manualPrivateLinkServiceConnections": {
                              "type": "array",
                              "metadata": {
                                "__bicep_resource_derived_type!": {
                                  "source": "Microsoft.Network/privateEndpoints@2024-01-01#properties/properties/properties/manualPrivateLinkServiceConnections"
                                },
                                "description": "Conditional. A grouping of information about the connection to the remote resource. Used when the network admin does not have access to approve connections to the remote resource. Required if `privateLinkServiceConnections` is empty."
                              },
                              "nullable": true
                            },
                            "privateLinkServiceConnections": {
                              "type": "array",
                              "metadata": {
                                "__bicep_resource_derived_type!": {
                                  "source": "Microsoft.Network/privateEndpoints@2024-01-01#properties/properties/properties/privateLinkServiceConnections"
                                },
                                "description": "Conditional. A grouping of information about the connection to the remote resource. Required if `manualPrivateLinkServiceConnections` is empty."
                              },
                              "nullable": true
                            },
                            "enableTelemetry": {
                              "type": "bool",
                              "defaultValue": true,
                              "metadata": {
                                "description": "Optional. Enable/Disable usage telemetry for module."
                              }
                            }
                          },
                          "variables": {
                            "copy": [
                              {
                                "name": "formattedRoleAssignments",
                                "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                              }
                            ],
                            "builtInRoleNames": {
                              "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                              "DNS Resolver Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '0f2ebee7-ffd4-4fc0-b3b7-664099fdad5d')]",
                              "DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'befefa01-2a29-4197-83a8-272ff33ce314')]",
                              "Domain Services Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'eeaeda52-9324-47f6-8069-5d5bade478b2')]",
                              "Domain Services Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '361898ef-9ed1-48c2-849c-a832951106bb')]",
                              "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                              "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                              "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                              "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                              "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]"
                            }
                          },
                          "resources": {
                            "avmTelemetry": {
                              "condition": "[parameters('enableTelemetry')]",
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2025-04-01",
                              "name": "[format('46d3xbcp.res.network-privateendpoint.{0}.{1}', replace('0.11.1', '.', '-'), substring(uniqueString(deployment().name, parameters('location')), 0, 4))]",
                              "properties": {
                                "mode": "Incremental",
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "contentVersion": "1.0.0.0",
                                  "resources": [],
                                  "outputs": {
                                    "telemetry": {
                                      "type": "String",
                                      "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                    }
                                  }
                                }
                              }
                            },
                            "privateEndpoint": {
                              "type": "Microsoft.Network/privateEndpoints",
                              "apiVersion": "2024-10-01",
                              "name": "[parameters('name')]",
                              "location": "[parameters('location')]",
                              "tags": "[parameters('tags')]",
                              "properties": {
                                "copy": [
                                  {
                                    "name": "applicationSecurityGroups",
                                    "count": "[length(coalesce(parameters('applicationSecurityGroupResourceIds'), createArray()))]",
                                    "input": {
                                      "id": "[coalesce(parameters('applicationSecurityGroupResourceIds'), createArray())[copyIndex('applicationSecurityGroups')]]"
                                    }
                                  }
                                ],
                                "customDnsConfigs": "[coalesce(parameters('customDnsConfigs'), createArray())]",
                                "customNetworkInterfaceName": "[coalesce(parameters('customNetworkInterfaceName'), '')]",
                                "ipConfigurations": "[coalesce(parameters('ipConfigurations'), createArray())]",
                                "manualPrivateLinkServiceConnections": "[coalesce(parameters('manualPrivateLinkServiceConnections'), createArray())]",
                                "privateLinkServiceConnections": "[coalesce(parameters('privateLinkServiceConnections'), createArray())]",
                                "subnet": {
                                  "id": "[parameters('subnetResourceId')]"
                                }
                              }
                            },
                            "privateEndpoint_lock": {
                              "condition": "[and(not(empty(coalesce(parameters('lock'), createObject()))), not(equals(tryGet(parameters('lock'), 'kind'), 'None')))]",
                              "type": "Microsoft.Authorization/locks",
                              "apiVersion": "2020-05-01",
                              "scope": "[format('Microsoft.Network/privateEndpoints/{0}', parameters('name'))]",
                              "name": "[coalesce(tryGet(parameters('lock'), 'name'), format('lock-{0}', parameters('name')))]",
                              "properties": {
                                "level": "[coalesce(tryGet(parameters('lock'), 'kind'), '')]",
                                "notes": "[coalesce(tryGet(parameters('lock'), 'notes'), if(equals(tryGet(parameters('lock'), 'kind'), 'CanNotDelete'), 'Cannot delete resource or child resources.', 'Cannot delete or modify the resource or child resources.'))]"
                              },
                              "dependsOn": [
                                "privateEndpoint"
                              ]
                            },
                            "privateEndpoint_roleAssignments": {
                              "copy": {
                                "name": "privateEndpoint_roleAssignments",
                                "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                              },
                              "type": "Microsoft.Authorization/roleAssignments",
                              "apiVersion": "2022-04-01",
                              "scope": "[format('Microsoft.Network/privateEndpoints/{0}', parameters('name'))]",
                              "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateEndpoints', parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                              "properties": {
                                "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                              },
                              "dependsOn": [
                                "privateEndpoint"
                              ]
                            },
                            "privateEndpoint_privateDnsZoneGroup": {
                              "condition": "[not(empty(parameters('privateDnsZoneGroup')))]",
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2025-04-01",
                              "name": "[format('{0}-PrivateEndpoint-PrivateDnsZoneGroup', uniqueString(deployment().name))]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "name": {
                                    "value": "[tryGet(parameters('privateDnsZoneGroup'), 'name')]"
                                  },
                                  "privateEndpointName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "privateDnsZoneConfigs": {
                                    "value": "[parameters('privateDnsZoneGroup').privateDnsZoneGroupConfigs]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.38.5.1644",
                                      "templateHash": "24141742673128945"
                                    },
                                    "name": "Private Endpoint Private DNS Zone Groups",
                                    "description": "This module deploys a Private Endpoint Private DNS Zone Group."
                                  },
                                  "definitions": {
                                    "privateDnsZoneGroupConfigType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name of the private DNS zone group config."
                                          }
                                        },
                                        "privateDnsZoneResourceId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The resource id of the private DNS zone."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "__bicep_export!": true,
                                        "description": "The type of a private DNS zone group configuration."
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateEndpointName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent private endpoint. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "privateDnsZoneConfigs": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/privateDnsZoneGroupConfigType"
                                      },
                                      "minLength": 1,
                                      "maxLength": 5,
                                      "metadata": {
                                        "description": "Required. Array of private DNS zone configurations of the private DNS zone group. A DNS zone group can support up to 5 DNS zones."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "defaultValue": "default",
                                      "metadata": {
                                        "description": "Optional. The name of the private DNS zone group."
                                      }
                                    }
                                  },
                                  "resources": {
                                    "privateEndpoint": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateEndpoints",
                                      "apiVersion": "2024-10-01",
                                      "name": "[parameters('privateEndpointName')]"
                                    },
                                    "privateDnsZoneGroup": {
                                      "type": "Microsoft.Network/privateEndpoints/privateDnsZoneGroups",
                                      "apiVersion": "2024-10-01",
                                      "name": "[format('{0}/{1}', parameters('privateEndpointName'), parameters('name'))]",
                                      "properties": {
                                        "copy": [
                                          {
                                            "name": "privateDnsZoneConfigs",
                                            "count": "[length(parameters('privateDnsZoneConfigs'))]",
                                            "input": {
                                              "name": "[coalesce(tryGet(parameters('privateDnsZoneConfigs')[copyIndex('privateDnsZoneConfigs')], 'name'), last(split(parameters('privateDnsZoneConfigs')[copyIndex('privateDnsZoneConfigs')].privateDnsZoneResourceId, '/')))]",
                                              "properties": {
                                                "privateDnsZoneId": "[parameters('privateDnsZoneConfigs')[copyIndex('privateDnsZoneConfigs')].privateDnsZoneResourceId]"
                                              }
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the private endpoint DNS zone group."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the private endpoint DNS zone group."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateEndpoints/privateDnsZoneGroups', parameters('privateEndpointName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group the private endpoint DNS zone group was deployed into."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateEndpoint"
                              ]
                            }
                          },
                          "outputs": {
                            "resourceGroupName": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource group the private endpoint was deployed into."
                              },
                              "value": "[resourceGroup().name]"
                            },
                            "resourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource ID of the private endpoint."
                              },
                              "value": "[resourceId('Microsoft.Network/privateEndpoints', parameters('name'))]"
                            },
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the private endpoint."
                              },
                              "value": "[parameters('name')]"
                            },
                            "location": {
                              "type": "string",
                              "metadata": {
                                "description": "The location the resource was deployed into."
                              },
                              "value": "[reference('privateEndpoint', '2024-10-01', 'full').location]"
                            },
                            "customDnsConfigs": {
                              "type": "array",
                              "metadata": {
                                "__bicep_resource_derived_type!": {
                                  "source": "Microsoft.Network/privateEndpoints@2024-01-01#properties/properties/properties/customDnsConfigs",
                                  "output": true
                                },
                                "description": "The custom DNS configurations of the private endpoint."
                              },
                              "value": "[reference('privateEndpoint').customDnsConfigs]"
                            },
                            "networkInterfaceResourceIds": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              },
                              "metadata": {
                                "description": "The resource IDs of the network interfaces associated with the private endpoint."
                              },
                              "value": "[map(reference('privateEndpoint').networkInterfaces, lambda('nic', lambdaVariables('nic').id))]"
                            },
                            "groupId": {
                              "type": "string",
                              "nullable": true,
                              "metadata": {
                                "description": "The group Id for the private endpoint Group."
                              },
                              "value": "[coalesce(tryGet(tryGet(tryGet(tryGet(reference('privateEndpoint'), 'manualPrivateLinkServiceConnections'), 0, 'properties'), 'groupIds'), 0), tryGet(tryGet(tryGet(tryGet(reference('privateEndpoint'), 'privateLinkServiceConnections'), 0, 'properties'), 'groupIds'), 0))]"
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "dataFactory"
                      ]
                    }
                  },
                  "outputs": {
                    "name": {
                      "type": "string",
                      "metadata": {
                        "description": "The Name of the Azure Data Factory instance."
                      },
                      "value": "[parameters('name')]"
                    },
                    "resourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "The Resource ID of the Data Factory."
                      },
                      "value": "[resourceId('Microsoft.DataFactory/factories', parameters('name'))]"
                    },
                    "resourceGroupName": {
                      "type": "string",
                      "metadata": {
                        "description": "The name of the Resource Group with the Data factory."
                      },
                      "value": "[resourceGroup().name]"
                    },
                    "systemAssignedMIPrincipalId": {
                      "type": "string",
                      "nullable": true,
                      "metadata": {
                        "description": "The principal ID of the system assigned identity."
                      },
                      "value": "[tryGet(tryGet(reference('dataFactory', '2018-06-01', 'full'), 'identity'), 'principalId')]"
                    },
                    "location": {
                      "type": "string",
                      "metadata": {
                        "description": "The location the resource was deployed into."
                      },
                      "value": "[reference('dataFactory', '2018-06-01', 'full').location]"
                    },
                    "privateEndpoints": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/privateEndpointOutputType"
                      },
                      "metadata": {
                        "description": "The private endpoints of the Data Factory."
                      },
                      "copy": {
                        "count": "[length(coalesce(parameters('privateEndpoints'), createArray()))]",
                        "input": {
                          "name": "[reference(format('dataFactory_privateEndpoints[{0}]', copyIndex())).outputs.name.value]",
                          "resourceId": "[reference(format('dataFactory_privateEndpoints[{0}]', copyIndex())).outputs.resourceId.value]",
                          "groupId": "[tryGet(tryGet(reference(format('dataFactory_privateEndpoints[{0}]', copyIndex())).outputs, 'groupId'), 'value')]",
                          "customDnsConfigs": "[reference(format('dataFactory_privateEndpoints[{0}]', copyIndex())).outputs.customDnsConfigs.value]",
                          "networkInterfaceResourceIds": "[reference(format('dataFactory_privateEndpoints[{0}]', copyIndex())).outputs.networkInterfaceResourceIds.value]"
                        }
                      }
                    }
                  }
                }
              },
              "dependsOn": [
                "keyVault",
                "managedIdentity",
                "managedNetwork",
                "storageAccount"
              ]
            },
            "stopTriggers": {
              "condition": "[parameters('enableTriggerManagement')]",
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-stop-triggers', uniqueString(deployment().name, parameters('location')))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "dataFactoryName": {
                    "value": "[variables('dataFactoryName')]"
                  },
                  "resourceGroupName": {
                    "value": "[resourceGroup().name]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "managedIdentityResourceId": "[if(variables('useExistingIdentity'), createObject('value', parameters('existingManagedIdentityResourceId')), createObject('value', reference('managedIdentity').outputs.resourceId.value))]",
                  "storageAccountResourceId": {
                    "value": "[reference('storageAccount').outputs.resourceId.value]"
                  },
                  "operation": {
                    "value": "stop"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.40.2.10011",
                      "templateHash": "9868901521815016226"
                    }
                  },
                  "parameters": {
                    "dataFactoryName": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. Name of the Data Factory."
                      }
                    },
                    "resourceGroupName": {
                      "type": "string",
                      "defaultValue": "[resourceGroup().name]",
                      "metadata": {
                        "description": "Required. Resource group name where Data Factory is located."
                      }
                    },
                    "location": {
                      "type": "string",
                      "defaultValue": "[resourceGroup().location]",
                      "metadata": {
                        "description": "Required. Location for the deployment script resources."
                      }
                    },
                    "managedIdentityResourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. Managed identity resource ID for running the scripts."
                      }
                    },
                    "storageAccountResourceId": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Optional. Existing storage account resource ID for deployment scripts. Uses the FinOps Hub storage account to avoid creating additional resources."
                      }
                    },
                    "operation": {
                      "type": "string",
                      "defaultValue": "start",
                      "allowedValues": [
                        "stop",
                        "start"
                      ],
                      "metadata": {
                        "description": "Optional. Operation to perform: \"stop\" before deployment, \"start\" after deployment."
                      }
                    },
                    "triggerNames": {
                      "type": "array",
                      "defaultValue": [],
                      "metadata": {
                        "description": "Optional. Trigger names to manage. Empty means all triggers."
                      }
                    },
                    "forceRun": {
                      "type": "string",
                      "defaultValue": "[utcNow()]",
                      "metadata": {
                        "description": "Optional. Force script to run even if nothing changed (use timestamp)."
                      }
                    },
                    "timeout": {
                      "type": "string",
                      "defaultValue": "PT10M",
                      "metadata": {
                        "description": "Optional. Timeout for the script execution."
                      }
                    }
                  },
                  "variables": {
                    "stopScript": "$ErrorActionPreference = 'Continue'\n$factory = $env:ADF_NAME\n$rg = $env:RESOURCE_GROUP\n$subId = $env:SUBSCRIPTION_ID\n$specificTriggers = $env:TRIGGER_NAMES\n\nWrite-Output \"=== Stop Triggers Script ===\"\nWrite-Output \"Data Factory: $factory\"\nWrite-Output \"Resource Group: $rg\"\nWrite-Output \"Subscription: $subId\"\n\ntry {\n    # Get access token using managed identity\n    $token = (Get-AzAccessToken -ResourceUrl 'https://management.azure.com').Token\n    $headers = @{ \n        'Authorization' = \"Bearer $token\"\n        'Content-Type' = 'application/json'\n    }\n    \n    # Check if ADF exists\n    $adfUri = \"https://management.azure.com/subscriptions/$subId/resourceGroups/$rg/providers/Microsoft.DataFactory/factories/$factory?api-version=2018-06-01\"\n    try {\n        $adfCheck = Invoke-RestMethod -Uri $adfUri -Method Get -Headers $headers -ErrorAction Stop\n        Write-Output \"Data Factory exists: $($adfCheck.name)\"\n    } catch {\n        if ($_.Exception.Response.StatusCode -eq 'NotFound') {\n            Write-Output \"Data Factory does not exist yet (first deployment). Skipping trigger stop.\"\n            $DeploymentScriptOutputs = @{ stoppedTriggers = @(); status = \"skipped-not-found\"; triggersCount = 0 }\n            exit 0\n        }\n        throw\n    }\n    \n    # List all triggers\n    $listUri = \"https://management.azure.com/subscriptions/$subId/resourceGroups/$rg/providers/Microsoft.DataFactory/factories/$factory/triggers?api-version=2018-06-01\"\n    $triggersResponse = Invoke-RestMethod -Uri $listUri -Method Get -Headers $headers\n    \n    $stoppedList = @()\n    foreach ($trigger in $triggersResponse.value) {\n        $triggerName = $trigger.name\n        $state = $trigger.properties.runtimeState\n        \n        # Skip if not started or if specific triggers specified and this isn't one of them\n        if ($state -ne 'Started') {\n            Write-Output \"Trigger $triggerName is already $state - skipping\"\n            continue\n        }\n        \n        if (-not [string]::IsNullOrEmpty($specificTriggers) -and $specificTriggers -notcontains $triggerName) {\n            continue\n        }\n        \n        Write-Output \"Stopping trigger: $triggerName (currently $state)\"\n        $stopUri = \"https://management.azure.com/subscriptions/$subId/resourceGroups/$rg/providers/Microsoft.DataFactory/factories/$factory/triggers/$triggerName/stop?api-version=2018-06-01\"\n        try {\n            Invoke-RestMethod -Uri $stopUri -Method Post -Headers $headers\n            $stoppedList += $triggerName\n            Write-Output \"  Successfully stopped: $triggerName\"\n        } catch {\n            Write-Output \"  Warning: Failed to stop $triggerName - $($_.Exception.Message)\"\n        }\n    }\n\n    Write-Output \"=== Summary ===\"\n    Write-Output \"Stopped $($stoppedList.Count) triggers\"\n    $DeploymentScriptOutputs = @{ \n        stoppedTriggers = $stoppedList\n        status = \"completed\"\n        triggersCount = $stoppedList.Count\n    }\n} catch {\n    Write-Output \"Error: $_\"\n    # Don't fail the deployment if we can't stop triggers\n    $DeploymentScriptOutputs = @{ stoppedTriggers = @(); status = \"error\"; error = $_.ToString(); triggersCount = 0 }\n}\n",
                    "startScript": "$ErrorActionPreference = 'Stop'\n$factory = $env:ADF_NAME\n$rg = $env:RESOURCE_GROUP\n$subId = $env:SUBSCRIPTION_ID\n$specificTriggers = $env:TRIGGER_NAMES\n\nWrite-Output \"=== Start Triggers Script ===\"\nWrite-Output \"Data Factory: $factory\"\nWrite-Output \"Resource Group: $rg\"\nWrite-Output \"Subscription: $subId\"\n\ntry {\n    # Get access token using managed identity\n    $token = (Get-AzAccessToken -ResourceUrl 'https://management.azure.com').Token\n    $headers = @{ \n        'Authorization' = \"Bearer $token\"\n        'Content-Type' = 'application/json'\n    }\n    \n    # List all triggers\n    $listUri = \"https://management.azure.com/subscriptions/$subId/resourceGroups/$rg/providers/Microsoft.DataFactory/factories/$factory/triggers?api-version=2018-06-01\"\n    $triggersResponse = Invoke-RestMethod -Uri $listUri -Method Get -Headers $headers\n    \n    $startedList = @()\n    $failedList = @()\n    \n    foreach ($trigger in $triggersResponse.value) {\n        $triggerName = $trigger.name\n        $state = $trigger.properties.runtimeState\n        \n        # Skip if already started\n        if ($state -eq 'Started') {\n            Write-Output \"Trigger $triggerName is already Started - skipping\"\n            continue\n        }\n        \n        # Skip if specific triggers specified and this isn't one of them\n        if (-not [string]::IsNullOrEmpty($specificTriggers) -and $specificTriggers -notcontains $triggerName) {\n            continue\n        }\n        \n        Write-Output \"Starting trigger: $triggerName (currently $state)\"\n        $startUri = \"https://management.azure.com/subscriptions/$subId/resourceGroups/$rg/providers/Microsoft.DataFactory/factories/$factory/triggers/$triggerName/start?api-version=2018-06-01\"\n        try {\n            Invoke-RestMethod -Uri $startUri -Method Post -Headers $headers\n            $startedList += $triggerName\n            Write-Output \"  Successfully started: $triggerName\"\n        } catch {\n            $failedList += $triggerName\n            Write-Output \"  Warning: Failed to start $triggerName - $($_.Exception.Message)\"\n        }\n    }\n\n    Write-Output \"=== Summary ===\"\n    Write-Output \"Started: $($startedList.Count) triggers\"\n    Write-Output \"Failed: $($failedList.Count) triggers\"\n    \n    if ($failedList.Count -gt 0) {\n        Write-Warning \"Some triggers failed to start. Check EventGrid subscription registration.\"\n    }\n    \n    $DeploymentScriptOutputs = @{ \n        startedTriggers = $startedList\n        failedTriggers = $failedList\n        status = if ($failedList.Count -eq 0) { \"completed\" } else { \"partial\" }\n        triggersCount = $startedList.Count\n    }\n} catch {\n    Write-Output \"Error: $_\"\n    throw\n}\n"
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Resources/deploymentScripts",
                      "apiVersion": "2023-08-01",
                      "name": "[format('ds-{0}-triggers-{1}', parameters('operation'), take(uniqueString(parameters('dataFactoryName'), parameters('forceRun')), 8))]",
                      "location": "[parameters('location')]",
                      "kind": "AzurePowerShell",
                      "identity": {
                        "type": "UserAssigned",
                        "userAssignedIdentities": {
                          "[format('{0}', parameters('managedIdentityResourceId'))]": {}
                        }
                      },
                      "properties": {
                        "azPowerShellVersion": "12.0",
                        "timeout": "[parameters('timeout')]",
                        "retentionInterval": "PT1H",
                        "cleanupPreference": "OnSuccess",
                        "forceUpdateTag": "[parameters('forceRun')]",
                        "storageAccountSettings": "[if(not(empty(parameters('storageAccountResourceId'))), createObject('storageAccountKey', null(), 'storageAccountName', last(split(parameters('storageAccountResourceId'), '/'))), null())]",
                        "environmentVariables": [
                          {
                            "name": "ADF_NAME",
                            "value": "[parameters('dataFactoryName')]"
                          },
                          {
                            "name": "RESOURCE_GROUP",
                            "value": "[parameters('resourceGroupName')]"
                          },
                          {
                            "name": "SUBSCRIPTION_ID",
                            "value": "[subscription().subscriptionId]"
                          },
                          {
                            "name": "TRIGGER_NAMES",
                            "value": "[join(parameters('triggerNames'), ',')]"
                          }
                        ],
                        "scriptContent": "[if(equals(parameters('operation'), 'stop'), variables('stopScript'), variables('startScript'))]"
                      }
                    }
                  ],
                  "outputs": {
                    "managedTriggers": {
                      "type": "array",
                      "metadata": {
                        "description": "List of triggers that were managed."
                      },
                      "value": "[if(and(contains(reference(resourceId('Microsoft.Resources/deploymentScripts', format('ds-{0}-triggers-{1}', parameters('operation'), take(uniqueString(parameters('dataFactoryName'), parameters('forceRun')), 8))), '2023-08-01'), 'outputs'), not(equals(reference(resourceId('Microsoft.Resources/deploymentScripts', format('ds-{0}-triggers-{1}', parameters('operation'), take(uniqueString(parameters('dataFactoryName'), parameters('forceRun')), 8))), '2023-08-01').outputs, null()))), if(equals(parameters('operation'), 'stop'), if(contains(reference(resourceId('Microsoft.Resources/deploymentScripts', format('ds-{0}-triggers-{1}', parameters('operation'), take(uniqueString(parameters('dataFactoryName'), parameters('forceRun')), 8))), '2023-08-01').outputs, 'stoppedTriggers'), reference(resourceId('Microsoft.Resources/deploymentScripts', format('ds-{0}-triggers-{1}', parameters('operation'), take(uniqueString(parameters('dataFactoryName'), parameters('forceRun')), 8))), '2023-08-01').outputs.stoppedTriggers, createArray()), if(contains(reference(resourceId('Microsoft.Resources/deploymentScripts', format('ds-{0}-triggers-{1}', parameters('operation'), take(uniqueString(parameters('dataFactoryName'), parameters('forceRun')), 8))), '2023-08-01').outputs, 'startedTriggers'), reference(resourceId('Microsoft.Resources/deploymentScripts', format('ds-{0}-triggers-{1}', parameters('operation'), take(uniqueString(parameters('dataFactoryName'), parameters('forceRun')), 8))), '2023-08-01').outputs.startedTriggers, createArray())), createArray())]"
                    },
                    "status": {
                      "type": "string",
                      "metadata": {
                        "description": "Script execution status."
                      },
                      "value": "[if(and(and(contains(reference(resourceId('Microsoft.Resources/deploymentScripts', format('ds-{0}-triggers-{1}', parameters('operation'), take(uniqueString(parameters('dataFactoryName'), parameters('forceRun')), 8))), '2023-08-01'), 'outputs'), not(equals(reference(resourceId('Microsoft.Resources/deploymentScripts', format('ds-{0}-triggers-{1}', parameters('operation'), take(uniqueString(parameters('dataFactoryName'), parameters('forceRun')), 8))), '2023-08-01').outputs, null()))), contains(reference(resourceId('Microsoft.Resources/deploymentScripts', format('ds-{0}-triggers-{1}', parameters('operation'), take(uniqueString(parameters('dataFactoryName'), parameters('forceRun')), 8))), '2023-08-01').outputs, 'status')), reference(resourceId('Microsoft.Resources/deploymentScripts', format('ds-{0}-triggers-{1}', parameters('operation'), take(uniqueString(parameters('dataFactoryName'), parameters('forceRun')), 8))), '2023-08-01').outputs.status, 'unknown')]"
                    },
                    "triggerCount": {
                      "type": "int",
                      "metadata": {
                        "description": "Number of triggers managed."
                      },
                      "value": "[if(and(and(contains(reference(resourceId('Microsoft.Resources/deploymentScripts', format('ds-{0}-triggers-{1}', parameters('operation'), take(uniqueString(parameters('dataFactoryName'), parameters('forceRun')), 8))), '2023-08-01'), 'outputs'), not(equals(reference(resourceId('Microsoft.Resources/deploymentScripts', format('ds-{0}-triggers-{1}', parameters('operation'), take(uniqueString(parameters('dataFactoryName'), parameters('forceRun')), 8))), '2023-08-01').outputs, null()))), contains(reference(resourceId('Microsoft.Resources/deploymentScripts', format('ds-{0}-triggers-{1}', parameters('operation'), take(uniqueString(parameters('dataFactoryName'), parameters('forceRun')), 8))), '2023-08-01').outputs, 'triggersCount')), reference(resourceId('Microsoft.Resources/deploymentScripts', format('ds-{0}-triggers-{1}', parameters('operation'), take(uniqueString(parameters('dataFactoryName'), parameters('forceRun')), 8))), '2023-08-01').outputs.triggersCount, 0)]"
                    },
                    "scriptResourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Deployment script resource ID."
                      },
                      "value": "[resourceId('Microsoft.Resources/deploymentScripts', format('ds-{0}-triggers-{1}', parameters('operation'), take(uniqueString(parameters('dataFactoryName'), parameters('forceRun')), 8)))]"
                    }
                  }
                }
              },
              "dependsOn": [
                "identityStorageRoleAssignment",
                "managedIdentity",
                "storageAccount"
              ]
            },
            "dataFactoryResources": {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-adf-resources', uniqueString(deployment().name, parameters('location')))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "dataFactoryName": {
                    "value": "[reference('dataFactory').outputs.name.value]"
                  },
                  "storageAccountName": {
                    "value": "[reference('storageAccount').outputs.name.value]"
                  },
                  "keyVaultName": {
                    "value": "[reference('keyVault').outputs.name.value]"
                  },
                  "dataExplorerEndpoint": "[if(and(variables('createNewAdx'), not(equals(reference('dataExplorer'), null()))), createObject('value', format('https://{0}.{1}.kusto.windows.net', reference('dataExplorer').outputs.name.value, parameters('location'))), if(variables('useExistingAdx'), createObject('value', format('https://{0}.{1}.kusto.windows.net', variables('existingAdxClusterName'), parameters('location'))), createObject('value', '')))]",
                  "dataExplorerPrincipalId": "[if(and(variables('createNewAdx'), not(equals(reference('dataExplorer'), null()))), createObject('value', reference('dataExplorer').outputs.systemAssignedMIPrincipalId.value), createObject('value', ''))]",
                  "fabricQueryUri": "[if(variables('useFabric'), createObject('value', parameters('fabricQueryUri')), createObject('value', ''))]",
                  "ftkVersion": {
                    "value": "[variables('ftkVersion')]"
                  },
                  "integrationRuntimeName": "[if(variables('effectiveAdfManagedVnet'), createObject('value', 'FinOpsHubManagedIR'), createObject('value', ''))]",
                  "billingAccountId": {
                    "value": "[parameters('billingAccountId')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.40.2.10011",
                      "templateHash": "13546238621944451411"
                    }
                  },
                  "parameters": {
                    "dataFactoryName": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. Name of the Data Factory."
                      }
                    },
                    "storageAccountName": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. Name of the storage account."
                      }
                    },
                    "keyVaultName": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. Name of the Key Vault."
                      }
                    },
                    "dataExplorerEndpoint": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Optional. Data Explorer cluster endpoint (for ADX deployments)."
                      }
                    },
                    "dataExplorerPrincipalId": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Optional. Data Explorer cluster system-assigned managed identity principal ID."
                      }
                    },
                    "fabricQueryUri": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Optional. Fabric eventhouse query URI (for Fabric deployments)."
                      }
                    },
                    "integrationRuntimeName": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Optional. Name of the integration runtime to use. If using managed VNet, this should reference the managed IR."
                      }
                    },
                    "ftkVersion": {
                      "type": "string",
                      "defaultValue": "0.7.0",
                      "metadata": {
                        "description": "Optional. FinOps toolkit version."
                      }
                    },
                    "billingAccountId": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Optional. Billing account ID for MACC tracking. Required for MACC pipelines."
                      }
                    }
                  },
                  "variables": {
                    "CONFIG": "config",
                    "INGESTION": "ingestion",
                    "MSEXPORTS": "msexports",
                    "INGESTION_ID_SEPARATOR": "__",
                    "useDataExplorer": "[not(empty(parameters('dataExplorerEndpoint')))]",
                    "useFabric": "[not(empty(parameters('fabricQueryUri')))]",
                    "useAnalytics": "[or(variables('useDataExplorer'), variables('useFabric'))]",
                    "dataExplorerUri": "[if(variables('useDataExplorer'), parameters('dataExplorerEndpoint'), if(variables('useFabric'), parameters('fabricQueryUri'), ''))]",
                    "ingestionAuthMethod": "[if(variables('useFabric'), 'impersonate', 'managed_identity=system')]",
                    "hubAnnotations": [
                      "FinOps Hub",
                      "[format('ftk-version-{0}', parameters('ftkVersion'))]"
                    ],
                    "useIntegrationRuntime": "[not(empty(parameters('integrationRuntimeName')))]",
                    "connectViaProperty": "[if(variables('useIntegrationRuntime'), createObject('referenceName', parameters('integrationRuntimeName'), 'type', 'IntegrationRuntimeReference'), null())]",
                    "useMacc": "[and(not(empty(parameters('billingAccountId'))), variables('useAnalytics'))]"
                  },
                  "resources": [
                    {
                      "type": "Microsoft.DataFactory/factories/linkedservices",
                      "apiVersion": "2018-06-01",
                      "name": "[format('{0}/{1}', parameters('dataFactoryName'), parameters('storageAccountName'))]",
                      "properties": {
                        "type": "AzureBlobFS",
                        "typeProperties": {
                          "url": "[format('https://{0}.dfs.{1}', parameters('storageAccountName'), environment().suffixes.storage)]"
                        },
                        "connectVia": "[variables('connectViaProperty')]",
                        "annotations": []
                      }
                    },
                    {
                      "type": "Microsoft.DataFactory/factories/linkedservices",
                      "apiVersion": "2018-06-01",
                      "name": "[format('{0}/{1}', parameters('dataFactoryName'), parameters('keyVaultName'))]",
                      "properties": {
                        "type": "AzureKeyVault",
                        "typeProperties": {
                          "baseUrl": "[format('https://{0}{1}', parameters('keyVaultName'), environment().suffixes.keyvaultDns)]"
                        },
                        "connectVia": "[variables('connectViaProperty')]",
                        "annotations": []
                      }
                    },
                    {
                      "condition": "[variables('useAnalytics')]",
                      "type": "Microsoft.DataFactory/factories/linkedservices",
                      "apiVersion": "2018-06-01",
                      "name": "[format('{0}/{1}', parameters('dataFactoryName'), 'dataExplorer')]",
                      "properties": {
                        "type": "AzureDataExplorer",
                        "typeProperties": {
                          "endpoint": "[variables('dataExplorerUri')]",
                          "database": "@{linkedService().database}"
                        },
                        "parameters": {
                          "database": {
                            "type": "String",
                            "defaultValue": "Ingestion"
                          }
                        },
                        "connectVia": "[variables('connectViaProperty')]",
                        "annotations": []
                      }
                    },
                    {
                      "type": "Microsoft.DataFactory/factories/datasets",
                      "apiVersion": "2018-06-01",
                      "name": "[format('{0}/{1}', parameters('dataFactoryName'), variables('CONFIG'))]",
                      "properties": {
                        "linkedServiceName": {
                          "referenceName": "[parameters('storageAccountName')]",
                          "type": "LinkedServiceReference"
                        },
                        "type": "Json",
                        "typeProperties": {
                          "location": {
                            "type": "AzureBlobFSLocation",
                            "fileName": {
                              "value": "@{dataset().fileName}",
                              "type": "Expression"
                            },
                            "folderPath": {
                              "value": "@{dataset().folderPath}",
                              "type": "Expression"
                            },
                            "fileSystem": "[variables('CONFIG')]"
                          }
                        },
                        "parameters": {
                          "fileName": {
                            "type": "String",
                            "defaultValue": "settings.json"
                          },
                          "folderPath": {
                            "type": "String",
                            "defaultValue": ""
                          }
                        }
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.DataFactory/factories/linkedservices', parameters('dataFactoryName'), parameters('storageAccountName'))]"
                      ]
                    },
                    {
                      "type": "Microsoft.DataFactory/factories/datasets",
                      "apiVersion": "2018-06-01",
                      "name": "[format('{0}/{1}', parameters('dataFactoryName'), variables('INGESTION'))]",
                      "properties": {
                        "linkedServiceName": {
                          "referenceName": "[parameters('storageAccountName')]",
                          "type": "LinkedServiceReference"
                        },
                        "type": "Parquet",
                        "typeProperties": {
                          "location": {
                            "type": "AzureBlobFSLocation",
                            "fileName": {
                              "value": "@{dataset().blobPath}",
                              "type": "Expression"
                            },
                            "fileSystem": "[variables('INGESTION')]"
                          }
                        },
                        "parameters": {
                          "blobPath": {
                            "type": "String"
                          }
                        },
                        "annotations": []
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.DataFactory/factories/linkedservices', parameters('dataFactoryName'), parameters('storageAccountName'))]"
                      ]
                    },
                    {
                      "type": "Microsoft.DataFactory/factories/datasets",
                      "apiVersion": "2018-06-01",
                      "name": "[format('{0}/{1}', parameters('dataFactoryName'), format('{0}_files', variables('INGESTION')))]",
                      "properties": {
                        "linkedServiceName": {
                          "referenceName": "[parameters('storageAccountName')]",
                          "type": "LinkedServiceReference"
                        },
                        "type": "Parquet",
                        "typeProperties": {
                          "location": {
                            "type": "AzureBlobFSLocation",
                            "fileSystem": "[variables('INGESTION')]",
                            "folderPath": {
                              "value": "@dataset().folderPath",
                              "type": "Expression"
                            }
                          }
                        },
                        "parameters": {
                          "folderPath": {
                            "type": "String"
                          }
                        },
                        "annotations": []
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.DataFactory/factories/linkedservices', parameters('dataFactoryName'), parameters('storageAccountName'))]"
                      ]
                    },
                    {
                      "type": "Microsoft.DataFactory/factories/datasets",
                      "apiVersion": "2018-06-01",
                      "name": "[format('{0}/{1}', parameters('dataFactoryName'), 'ingestion_manifest')]",
                      "properties": {
                        "linkedServiceName": {
                          "referenceName": "[parameters('storageAccountName')]",
                          "type": "LinkedServiceReference"
                        },
                        "type": "Json",
                        "typeProperties": {
                          "location": {
                            "type": "AzureBlobFSLocation",
                            "fileName": {
                              "value": "@{dataset().fileName}",
                              "type": "Expression"
                            },
                            "folderPath": {
                              "value": "@{dataset().folderPath}",
                              "type": "Expression"
                            },
                            "fileSystem": "[variables('INGESTION')]"
                          }
                        },
                        "parameters": {
                          "fileName": {
                            "type": "String",
                            "defaultValue": "manifest.json"
                          },
                          "folderPath": {
                            "type": "String",
                            "defaultValue": "[variables('INGESTION')]"
                          }
                        },
                        "annotations": []
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.DataFactory/factories/linkedservices', parameters('dataFactoryName'), parameters('storageAccountName'))]"
                      ]
                    },
                    {
                      "type": "Microsoft.DataFactory/factories/datasets",
                      "apiVersion": "2018-06-01",
                      "name": "[format('{0}/{1}', parameters('dataFactoryName'), 'msexports_manifest')]",
                      "properties": {
                        "linkedServiceName": {
                          "referenceName": "[parameters('storageAccountName')]",
                          "type": "LinkedServiceReference"
                        },
                        "type": "Json",
                        "typeProperties": {
                          "location": {
                            "type": "AzureBlobFSLocation",
                            "fileName": {
                              "value": "@{dataset().fileName}",
                              "type": "Expression"
                            },
                            "folderPath": {
                              "value": "@{dataset().folderPath}",
                              "type": "Expression"
                            },
                            "fileSystem": "[variables('MSEXPORTS')]"
                          }
                        },
                        "parameters": {
                          "fileName": {
                            "type": "String",
                            "defaultValue": "manifest.json"
                          },
                          "folderPath": {
                            "type": "String",
                            "defaultValue": "[variables('MSEXPORTS')]"
                          }
                        },
                        "annotations": []
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.DataFactory/factories/linkedservices', parameters('dataFactoryName'), parameters('storageAccountName'))]"
                      ]
                    },
                    {
                      "type": "Microsoft.DataFactory/factories/datasets",
                      "apiVersion": "2018-06-01",
                      "name": "[format('{0}/{1}', parameters('dataFactoryName'), replace(format('{0}', variables('MSEXPORTS')), '-', '_'))]",
                      "properties": {
                        "linkedServiceName": {
                          "referenceName": "[parameters('storageAccountName')]",
                          "type": "LinkedServiceReference"
                        },
                        "type": "DelimitedText",
                        "typeProperties": {
                          "location": {
                            "type": "AzureBlobFSLocation",
                            "folderPath": {
                              "value": "@substring(dataset().blobPath, 0, lastIndexOf(dataset().blobPath, '/'))",
                              "type": "Expression"
                            },
                            "fileName": {
                              "value": "@substring(dataset().blobPath, add(lastIndexOf(dataset().blobPath, '/'), 1), sub(length(dataset().blobPath), add(lastIndexOf(dataset().blobPath, '/'), 1)))",
                              "type": "Expression"
                            },
                            "fileSystem": "[variables('MSEXPORTS')]"
                          },
                          "columnDelimiter": ",",
                          "escapeChar": "\"",
                          "quoteChar": "\"",
                          "firstRowAsHeader": true
                        },
                        "parameters": {
                          "blobPath": {
                            "type": "String"
                          }
                        }
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.DataFactory/factories/linkedservices', parameters('dataFactoryName'), parameters('storageAccountName'))]"
                      ]
                    },
                    {
                      "type": "Microsoft.DataFactory/factories/datasets",
                      "apiVersion": "2018-06-01",
                      "name": "[format('{0}/{1}', parameters('dataFactoryName'), format('{0}_gzip', variables('MSEXPORTS')))]",
                      "properties": {
                        "linkedServiceName": {
                          "referenceName": "[parameters('storageAccountName')]",
                          "type": "LinkedServiceReference"
                        },
                        "type": "DelimitedText",
                        "typeProperties": {
                          "location": {
                            "type": "AzureBlobFSLocation",
                            "folderPath": {
                              "value": "@substring(dataset().blobPath, 0, lastIndexOf(dataset().blobPath, '/'))",
                              "type": "Expression"
                            },
                            "fileName": {
                              "value": "@substring(dataset().blobPath, add(lastIndexOf(dataset().blobPath, '/'), 1), sub(length(dataset().blobPath), add(lastIndexOf(dataset().blobPath, '/'), 1)))",
                              "type": "Expression"
                            },
                            "fileSystem": "[variables('MSEXPORTS')]"
                          },
                          "columnDelimiter": ",",
                          "escapeChar": "\"",
                          "quoteChar": "\"",
                          "firstRowAsHeader": true,
                          "compressionCodec": "Gzip"
                        },
                        "parameters": {
                          "blobPath": {
                            "type": "String"
                          }
                        }
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.DataFactory/factories/linkedservices', parameters('dataFactoryName'), parameters('storageAccountName'))]"
                      ]
                    },
                    {
                      "type": "Microsoft.DataFactory/factories/datasets",
                      "apiVersion": "2018-06-01",
                      "name": "[format('{0}/{1}', parameters('dataFactoryName'), format('{0}_parquet', variables('MSEXPORTS')))]",
                      "properties": {
                        "linkedServiceName": {
                          "referenceName": "[parameters('storageAccountName')]",
                          "type": "LinkedServiceReference"
                        },
                        "type": "Parquet",
                        "typeProperties": {
                          "location": {
                            "type": "AzureBlobFSLocation",
                            "folderPath": {
                              "value": "@substring(dataset().blobPath, 0, lastIndexOf(dataset().blobPath, '/'))",
                              "type": "Expression"
                            },
                            "fileName": {
                              "value": "@substring(dataset().blobPath, add(lastIndexOf(dataset().blobPath, '/'), 1), sub(length(dataset().blobPath), add(lastIndexOf(dataset().blobPath, '/'), 1)))",
                              "type": "Expression"
                            },
                            "fileSystem": "[variables('MSEXPORTS')]"
                          }
                        },
                        "parameters": {
                          "blobPath": {
                            "type": "String"
                          }
                        }
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.DataFactory/factories/linkedservices', parameters('dataFactoryName'), parameters('storageAccountName'))]"
                      ]
                    },
                    {
                      "type": "Microsoft.DataFactory/factories/pipelines",
                      "apiVersion": "2018-06-01",
                      "name": "[format('{0}/{1}', parameters('dataFactoryName'), format('{0}_ExecuteETL', variables('MSEXPORTS')))]",
                      "properties": {
                        "concurrency": 1,
                        "activities": [
                          {
                            "name": "Wait",
                            "description": "Wait for files to be fully available",
                            "type": "Wait",
                            "dependsOn": [],
                            "userProperties": [],
                            "typeProperties": {
                              "waitTimeInSeconds": 60
                            }
                          },
                          {
                            "name": "Execute ETL",
                            "description": "Run the msexports to ingestion ETL pipeline",
                            "type": "ExecutePipeline",
                            "dependsOn": [
                              {
                                "activity": "Wait",
                                "dependencyConditions": [
                                  "Succeeded"
                                ]
                              }
                            ],
                            "policy": {
                              "secureInput": false
                            },
                            "userProperties": [],
                            "typeProperties": {
                              "pipeline": {
                                "referenceName": "[format('{0}_ETL_{1}', variables('MSEXPORTS'), variables('INGESTION'))]",
                                "type": "PipelineReference"
                              },
                              "waitOnCompletion": true,
                              "parameters": {
                                "folderPath": {
                                  "value": "@join(skip(array(split(pipeline().parameters.folderPath, '/')), 1), '/')",
                                  "type": "Expression"
                                },
                                "fileName": {
                                  "value": "@pipeline().parameters.fileName",
                                  "type": "Expression"
                                }
                              }
                            }
                          }
                        ],
                        "parameters": {
                          "folderPath": {
                            "type": "String"
                          },
                          "fileName": {
                            "type": "String"
                          }
                        },
                        "annotations": "[union(variables('hubAnnotations'), createArray('Cost Management Exports'))]"
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.DataFactory/factories/pipelines', parameters('dataFactoryName'), format('{0}_ETL_{1}', variables('MSEXPORTS'), variables('INGESTION')))]"
                      ]
                    },
                    {
                      "type": "Microsoft.DataFactory/factories/pipelines",
                      "apiVersion": "2018-06-01",
                      "name": "[format('{0}/{1}', parameters('dataFactoryName'), format('{0}_ETL_{1}', variables('MSEXPORTS'), variables('INGESTION')))]",
                      "properties": {
                        "activities": [
                          {
                            "name": "Read Manifest",
                            "description": "Read the Cost Management export manifest",
                            "type": "Lookup",
                            "dependsOn": [],
                            "policy": {
                              "timeout": "0.12:00:00",
                              "retry": 0,
                              "retryIntervalInSeconds": 30,
                              "secureOutput": false,
                              "secureInput": false
                            },
                            "userProperties": [],
                            "typeProperties": {
                              "source": {
                                "type": "JsonSource",
                                "storeSettings": {
                                  "type": "AzureBlobFSReadSettings",
                                  "recursive": false,
                                  "enablePartitionDiscovery": false
                                },
                                "formatSettings": {
                                  "type": "JsonReadSettings"
                                }
                              },
                              "dataset": {
                                "referenceName": "msexports_manifest",
                                "type": "DatasetReference",
                                "parameters": {
                                  "fileName": {
                                    "value": "@pipeline().parameters.fileName",
                                    "type": "Expression"
                                  },
                                  "folderPath": {
                                    "value": "@pipeline().parameters.folderPath",
                                    "type": "Expression"
                                  }
                                }
                              }
                            }
                          },
                          {
                            "name": "Set Export Scope",
                            "description": "Extract the export scope from the manifest",
                            "type": "SetVariable",
                            "dependsOn": [
                              {
                                "activity": "Read Manifest",
                                "dependencyConditions": [
                                  "Succeeded"
                                ]
                              }
                            ],
                            "policy": {
                              "secureOutput": false,
                              "secureInput": false
                            },
                            "userProperties": [],
                            "typeProperties": {
                              "variableName": "scope",
                              "value": {
                                "value": "@if(contains(activity('Read Manifest').output.firstRow, 'exportConfig'), activity('Read Manifest').output.firstRow.exportConfig.resourceId, '')",
                                "type": "Expression"
                              }
                            }
                          },
                          {
                            "name": "Set Dataset Type",
                            "description": "Extract the dataset type (FocusCost, ActualCost, etc.) from exportConfig.type",
                            "type": "SetVariable",
                            "dependsOn": [
                              {
                                "activity": "Read Manifest",
                                "dependencyConditions": [
                                  "Succeeded"
                                ]
                              }
                            ],
                            "policy": {
                              "secureOutput": false,
                              "secureInput": false
                            },
                            "userProperties": [],
                            "typeProperties": {
                              "variableName": "exportDatasetType",
                              "value": {
                                "value": "@if(contains(activity('Read Manifest').output.firstRow, 'exportConfig'), activity('Read Manifest').output.firstRow.exportConfig.type, 'FocusCost')",
                                "type": "Expression"
                              }
                            }
                          },
                          {
                            "name": "Set Hub Dataset",
                            "description": "Map export dataset type to hub folder name (FocusCost  Costs, PriceSheet  Prices, etc.)",
                            "type": "SetVariable",
                            "dependsOn": [
                              {
                                "activity": "Set Dataset Type",
                                "dependencyConditions": [
                                  "Succeeded"
                                ]
                              }
                            ],
                            "policy": {
                              "secureOutput": false,
                              "secureInput": false
                            },
                            "userProperties": [],
                            "typeProperties": {
                              "variableName": "hubDataset",
                              "value": {
                                "value": "@if(equals(toLower(variables('exportDatasetType')), 'focuscost'), 'Costs', if(equals(toLower(variables('exportDatasetType')), 'pricesheet'), 'Prices', if(equals(toLower(variables('exportDatasetType')), 'reservationdetails'), 'CommitmentDiscountUsage', if(equals(toLower(variables('exportDatasetType')), 'reservationrecommendations'), 'Recommendations', if(equals(toLower(variables('exportDatasetType')), 'reservationtransactions'), 'Transactions', if(equals(toLower(variables('exportDatasetType')), 'actualcost'), 'ActualCosts', if(equals(toLower(variables('exportDatasetType')), 'amortizedcost'), 'AmortizedCosts', toLower(variables('exportDatasetType')))))))))",
                                "type": "Expression"
                              }
                            }
                          },
                          {
                            "name": "Set Destination Folder",
                            "description": "Build the destination folder path in ingestion container: {hubDataset}/{yyyy}/{mm}/{scope}",
                            "type": "SetVariable",
                            "dependsOn": [
                              {
                                "activity": "Set Export Scope",
                                "dependencyConditions": [
                                  "Succeeded"
                                ]
                              },
                              {
                                "activity": "Set Hub Dataset",
                                "dependencyConditions": [
                                  "Succeeded"
                                ]
                              }
                            ],
                            "policy": {
                              "secureOutput": false,
                              "secureInput": false
                            },
                            "userProperties": [],
                            "typeProperties": {
                              "variableName": "destinationFolder",
                              "value": {
                                "value": "@replace(concat(variables('hubDataset'), '/', formatDateTime(utcNow(), 'yyyy'), '/', formatDateTime(utcNow(), 'MM'), '/', if(startsWith(variables('scope'), '/'), substring(variables('scope'), 1, sub(length(variables('scope')), 1)), variables('scope'))), '//', '/')",
                                "type": "Expression"
                              }
                            }
                          },
                          {
                            "name": "Set Date",
                            "description": "Extract the date from the manifest",
                            "type": "SetVariable",
                            "dependsOn": [
                              {
                                "activity": "Read Manifest",
                                "dependencyConditions": [
                                  "Succeeded"
                                ]
                              }
                            ],
                            "policy": {
                              "secureOutput": false,
                              "secureInput": false
                            },
                            "userProperties": [],
                            "typeProperties": {
                              "variableName": "date",
                              "value": {
                                "value": "@if(contains(activity('Read Manifest').output.firstRow, 'runInfo'), formatDateTime(activity('Read Manifest').output.firstRow.runInfo.startDate, 'yyyyMMdd'), formatDateTime(utcNow(), 'yyyyMMdd'))",
                                "type": "Expression"
                              }
                            }
                          },
                          {
                            "name": "For Each Blob",
                            "description": "Process each CSV/Parquet file in the export",
                            "type": "ForEach",
                            "dependsOn": [
                              {
                                "activity": "Set Destination Folder",
                                "dependencyConditions": [
                                  "Succeeded"
                                ]
                              },
                              {
                                "activity": "Set Date",
                                "dependencyConditions": [
                                  "Succeeded"
                                ]
                              }
                            ],
                            "userProperties": [],
                            "typeProperties": {
                              "items": {
                                "value": "@activity('Read Manifest').output.firstRow.blobs",
                                "type": "Expression"
                              },
                              "isSequential": false,
                              "batchCount": 20,
                              "activities": [
                                {
                                  "name": "Convert to Ingestion",
                                  "description": "Convert and copy each file to ingestion container",
                                  "type": "ExecutePipeline",
                                  "dependsOn": [],
                                  "policy": {
                                    "secureInput": false
                                  },
                                  "userProperties": [],
                                  "typeProperties": {
                                    "pipeline": {
                                      "referenceName": "[format('{0}_ToIngestion', variables('MSEXPORTS'))]",
                                      "type": "PipelineReference"
                                    },
                                    "waitOnCompletion": true,
                                    "parameters": {
                                      "blobPath": {
                                        "value": "@item().blobName",
                                        "type": "Expression"
                                      },
                                      "destinationFolder": {
                                        "value": "@variables('destinationFolder')",
                                        "type": "Expression"
                                      },
                                      "destinationFile": {
                                        "value": "@last(array(split(replace(replace(item().blobName, '.gz', ''), '.csv', '.parquet'), '/')))",
                                        "type": "Expression"
                                      },
                                      "ingestionId": {
                                        "value": "@activity('Read Manifest').output.firstRow.runInfo.runId",
                                        "type": "Expression"
                                      }
                                    }
                                  }
                                }
                              ]
                            }
                          },
                          {
                            "name": "Copy Manifest",
                            "description": "Copy the manifest to ingestion container to trigger ADX ingestion",
                            "type": "Copy",
                            "dependsOn": [
                              {
                                "activity": "For Each Blob",
                                "dependencyConditions": [
                                  "Succeeded"
                                ]
                              }
                            ],
                            "policy": {
                              "timeout": "0.12:00:00",
                              "retry": 0,
                              "retryIntervalInSeconds": 30,
                              "secureOutput": false,
                              "secureInput": false
                            },
                            "userProperties": [],
                            "typeProperties": {
                              "source": {
                                "type": "JsonSource",
                                "storeSettings": {
                                  "type": "AzureBlobFSReadSettings",
                                  "recursive": true,
                                  "enablePartitionDiscovery": false
                                },
                                "formatSettings": {
                                  "type": "JsonReadSettings"
                                }
                              },
                              "sink": {
                                "type": "JsonSink",
                                "storeSettings": {
                                  "type": "AzureBlobFSWriteSettings"
                                },
                                "formatSettings": {
                                  "type": "JsonWriteSettings"
                                }
                              },
                              "enableStaging": false
                            },
                            "inputs": [
                              {
                                "referenceName": "msexports_manifest",
                                "type": "DatasetReference",
                                "parameters": {
                                  "fileName": "manifest.json",
                                  "folderPath": {
                                    "value": "@pipeline().parameters.folderPath",
                                    "type": "Expression"
                                  }
                                }
                              }
                            ],
                            "outputs": [
                              {
                                "referenceName": "ingestion_manifest",
                                "type": "DatasetReference",
                                "parameters": {
                                  "fileName": "manifest.json",
                                  "folderPath": {
                                    "value": "@variables('destinationFolder')",
                                    "type": "Expression"
                                  }
                                }
                              }
                            ]
                          }
                        ],
                        "parameters": {
                          "folderPath": {
                            "type": "string"
                          },
                          "fileName": {
                            "type": "string"
                          }
                        },
                        "variables": {
                          "scope": {
                            "type": "String"
                          },
                          "exportDatasetType": {
                            "type": "String"
                          },
                          "hubDataset": {
                            "type": "String"
                          },
                          "destinationFolder": {
                            "type": "String"
                          },
                          "date": {
                            "type": "String"
                          }
                        },
                        "annotations": [
                          "FinOps Hub",
                          "Cost Management Exports",
                          "ETL"
                        ]
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.DataFactory/factories/datasets', parameters('dataFactoryName'), 'ingestion_manifest')]",
                        "[resourceId('Microsoft.DataFactory/factories/datasets', parameters('dataFactoryName'), 'msexports_manifest')]",
                        "[resourceId('Microsoft.DataFactory/factories/pipelines', parameters('dataFactoryName'), format('{0}_ToIngestion', variables('MSEXPORTS')))]"
                      ]
                    },
                    {
                      "type": "Microsoft.DataFactory/factories/pipelines",
                      "apiVersion": "2018-06-01",
                      "name": "[format('{0}/{1}', parameters('dataFactoryName'), format('{0}_ToIngestion', variables('MSEXPORTS')))]",
                      "properties": {
                        "activities": [
                          {
                            "name": "Get File Extension",
                            "description": "Determine the file type to process",
                            "type": "SetVariable",
                            "dependsOn": [],
                            "policy": {
                              "secureOutput": false,
                              "secureInput": false
                            },
                            "userProperties": [],
                            "typeProperties": {
                              "variableName": "fileExtension",
                              "value": {
                                "value": "@if(endsWith(toLower(pipeline().parameters.blobPath), '.gz'), 'gz', if(endsWith(toLower(pipeline().parameters.blobPath), '.csv'), 'csv', if(endsWith(toLower(pipeline().parameters.blobPath), '.parquet'), 'parquet', 'unknown')))",
                                "type": "Expression"
                              }
                            }
                          },
                          {
                            "name": "Set Destination Path",
                            "description": "Build the destination file path with ingestion ID",
                            "type": "SetVariable",
                            "dependsOn": [
                              {
                                "activity": "Get File Extension",
                                "dependencyConditions": [
                                  "Succeeded"
                                ]
                              }
                            ],
                            "policy": {
                              "secureOutput": false,
                              "secureInput": false
                            },
                            "userProperties": [],
                            "typeProperties": {
                              "variableName": "destinationPath",
                              "value": {
                                "value": "[format('@concat(pipeline().parameters.destinationFolder, ''/'', pipeline().parameters.ingestionId, ''{0}'', pipeline().parameters.destinationFile)', variables('INGESTION_ID_SEPARATOR'))]",
                                "type": "Expression"
                              }
                            }
                          },
                          {
                            "name": "Switch On File Type",
                            "description": "Handle different file formats",
                            "type": "Switch",
                            "dependsOn": [
                              {
                                "activity": "Set Destination Path",
                                "dependencyConditions": [
                                  "Succeeded"
                                ]
                              }
                            ],
                            "userProperties": [],
                            "typeProperties": {
                              "on": {
                                "value": "@variables('fileExtension')",
                                "type": "Expression"
                              },
                              "cases": [
                                {
                                  "value": "csv",
                                  "activities": [
                                    {
                                      "name": "Convert CSV",
                                      "description": "Convert CSV to Parquet",
                                      "type": "Copy",
                                      "dependsOn": [],
                                      "policy": {
                                        "timeout": "0.00:10:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                      },
                                      "userProperties": [],
                                      "typeProperties": {
                                        "source": {
                                          "type": "DelimitedTextSource",
                                          "storeSettings": {
                                            "type": "AzureBlobFSReadSettings",
                                            "recursive": true,
                                            "wildcardFileName": "*",
                                            "enablePartitionDiscovery": false
                                          },
                                          "formatSettings": {
                                            "type": "DelimitedTextReadSettings"
                                          }
                                        },
                                        "sink": {
                                          "type": "ParquetSink",
                                          "storeSettings": {
                                            "type": "AzureBlobFSWriteSettings"
                                          },
                                          "formatSettings": {
                                            "type": "ParquetWriteSettings",
                                            "fileExtension": ".parquet"
                                          }
                                        },
                                        "enableStaging": false,
                                        "parallelCopies": 1,
                                        "validateDataConsistency": false
                                      },
                                      "inputs": [
                                        {
                                          "referenceName": "[replace(format('{0}', variables('MSEXPORTS')), '-', '_')]",
                                          "type": "DatasetReference",
                                          "parameters": {
                                            "blobPath": {
                                              "value": "@pipeline().parameters.blobPath",
                                              "type": "Expression"
                                            }
                                          }
                                        }
                                      ],
                                      "outputs": [
                                        {
                                          "referenceName": "[variables('INGESTION')]",
                                          "type": "DatasetReference",
                                          "parameters": {
                                            "blobPath": {
                                              "value": "@variables('destinationPath')",
                                              "type": "Expression"
                                            }
                                          }
                                        }
                                      ]
                                    }
                                  ]
                                },
                                {
                                  "value": "gz",
                                  "activities": [
                                    {
                                      "name": "Convert GZip CSV",
                                      "description": "Convert GZip CSV to Parquet",
                                      "type": "Copy",
                                      "dependsOn": [],
                                      "policy": {
                                        "timeout": "0.00:10:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                      },
                                      "userProperties": [],
                                      "typeProperties": {
                                        "source": {
                                          "type": "DelimitedTextSource",
                                          "storeSettings": {
                                            "type": "AzureBlobFSReadSettings",
                                            "recursive": true,
                                            "wildcardFileName": "*",
                                            "enablePartitionDiscovery": false
                                          },
                                          "formatSettings": {
                                            "type": "DelimitedTextReadSettings"
                                          }
                                        },
                                        "sink": {
                                          "type": "ParquetSink",
                                          "storeSettings": {
                                            "type": "AzureBlobFSWriteSettings"
                                          },
                                          "formatSettings": {
                                            "type": "ParquetWriteSettings",
                                            "fileExtension": ".parquet"
                                          }
                                        },
                                        "enableStaging": false,
                                        "parallelCopies": 1,
                                        "validateDataConsistency": false
                                      },
                                      "inputs": [
                                        {
                                          "referenceName": "[format('{0}_gzip', variables('MSEXPORTS'))]",
                                          "type": "DatasetReference",
                                          "parameters": {
                                            "blobPath": {
                                              "value": "@pipeline().parameters.blobPath",
                                              "type": "Expression"
                                            }
                                          }
                                        }
                                      ],
                                      "outputs": [
                                        {
                                          "referenceName": "[variables('INGESTION')]",
                                          "type": "DatasetReference",
                                          "parameters": {
                                            "blobPath": {
                                              "value": "@variables('destinationPath')",
                                              "type": "Expression"
                                            }
                                          }
                                        }
                                      ]
                                    }
                                  ]
                                },
                                {
                                  "value": "parquet",
                                  "activities": [
                                    {
                                      "name": "Copy Parquet",
                                      "description": "Copy Parquet file directly",
                                      "type": "Copy",
                                      "dependsOn": [],
                                      "policy": {
                                        "timeout": "0.00:05:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                      },
                                      "userProperties": [],
                                      "typeProperties": {
                                        "source": {
                                          "type": "ParquetSource",
                                          "storeSettings": {
                                            "type": "AzureBlobFSReadSettings",
                                            "recursive": true,
                                            "wildcardFileName": "*",
                                            "enablePartitionDiscovery": false
                                          },
                                          "formatSettings": {
                                            "type": "ParquetReadSettings"
                                          }
                                        },
                                        "sink": {
                                          "type": "ParquetSink",
                                          "storeSettings": {
                                            "type": "AzureBlobFSWriteSettings"
                                          },
                                          "formatSettings": {
                                            "type": "ParquetWriteSettings",
                                            "fileExtension": ".parquet"
                                          }
                                        },
                                        "enableStaging": false,
                                        "parallelCopies": 1,
                                        "validateDataConsistency": false
                                      },
                                      "inputs": [
                                        {
                                          "referenceName": "[format('{0}_parquet', variables('MSEXPORTS'))]",
                                          "type": "DatasetReference",
                                          "parameters": {
                                            "blobPath": {
                                              "value": "@pipeline().parameters.blobPath",
                                              "type": "Expression"
                                            }
                                          }
                                        }
                                      ],
                                      "outputs": [
                                        {
                                          "referenceName": "[variables('INGESTION')]",
                                          "type": "DatasetReference",
                                          "parameters": {
                                            "blobPath": {
                                              "value": "@variables('destinationPath')",
                                              "type": "Expression"
                                            }
                                          }
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ],
                              "defaultActivities": []
                            }
                          }
                        ],
                        "parameters": {
                          "blobPath": {
                            "type": "string"
                          },
                          "destinationFolder": {
                            "type": "string"
                          },
                          "destinationFile": {
                            "type": "string"
                          },
                          "ingestionId": {
                            "type": "string"
                          }
                        },
                        "variables": {
                          "fileExtension": {
                            "type": "String"
                          },
                          "destinationPath": {
                            "type": "String"
                          }
                        },
                        "annotations": [
                          "FinOps Hub",
                          "ETL",
                          "File Conversion"
                        ]
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.DataFactory/factories/datasets', parameters('dataFactoryName'), variables('INGESTION'))]",
                        "[resourceId('Microsoft.DataFactory/factories/datasets', parameters('dataFactoryName'), replace(format('{0}', variables('MSEXPORTS')), '-', '_'))]",
                        "[resourceId('Microsoft.DataFactory/factories/datasets', parameters('dataFactoryName'), format('{0}_gzip', variables('MSEXPORTS')))]",
                        "[resourceId('Microsoft.DataFactory/factories/datasets', parameters('dataFactoryName'), format('{0}_parquet', variables('MSEXPORTS')))]"
                      ]
                    },
                    {
                      "condition": "[variables('useAnalytics')]",
                      "type": "Microsoft.DataFactory/factories/pipelines",
                      "apiVersion": "2018-06-01",
                      "name": "[format('{0}/{1}', parameters('dataFactoryName'), format('{0}_ExecuteETL', variables('INGESTION')))]",
                      "properties": {
                        "concurrency": 1,
                        "activities": [
                          {
                            "name": "Wait",
                            "description": "Wait for files to be fully available",
                            "type": "Wait",
                            "dependsOn": [],
                            "userProperties": [],
                            "typeProperties": {
                              "waitTimeInSeconds": 60
                            }
                          },
                          {
                            "name": "Set Container Folder Path",
                            "type": "SetVariable",
                            "dependsOn": [
                              {
                                "activity": "Wait",
                                "dependencyConditions": [
                                  "Succeeded"
                                ]
                              }
                            ],
                            "policy": {
                              "secureOutput": false,
                              "secureInput": false
                            },
                            "userProperties": [],
                            "typeProperties": {
                              "variableName": "containerFolderPath",
                              "value": {
                                "value": "@join(skip(array(split(pipeline().parameters.folderPath, '/')), 1), '/')",
                                "type": "Expression"
                              }
                            }
                          },
                          {
                            "name": "Get Parquet Files",
                            "description": "List all parquet files to ingest",
                            "type": "GetMetadata",
                            "dependsOn": [
                              {
                                "activity": "Set Container Folder Path",
                                "dependencyConditions": [
                                  "Succeeded"
                                ]
                              }
                            ],
                            "policy": {
                              "timeout": "0.12:00:00",
                              "retry": 0,
                              "retryIntervalInSeconds": 30,
                              "secureOutput": false,
                              "secureInput": false
                            },
                            "userProperties": [],
                            "typeProperties": {
                              "dataset": {
                                "referenceName": "[format('{0}_files', variables('INGESTION'))]",
                                "type": "DatasetReference",
                                "parameters": {
                                  "folderPath": "@variables('containerFolderPath')"
                                }
                              },
                              "fieldList": [
                                "childItems"
                              ],
                              "storeSettings": {
                                "type": "AzureBlobFSReadSettings",
                                "enablePartitionDiscovery": false
                              },
                              "formatSettings": {
                                "type": "ParquetReadSettings"
                              }
                            }
                          },
                          {
                            "name": "Filter Parquet Files",
                            "description": "Filter to only parquet files",
                            "type": "Filter",
                            "dependsOn": [
                              {
                                "activity": "Get Parquet Files",
                                "dependencyConditions": [
                                  "Succeeded"
                                ]
                              }
                            ],
                            "userProperties": [],
                            "typeProperties": {
                              "items": {
                                "value": "@activity('Get Parquet Files').output.childItems",
                                "type": "Expression"
                              },
                              "condition": {
                                "value": "@and(equals(item().type, 'File'), endsWith(item().name, '.parquet'))",
                                "type": "Expression"
                              }
                            }
                          },
                          {
                            "name": "For Each Parquet File",
                            "description": "Ingest each parquet file to Data Explorer",
                            "type": "ForEach",
                            "dependsOn": [
                              {
                                "activity": "Filter Parquet Files",
                                "dependencyConditions": [
                                  "Succeeded"
                                ]
                              }
                            ],
                            "userProperties": [],
                            "typeProperties": {
                              "items": {
                                "value": "@activity('Filter Parquet Files').output.Value",
                                "type": "Expression"
                              },
                              "isSequential": false,
                              "batchCount": 10,
                              "activities": [
                                {
                                  "name": "Execute ADX ETL",
                                  "description": "Run the ADX ingestion pipeline",
                                  "type": "ExecutePipeline",
                                  "dependsOn": [],
                                  "policy": {
                                    "secureInput": false
                                  },
                                  "userProperties": [],
                                  "typeProperties": {
                                    "pipeline": {
                                      "referenceName": "ingestion_ETL_dataExplorer",
                                      "type": "PipelineReference"
                                    },
                                    "waitOnCompletion": true,
                                    "parameters": {
                                      "folderPath": {
                                        "value": "@variables('containerFolderPath')",
                                        "type": "Expression"
                                      },
                                      "fileName": {
                                        "value": "@item().name",
                                        "type": "Expression"
                                      },
                                      "table": {
                                        "value": "@concat(first(split(variables('containerFolderPath'), '/')), '_raw')",
                                        "type": "Expression"
                                      }
                                    }
                                  }
                                }
                              ]
                            }
                          }
                        ],
                        "parameters": {
                          "folderPath": {
                            "type": "string"
                          }
                        },
                        "variables": {
                          "containerFolderPath": {
                            "type": "String"
                          }
                        },
                        "annotations": [
                          "FinOps Hub",
                          "Data Explorer",
                          "Ingestion"
                        ]
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.DataFactory/factories/datasets', parameters('dataFactoryName'), format('{0}_files', variables('INGESTION')))]"
                      ]
                    },
                    {
                      "condition": "[variables('useAnalytics')]",
                      "type": "Microsoft.DataFactory/factories/pipelines",
                      "apiVersion": "2018-06-01",
                      "name": "[format('{0}/{1}', parameters('dataFactoryName'), format('{0}_ETL_dataExplorer', variables('INGESTION')))]",
                      "properties": {
                        "activities": [
                          {
                            "name": "Set Ingestion Policy",
                            "description": "Configure ADX managed identity policy to allow NativeIngestion using the cluster system identity",
                            "type": "AzureDataExplorerCommand",
                            "dependsOn": [],
                            "policy": {
                              "timeout": "0.12:00:00",
                              "retry": 0,
                              "retryIntervalInSeconds": 30,
                              "secureOutput": false,
                              "secureInput": false
                            },
                            "typeProperties": {
                              "command": "[if(variables('useDataExplorer'), format('.alter-merge database Ingestion policy managed_identity ```[{{ \"ObjectId\" : \"{0}\", \"AllowedUsages\" : \"NativeIngestion\" }}]```', parameters('dataExplorerPrincipalId')), '.show database Ingestion policy managed_identity')]",
                              "commandTimeout": "00:20:00"
                            },
                            "linkedServiceName": {
                              "referenceName": "dataExplorer",
                              "type": "LinkedServiceReference",
                              "parameters": {
                                "database": "Ingestion"
                              }
                            }
                          },
                          {
                            "name": "Ingest to Data Explorer",
                            "description": "Ingest parquet file into Data Explorer",
                            "type": "AzureDataExplorerCommand",
                            "dependsOn": [
                              {
                                "activity": "Set Ingestion Policy",
                                "dependencyConditions": [
                                  "Succeeded"
                                ]
                              }
                            ],
                            "policy": {
                              "timeout": "0.12:00:00",
                              "retry": 2,
                              "retryIntervalInSeconds": 30,
                              "secureOutput": false,
                              "secureInput": false
                            },
                            "typeProperties": {
                              "command": {
                                "value": "[format('@concat(''.ingest into table '', pipeline().parameters.table, '' (\"abfss://{0}@{1}.dfs.{2}/'', pipeline().parameters.folderPath, ''/'', pipeline().parameters.fileName, '';{3}\") with (format=\"parquet\", ingestionMappingReference=\"'', pipeline().parameters.table, ''_mapping\", tags=\"[\\\"drop-by:'', pipeline().parameters.folderPath, ''/'', pipeline().parameters.fileName, ''\\\"]\")'')', variables('INGESTION'), parameters('storageAccountName'), environment().suffixes.storage, variables('ingestionAuthMethod'))]",
                                "type": "Expression"
                              },
                              "commandTimeout": "01:00:00"
                            },
                            "linkedServiceName": {
                              "referenceName": "dataExplorer",
                              "type": "LinkedServiceReference",
                              "parameters": {
                                "database": "Ingestion"
                              }
                            }
                          }
                        ],
                        "parameters": {
                          "folderPath": {
                            "type": "string"
                          },
                          "fileName": {
                            "type": "string"
                          },
                          "table": {
                            "type": "string"
                          }
                        },
                        "annotations": [
                          "FinOps Hub",
                          "Data Explorer",
                          "KQL Ingestion"
                        ]
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.DataFactory/factories/linkedservices', parameters('dataFactoryName'), 'dataExplorer')]"
                      ]
                    },
                    {
                      "condition": "[variables('useMacc')]",
                      "type": "Microsoft.DataFactory/factories/pipelines",
                      "apiVersion": "2018-06-01",
                      "name": "[format('{0}/{1}', parameters('dataFactoryName'), 'macc_FetchLots')]",
                      "properties": {
                        "description": "Fetches Microsoft Azure Consumption Commitment (MACC) lots from the Azure Consumption API and ingests into ADX.",
                        "activities": [
                          {
                            "name": "Fetch MACC Lots",
                            "description": "Call Azure Consumption Lots API to get MACC data",
                            "type": "WebActivity",
                            "dependsOn": [],
                            "policy": {
                              "timeout": "0.12:00:00",
                              "retry": 2,
                              "retryIntervalInSeconds": 30,
                              "secureOutput": false,
                              "secureInput": false
                            },
                            "userProperties": [],
                            "typeProperties": {
                              "url": "https://management.azure.com/providers/Microsoft.Billing/billingAccounts/@{pipeline().parameters.billingAccountId}/providers/Microsoft.Consumption/lots?api-version=2021-05-01&$filter=source%20eq%20%27ConsumptionCommitment%27",
                              "method": "GET",
                              "authentication": {
                                "type": "MSI",
                                "resource": "https://management.azure.com/"
                              }
                            }
                          },
                          {
                            "name": "For Each Lot",
                            "description": "Process each MACC lot",
                            "type": "ForEach",
                            "dependsOn": [
                              {
                                "activity": "Fetch MACC Lots",
                                "dependencyConditions": [
                                  "Succeeded"
                                ]
                              }
                            ],
                            "userProperties": [],
                            "typeProperties": {
                              "items": {
                                "value": "@activity('Fetch MACC Lots').output.value",
                                "type": "Expression"
                              },
                              "isSequential": false,
                              "batchCount": 10,
                              "activities": [
                                {
                                  "name": "Ingest Lot to ADX",
                                  "description": "Ingest MACC lot data into ADX",
                                  "type": "AzureDataExplorerCommand",
                                  "dependsOn": [],
                                  "policy": {
                                    "timeout": "0.12:00:00",
                                    "retry": 0,
                                    "retryIntervalInSeconds": 30,
                                    "secureOutput": false,
                                    "secureInput": false
                                  },
                                  "typeProperties": {
                                    "command": {
                                      "value": "@concat('.set-or-append MACC_Lots_raw <| print LotId=\"', item().name, '\", BillingAccountId=\"', pipeline().parameters.billingAccountId, '\", BillingAccountName=\"\", Status=\"', item().properties.status, '\", PurchasedDate=todatetime(\"', item().properties.purchasedDate, '\"), StartDate=todatetime(\"', item().properties.startDate, '\"), ExpirationDate=todatetime(\"', item().properties.expirationDate, '\"), OriginalAmount=', item().properties.originalAmount.value, ', OriginalCurrency=\"', item().properties.originalAmount.currency, '\", ClosedBalance=', item().properties.closedBalance.value, ', ClosedBalanceCurrency=\"', item().properties.closedBalance.currency, '\", ETag=\"\", x_SourceName=\"Cost Management\", x_SourceProvider=\"Microsoft\", x_SourceType=\"ConsumptionLots\", x_SourceVersion=\"2021-05-01\"')",
                                      "type": "Expression"
                                    },
                                    "commandTimeout": "00:20:00"
                                  },
                                  "linkedServiceName": {
                                    "referenceName": "dataExplorer",
                                    "type": "LinkedServiceReference",
                                    "parameters": {
                                      "database": "Ingestion"
                                    }
                                  }
                                }
                              ]
                            }
                          }
                        ],
                        "parameters": {
                          "billingAccountId": {
                            "type": "string",
                            "defaultValue": "[parameters('billingAccountId')]"
                          }
                        },
                        "annotations": "[union(variables('hubAnnotations'), createArray('MACC', 'Consumption Commitment'))]"
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.DataFactory/factories/linkedservices', parameters('dataFactoryName'), 'dataExplorer')]"
                      ]
                    },
                    {
                      "condition": "[variables('useMacc')]",
                      "type": "Microsoft.DataFactory/factories/pipelines",
                      "apiVersion": "2018-06-01",
                      "name": "[format('{0}/{1}', parameters('dataFactoryName'), 'macc_FetchEvents')]",
                      "properties": {
                        "description": "Fetches Microsoft Azure Consumption Commitment (MACC) events from the Azure Consumption API and ingests into ADX.",
                        "activities": [
                          {
                            "name": "Fetch MACC Events",
                            "description": "Call Azure Consumption Events API to get MACC decrement events",
                            "type": "WebActivity",
                            "dependsOn": [],
                            "policy": {
                              "timeout": "0.12:00:00",
                              "retry": 2,
                              "retryIntervalInSeconds": 30,
                              "secureOutput": false,
                              "secureInput": false
                            },
                            "userProperties": [],
                            "typeProperties": {
                              "url": "@concat('https://management.azure.com/providers/Microsoft.Billing/billingAccounts/', pipeline().parameters.billingAccountId, '/providers/Microsoft.Consumption/events?api-version=2021-05-01&startDate=', pipeline().parameters.startDate, '&endDate=', pipeline().parameters.endDate, '&$filter=lotsource%20eq%20%27ConsumptionCommitment%27')",
                              "method": "GET",
                              "authentication": {
                                "type": "MSI",
                                "resource": "https://management.azure.com/"
                              }
                            }
                          },
                          {
                            "name": "For Each Event",
                            "description": "Process each MACC event",
                            "type": "ForEach",
                            "dependsOn": [
                              {
                                "activity": "Fetch MACC Events",
                                "dependencyConditions": [
                                  "Succeeded"
                                ]
                              }
                            ],
                            "userProperties": [],
                            "typeProperties": {
                              "items": {
                                "value": "@activity('Fetch MACC Events').output.value",
                                "type": "Expression"
                              },
                              "isSequential": false,
                              "batchCount": 10,
                              "activities": [
                                {
                                  "name": "Ingest Event to ADX",
                                  "description": "Ingest MACC event data into ADX",
                                  "type": "AzureDataExplorerCommand",
                                  "dependsOn": [],
                                  "policy": {
                                    "timeout": "0.12:00:00",
                                    "retry": 0,
                                    "retryIntervalInSeconds": 30,
                                    "secureOutput": false,
                                    "secureInput": false
                                  },
                                  "typeProperties": {
                                    "command": {
                                      "value": "@concat('.set-or-append MACC_Events_raw <| print EventId=\"', item().name, '\", BillingAccountId=\"', pipeline().parameters.billingAccountId, '\", BillingProfileId=\"', coalesce(item().properties.billingProfileId, ''), '\", BillingProfileDisplayName=\"', coalesce(item().properties.billingProfileDisplayName, ''), '\", LotId=\"', item().properties.lotId, '\", LotSource=\"', item().properties.lotSource, '\", TransactionDate=todatetime(\"', item().properties.transactionDate, '\"), Description=\"', replace(item().properties.description, '\"', ''), '\", EventType=\"', item().properties.eventType, '\", InvoiceNumber=\"', coalesce(item().properties.invoiceNumber, ''), '\", Charges=', item().properties.charges.value, ', ChargesCurrency=\"', item().properties.charges.currency, '\", ClosedBalance=', item().properties.closedBalance.value, ', ClosedBalanceCurrency=\"', item().properties.closedBalance.currency, '\", ETag=\"\", x_SourceName=\"Cost Management\", x_SourceProvider=\"Microsoft\", x_SourceType=\"ConsumptionEvents\", x_SourceVersion=\"2021-05-01\"')",
                                      "type": "Expression"
                                    },
                                    "commandTimeout": "00:20:00"
                                  },
                                  "linkedServiceName": {
                                    "referenceName": "dataExplorer",
                                    "type": "LinkedServiceReference",
                                    "parameters": {
                                      "database": "Ingestion"
                                    }
                                  }
                                }
                              ]
                            }
                          }
                        ],
                        "parameters": {
                          "billingAccountId": {
                            "type": "string",
                            "defaultValue": "[parameters('billingAccountId')]"
                          },
                          "startDate": {
                            "type": "string",
                            "defaultValue": "@formatDateTime(addDays(utcNow(), -730), 'yyyy-MM-dd')"
                          },
                          "endDate": {
                            "type": "string",
                            "defaultValue": "@formatDateTime(utcNow(), 'yyyy-MM-dd')"
                          }
                        },
                        "annotations": "[union(variables('hubAnnotations'), createArray('MACC', 'Consumption Commitment'))]"
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.DataFactory/factories/linkedservices', parameters('dataFactoryName'), 'dataExplorer')]"
                      ]
                    },
                    {
                      "condition": "[variables('useMacc')]",
                      "type": "Microsoft.DataFactory/factories/pipelines",
                      "apiVersion": "2018-06-01",
                      "name": "[format('{0}/{1}', parameters('dataFactoryName'), 'macc_SyncAll')]",
                      "properties": {
                        "description": "Syncs all MACC (Microsoft Azure Consumption Commitment) data - lots and events.",
                        "activities": [
                          {
                            "name": "Sync MACC Lots",
                            "description": "Fetch and ingest MACC lot data",
                            "type": "ExecutePipeline",
                            "dependsOn": [],
                            "policy": {
                              "secureInput": false
                            },
                            "userProperties": [],
                            "typeProperties": {
                              "pipeline": {
                                "referenceName": "macc_FetchLots",
                                "type": "PipelineReference"
                              },
                              "waitOnCompletion": true,
                              "parameters": {
                                "billingAccountId": {
                                  "value": "@pipeline().parameters.billingAccountId",
                                  "type": "Expression"
                                }
                              }
                            }
                          },
                          {
                            "name": "Sync MACC Events",
                            "description": "Fetch and ingest MACC event data",
                            "type": "ExecutePipeline",
                            "dependsOn": [
                              {
                                "activity": "Sync MACC Lots",
                                "dependencyConditions": [
                                  "Succeeded"
                                ]
                              }
                            ],
                            "policy": {
                              "secureInput": false
                            },
                            "userProperties": [],
                            "typeProperties": {
                              "pipeline": {
                                "referenceName": "macc_FetchEvents",
                                "type": "PipelineReference"
                              },
                              "waitOnCompletion": true,
                              "parameters": {
                                "billingAccountId": {
                                  "value": "@pipeline().parameters.billingAccountId",
                                  "type": "Expression"
                                },
                                "startDate": {
                                  "value": "@pipeline().parameters.startDate",
                                  "type": "Expression"
                                },
                                "endDate": {
                                  "value": "@pipeline().parameters.endDate",
                                  "type": "Expression"
                                }
                              }
                            }
                          }
                        ],
                        "parameters": {
                          "billingAccountId": {
                            "type": "string",
                            "defaultValue": "[parameters('billingAccountId')]"
                          },
                          "startDate": {
                            "type": "string",
                            "defaultValue": "@formatDateTime(addDays(utcNow(), -730), 'yyyy-MM-dd')"
                          },
                          "endDate": {
                            "type": "string",
                            "defaultValue": "@formatDateTime(utcNow(), 'yyyy-MM-dd')"
                          }
                        },
                        "annotations": "[union(variables('hubAnnotations'), createArray('MACC', 'Consumption Commitment', 'Master Sync'))]"
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.DataFactory/factories/pipelines', parameters('dataFactoryName'), 'macc_FetchEvents')]",
                        "[resourceId('Microsoft.DataFactory/factories/pipelines', parameters('dataFactoryName'), 'macc_FetchLots')]"
                      ]
                    },
                    {
                      "type": "Microsoft.DataFactory/factories/triggers",
                      "apiVersion": "2018-06-01",
                      "name": "[format('{0}/{1}', parameters('dataFactoryName'), format('{0}_ManifestAdded', variables('MSEXPORTS')))]",
                      "properties": {
                        "annotations": [],
                        "pipelines": [
                          {
                            "pipelineReference": {
                              "referenceName": "[format('{0}_ExecuteETL', variables('MSEXPORTS'))]",
                              "type": "PipelineReference"
                            },
                            "parameters": {
                              "folderPath": "@triggerBody().folderPath",
                              "fileName": "@triggerBody().fileName"
                            }
                          }
                        ],
                        "type": "BlobEventsTrigger",
                        "typeProperties": {
                          "blobPathBeginsWith": "[format('/{0}/blobs/', variables('MSEXPORTS'))]",
                          "blobPathEndsWith": "manifest.json",
                          "ignoreEmptyBlobs": true,
                          "scope": "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]",
                          "events": [
                            "Microsoft.Storage.BlobCreated"
                          ]
                        }
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.DataFactory/factories/pipelines', parameters('dataFactoryName'), format('{0}_ExecuteETL', variables('MSEXPORTS')))]"
                      ]
                    },
                    {
                      "condition": "[variables('useAnalytics')]",
                      "type": "Microsoft.DataFactory/factories/triggers",
                      "apiVersion": "2018-06-01",
                      "name": "[format('{0}/{1}', parameters('dataFactoryName'), format('{0}_ManifestAdded', variables('INGESTION')))]",
                      "properties": {
                        "annotations": [],
                        "pipelines": [
                          {
                            "pipelineReference": {
                              "referenceName": "[format('{0}_ExecuteETL', variables('INGESTION'))]",
                              "type": "PipelineReference"
                            },
                            "parameters": {
                              "folderPath": "@triggerBody().folderPath"
                            }
                          }
                        ],
                        "type": "BlobEventsTrigger",
                        "typeProperties": {
                          "blobPathBeginsWith": "[format('/{0}/', variables('INGESTION'))]",
                          "blobPathEndsWith": "manifest.json",
                          "ignoreEmptyBlobs": true,
                          "scope": "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]",
                          "events": [
                            "Microsoft.Storage.BlobCreated"
                          ]
                        }
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.DataFactory/factories/pipelines', parameters('dataFactoryName'), format('{0}_ExecuteETL', variables('INGESTION')))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "pipelineNames": {
                      "type": "array",
                      "metadata": {
                        "description": "List of pipelines created."
                      },
                      "value": "[if(variables('useMacc'), createArray(format('{0}_ExecuteETL', variables('MSEXPORTS')), format('{0}_ETL_{1}', variables('MSEXPORTS'), variables('INGESTION')), format('{0}_ToIngestion', variables('MSEXPORTS')), format('{0}_ExecuteETL', variables('INGESTION')), format('{0}_ETL_dataExplorer', variables('INGESTION')), 'macc_FetchLots', 'macc_FetchEvents', 'macc_SyncAll'), if(variables('useAnalytics'), createArray(format('{0}_ExecuteETL', variables('MSEXPORTS')), format('{0}_ETL_{1}', variables('MSEXPORTS'), variables('INGESTION')), format('{0}_ToIngestion', variables('MSEXPORTS')), format('{0}_ExecuteETL', variables('INGESTION')), format('{0}_ETL_dataExplorer', variables('INGESTION'))), createArray(format('{0}_ExecuteETL', variables('MSEXPORTS')), format('{0}_ETL_{1}', variables('MSEXPORTS'), variables('INGESTION')), format('{0}_ToIngestion', variables('MSEXPORTS')))))]"
                    },
                    "triggerNames": {
                      "type": "array",
                      "metadata": {
                        "description": "List of triggers created."
                      },
                      "value": "[if(variables('useAnalytics'), createArray(format('{0}_ManifestAdded', variables('MSEXPORTS')), format('{0}_ManifestAdded', variables('INGESTION'))), createArray(format('{0}_ManifestAdded', variables('MSEXPORTS'))))]"
                    },
                    "analyticsPlatform": {
                      "type": "string",
                      "metadata": {
                        "description": "Analytics platform being used (adx, fabric, or none)."
                      },
                      "value": "[if(variables('useDataExplorer'), 'adx', if(variables('useFabric'), 'fabric', 'none'))]"
                    },
                    "maccEnabled": {
                      "type": "bool",
                      "metadata": {
                        "description": "Whether MACC pipelines are enabled."
                      },
                      "value": "[variables('useMacc')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "adfKeyVaultRoleAssignment",
                "adfStorageRoleAssignment",
                "dataExplorer",
                "dataFactory",
                "keyVault",
                "stopTriggers",
                "storageAccount"
              ]
            },
            "managedExportsPipelines": {
              "condition": "[variables('enableManagedExports')]",
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-managed-exports', uniqueString(deployment().name, parameters('location')))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "dataFactoryName": {
                    "value": "[reference('dataFactory').outputs.name.value]"
                  },
                  "storageAccountName": {
                    "value": "[reference('storageAccount').outputs.name.value]"
                  },
                  "hubName": {
                    "value": "[parameters('hubName')]"
                  },
                  "ftkVersion": {
                    "value": "[variables('ftkVersion')]"
                  },
                  "integrationRuntimeName": "[if(variables('effectiveAdfManagedVnet'), createObject('value', 'FinOpsHubManagedIR'), createObject('value', ''))]"
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.40.2.10011",
                      "templateHash": "2296206552585661183"
                    }
                  },
                  "parameters": {
                    "dataFactoryName": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. Name of the Data Factory."
                      }
                    },
                    "storageAccountName": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. Name of the storage account."
                      }
                    },
                    "integrationRuntimeName": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Optional. Name of the integration runtime to use."
                      }
                    },
                    "ftkVersion": {
                      "type": "string",
                      "defaultValue": "0.7.0",
                      "metadata": {
                        "description": "Optional. FinOps toolkit version."
                      }
                    },
                    "hubName": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. Hub name for export naming."
                      }
                    }
                  },
                  "variables": {
                    "CONFIG": "config",
                    "MSEXPORTS": "msexports",
                    "exportsApiVersion": "2023-07-01-preview",
                    "hubAnnotations": [
                      "FinOps Hub",
                      "[format('ftk-version-{0}', parameters('ftkVersion'))]",
                      "ManagedExports"
                    ]
                  },
                  "resources": [
                    {
                      "type": "Microsoft.DataFactory/factories/datasets",
                      "apiVersion": "2018-06-01",
                      "name": "[format('{0}/{1}', parameters('dataFactoryName'), format('{0}_json', variables('CONFIG')))]",
                      "properties": {
                        "type": "Json",
                        "linkedServiceName": {
                          "referenceName": "[parameters('storageAccountName')]",
                          "type": "LinkedServiceReference"
                        },
                        "parameters": {
                          "fileName": {
                            "type": "String",
                            "defaultValue": "settings.json"
                          },
                          "folderPath": {
                            "type": "String",
                            "defaultValue": "[variables('CONFIG')]"
                          }
                        },
                        "typeProperties": {
                          "location": {
                            "type": "AzureBlobFSLocation",
                            "fileName": {
                              "value": "@dataset().fileName",
                              "type": "Expression"
                            },
                            "folderPath": {
                              "value": "@dataset().folderPath",
                              "type": "Expression"
                            },
                            "fileSystem": "[variables('CONFIG')]"
                          }
                        },
                        "annotations": "[variables('hubAnnotations')]"
                      }
                    },
                    {
                      "type": "Microsoft.DataFactory/factories/pipelines",
                      "apiVersion": "2018-06-01",
                      "name": "[format('{0}/{1}', parameters('dataFactoryName'), format('{0}_ConfigureExports', variables('CONFIG')))]",
                      "properties": {
                        "description": "Reads scopes from settings.json and creates/updates Cost Management exports for each scope. Only works with EA/MCA/MPA billing accounts.",
                        "activities": [
                          {
                            "name": "Get Config",
                            "type": "Lookup",
                            "dependsOn": [],
                            "policy": {
                              "timeout": "0.00:05:00",
                              "retry": 2,
                              "retryIntervalInSeconds": 30,
                              "secureOutput": false,
                              "secureInput": false
                            },
                            "userProperties": [],
                            "typeProperties": {
                              "source": {
                                "type": "JsonSource",
                                "storeSettings": {
                                  "type": "AzureBlobFSReadSettings",
                                  "recursive": true,
                                  "enablePartitionDiscovery": false
                                },
                                "formatSettings": {
                                  "type": "JsonReadSettings"
                                }
                              },
                              "dataset": {
                                "referenceName": "[format('{0}_json', variables('CONFIG'))]",
                                "type": "DatasetReference",
                                "parameters": {
                                  "fileName": "settings.json",
                                  "folderPath": "[variables('CONFIG')]"
                                }
                              }
                            }
                          },
                          {
                            "name": "Check Export Support",
                            "type": "IfCondition",
                            "dependsOn": [
                              {
                                "activity": "Get Config",
                                "dependencyConditions": [
                                  "Succeeded"
                                ]
                              }
                            ],
                            "userProperties": [],
                            "typeProperties": {
                              "expression": {
                                "value": "@and(not(empty(activity('Get Config').output.firstRow.deployment.billingType)), or(or(equals(activity('Get Config').output.firstRow.deployment.billingType, 'ea'), equals(activity('Get Config').output.firstRow.deployment.billingType, 'mca')), equals(activity('Get Config').output.firstRow.deployment.billingType, 'mpa')))",
                                "type": "Expression"
                              },
                              "ifTrueActivities": [
                                {
                                  "name": "Set Scopes",
                                  "type": "SetVariable",
                                  "dependsOn": [],
                                  "policy": {
                                    "secureOutput": false,
                                    "secureInput": false
                                  },
                                  "userProperties": [],
                                  "typeProperties": {
                                    "variableName": "scopesArray",
                                    "value": {
                                      "value": "@if(equals(string(activity('Get Config').output.firstRow.scopes), '[]'), json('[]'), activity('Get Config').output.firstRow.scopes)",
                                      "type": "Expression"
                                    }
                                  }
                                },
                                {
                                  "name": "ForEach Scope",
                                  "type": "ForEach",
                                  "dependsOn": [
                                    {
                                      "activity": "Set Scopes",
                                      "dependencyConditions": [
                                        "Succeeded"
                                      ]
                                    }
                                  ],
                                  "userProperties": [],
                                  "typeProperties": {
                                    "items": {
                                      "value": "@variables('scopesArray')",
                                      "type": "Expression"
                                    },
                                    "isSequential": true,
                                    "activities": [
                                      {
                                        "name": "Create Daily Cost Export",
                                        "type": "WebActivity",
                                        "dependsOn": [],
                                        "policy": {
                                          "timeout": "0.00:05:00",
                                          "retry": 2,
                                          "retryIntervalInSeconds": 30,
                                          "secureOutput": false,
                                          "secureInput": false
                                        },
                                        "userProperties": [],
                                        "typeProperties": {
                                          "url": {
                                            "value": "[format('@concat(environment().resourceManager, item().scope, ''/providers/Microsoft.CostManagement/exports/{0}-daily-focuscost?api-version={1}'')', parameters('hubName'), variables('exportsApiVersion'))]",
                                            "type": "Expression"
                                          },
                                          "method": "PUT",
                                          "body": {
                                            "value": "[format('@json(concat(''{{\"properties\":{{\"schedule\":{{\"status\":\"Active\",\"recurrence\":\"Daily\",\"recurrencePeriod\":{{\"from\":\"'', formatDateTime(utcNow(), ''yyyy-MM-dd''), ''T00:00:00Z\",\"to\":\"2099-12-31T23:59:59Z\"}}}},\"format\":\"Parquet\",\"deliveryInfo\":{{\"destination\":{{\"resourceId\":\"{0}\",\"container\":\"{1}\",\"rootFolderPath\":\"'', replace(item().scope, ''/providers/Microsoft.Billing/'', ''''), ''\"}}}},\"definition\":{{\"type\":\"FocusCost\",\"timeframe\":\"MonthToDate\",\"dataSet\":{{\"granularity\":\"Daily\"}}}},\"partitionData\":true}}}}''))', resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName')), variables('MSEXPORTS'))]",
                                            "type": "Expression"
                                          },
                                          "headers": {
                                            "x-ms-command-name": "[format('FinOpsToolkit.Hubs.config_ConfigureExports.DailyCost@{0}', parameters('ftkVersion'))]",
                                            "ClientType": "[format('FinOpsToolkit.Hubs@{0}', parameters('ftkVersion'))]"
                                          },
                                          "authentication": {
                                            "type": "MSI",
                                            "resource": {
                                              "value": "@environment().resourceManager",
                                              "type": "Expression"
                                            }
                                          }
                                        }
                                      },
                                      {
                                        "name": "Create Monthly Cost Export",
                                        "type": "WebActivity",
                                        "dependsOn": [
                                          {
                                            "activity": "Create Daily Cost Export",
                                            "dependencyConditions": [
                                              "Succeeded"
                                            ]
                                          }
                                        ],
                                        "policy": {
                                          "timeout": "0.00:05:00",
                                          "retry": 2,
                                          "retryIntervalInSeconds": 30,
                                          "secureOutput": false,
                                          "secureInput": false
                                        },
                                        "userProperties": [],
                                        "typeProperties": {
                                          "url": {
                                            "value": "[format('@concat(environment().resourceManager, item().scope, ''/providers/Microsoft.CostManagement/exports/{0}-monthly-focuscost?api-version={1}'')', parameters('hubName'), variables('exportsApiVersion'))]",
                                            "type": "Expression"
                                          },
                                          "method": "PUT",
                                          "body": {
                                            "value": "[format('@json(concat(''{{\"properties\":{{\"schedule\":{{\"status\":\"Active\",\"recurrence\":\"Monthly\",\"recurrencePeriod\":{{\"from\":\"'', formatDateTime(utcNow(), ''yyyy-MM-dd''), ''T00:00:00Z\",\"to\":\"2099-12-31T23:59:59Z\"}}}},\"format\":\"Parquet\",\"deliveryInfo\":{{\"destination\":{{\"resourceId\":\"{0}\",\"container\":\"{1}\",\"rootFolderPath\":\"'', replace(item().scope, ''/providers/Microsoft.Billing/'', ''''), ''\"}}}},\"definition\":{{\"type\":\"FocusCost\",\"timeframe\":\"TheLastMonth\",\"dataSet\":{{\"granularity\":\"Daily\"}}}},\"partitionData\":true}}}}''))', resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName')), variables('MSEXPORTS'))]",
                                            "type": "Expression"
                                          },
                                          "headers": {
                                            "x-ms-command-name": "[format('FinOpsToolkit.Hubs.config_ConfigureExports.MonthlyCost@{0}', parameters('ftkVersion'))]",
                                            "ClientType": "[format('FinOpsToolkit.Hubs@{0}', parameters('ftkVersion'))]"
                                          },
                                          "authentication": {
                                            "type": "MSI",
                                            "resource": {
                                              "value": "@environment().resourceManager",
                                              "type": "Expression"
                                            }
                                          }
                                        }
                                      },
                                      {
                                        "name": "Run Daily Export",
                                        "type": "WebActivity",
                                        "dependsOn": [
                                          {
                                            "activity": "Create Monthly Cost Export",
                                            "dependencyConditions": [
                                              "Succeeded"
                                            ]
                                          }
                                        ],
                                        "policy": {
                                          "timeout": "0.00:05:00",
                                          "retry": 2,
                                          "retryIntervalInSeconds": 30,
                                          "secureOutput": false,
                                          "secureInput": false
                                        },
                                        "userProperties": [],
                                        "typeProperties": {
                                          "url": {
                                            "value": "[format('@concat(environment().resourceManager, item().scope, ''/providers/Microsoft.CostManagement/exports/{0}-daily-focuscost/run?api-version={1}'')', parameters('hubName'), variables('exportsApiVersion'))]",
                                            "type": "Expression"
                                          },
                                          "method": "POST",
                                          "body": " ",
                                          "headers": {
                                            "x-ms-command-name": "[format('FinOpsToolkit.Hubs.config_ConfigureExports.RunExport@{0}', parameters('ftkVersion'))]",
                                            "ClientType": "[format('FinOpsToolkit.Hubs@{0}', parameters('ftkVersion'))]"
                                          },
                                          "authentication": {
                                            "type": "MSI",
                                            "resource": {
                                              "value": "@environment().resourceManager",
                                              "type": "Expression"
                                            }
                                          }
                                        }
                                      }
                                    ]
                                  }
                                }
                              ],
                              "ifFalseActivities": [
                                {
                                  "name": "Log Skipped",
                                  "type": "SetVariable",
                                  "dependsOn": [],
                                  "policy": {
                                    "secureOutput": false,
                                    "secureInput": false
                                  },
                                  "userProperties": [],
                                  "typeProperties": {
                                    "variableName": "skippedReason",
                                    "value": {
                                      "value": "@concat('Export configuration skipped: Billing type ', coalesce(activity('Get Config').output.firstRow.deployment.billingType, 'unknown'), ' does not support managed exports. Use Demo mode with test data scripts.')",
                                      "type": "Expression"
                                    }
                                  }
                                }
                              ]
                            }
                          }
                        ],
                        "concurrency": 1,
                        "variables": {
                          "scopesArray": {
                            "type": "Array"
                          },
                          "skippedReason": {
                            "type": "String"
                          }
                        },
                        "annotations": "[variables('hubAnnotations')]"
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.DataFactory/factories/datasets', parameters('dataFactoryName'), format('{0}_json', variables('CONFIG')))]"
                      ]
                    },
                    {
                      "type": "Microsoft.DataFactory/factories/pipelines",
                      "apiVersion": "2018-06-01",
                      "name": "[format('{0}/{1}', parameters('dataFactoryName'), format('{0}_RunExportJobs', variables('CONFIG')))]",
                      "properties": {
                        "description": "Runs all Cost Management exports configured for this hub. Reads scopes from settings.json.",
                        "activities": [
                          {
                            "name": "Get Config",
                            "type": "Lookup",
                            "dependsOn": [],
                            "policy": {
                              "timeout": "0.00:05:00",
                              "retry": 2,
                              "retryIntervalInSeconds": 30,
                              "secureOutput": false,
                              "secureInput": false
                            },
                            "userProperties": [],
                            "typeProperties": {
                              "source": {
                                "type": "JsonSource",
                                "storeSettings": {
                                  "type": "AzureBlobFSReadSettings",
                                  "recursive": true,
                                  "enablePartitionDiscovery": false
                                },
                                "formatSettings": {
                                  "type": "JsonReadSettings"
                                }
                              },
                              "dataset": {
                                "referenceName": "[format('{0}_json', variables('CONFIG'))]",
                                "type": "DatasetReference",
                                "parameters": {
                                  "fileName": "settings.json",
                                  "folderPath": "[variables('CONFIG')]"
                                }
                              }
                            }
                          },
                          {
                            "name": "Set Scopes",
                            "type": "SetVariable",
                            "dependsOn": [
                              {
                                "activity": "Get Config",
                                "dependencyConditions": [
                                  "Succeeded"
                                ]
                              }
                            ],
                            "policy": {
                              "secureOutput": false,
                              "secureInput": false
                            },
                            "userProperties": [],
                            "typeProperties": {
                              "variableName": "scopesArray",
                              "value": {
                                "value": "@if(equals(string(activity('Get Config').output.firstRow.scopes), '[]'), json('[]'), activity('Get Config').output.firstRow.scopes)",
                                "type": "Expression"
                              }
                            }
                          },
                          {
                            "name": "ForEach Scope",
                            "type": "ForEach",
                            "dependsOn": [
                              {
                                "activity": "Set Scopes",
                                "dependencyConditions": [
                                  "Succeeded"
                                ]
                              }
                            ],
                            "userProperties": [],
                            "typeProperties": {
                              "items": {
                                "value": "@variables('scopesArray')",
                                "type": "Expression"
                              },
                              "isSequential": false,
                              "activities": [
                                {
                                  "name": "Run Daily Export",
                                  "type": "WebActivity",
                                  "dependsOn": [],
                                  "policy": {
                                    "timeout": "0.00:05:00",
                                    "retry": 2,
                                    "retryIntervalInSeconds": 30,
                                    "secureOutput": false,
                                    "secureInput": false
                                  },
                                  "userProperties": [],
                                  "typeProperties": {
                                    "url": {
                                      "value": "[format('@concat(environment().resourceManager, item().scope, ''/providers/Microsoft.CostManagement/exports/{0}-daily-focuscost/run?api-version={1}'')', parameters('hubName'), variables('exportsApiVersion'))]",
                                      "type": "Expression"
                                    },
                                    "method": "POST",
                                    "body": " ",
                                    "headers": {
                                      "x-ms-command-name": "[format('FinOpsToolkit.Hubs.config_RunExportJobs@{0}', parameters('ftkVersion'))]",
                                      "ClientType": "[format('FinOpsToolkit.Hubs@{0}', parameters('ftkVersion'))]"
                                    },
                                    "authentication": {
                                      "type": "MSI",
                                      "resource": {
                                        "value": "@environment().resourceManager",
                                        "type": "Expression"
                                      }
                                    }
                                  }
                                }
                              ]
                            }
                          }
                        ],
                        "concurrency": 1,
                        "variables": {
                          "scopesArray": {
                            "type": "Array"
                          }
                        },
                        "annotations": "[variables('hubAnnotations')]"
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.DataFactory/factories/datasets', parameters('dataFactoryName'), format('{0}_json', variables('CONFIG')))]"
                      ]
                    },
                    {
                      "type": "Microsoft.DataFactory/factories/pipelines",
                      "apiVersion": "2018-06-01",
                      "name": "[format('{0}/{1}', parameters('dataFactoryName'), format('{0}_RunBackfillJob', variables('CONFIG')))]",
                      "properties": {
                        "description": "Runs exports for a specific date range to backfill historical data. Specify start and end dates as parameters.",
                        "parameters": {
                          "StartDate": {
                            "type": "String",
                            "defaultValue": ""
                          },
                          "EndDate": {
                            "type": "String",
                            "defaultValue": ""
                          },
                          "MonthsToBackfill": {
                            "type": "Int",
                            "defaultValue": 3
                          }
                        },
                        "activities": [
                          {
                            "name": "Get Config",
                            "type": "Lookup",
                            "dependsOn": [],
                            "policy": {
                              "timeout": "0.00:05:00",
                              "retry": 2,
                              "retryIntervalInSeconds": 30,
                              "secureOutput": false,
                              "secureInput": false
                            },
                            "userProperties": [],
                            "typeProperties": {
                              "source": {
                                "type": "JsonSource",
                                "storeSettings": {
                                  "type": "AzureBlobFSReadSettings",
                                  "recursive": true,
                                  "enablePartitionDiscovery": false
                                },
                                "formatSettings": {
                                  "type": "JsonReadSettings"
                                }
                              },
                              "dataset": {
                                "referenceName": "[format('{0}_json', variables('CONFIG'))]",
                                "type": "DatasetReference",
                                "parameters": {
                                  "fileName": "settings.json",
                                  "folderPath": "[variables('CONFIG')]"
                                }
                              }
                            }
                          },
                          {
                            "name": "Calculate Backfill Range",
                            "type": "SetVariable",
                            "dependsOn": [
                              {
                                "activity": "Get Config",
                                "dependencyConditions": [
                                  "Succeeded"
                                ]
                              }
                            ],
                            "policy": {
                              "secureOutput": false,
                              "secureInput": false
                            },
                            "userProperties": [],
                            "typeProperties": {
                              "variableName": "startDate",
                              "value": {
                                "value": "@if(empty(pipeline().parameters.StartDate), formatDateTime(addToTime(utcNow(), -pipeline().parameters.MonthsToBackfill, 'Month'), 'yyyy-MM-01'), pipeline().parameters.StartDate)",
                                "type": "Expression"
                              }
                            }
                          },
                          {
                            "name": "Set End Date",
                            "type": "SetVariable",
                            "dependsOn": [
                              {
                                "activity": "Calculate Backfill Range",
                                "dependencyConditions": [
                                  "Succeeded"
                                ]
                              }
                            ],
                            "policy": {
                              "secureOutput": false,
                              "secureInput": false
                            },
                            "userProperties": [],
                            "typeProperties": {
                              "variableName": "endDate",
                              "value": {
                                "value": "@if(empty(pipeline().parameters.EndDate), formatDateTime(utcNow(), 'yyyy-MM-dd'), pipeline().parameters.EndDate)",
                                "type": "Expression"
                              }
                            }
                          },
                          {
                            "name": "Set Scopes",
                            "type": "SetVariable",
                            "dependsOn": [
                              {
                                "activity": "Set End Date",
                                "dependencyConditions": [
                                  "Succeeded"
                                ]
                              }
                            ],
                            "policy": {
                              "secureOutput": false,
                              "secureInput": false
                            },
                            "userProperties": [],
                            "typeProperties": {
                              "variableName": "scopesArray",
                              "value": {
                                "value": "@if(equals(string(activity('Get Config').output.firstRow.scopes), '[]'), json('[]'), activity('Get Config').output.firstRow.scopes)",
                                "type": "Expression"
                              }
                            }
                          },
                          {
                            "name": "ForEach Scope",
                            "type": "ForEach",
                            "dependsOn": [
                              {
                                "activity": "Set Scopes",
                                "dependencyConditions": [
                                  "Succeeded"
                                ]
                              }
                            ],
                            "userProperties": [],
                            "typeProperties": {
                              "items": {
                                "value": "@variables('scopesArray')",
                                "type": "Expression"
                              },
                              "isSequential": true,
                              "activities": [
                                {
                                  "name": "Run Backfill Export",
                                  "type": "WebActivity",
                                  "dependsOn": [],
                                  "policy": {
                                    "timeout": "0.00:10:00",
                                    "retry": 2,
                                    "retryIntervalInSeconds": 60,
                                    "secureOutput": false,
                                    "secureInput": false
                                  },
                                  "userProperties": [],
                                  "typeProperties": {
                                    "url": {
                                      "value": "[format('@concat(environment().resourceManager, item().scope, ''/providers/Microsoft.CostManagement/exports/{0}-daily-focuscost/run?api-version={1}'')', parameters('hubName'), variables('exportsApiVersion'))]",
                                      "type": "Expression"
                                    },
                                    "method": "POST",
                                    "body": {
                                      "value": "@json(concat('{\"timePeriod\":{\"from\":\"', variables('startDate'), 'T00:00:00Z\",\"to\":\"', variables('endDate'), 'T23:59:59Z\"}}'))",
                                      "type": "Expression"
                                    },
                                    "headers": {
                                      "x-ms-command-name": "[format('FinOpsToolkit.Hubs.config_RunBackfillJob@{0}', parameters('ftkVersion'))]",
                                      "ClientType": "[format('FinOpsToolkit.Hubs@{0}', parameters('ftkVersion'))]",
                                      "Content-Type": "application/json"
                                    },
                                    "authentication": {
                                      "type": "MSI",
                                      "resource": {
                                        "value": "@environment().resourceManager",
                                        "type": "Expression"
                                      }
                                    }
                                  }
                                }
                              ]
                            }
                          }
                        ],
                        "concurrency": 1,
                        "variables": {
                          "scopesArray": {
                            "type": "Array"
                          },
                          "startDate": {
                            "type": "String"
                          },
                          "endDate": {
                            "type": "String"
                          }
                        },
                        "annotations": "[variables('hubAnnotations')]"
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.DataFactory/factories/datasets', parameters('dataFactoryName'), format('{0}_json', variables('CONFIG')))]"
                      ]
                    },
                    {
                      "type": "Microsoft.DataFactory/factories/triggers",
                      "apiVersion": "2018-06-01",
                      "name": "[format('{0}/{1}', parameters('dataFactoryName'), format('{0}_SettingsUpdated', variables('CONFIG')))]",
                      "properties": {
                        "type": "BlobEventsTrigger",
                        "typeProperties": {
                          "blobPathBeginsWith": "[format('/{0}/blobs/', variables('CONFIG'))]",
                          "blobPathEndsWith": "settings.json",
                          "ignoreEmptyBlobs": true,
                          "scope": "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]",
                          "events": [
                            "Microsoft.Storage.BlobCreated",
                            "Microsoft.Storage.BlobRenamed"
                          ]
                        },
                        "pipelines": [
                          {
                            "pipelineReference": {
                              "referenceName": "[format('{0}_ConfigureExports', variables('CONFIG'))]",
                              "type": "PipelineReference"
                            },
                            "parameters": {}
                          }
                        ],
                        "annotations": "[variables('hubAnnotations')]"
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.DataFactory/factories/pipelines', parameters('dataFactoryName'), format('{0}_ConfigureExports', variables('CONFIG')))]"
                      ]
                    },
                    {
                      "type": "Microsoft.DataFactory/factories/triggers",
                      "apiVersion": "2018-06-01",
                      "name": "[format('{0}/{1}', parameters('dataFactoryName'), format('{0}_DailySchedule', variables('CONFIG')))]",
                      "properties": {
                        "type": "ScheduleTrigger",
                        "typeProperties": {
                          "recurrence": {
                            "frequency": "Day",
                            "interval": 1,
                            "startTime": "2024-01-01T06:00:00Z",
                            "timeZone": "UTC"
                          }
                        },
                        "pipelines": [
                          {
                            "pipelineReference": {
                              "referenceName": "[format('{0}_RunExportJobs', variables('CONFIG'))]",
                              "type": "PipelineReference"
                            },
                            "parameters": {}
                          }
                        ],
                        "annotations": "[variables('hubAnnotations')]"
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.DataFactory/factories/pipelines', parameters('dataFactoryName'), format('{0}_RunExportJobs', variables('CONFIG')))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "pipelineNames": {
                      "type": "array",
                      "metadata": {
                        "description": "List of managed exports pipeline names."
                      },
                      "value": [
                        "[format('{0}_ConfigureExports', variables('CONFIG'))]",
                        "[format('{0}_RunExportJobs', variables('CONFIG'))]",
                        "[format('{0}_RunBackfillJob', variables('CONFIG'))]"
                      ]
                    },
                    "triggerNames": {
                      "type": "array",
                      "metadata": {
                        "description": "List of managed exports trigger names."
                      },
                      "value": [
                        "[format('{0}_SettingsUpdated', variables('CONFIG'))]",
                        "[format('{0}_DailySchedule', variables('CONFIG'))]"
                      ]
                    }
                  }
                }
              },
              "dependsOn": [
                "dataFactory",
                "dataFactoryResources",
                "storageAccount"
              ]
            },
            "dataExplorer": {
              "condition": "[variables('createNewAdx')]",
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-adx', uniqueString(deployment().name, parameters('location')))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "name": {
                    "value": "[variables('adxClusterName')]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "tags": "[if(contains(parameters('tagsByResource'), 'Microsoft.Kusto/clusters'), createObject('value', union(variables('allTags'), parameters('tagsByResource')['Microsoft.Kusto/clusters'])), createObject('value', variables('allTags')))]",
                  "enableTelemetry": {
                    "value": "[parameters('enableTelemetry')]"
                  },
                  "sku": {
                    "value": "[variables('effectiveAdxSku')]"
                  },
                  "tier": {
                    "value": "[variables('effectiveAdxTier')]"
                  },
                  "capacity": {
                    "value": "[variables('effectiveAdxCapacity')]"
                  },
                  "enableAutoScale": {
                    "value": "[equals(parameters('deploymentConfiguration'), 'waf-aligned')]"
                  },
                  "enableAutoStop": {
                    "value": "[equals(parameters('deploymentConfiguration'), 'minimal')]"
                  },
                  "enableDiskEncryption": {
                    "value": true
                  },
                  "enablePublicNetworkAccess": {
                    "value": "[not(variables('enablePrivateEndpoints'))]"
                  },
                  "publicIPType": {
                    "value": "IPv4"
                  },
                  "managedIdentities": {
                    "value": {
                      "systemAssigned": true
                    }
                  },
                  "databases": {
                    "value": [
                      {
                        "name": "Hub",
                        "kind": "ReadWrite",
                        "readWriteProperties": {},
                        "databasePrincipalAssignments": []
                      },
                      {
                        "name": "Ingestion",
                        "kind": "ReadWrite",
                        "readWriteProperties": {},
                        "databasePrincipalAssignments": []
                      }
                    ]
                  },
                  "clusterPrincipalAssignments": {
                    "value": "[concat(createArray(createObject('principalId', reference('dataFactory').outputs.systemAssignedMIPrincipalId.value, 'principalType', 'App', 'role', 'AllDatabasesAdmin', 'tenantId', tenant().tenantId)), createArray(createObject('principalId', if(variables('useExistingIdentity'), reference('existingManagedIdentity').clientId, reference('managedIdentity').outputs.clientId.value), 'principalType', 'App', 'role', 'AllDatabasesAdmin', 'tenantId', tenant().tenantId)), variables('deployerAdminAssignment'), variables('adxAdminAssignments'))]"
                  },
                  "privateEndpoints": "[if(variables('enablePrivateEndpoints'), createObject('value', createArray(createObject('name', format('{0}-pe', variables('adxClusterName')), 'subnetResourceId', if(equals(variables('effectiveNetworkIsolationMode'), 'Managed'), reference('managedNetwork').outputs.subnetResourceId.value, if(equals(variables('effectiveNetworkIsolationMode'), 'BringYourOwn'), if(not(empty(parameters('byoSubnetResourceId'))), parameters('byoSubnetResourceId'), parameters('privateEndpointSubnetId')), '')), 'service', 'cluster', 'privateDnsZoneGroup', if(and(parameters('enablePrivateDnsZoneGroups'), not(empty(if(equals(variables('effectiveNetworkIsolationMode'), 'Managed'), reference('managedNetwork').outputs.kustoDnsZoneId.value, parameters('byoKustoDnsZoneId'))))), createObject('privateDnsZoneGroupConfigs', createArray(createObject('privateDnsZoneResourceId', if(equals(variables('effectiveNetworkIsolationMode'), 'Managed'), reference('managedNetwork').outputs.kustoDnsZoneId.value, parameters('byoKustoDnsZoneId'))))), null())))), createObject('value', createArray()))]",
                  "lock": {
                    "value": "[parameters('lock')]"
                  },
                  "diagnosticSettings": {
                    "value": "[parameters('diagnosticSettings')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "languageVersion": "2.0",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.40.2.10011",
                      "templateHash": "13079404770240234892"
                    },
                    "name": "Kusto Cluster",
                    "description": "This module deploys a Kusto Cluster."
                  },
                  "definitions": {
                    "acceptedAudienceType": {
                      "type": "object",
                      "properties": {
                        "value": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. GUID or valid URL representing an accepted audience."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_export!": true,
                        "description": "The type for the accepted audience."
                      }
                    },
                    "languageExtensionType": {
                      "type": "object",
                      "properties": {
                        "languageExtensionCustomImageName": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name of the language extension custom image."
                          }
                        },
                        "languageExtensionImageName": {
                          "type": "string",
                          "allowedValues": [
                            "Python3_10_8",
                            "Python3_10_8_DL",
                            "Python3_6_5",
                            "PythonCustomImage",
                            "R"
                          ],
                          "metadata": {
                            "description": "Required. The name of the language extension image."
                          }
                        },
                        "languageExtensionName": {
                          "type": "string",
                          "allowedValues": [
                            "PYTHON",
                            "R"
                          ],
                          "metadata": {
                            "description": "Required. The name of the language extension."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_export!": true,
                        "description": "The type for the language extension."
                      }
                    },
                    "trustedExternalTenantType": {
                      "type": "object",
                      "properties": {
                        "value": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. GUID representing an external tenant."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_export!": true,
                        "description": "The type for the trusted external tenant."
                      }
                    },
                    "virtualNetworkConfigurationType": {
                      "type": "object",
                      "properties": {
                        "dataManagementPublicIpResourceId": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The public IP address resource id of the data management service.."
                          }
                        },
                        "enginePublicIpResourceId": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The public IP address resource id of the engine service."
                          }
                        },
                        "subnetResourceId": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The resource ID of the subnet to which to deploy the Kusto Cluster."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_export!": true,
                        "description": "The type for the virtual network configuration."
                      }
                    },
                    "clusterPrincipalAssignmentType": {
                      "type": "object",
                      "properties": {
                        "principalId": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The principal id assigned to the Kusto Cluster principal. It can be a user email, application id, or security group name."
                          }
                        },
                        "principalType": {
                          "type": "string",
                          "allowedValues": [
                            "App",
                            "Group",
                            "User"
                          ],
                          "metadata": {
                            "description": "Required. The principal type of the principal id."
                          }
                        },
                        "role": {
                          "type": "string",
                          "allowedValues": [
                            "AllDatabasesAdmin",
                            "AllDatabasesMonitor",
                            "AllDatabasesViewer"
                          ],
                          "metadata": {
                            "description": "Required. The Kusto Cluster role to be assigned to the principal id."
                          }
                        },
                        "tenantId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The tenant id of the principal."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_export!": true,
                        "description": "The type for the cluster principal assignment."
                      }
                    },
                    "databaseType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The name of the Kusto Cluster database."
                          }
                        },
                        "kind": {
                          "type": "string",
                          "allowedValues": [
                            "ReadOnlyFollowing",
                            "ReadWrite"
                          ],
                          "metadata": {
                            "description": "Required. The object type of the database."
                          }
                        },
                        "readWriteProperties": {
                          "$ref": "#/definitions/databaseReadWriteType",
                          "nullable": true,
                          "metadata": {
                            "description": "Conditional. Required if the database kind is ReadWrite. Contains the properties of the database."
                          }
                        },
                        "databasePrincipalAssignments": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/databasePrincipalAssignmentType"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The principal assignments for the Kusto Cluster database."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_export!": true,
                        "description": "The type for the database."
                      }
                    },
                    "privateEndpointOutputType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "metadata": {
                            "description": "The name of the private endpoint."
                          }
                        },
                        "resourceId": {
                          "type": "string",
                          "metadata": {
                            "description": "The resource ID of the private endpoint."
                          }
                        },
                        "groupId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "The group Id for the private endpoint Group."
                          }
                        },
                        "customDnsConfigs": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "fqdn": {
                                "type": "string",
                                "nullable": true,
                                "metadata": {
                                  "description": "FQDN that resolves to private endpoint IP address."
                                }
                              },
                              "ipAddresses": {
                                "type": "array",
                                "items": {
                                  "type": "string"
                                },
                                "metadata": {
                                  "description": "A list of private IP addresses of the private endpoint."
                                }
                              }
                            }
                          },
                          "metadata": {
                            "description": "The custom DNS configurations of the private endpoint."
                          }
                        },
                        "networkInterfaceResourceIds": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "metadata": {
                            "description": "The IDs of the network interfaces associated with the private endpoint."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_export!": true,
                        "description": "The type for the private endpoint output."
                      }
                    },
                    "_1.privateEndpointCustomDnsConfigType": {
                      "type": "object",
                      "properties": {
                        "fqdn": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. FQDN that resolves to private endpoint IP address."
                          }
                        },
                        "ipAddresses": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "metadata": {
                            "description": "Required. A list of private IP addresses of the private endpoint."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "_1.privateEndpointIpConfigurationType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The name of the resource that is unique within a resource group."
                          }
                        },
                        "properties": {
                          "type": "object",
                          "properties": {
                            "groupId": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. The ID of a group obtained from the remote resource that this private endpoint should connect to."
                              }
                            },
                            "memberName": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. The member name of a group obtained from the remote resource that this private endpoint should connect to."
                              }
                            },
                            "privateIPAddress": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. A private IP address obtained from the private endpoint's subnet."
                              }
                            }
                          },
                          "metadata": {
                            "description": "Required. Properties of private endpoint IP configurations."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "_1.privateEndpointPrivateDnsZoneGroupType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name of the Private DNS Zone Group."
                          }
                        },
                        "privateDnsZoneGroupConfigs": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "name": {
                                "type": "string",
                                "nullable": true,
                                "metadata": {
                                  "description": "Optional. The name of the private DNS Zone Group config."
                                }
                              },
                              "privateDnsZoneResourceId": {
                                "type": "string",
                                "metadata": {
                                  "description": "Required. The resource id of the private DNS zone."
                                }
                              }
                            }
                          },
                          "metadata": {
                            "description": "Required. The private DNS Zone Groups to associate the Private Endpoint. A DNS Zone Group can support up to 5 DNS zones."
                          }
                        }
                      },
                      "metadata": {
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "customerManagedKeyType": {
                      "type": "object",
                      "properties": {
                        "keyVaultResourceId": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The resource ID of a key vault to reference a customer managed key for encryption from."
                          }
                        },
                        "keyName": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The name of the customer managed key to use for encryption."
                          }
                        },
                        "keyVersion": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The version of the customer managed key to reference for encryption. If not provided, the deployment will use the latest version available at deployment time."
                          }
                        },
                        "userAssignedIdentityResourceId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. User assigned identity to use when fetching the customer managed key. Required if no system assigned identity is available for use."
                          }
                        }
                      },
                      "metadata": {
                        "description": "An AVM-aligned type for a customer-managed key. To be used if the resource type does not support auto-rotation of the customer-managed key.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "databasePrincipalAssignmentType": {
                      "type": "object",
                      "properties": {
                        "principalId": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The principal id assigned to the Kusto Cluster database principal. It can be a user email, application id, or security group name."
                          }
                        },
                        "principalType": {
                          "type": "string",
                          "allowedValues": [
                            "App",
                            "Group",
                            "User"
                          ],
                          "metadata": {
                            "description": "Required. The principal type of the principal id."
                          }
                        },
                        "role": {
                          "type": "string",
                          "allowedValues": [
                            "Admin",
                            "Ingestor",
                            "Monitor",
                            "UnrestrictedViewer",
                            "User",
                            "Viewer"
                          ],
                          "metadata": {
                            "description": "Required. The Kusto Cluster database role to be assigned to the principal id."
                          }
                        },
                        "tenantId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The tenant id of the principal."
                          }
                        }
                      },
                      "metadata": {
                        "description": "The type of a database principal assignment.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "database/main.bicep"
                        }
                      }
                    },
                    "databaseReadWriteType": {
                      "type": "object",
                      "properties": {
                        "hotCachePeriod": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Te time the data should be kept in cache for fast queries in TimeSpan."
                          }
                        },
                        "keyVaultProperties": {
                          "type": "object",
                          "properties": {
                            "keyName": {
                              "type": "string",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The name of the key."
                              }
                            },
                            "keyVaultUri": {
                              "type": "string",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The Uri of the key vault."
                              }
                            },
                            "keyVersion": {
                              "type": "string",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The version of the key."
                              }
                            },
                            "userIdentity": {
                              "type": "string",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The user identity."
                              }
                            }
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The properties of the key vault."
                          }
                        },
                        "softDeletePeriod": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The time the data should be kept before it stops being accessible to queries in TimeSpan."
                          }
                        }
                      },
                      "metadata": {
                        "description": "The properties of the database if using read-write.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "database/main.bicep"
                        }
                      }
                    },
                    "diagnosticSettingFullType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name of the diagnostic setting."
                          }
                        },
                        "logCategoriesAndGroups": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "category": {
                                "type": "string",
                                "nullable": true,
                                "metadata": {
                                  "description": "Optional. Name of a Diagnostic Log category for a resource type this setting is applied to. Set the specific logs to collect here."
                                }
                              },
                              "categoryGroup": {
                                "type": "string",
                                "nullable": true,
                                "metadata": {
                                  "description": "Optional. Name of a Diagnostic Log category group for a resource type this setting is applied to. Set to `allLogs` to collect all logs."
                                }
                              },
                              "enabled": {
                                "type": "bool",
                                "nullable": true,
                                "metadata": {
                                  "description": "Optional. Enable or disable the category explicitly. Default is `true`."
                                }
                              }
                            }
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name of logs that will be streamed. \"allLogs\" includes all possible logs for the resource. Set to `[]` to disable log collection."
                          }
                        },
                        "metricCategories": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "category": {
                                "type": "string",
                                "metadata": {
                                  "description": "Required. Name of a Diagnostic Metric category for a resource type this setting is applied to. Set to `AllMetrics` to collect all metrics."
                                }
                              },
                              "enabled": {
                                "type": "bool",
                                "nullable": true,
                                "metadata": {
                                  "description": "Optional. Enable or disable the category explicitly. Default is `true`."
                                }
                              }
                            }
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name of metrics that will be streamed. \"allMetrics\" includes all possible metrics for the resource. Set to `[]` to disable metric collection."
                          }
                        },
                        "logAnalyticsDestinationType": {
                          "type": "string",
                          "allowedValues": [
                            "AzureDiagnostics",
                            "Dedicated"
                          ],
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. A string indicating whether the export to Log Analytics should use the default destination type, i.e. AzureDiagnostics, or use a destination type."
                          }
                        },
                        "workspaceResourceId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Resource ID of the diagnostic log analytics workspace. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                          }
                        },
                        "storageAccountResourceId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Resource ID of the diagnostic storage account. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                          }
                        },
                        "eventHubAuthorizationRuleResourceId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Resource ID of the diagnostic event hub authorization rule for the Event Hubs namespace in which the event hub should be created or streamed to."
                          }
                        },
                        "eventHubName": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Name of the diagnostic event hub within the namespace to which logs are streamed. Without this, an event hub is created for each log category. For security reasons, it is recommended to set diagnostic settings to send data to either storage account, log analytics workspace or event hub."
                          }
                        },
                        "marketplacePartnerResourceId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The full ARM resource ID of the Marketplace resource to which you would like to send Diagnostic Logs."
                          }
                        }
                      },
                      "metadata": {
                        "description": "An AVM-aligned type for a diagnostic setting. To be used if both logs & metrics are supported by the resource provider.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "lockType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Specify the name of lock."
                          }
                        },
                        "kind": {
                          "type": "string",
                          "allowedValues": [
                            "CanNotDelete",
                            "None",
                            "ReadOnly"
                          ],
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Specify the type of lock."
                          }
                        },
                        "notes": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Specify the notes of the lock."
                          }
                        }
                      },
                      "metadata": {
                        "description": "An AVM-aligned type for a lock.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "managedIdentityAllType": {
                      "type": "object",
                      "properties": {
                        "systemAssigned": {
                          "type": "bool",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Enables system assigned managed identity on the resource."
                          }
                        },
                        "userAssignedResourceIds": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The resource ID(s) to assign to the resource. Required if a user assigned identity is used for encryption."
                          }
                        }
                      },
                      "metadata": {
                        "description": "An AVM-aligned type for a managed identity configuration. To be used if both a system-assigned & user-assigned identities are supported by the resource provider.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "privateEndpointMultiServiceType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name of the private endpoint."
                          }
                        },
                        "location": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The location to deploy the private endpoint to."
                          }
                        },
                        "privateLinkServiceConnectionName": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name of the private link connection to create."
                          }
                        },
                        "service": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The subresource to deploy the private endpoint for. For example \"blob\", \"table\", \"queue\" or \"file\" for a Storage Account's Private Endpoints."
                          }
                        },
                        "subnetResourceId": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. Resource ID of the subnet where the endpoint needs to be created."
                          }
                        },
                        "resourceGroupResourceId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The resource ID of the Resource Group the Private Endpoint will be created in. If not specified, the Resource Group of the provided Virtual Network Subnet is used."
                          }
                        },
                        "privateDnsZoneGroup": {
                          "$ref": "#/definitions/_1.privateEndpointPrivateDnsZoneGroupType",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The private DNS zone group to configure for the private endpoint."
                          }
                        },
                        "isManualConnection": {
                          "type": "bool",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. If Manual Private Link Connection is required."
                          }
                        },
                        "manualConnectionRequestMessage": {
                          "type": "string",
                          "nullable": true,
                          "maxLength": 140,
                          "metadata": {
                            "description": "Optional. A message passed to the owner of the remote resource with the manual connection request."
                          }
                        },
                        "customDnsConfigs": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/_1.privateEndpointCustomDnsConfigType"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Custom DNS configurations."
                          }
                        },
                        "ipConfigurations": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/_1.privateEndpointIpConfigurationType"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. A list of IP configurations of the private endpoint. This will be used to map to the First Party Service endpoints."
                          }
                        },
                        "applicationSecurityGroupResourceIds": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Application security groups in which the private endpoint IP configuration is included."
                          }
                        },
                        "customNetworkInterfaceName": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The custom name of the network interface attached to the private endpoint."
                          }
                        },
                        "lock": {
                          "$ref": "#/definitions/lockType",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Specify the type of lock."
                          }
                        },
                        "roleAssignments": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/roleAssignmentType"
                          },
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Array of role assignments to create."
                          }
                        },
                        "tags": {
                          "type": "object",
                          "nullable": true,
                          "metadata": {
                            "__bicep_resource_derived_type!": {
                              "source": "Microsoft.Network/privateEndpoints@2024-07-01#properties/tags"
                            },
                            "description": "Optional. Tags to be applied on all resources/resource groups in this deployment."
                          }
                        },
                        "enableTelemetry": {
                          "type": "bool",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Enable/Disable usage telemetry for module."
                          }
                        }
                      },
                      "metadata": {
                        "description": "An AVM-aligned type for a private endpoint. To be used if the private endpoint's default service / groupId can NOT be assumed (i.e., for services that have more than one subresource, like Storage Account with Blob (blob, table, queue, file, ...).",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    },
                    "roleAssignmentType": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                          }
                        },
                        "roleDefinitionIdOrName": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                          }
                        },
                        "principalId": {
                          "type": "string",
                          "metadata": {
                            "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                          }
                        },
                        "principalType": {
                          "type": "string",
                          "allowedValues": [
                            "Device",
                            "ForeignGroup",
                            "Group",
                            "ServicePrincipal",
                            "User"
                          ],
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The principal type of the assigned principal ID."
                          }
                        },
                        "description": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The description of the role assignment."
                          }
                        },
                        "condition": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                          }
                        },
                        "conditionVersion": {
                          "type": "string",
                          "allowedValues": [
                            "2.0"
                          ],
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. Version of the condition."
                          }
                        },
                        "delegatedManagedIdentityResourceId": {
                          "type": "string",
                          "nullable": true,
                          "metadata": {
                            "description": "Optional. The Resource Id of the delegated managed identity resource."
                          }
                        }
                      },
                      "metadata": {
                        "description": "An AVM-aligned type for a role assignment.",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                        }
                      }
                    }
                  },
                  "parameters": {
                    "name": {
                      "type": "string",
                      "minLength": 4,
                      "maxLength": 22,
                      "metadata": {
                        "description": "Required. The name of the Kusto cluster which must be unique within Azure."
                      }
                    },
                    "location": {
                      "type": "string",
                      "defaultValue": "[resourceGroup().location]",
                      "metadata": {
                        "description": "Optional. Location for all resources."
                      }
                    },
                    "capacity": {
                      "type": "int",
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. The number of instances of the Kusto Cluster."
                      }
                    },
                    "sku": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. The SKU of the Kusto Cluster."
                      }
                    },
                    "tier": {
                      "type": "string",
                      "defaultValue": "Standard",
                      "allowedValues": [
                        "Basic",
                        "Standard"
                      ],
                      "metadata": {
                        "description": "Optional. The tier of the Kusto Cluster."
                      }
                    },
                    "managedIdentities": {
                      "$ref": "#/definitions/managedIdentityAllType",
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. The managed identity definition for this resource."
                      }
                    },
                    "acceptedAudiences": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/acceptedAudienceType"
                      },
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. The Kusto Cluster's accepted audiences."
                      }
                    },
                    "allowedFqdnList": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. List of allowed fully-qulified domain names (FQDNs) for egress from the Kusto Cluster."
                      }
                    },
                    "allowedIpRangeList": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. List of IP addresses in CIDR format allowed to connect to the Kusto Cluster."
                      }
                    },
                    "enableAutoStop": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Optional. Enable/disable auto-stop."
                      }
                    },
                    "enableDiskEncryption": {
                      "type": "bool",
                      "defaultValue": false,
                      "metadata": {
                        "description": "Optional. Enable/disable disk encryption."
                      }
                    },
                    "enableDoubleEncryption": {
                      "type": "bool",
                      "defaultValue": false,
                      "metadata": {
                        "description": "Optional. Enable/disable double encryption."
                      }
                    },
                    "enablePurge": {
                      "type": "bool",
                      "defaultValue": false,
                      "metadata": {
                        "description": "Optional. Enable/disable purge."
                      }
                    },
                    "enableStreamingIngest": {
                      "type": "bool",
                      "defaultValue": false,
                      "metadata": {
                        "description": "Optional. Enable/disable streaming ingest."
                      }
                    },
                    "engineType": {
                      "type": "string",
                      "defaultValue": "V3",
                      "allowedValues": [
                        "V2",
                        "V3"
                      ],
                      "metadata": {
                        "description": "Optional. The engine type of the Kusto Cluster."
                      }
                    },
                    "customerManagedKey": {
                      "$ref": "#/definitions/customerManagedKeyType",
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. The customer managed key definition."
                      }
                    },
                    "languageExtensions": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/languageExtensionType"
                      },
                      "defaultValue": [],
                      "metadata": {
                        "description": "Optional. List of the language extensions of the Kusto Cluster."
                      }
                    },
                    "enableAutoScale": {
                      "type": "bool",
                      "defaultValue": false,
                      "metadata": {
                        "description": "Optional. Enable/disable auto-scale."
                      }
                    },
                    "autoScaleMin": {
                      "type": "int",
                      "defaultValue": 2,
                      "minValue": 2,
                      "maxValue": 999,
                      "metadata": {
                        "description": "Optional. When auto-scale is enabled, the minimum number of instances in the Kusto Cluster."
                      }
                    },
                    "autoScaleMax": {
                      "type": "int",
                      "defaultValue": 3,
                      "minValue": 3,
                      "maxValue": 1000,
                      "metadata": {
                        "description": "Optional. When auto-scale is enabled, the maximum number of instances in the Kusto Cluster."
                      }
                    },
                    "publicIPType": {
                      "type": "string",
                      "defaultValue": "DualStack",
                      "allowedValues": [
                        "IPv4",
                        "IPv6",
                        "DualStack"
                      ],
                      "metadata": {
                        "description": "Optional. Indicates what public IP type to create - IPv4 (default), or DualStack (both IPv4 and IPv6)."
                      }
                    },
                    "enablePublicNetworkAccess": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Optional. Enable/disable public network access. If disabled, only private endpoint connection is allowed to the Kusto Cluster."
                      }
                    },
                    "enableRestrictOutboundNetworkAccess": {
                      "type": "bool",
                      "defaultValue": false,
                      "metadata": {
                        "description": "Optional. Enable/disable restricting outbound network access."
                      }
                    },
                    "trustedExternalTenants": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/trustedExternalTenantType"
                      },
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. The external tenants trusted by the Kusto Cluster."
                      }
                    },
                    "virtualClusterGraduationProperties": {
                      "type": "securestring",
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. The virtual cluster graduation properties of the Kusto Cluster."
                      }
                    },
                    "virtualNetworkConfiguration": {
                      "$ref": "#/definitions/virtualNetworkConfigurationType",
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. The virtual network configuration of the Kusto Cluster."
                      }
                    },
                    "lock": {
                      "$ref": "#/definitions/lockType",
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. The lock settings of the service."
                      }
                    },
                    "roleAssignments": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/roleAssignmentType"
                      },
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. Array of role assignments to create."
                      }
                    },
                    "tags": {
                      "type": "object",
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. Tags of the resource."
                      }
                    },
                    "privateEndpoints": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/privateEndpointMultiServiceType"
                      },
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. Configuration details for private endpoints. For security reasons, it is recommended to use private endpoints whenever possible."
                      }
                    },
                    "enableTelemetry": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Optional. Enable/disable usage telemetry for module."
                      }
                    },
                    "diagnosticSettings": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/diagnosticSettingFullType"
                      },
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. The diagnostic settings of the service."
                      }
                    },
                    "clusterPrincipalAssignments": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/clusterPrincipalAssignmentType"
                      },
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. The Principal Assignments for the Kusto Cluster."
                      }
                    },
                    "databases": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/databaseType"
                      },
                      "nullable": true,
                      "metadata": {
                        "description": "Optional. The Kusto Cluster databases."
                      }
                    },
                    "availabilityZones": {
                      "type": "array",
                      "items": {
                        "type": "int"
                      },
                      "defaultValue": [
                        1,
                        2,
                        3
                      ],
                      "allowedValues": [
                        1,
                        2,
                        3
                      ],
                      "metadata": {
                        "description": "Optional. The list of Availability zones to use for the zone-redundant resources. Once a zone is selected, you cannot opt-out again."
                      }
                    }
                  },
                  "variables": {
                    "copy": [
                      {
                        "name": "formattedRoleAssignments",
                        "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                        "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                      }
                    ],
                    "enableReferencedModulesTelemetry": false,
                    "formattedUserAssignedIdentities": "[reduce(map(coalesce(tryGet(parameters('managedIdentities'), 'userAssignedResourceIds'), createArray()), lambda('id', createObject(format('{0}', lambdaVariables('id')), createObject()))), createObject(), lambda('cur', 'next', union(lambdaVariables('cur'), lambdaVariables('next'))))]",
                    "identity": "[if(not(empty(parameters('managedIdentities'))), createObject('type', if(coalesce(tryGet(parameters('managedIdentities'), 'systemAssigned'), false()), if(not(empty(coalesce(tryGet(parameters('managedIdentities'), 'userAssignedResourceIds'), createObject()))), 'SystemAssigned,UserAssigned', 'SystemAssigned'), if(not(empty(coalesce(tryGet(parameters('managedIdentities'), 'userAssignedResourceIds'), createObject()))), 'UserAssigned', 'None')), 'userAssignedIdentities', if(not(empty(variables('formattedUserAssignedIdentities'))), variables('formattedUserAssignedIdentities'), null())), null())]",
                    "builtInRoleNames": {
                      "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                      "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                      "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]"
                    }
                  },
                  "resources": {
                    "cMKKeyVault::cMKKey": {
                      "condition": "[and(not(empty(parameters('customerManagedKey'))), not(empty(parameters('customerManagedKey'))))]",
                      "existing": true,
                      "type": "Microsoft.KeyVault/vaults/keys",
                      "apiVersion": "2025-05-01",
                      "subscriptionId": "[split(tryGet(parameters('customerManagedKey'), 'keyVaultResourceId'), '/')[2]]",
                      "resourceGroup": "[split(tryGet(parameters('customerManagedKey'), 'keyVaultResourceId'), '/')[4]]",
                      "name": "[format('{0}/{1}', last(split(tryGet(parameters('customerManagedKey'), 'keyVaultResourceId'), '/')), tryGet(parameters('customerManagedKey'), 'keyName'))]"
                    },
                    "avmTelemetry": {
                      "condition": "[parameters('enableTelemetry')]",
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "[format('46d3xbcp.res.kusto-cluster.{0}.{1}', replace('0.9.1', '.', '-'), substring(uniqueString(deployment().name, parameters('location')), 0, 4))]",
                      "properties": {
                        "mode": "Incremental",
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "resources": [],
                          "outputs": {
                            "telemetry": {
                              "type": "String",
                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                            }
                          }
                        }
                      }
                    },
                    "cMKKeyVault": {
                      "condition": "[not(empty(parameters('customerManagedKey')))]",
                      "existing": true,
                      "type": "Microsoft.KeyVault/vaults",
                      "apiVersion": "2025-05-01",
                      "subscriptionId": "[split(tryGet(parameters('customerManagedKey'), 'keyVaultResourceId'), '/')[2]]",
                      "resourceGroup": "[split(tryGet(parameters('customerManagedKey'), 'keyVaultResourceId'), '/')[4]]",
                      "name": "[last(split(tryGet(parameters('customerManagedKey'), 'keyVaultResourceId'), '/'))]"
                    },
                    "kustoCluster": {
                      "type": "Microsoft.Kusto/clusters",
                      "apiVersion": "2024-04-13",
                      "name": "[parameters('name')]",
                      "location": "[parameters('location')]",
                      "tags": "[parameters('tags')]",
                      "sku": {
                        "capacity": "[parameters('capacity')]",
                        "name": "[parameters('sku')]",
                        "tier": "[parameters('tier')]"
                      },
                      "identity": "[variables('identity')]",
                      "properties": {
                        "acceptedAudiences": "[parameters('acceptedAudiences')]",
                        "allowedFqdnList": "[parameters('allowedFqdnList')]",
                        "allowedIpRangeList": "[parameters('allowedIpRangeList')]",
                        "enableAutoStop": "[parameters('enableAutoStop')]",
                        "enableDiskEncryption": "[parameters('enableDiskEncryption')]",
                        "enableDoubleEncryption": "[parameters('enableDoubleEncryption')]",
                        "enablePurge": "[parameters('enablePurge')]",
                        "enableStreamingIngest": "[parameters('enableStreamingIngest')]",
                        "engineType": "[parameters('engineType')]",
                        "keyVaultProperties": "[if(not(empty(parameters('customerManagedKey'))), createObject('keyName', parameters('customerManagedKey').keyName, 'keyVaultUri', reference('cMKKeyVault').vaultUri, 'keyVersion', if(not(empty(tryGet(parameters('customerManagedKey'), 'keyVersion'))), parameters('customerManagedKey').keyVersion, last(split(reference('cMKKeyVault::cMKKey').keyUriWithVersion, '/'))), 'userIdentity', if(not(empty(tryGet(parameters('customerManagedKey'), 'userAssignedIdentityResourceId'))), tryGet(parameters('customerManagedKey'), 'userAssignedIdentityResourceId'), null())), null())]",
                        "languageExtensions": {
                          "value": "[parameters('languageExtensions')]"
                        },
                        "optimizedAutoscale": {
                          "isEnabled": "[parameters('enableAutoScale')]",
                          "minimum": "[parameters('autoScaleMin')]",
                          "maximum": "[parameters('autoScaleMax')]",
                          "version": 1
                        },
                        "publicIPType": "[parameters('publicIPType')]",
                        "publicNetworkAccess": "[if(and(parameters('enablePublicNetworkAccess'), empty(parameters('privateEndpoints'))), 'Enabled', 'Disabled')]",
                        "restrictOutboundNetworkAccess": "[if(parameters('enableRestrictOutboundNetworkAccess'), 'Enabled', 'Disabled')]",
                        "trustedExternalTenants": "[parameters('trustedExternalTenants')]",
                        "virtualClusterGraduationProperties": "[parameters('virtualClusterGraduationProperties')]",
                        "virtualNetworkConfiguration": "[if(not(empty(parameters('virtualNetworkConfiguration'))), createObject('dataManagementPublicIpId', parameters('virtualNetworkConfiguration').dataManagementPublicIpResourceId, 'enginePublicIpId', parameters('virtualNetworkConfiguration').enginePublicIpResourceId, 'subnetId', parameters('virtualNetworkConfiguration').subnetResourceId), null())]"
                      },
                      "zones": "[if(not(empty(parameters('availabilityZones'))), map(parameters('availabilityZones'), lambda('zone', format('{0}', lambdaVariables('zone')))), null())]",
                      "dependsOn": [
                        "cMKKeyVault",
                        "cMKKeyVault::cMKKey"
                      ]
                    },
                    "kustoCluster_diagnosticSettings": {
                      "copy": {
                        "name": "kustoCluster_diagnosticSettings",
                        "count": "[length(coalesce(parameters('diagnosticSettings'), createArray()))]"
                      },
                      "type": "Microsoft.Insights/diagnosticSettings",
                      "apiVersion": "2021-05-01-preview",
                      "scope": "[resourceId('Microsoft.Kusto/clusters', parameters('name'))]",
                      "name": "[coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'name'), format('{0}-diagnosticSettings', parameters('name')))]",
                      "properties": {
                        "copy": [
                          {
                            "name": "metrics",
                            "count": "[length(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'metricCategories'), createArray(createObject('category', 'AllMetrics'))))]",
                            "input": {
                              "category": "[coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'metricCategories'), createArray(createObject('category', 'AllMetrics')))[copyIndex('metrics')].category]",
                              "enabled": "[coalesce(tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'metricCategories'), createArray(createObject('category', 'AllMetrics')))[copyIndex('metrics')], 'enabled'), true())]",
                              "timeGrain": null
                            }
                          },
                          {
                            "name": "logs",
                            "count": "[length(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs'))))]",
                            "input": {
                              "categoryGroup": "[tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs')))[copyIndex('logs')], 'categoryGroup')]",
                              "category": "[tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs')))[copyIndex('logs')], 'category')]",
                              "enabled": "[coalesce(tryGet(coalesce(tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logCategoriesAndGroups'), createArray(createObject('categoryGroup', 'allLogs')))[copyIndex('logs')], 'enabled'), true())]"
                            }
                          }
                        ],
                        "storageAccountId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'storageAccountResourceId')]",
                        "workspaceId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'workspaceResourceId')]",
                        "eventHubAuthorizationRuleId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'eventHubAuthorizationRuleResourceId')]",
                        "eventHubName": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'eventHubName')]",
                        "marketplacePartnerId": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'marketplacePartnerResourceId')]",
                        "logAnalyticsDestinationType": "[tryGet(coalesce(parameters('diagnosticSettings'), createArray())[copyIndex()], 'logAnalyticsDestinationType')]"
                      },
                      "dependsOn": [
                        "kustoCluster"
                      ]
                    },
                    "kustoCluster_lock": {
                      "condition": "[and(not(empty(coalesce(parameters('lock'), createObject()))), not(equals(tryGet(parameters('lock'), 'kind'), 'None')))]",
                      "type": "Microsoft.Authorization/locks",
                      "apiVersion": "2020-05-01",
                      "scope": "[resourceId('Microsoft.Kusto/clusters', parameters('name'))]",
                      "name": "[coalesce(tryGet(parameters('lock'), 'name'), format('lock-{0}', parameters('name')))]",
                      "properties": {
                        "level": "[coalesce(tryGet(parameters('lock'), 'kind'), '')]",
                        "notes": "[coalesce(tryGet(parameters('lock'), 'notes'), if(equals(tryGet(parameters('lock'), 'kind'), 'CanNotDelete'), 'Cannot delete resource or child resources.', 'Cannot delete or modify the resource or child resources.'))]"
                      },
                      "dependsOn": [
                        "kustoCluster"
                      ]
                    },
                    "kustoCluster_roleAssignments": {
                      "copy": {
                        "name": "kustoCluster_roleAssignments",
                        "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                      },
                      "type": "Microsoft.Authorization/roleAssignments",
                      "apiVersion": "2022-04-01",
                      "scope": "[resourceId('Microsoft.Kusto/clusters', parameters('name'))]",
                      "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Kusto/clusters', parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                      "properties": {
                        "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                        "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                        "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                        "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                        "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                        "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                        "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                      },
                      "dependsOn": [
                        "kustoCluster"
                      ]
                    },
                    "kustoCluster_principalAssignments": {
                      "copy": {
                        "name": "kustoCluster_principalAssignments",
                        "count": "[length(coalesce(parameters('clusterPrincipalAssignments'), createArray()))]"
                      },
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "[format('{0}-KC-PrincipalAssignment-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "kustoClusterName": {
                            "value": "[parameters('name')]"
                          },
                          "principalId": {
                            "value": "[coalesce(parameters('clusterPrincipalAssignments'), createArray())[copyIndex()].principalId]"
                          },
                          "principalType": {
                            "value": "[coalesce(parameters('clusterPrincipalAssignments'), createArray())[copyIndex()].principalType]"
                          },
                          "role": {
                            "value": "[coalesce(parameters('clusterPrincipalAssignments'), createArray())[copyIndex()].role]"
                          },
                          "tenantId": {
                            "value": "[tryGet(coalesce(parameters('clusterPrincipalAssignments'), createArray())[copyIndex()], 'tenantId')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.40.2.10011",
                              "templateHash": "7737164182940842473"
                            },
                            "name": "Kusto Cluster Principal Assignments",
                            "description": "This module deploys a Kusto Cluster Principal Assignment."
                          },
                          "parameters": {
                            "kustoClusterName": {
                              "type": "string",
                              "minLength": 4,
                              "maxLength": 22,
                              "metadata": {
                                "description": "Conditional. The name of the parent Kusto Cluster. Required if the template is used in a standalone deployment."
                              }
                            },
                            "principalId": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. The principal id assigned to the Kusto Cluster principal. It can be a user email, application id, or security group name."
                              }
                            },
                            "principalType": {
                              "type": "string",
                              "allowedValues": [
                                "App",
                                "Group",
                                "User"
                              ],
                              "metadata": {
                                "description": "Required. The principal type of the principal id."
                              }
                            },
                            "role": {
                              "type": "string",
                              "allowedValues": [
                                "AllDatabasesAdmin",
                                "AllDatabasesViewer"
                              ],
                              "metadata": {
                                "description": "Required. The Kusto Cluster role to be assigned to the principal id."
                              }
                            },
                            "tenantId": {
                              "type": "string",
                              "defaultValue": "[tenant().tenantId]",
                              "metadata": {
                                "description": "Optional. The tenant id of the principal id."
                              }
                            }
                          },
                          "resources": [
                            {
                              "type": "Microsoft.Kusto/clusters/principalAssignments",
                              "apiVersion": "2024-04-13",
                              "name": "[format('{0}/{1}', parameters('kustoClusterName'), parameters('principalId'))]",
                              "properties": {
                                "principalId": "[parameters('principalId')]",
                                "principalType": "[parameters('principalType')]",
                                "role": "[parameters('role')]",
                                "tenantId": "[parameters('tenantId')]"
                              }
                            }
                          ],
                          "outputs": {
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the deployed Kusto Cluster Principal Assignment."
                              },
                              "value": "[parameters('principalId')]"
                            },
                            "resourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource id of the deployed Kusto Cluster Principal Assignment."
                              },
                              "value": "[resourceId('Microsoft.Kusto/clusters/principalAssignments', parameters('kustoClusterName'), parameters('principalId'))]"
                            },
                            "resourceGroupName": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource group name of the deployed Kusto Cluster Principal Assignment."
                              },
                              "value": "[resourceGroup().name]"
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "kustoCluster"
                      ]
                    },
                    "kustoCluster_privateEndpoints": {
                      "copy": {
                        "name": "kustoCluster_privateEndpoints",
                        "count": "[length(coalesce(parameters('privateEndpoints'), createArray()))]",
                        "mode": "serial",
                        "batchSize": 1
                      },
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "[format('{0}-kustoCluster-PrivateEndpoint-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                      "subscriptionId": "[split(coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'resourceGroupResourceId'), resourceGroup().id), '/')[2]]",
                      "resourceGroup": "[split(coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'resourceGroupResourceId'), resourceGroup().id), '/')[4]]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "name": {
                            "value": "[coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'name'), format('pep-{0}-{1}-{2}', last(split(resourceId('Microsoft.Kusto/clusters', parameters('name')), '/')), coalesce(parameters('privateEndpoints'), createArray())[copyIndex()].service, copyIndex()))]"
                          },
                          "privateLinkServiceConnections": "[if(not(equals(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'isManualConnection'), true())), createObject('value', createArray(createObject('name', coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'privateLinkServiceConnectionName'), format('{0}-{1}-{2}', last(split(resourceId('Microsoft.Kusto/clusters', parameters('name')), '/')), coalesce(parameters('privateEndpoints'), createArray())[copyIndex()].service, copyIndex())), 'properties', createObject('privateLinkServiceId', resourceId('Microsoft.Kusto/clusters', parameters('name')), 'groupIds', createArray(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()].service))))), createObject('value', null()))]",
                          "manualPrivateLinkServiceConnections": "[if(equals(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'isManualConnection'), true()), createObject('value', createArray(createObject('name', coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'privateLinkServiceConnectionName'), format('{0}-{1}-{2}', last(split(resourceId('Microsoft.Kusto/clusters', parameters('name')), '/')), coalesce(parameters('privateEndpoints'), createArray())[copyIndex()].service, copyIndex())), 'properties', createObject('privateLinkServiceId', resourceId('Microsoft.Kusto/clusters', parameters('name')), 'groupIds', createArray(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()].service), 'requestMessage', coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'manualConnectionRequestMessage'), 'Manual approval required.'))))), createObject('value', null()))]",
                          "subnetResourceId": {
                            "value": "[coalesce(parameters('privateEndpoints'), createArray())[copyIndex()].subnetResourceId]"
                          },
                          "enableTelemetry": {
                            "value": "[variables('enableReferencedModulesTelemetry')]"
                          },
                          "location": {
                            "value": "[coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'location'), reference(split(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()].subnetResourceId, '/subnets/')[0], '2020-06-01', 'Full').location)]"
                          },
                          "lock": {
                            "value": "[coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'lock'), parameters('lock'))]"
                          },
                          "privateDnsZoneGroup": {
                            "value": "[tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'privateDnsZoneGroup')]"
                          },
                          "roleAssignments": {
                            "value": "[tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'roleAssignments')]"
                          },
                          "tags": {
                            "value": "[coalesce(tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'tags'), parameters('tags'))]"
                          },
                          "customDnsConfigs": {
                            "value": "[tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'customDnsConfigs')]"
                          },
                          "ipConfigurations": {
                            "value": "[tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'ipConfigurations')]"
                          },
                          "applicationSecurityGroupResourceIds": {
                            "value": "[tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'applicationSecurityGroupResourceIds')]"
                          },
                          "customNetworkInterfaceName": {
                            "value": "[tryGet(coalesce(parameters('privateEndpoints'), createArray())[copyIndex()], 'customNetworkInterfaceName')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.38.5.1644",
                              "templateHash": "16604612898799598358"
                            },
                            "name": "Private Endpoints",
                            "description": "This module deploys a Private Endpoint."
                          },
                          "definitions": {
                            "privateDnsZoneGroupType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name of the Private DNS Zone Group."
                                  }
                                },
                                "privateDnsZoneGroupConfigs": {
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/definitions/privateDnsZoneGroupConfigType"
                                  },
                                  "metadata": {
                                    "description": "Required. The private DNS zone groups to associate the private endpoint. A DNS zone group can support up to 5 DNS zones."
                                  }
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type of a private dns zone group."
                              }
                            },
                            "lockType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Specify the name of lock."
                                  }
                                },
                                "kind": {
                                  "type": "string",
                                  "allowedValues": [
                                    "CanNotDelete",
                                    "None",
                                    "ReadOnly"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Specify the type of lock."
                                  }
                                },
                                "notes": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Specify the notes of the lock."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for a lock.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                                }
                              }
                            },
                            "privateDnsZoneGroupConfigType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name of the private DNS zone group config."
                                  }
                                },
                                "privateDnsZoneResourceId": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The resource id of the private DNS zone."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "The type of a private DNS zone group configuration.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "private-dns-zone-group/main.bicep"
                                }
                              }
                            },
                            "roleAssignmentType": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The name (as GUID) of the role assignment. If not provided, a GUID will be generated."
                                  }
                                },
                                "roleDefinitionIdOrName": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The role to assign. You can provide either the display name of the role definition, the role definition GUID, or its fully qualified ID in the following format: '/providers/Microsoft.Authorization/roleDefinitions/c2f4ef07-c644-48eb-af81-4b1b4947fb11'."
                                  }
                                },
                                "principalId": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The principal ID of the principal (user/group/identity) to assign the role to."
                                  }
                                },
                                "principalType": {
                                  "type": "string",
                                  "allowedValues": [
                                    "Device",
                                    "ForeignGroup",
                                    "Group",
                                    "ServicePrincipal",
                                    "User"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The principal type of the assigned principal ID."
                                  }
                                },
                                "description": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The description of the role assignment."
                                  }
                                },
                                "condition": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The conditions on the role assignment. This limits the resources it can be assigned to. e.g.: @Resource[Microsoft.Storage/storageAccounts/blobServices/containers:ContainerName] StringEqualsIgnoreCase \"foo_storage_container\"."
                                  }
                                },
                                "conditionVersion": {
                                  "type": "string",
                                  "allowedValues": [
                                    "2.0"
                                  ],
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Version of the condition."
                                  }
                                },
                                "delegatedManagedIdentityResourceId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The Resource Id of the delegated managed identity resource."
                                  }
                                }
                              },
                              "metadata": {
                                "description": "An AVM-aligned type for a role assignment.",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "br:mcr.microsoft.com/bicep/avm/utl/types/avm-common-types:0.6.1"
                                }
                              }
                            }
                          },
                          "parameters": {
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. Name of the private endpoint resource to create."
                              }
                            },
                            "subnetResourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. Resource ID of the subnet where the endpoint needs to be created."
                              }
                            },
                            "applicationSecurityGroupResourceIds": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Application security groups in which the private endpoint IP configuration is included."
                              }
                            },
                            "customNetworkInterfaceName": {
                              "type": "string",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The custom name of the network interface attached to the private endpoint."
                              }
                            },
                            "ipConfigurations": {
                              "type": "array",
                              "metadata": {
                                "__bicep_resource_derived_type!": {
                                  "source": "Microsoft.Network/privateEndpoints@2024-01-01#properties/properties/properties/ipConfigurations"
                                },
                                "description": "Optional. A list of IP configurations of the private endpoint. This will be used to map to the First Party Service endpoints."
                              },
                              "nullable": true
                            },
                            "privateDnsZoneGroup": {
                              "$ref": "#/definitions/privateDnsZoneGroupType",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The private DNS zone group to configure for the private endpoint."
                              }
                            },
                            "location": {
                              "type": "string",
                              "defaultValue": "[resourceGroup().location]",
                              "metadata": {
                                "description": "Optional. Location for all Resources."
                              }
                            },
                            "lock": {
                              "$ref": "#/definitions/lockType",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The lock settings of the service."
                              }
                            },
                            "roleAssignments": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/roleAssignmentType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. Array of role assignments to create."
                              }
                            },
                            "tags": {
                              "type": "object",
                              "metadata": {
                                "__bicep_resource_derived_type!": {
                                  "source": "Microsoft.Network/privateEndpoints@2024-01-01#properties/tags"
                                },
                                "description": "Optional. Tags to be applied on all resources/resource groups in this deployment."
                              },
                              "nullable": true
                            },
                            "customDnsConfigs": {
                              "type": "array",
                              "metadata": {
                                "__bicep_resource_derived_type!": {
                                  "source": "Microsoft.Network/privateEndpoints@2024-01-01#properties/properties/properties/customDnsConfigs"
                                },
                                "description": "Optional. Custom DNS configurations."
                              },
                              "nullable": true
                            },
                            "manualPrivateLinkServiceConnections": {
                              "type": "array",
                              "metadata": {
                                "__bicep_resource_derived_type!": {
                                  "source": "Microsoft.Network/privateEndpoints@2024-01-01#properties/properties/properties/manualPrivateLinkServiceConnections"
                                },
                                "description": "Conditional. A grouping of information about the connection to the remote resource. Used when the network admin does not have access to approve connections to the remote resource. Required if `privateLinkServiceConnections` is empty."
                              },
                              "nullable": true
                            },
                            "privateLinkServiceConnections": {
                              "type": "array",
                              "metadata": {
                                "__bicep_resource_derived_type!": {
                                  "source": "Microsoft.Network/privateEndpoints@2024-01-01#properties/properties/properties/privateLinkServiceConnections"
                                },
                                "description": "Conditional. A grouping of information about the connection to the remote resource. Required if `manualPrivateLinkServiceConnections` is empty."
                              },
                              "nullable": true
                            },
                            "enableTelemetry": {
                              "type": "bool",
                              "defaultValue": true,
                              "metadata": {
                                "description": "Optional. Enable/Disable usage telemetry for module."
                              }
                            }
                          },
                          "variables": {
                            "copy": [
                              {
                                "name": "formattedRoleAssignments",
                                "count": "[length(coalesce(parameters('roleAssignments'), createArray()))]",
                                "input": "[union(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')], createObject('roleDefinitionId', coalesce(tryGet(variables('builtInRoleNames'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName), if(contains(coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, '/providers/Microsoft.Authorization/roleDefinitions/'), coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName, subscriptionResourceId('Microsoft.Authorization/roleDefinitions', coalesce(parameters('roleAssignments'), createArray())[copyIndex('formattedRoleAssignments')].roleDefinitionIdOrName)))))]"
                              }
                            ],
                            "builtInRoleNames": {
                              "Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]",
                              "DNS Resolver Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '0f2ebee7-ffd4-4fc0-b3b7-664099fdad5d')]",
                              "DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'befefa01-2a29-4197-83a8-272ff33ce314')]",
                              "Domain Services Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'eeaeda52-9324-47f6-8069-5d5bade478b2')]",
                              "Domain Services Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '361898ef-9ed1-48c2-849c-a832951106bb')]",
                              "Network Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4d97b98b-1d4f-4787-a291-c67834d212e7')]",
                              "Owner": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]",
                              "Private DNS Zone Contributor": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b12aa53e-6015-4669-85d0-8515ebb3ae7f')]",
                              "Reader": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'acdd72a7-3385-48ef-bd42-f606fba81ae7')]",
                              "Role Based Access Control Administrator": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f58310d9-a9f6-439a-9e8d-f62e7b41a168')]"
                            }
                          },
                          "resources": {
                            "avmTelemetry": {
                              "condition": "[parameters('enableTelemetry')]",
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2025-04-01",
                              "name": "[format('46d3xbcp.res.network-privateendpoint.{0}.{1}', replace('0.11.1', '.', '-'), substring(uniqueString(deployment().name, parameters('location')), 0, 4))]",
                              "properties": {
                                "mode": "Incremental",
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "contentVersion": "1.0.0.0",
                                  "resources": [],
                                  "outputs": {
                                    "telemetry": {
                                      "type": "String",
                                      "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                                    }
                                  }
                                }
                              }
                            },
                            "privateEndpoint": {
                              "type": "Microsoft.Network/privateEndpoints",
                              "apiVersion": "2024-10-01",
                              "name": "[parameters('name')]",
                              "location": "[parameters('location')]",
                              "tags": "[parameters('tags')]",
                              "properties": {
                                "copy": [
                                  {
                                    "name": "applicationSecurityGroups",
                                    "count": "[length(coalesce(parameters('applicationSecurityGroupResourceIds'), createArray()))]",
                                    "input": {
                                      "id": "[coalesce(parameters('applicationSecurityGroupResourceIds'), createArray())[copyIndex('applicationSecurityGroups')]]"
                                    }
                                  }
                                ],
                                "customDnsConfigs": "[coalesce(parameters('customDnsConfigs'), createArray())]",
                                "customNetworkInterfaceName": "[coalesce(parameters('customNetworkInterfaceName'), '')]",
                                "ipConfigurations": "[coalesce(parameters('ipConfigurations'), createArray())]",
                                "manualPrivateLinkServiceConnections": "[coalesce(parameters('manualPrivateLinkServiceConnections'), createArray())]",
                                "privateLinkServiceConnections": "[coalesce(parameters('privateLinkServiceConnections'), createArray())]",
                                "subnet": {
                                  "id": "[parameters('subnetResourceId')]"
                                }
                              }
                            },
                            "privateEndpoint_lock": {
                              "condition": "[and(not(empty(coalesce(parameters('lock'), createObject()))), not(equals(tryGet(parameters('lock'), 'kind'), 'None')))]",
                              "type": "Microsoft.Authorization/locks",
                              "apiVersion": "2020-05-01",
                              "scope": "[format('Microsoft.Network/privateEndpoints/{0}', parameters('name'))]",
                              "name": "[coalesce(tryGet(parameters('lock'), 'name'), format('lock-{0}', parameters('name')))]",
                              "properties": {
                                "level": "[coalesce(tryGet(parameters('lock'), 'kind'), '')]",
                                "notes": "[coalesce(tryGet(parameters('lock'), 'notes'), if(equals(tryGet(parameters('lock'), 'kind'), 'CanNotDelete'), 'Cannot delete resource or child resources.', 'Cannot delete or modify the resource or child resources.'))]"
                              },
                              "dependsOn": [
                                "privateEndpoint"
                              ]
                            },
                            "privateEndpoint_roleAssignments": {
                              "copy": {
                                "name": "privateEndpoint_roleAssignments",
                                "count": "[length(coalesce(variables('formattedRoleAssignments'), createArray()))]"
                              },
                              "type": "Microsoft.Authorization/roleAssignments",
                              "apiVersion": "2022-04-01",
                              "scope": "[format('Microsoft.Network/privateEndpoints/{0}', parameters('name'))]",
                              "name": "[coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'name'), guid(resourceId('Microsoft.Network/privateEndpoints', parameters('name')), coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId, coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId))]",
                              "properties": {
                                "roleDefinitionId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].roleDefinitionId]",
                                "principalId": "[coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()].principalId]",
                                "description": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'description')]",
                                "principalType": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'principalType')]",
                                "condition": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition')]",
                                "conditionVersion": "[if(not(empty(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'condition'))), coalesce(tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'conditionVersion'), '2.0'), null())]",
                                "delegatedManagedIdentityResourceId": "[tryGet(coalesce(variables('formattedRoleAssignments'), createArray())[copyIndex()], 'delegatedManagedIdentityResourceId')]"
                              },
                              "dependsOn": [
                                "privateEndpoint"
                              ]
                            },
                            "privateEndpoint_privateDnsZoneGroup": {
                              "condition": "[not(empty(parameters('privateDnsZoneGroup')))]",
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2025-04-01",
                              "name": "[format('{0}-PrivateEndpoint-PrivateDnsZoneGroup', uniqueString(deployment().name))]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "name": {
                                    "value": "[tryGet(parameters('privateDnsZoneGroup'), 'name')]"
                                  },
                                  "privateEndpointName": {
                                    "value": "[parameters('name')]"
                                  },
                                  "privateDnsZoneConfigs": {
                                    "value": "[parameters('privateDnsZoneGroup').privateDnsZoneGroupConfigs]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "languageVersion": "2.0",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.38.5.1644",
                                      "templateHash": "24141742673128945"
                                    },
                                    "name": "Private Endpoint Private DNS Zone Groups",
                                    "description": "This module deploys a Private Endpoint Private DNS Zone Group."
                                  },
                                  "definitions": {
                                    "privateDnsZoneGroupConfigType": {
                                      "type": "object",
                                      "properties": {
                                        "name": {
                                          "type": "string",
                                          "nullable": true,
                                          "metadata": {
                                            "description": "Optional. The name of the private DNS zone group config."
                                          }
                                        },
                                        "privateDnsZoneResourceId": {
                                          "type": "string",
                                          "metadata": {
                                            "description": "Required. The resource id of the private DNS zone."
                                          }
                                        }
                                      },
                                      "metadata": {
                                        "__bicep_export!": true,
                                        "description": "The type of a private DNS zone group configuration."
                                      }
                                    }
                                  },
                                  "parameters": {
                                    "privateEndpointName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Conditional. The name of the parent private endpoint. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "privateDnsZoneConfigs": {
                                      "type": "array",
                                      "items": {
                                        "$ref": "#/definitions/privateDnsZoneGroupConfigType"
                                      },
                                      "minLength": 1,
                                      "maxLength": 5,
                                      "metadata": {
                                        "description": "Required. Array of private DNS zone configurations of the private DNS zone group. A DNS zone group can support up to 5 DNS zones."
                                      }
                                    },
                                    "name": {
                                      "type": "string",
                                      "defaultValue": "default",
                                      "metadata": {
                                        "description": "Optional. The name of the private DNS zone group."
                                      }
                                    }
                                  },
                                  "resources": {
                                    "privateEndpoint": {
                                      "existing": true,
                                      "type": "Microsoft.Network/privateEndpoints",
                                      "apiVersion": "2024-10-01",
                                      "name": "[parameters('privateEndpointName')]"
                                    },
                                    "privateDnsZoneGroup": {
                                      "type": "Microsoft.Network/privateEndpoints/privateDnsZoneGroups",
                                      "apiVersion": "2024-10-01",
                                      "name": "[format('{0}/{1}', parameters('privateEndpointName'), parameters('name'))]",
                                      "properties": {
                                        "copy": [
                                          {
                                            "name": "privateDnsZoneConfigs",
                                            "count": "[length(parameters('privateDnsZoneConfigs'))]",
                                            "input": {
                                              "name": "[coalesce(tryGet(parameters('privateDnsZoneConfigs')[copyIndex('privateDnsZoneConfigs')], 'name'), last(split(parameters('privateDnsZoneConfigs')[copyIndex('privateDnsZoneConfigs')].privateDnsZoneResourceId, '/')))]",
                                              "properties": {
                                                "privateDnsZoneId": "[parameters('privateDnsZoneConfigs')[copyIndex('privateDnsZoneConfigs')].privateDnsZoneResourceId]"
                                              }
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  },
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the private endpoint DNS zone group."
                                      },
                                      "value": "[parameters('name')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource ID of the private endpoint DNS zone group."
                                      },
                                      "value": "[resourceId('Microsoft.Network/privateEndpoints/privateDnsZoneGroups', parameters('privateEndpointName'), parameters('name'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group the private endpoint DNS zone group was deployed into."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "privateEndpoint"
                              ]
                            }
                          },
                          "outputs": {
                            "resourceGroupName": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource group the private endpoint was deployed into."
                              },
                              "value": "[resourceGroup().name]"
                            },
                            "resourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource ID of the private endpoint."
                              },
                              "value": "[resourceId('Microsoft.Network/privateEndpoints', parameters('name'))]"
                            },
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the private endpoint."
                              },
                              "value": "[parameters('name')]"
                            },
                            "location": {
                              "type": "string",
                              "metadata": {
                                "description": "The location the resource was deployed into."
                              },
                              "value": "[reference('privateEndpoint', '2024-10-01', 'full').location]"
                            },
                            "customDnsConfigs": {
                              "type": "array",
                              "metadata": {
                                "__bicep_resource_derived_type!": {
                                  "source": "Microsoft.Network/privateEndpoints@2024-01-01#properties/properties/properties/customDnsConfigs",
                                  "output": true
                                },
                                "description": "The custom DNS configurations of the private endpoint."
                              },
                              "value": "[reference('privateEndpoint').customDnsConfigs]"
                            },
                            "networkInterfaceResourceIds": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              },
                              "metadata": {
                                "description": "The resource IDs of the network interfaces associated with the private endpoint."
                              },
                              "value": "[map(reference('privateEndpoint').networkInterfaces, lambda('nic', lambdaVariables('nic').id))]"
                            },
                            "groupId": {
                              "type": "string",
                              "nullable": true,
                              "metadata": {
                                "description": "The group Id for the private endpoint Group."
                              },
                              "value": "[coalesce(tryGet(tryGet(tryGet(tryGet(reference('privateEndpoint'), 'manualPrivateLinkServiceConnections'), 0, 'properties'), 'groupIds'), 0), tryGet(tryGet(tryGet(tryGet(reference('privateEndpoint'), 'privateLinkServiceConnections'), 0, 'properties'), 'groupIds'), 0))]"
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "kustoCluster"
                      ]
                    },
                    "kustoCluster_databases": {
                      "copy": {
                        "name": "kustoCluster_databases",
                        "count": "[length(coalesce(parameters('databases'), createArray()))]"
                      },
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "[format('{0}-kustoCluster-database-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "name": {
                            "value": "[coalesce(parameters('databases'), createArray())[copyIndex()].name]"
                          },
                          "kustoClusterName": {
                            "value": "[parameters('name')]"
                          },
                          "location": {
                            "value": "[parameters('location')]"
                          },
                          "databaseKind": {
                            "value": "[coalesce(parameters('databases'), createArray())[copyIndex()].kind]"
                          },
                          "databaseReadWriteProperties": "[if(equals(coalesce(parameters('databases'), createArray())[copyIndex()].kind, 'ReadWrite'), createObject('value', coalesce(parameters('databases'), createArray())[copyIndex()].readWriteProperties), createObject('value', null()))]",
                          "databasePrincipalAssignments": {
                            "value": "[coalesce(parameters('databases'), createArray())[copyIndex()].databasePrincipalAssignments]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.40.2.10011",
                              "templateHash": "4679326301457114965"
                            },
                            "name": "Kusto Cluster Databases",
                            "description": "This module deploys a Kusto Cluster Database."
                          },
                          "definitions": {
                            "databaseReadWriteType": {
                              "type": "object",
                              "properties": {
                                "hotCachePeriod": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. Te time the data should be kept in cache for fast queries in TimeSpan."
                                  }
                                },
                                "keyVaultProperties": {
                                  "type": "object",
                                  "properties": {
                                    "keyName": {
                                      "type": "string",
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. The name of the key."
                                      }
                                    },
                                    "keyVaultUri": {
                                      "type": "string",
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. The Uri of the key vault."
                                      }
                                    },
                                    "keyVersion": {
                                      "type": "string",
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. The version of the key."
                                      }
                                    },
                                    "userIdentity": {
                                      "type": "string",
                                      "nullable": true,
                                      "metadata": {
                                        "description": "Optional. The user identity."
                                      }
                                    }
                                  },
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The properties of the key vault."
                                  }
                                },
                                "softDeletePeriod": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The time the data should be kept before it stops being accessible to queries in TimeSpan."
                                  }
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The properties of the database if using read-write."
                              }
                            },
                            "databasePrincipalAssignmentType": {
                              "type": "object",
                              "properties": {
                                "principalId": {
                                  "type": "string",
                                  "metadata": {
                                    "description": "Required. The principal id assigned to the Kusto Cluster database principal. It can be a user email, application id, or security group name."
                                  }
                                },
                                "principalType": {
                                  "type": "string",
                                  "allowedValues": [
                                    "App",
                                    "Group",
                                    "User"
                                  ],
                                  "metadata": {
                                    "description": "Required. The principal type of the principal id."
                                  }
                                },
                                "role": {
                                  "type": "string",
                                  "allowedValues": [
                                    "Admin",
                                    "Ingestor",
                                    "Monitor",
                                    "UnrestrictedViewer",
                                    "User",
                                    "Viewer"
                                  ],
                                  "metadata": {
                                    "description": "Required. The Kusto Cluster database role to be assigned to the principal id."
                                  }
                                },
                                "tenantId": {
                                  "type": "string",
                                  "nullable": true,
                                  "metadata": {
                                    "description": "Optional. The tenant id of the principal."
                                  }
                                }
                              },
                              "metadata": {
                                "__bicep_export!": true,
                                "description": "The type of a database principal assignment."
                              }
                            }
                          },
                          "parameters": {
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. The name of the Kusto Cluster database."
                              }
                            },
                            "kustoClusterName": {
                              "type": "string",
                              "metadata": {
                                "description": "Conditional. The name of the parent Kusto Cluster. Required if the template is used in a standalone deployment."
                              }
                            },
                            "location": {
                              "type": "string",
                              "defaultValue": "[resourceGroup().location]",
                              "metadata": {
                                "description": "Optional. Location for the databases."
                              }
                            },
                            "databaseKind": {
                              "type": "string",
                              "defaultValue": "ReadWrite",
                              "allowedValues": [
                                "ReadWrite",
                                "ReadOnlyFollowing"
                              ],
                              "metadata": {
                                "description": "Optional. The object type of the databse."
                              }
                            },
                            "databaseReadWriteProperties": {
                              "$ref": "#/definitions/databaseReadWriteType",
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The properties of the database if using read-write. Only used if databaseKind is ReadWrite."
                              }
                            },
                            "databasePrincipalAssignments": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/databasePrincipalAssignmentType"
                              },
                              "nullable": true,
                              "metadata": {
                                "description": "Optional. The principal assignments for the Kusto database."
                              }
                            }
                          },
                          "resources": {
                            "kustoCluster": {
                              "existing": true,
                              "type": "Microsoft.Kusto/clusters",
                              "apiVersion": "2024-04-13",
                              "name": "[parameters('kustoClusterName')]"
                            },
                            "database_readWrite": {
                              "condition": "[equals(parameters('databaseKind'), 'ReadWrite')]",
                              "type": "Microsoft.Kusto/clusters/databases",
                              "apiVersion": "2024-04-13",
                              "name": "[format('{0}/{1}', parameters('kustoClusterName'), parameters('name'))]",
                              "location": "[parameters('location')]",
                              "kind": "ReadWrite",
                              "properties": "[coalesce(parameters('databaseReadWriteProperties'), null())]"
                            },
                            "database_readOnly": {
                              "condition": "[equals(parameters('databaseKind'), 'ReadOnlyFollowing')]",
                              "type": "Microsoft.Kusto/clusters/databases",
                              "apiVersion": "2024-04-13",
                              "name": "[format('{0}/{1}', parameters('kustoClusterName'), parameters('name'))]",
                              "location": "[parameters('location')]",
                              "kind": "ReadOnlyFollowing"
                            },
                            "database_readWrite_PrincipalAssignment": {
                              "copy": {
                                "name": "database_readWrite_PrincipalAssignment",
                                "count": "[length(coalesce(parameters('databasePrincipalAssignments'), createArray()))]"
                              },
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2025-04-01",
                              "name": "[format('{0}-KDB-PrincipalAssignment-{1}', uniqueString(deployment().name, parameters('location')), copyIndex())]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "kustoClusterName": {
                                    "value": "[parameters('kustoClusterName')]"
                                  },
                                  "kustoDatabaseName": "[if(equals(parameters('databaseKind'), 'ReadOnlyFollowing'), createObject('value', parameters('name')), createObject('value', parameters('name')))]",
                                  "principalId": {
                                    "value": "[coalesce(parameters('databasePrincipalAssignments'), createArray())[copyIndex()].principalId]"
                                  },
                                  "principalType": {
                                    "value": "[coalesce(parameters('databasePrincipalAssignments'), createArray())[copyIndex()].principalType]"
                                  },
                                  "role": {
                                    "value": "[coalesce(parameters('databasePrincipalAssignments'), createArray())[copyIndex()].role]"
                                  },
                                  "tenantId": {
                                    "value": "[tryGet(coalesce(parameters('databasePrincipalAssignments'), createArray())[copyIndex()], 'tenantId')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.40.2.10011",
                                      "templateHash": "6533806870686790278"
                                    },
                                    "name": "Kusto Cluster Database Principal Assignments",
                                    "description": "This module deploys a Kusto Cluster Database Principal Assignment."
                                  },
                                  "parameters": {
                                    "kustoClusterName": {
                                      "type": "string",
                                      "maxLength": 22,
                                      "metadata": {
                                        "description": "Required. The name of the Kusto cluster."
                                      }
                                    },
                                    "kustoDatabaseName": {
                                      "type": "string",
                                      "minLength": 4,
                                      "maxLength": 22,
                                      "metadata": {
                                        "description": "Required. The name of the parent Kusto Cluster Database. Required if the template is used in a standalone deployment."
                                      }
                                    },
                                    "principalId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Required. The principal id assigned to the Kusto Cluster database principal. It can be a user email, application id, or security group name."
                                      }
                                    },
                                    "principalType": {
                                      "type": "string",
                                      "allowedValues": [
                                        "App",
                                        "Group",
                                        "User"
                                      ],
                                      "metadata": {
                                        "description": "Required. The principal type of the principal id."
                                      }
                                    },
                                    "role": {
                                      "type": "string",
                                      "allowedValues": [
                                        "Admin",
                                        "Ingestor",
                                        "Monitor",
                                        "UnrestrictedViewer",
                                        "User",
                                        "Viewer"
                                      ],
                                      "metadata": {
                                        "description": "Required. The Kusto Cluster database role to be assigned to the principal id."
                                      }
                                    },
                                    "tenantId": {
                                      "type": "string",
                                      "defaultValue": "[tenant().tenantId]",
                                      "metadata": {
                                        "description": "Optional. The tenant id of the principal."
                                      }
                                    }
                                  },
                                  "resources": [
                                    {
                                      "type": "Microsoft.Kusto/clusters/databases/principalAssignments",
                                      "apiVersion": "2024-04-13",
                                      "name": "[format('{0}/{1}/{2}', parameters('kustoClusterName'), parameters('kustoDatabaseName'), parameters('principalId'))]",
                                      "properties": {
                                        "principalId": "[parameters('principalId')]",
                                        "principalType": "[parameters('principalType')]",
                                        "role": "[parameters('role')]",
                                        "tenantId": "[parameters('tenantId')]"
                                      }
                                    }
                                  ],
                                  "outputs": {
                                    "name": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The name of the deployed Kusto Cluster Database Principal Assignment."
                                      },
                                      "value": "[parameters('principalId')]"
                                    },
                                    "resourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource id of the deployed Kusto Cluster Database Principal Assignment."
                                      },
                                      "value": "[resourceId('Microsoft.Kusto/clusters/databases/principalAssignments', parameters('kustoClusterName'), parameters('kustoDatabaseName'), parameters('principalId'))]"
                                    },
                                    "resourceGroupName": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "The resource group name of the deployed Kusto Cluster Database Principal Assignment."
                                      },
                                      "value": "[resourceGroup().name]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "database_readOnly",
                                "database_readWrite"
                              ]
                            }
                          },
                          "outputs": {
                            "name": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the Kusto Cluster database."
                              },
                              "value": "[if(equals(parameters('databaseKind'), 'ReadOnlyFollowing'), parameters('name'), parameters('name'))]"
                            },
                            "resourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource ID of the Kusto Cluster database."
                              },
                              "value": "[if(equals(parameters('databaseKind'), 'ReadOnlyFollowing'), resourceId('Microsoft.Kusto/clusters/databases', parameters('kustoClusterName'), parameters('name')), resourceId('Microsoft.Kusto/clusters/databases', parameters('kustoClusterName'), parameters('name')))]"
                            },
                            "resourceGroupName": {
                              "type": "string",
                              "metadata": {
                                "description": "The resource group containing the Kusto Cluster database."
                              },
                              "value": "[resourceGroup().name]"
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "kustoCluster"
                      ]
                    }
                  },
                  "outputs": {
                    "resourceGroupName": {
                      "type": "string",
                      "metadata": {
                        "description": "The resource group the kusto cluster was deployed into."
                      },
                      "value": "[resourceGroup().name]"
                    },
                    "resourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "The resource id of the kusto cluster."
                      },
                      "value": "[resourceId('Microsoft.Kusto/clusters', parameters('name'))]"
                    },
                    "systemAssignedMIPrincipalId": {
                      "type": "string",
                      "nullable": true,
                      "metadata": {
                        "description": "The principal ID of the system assigned identity."
                      },
                      "value": "[tryGet(tryGet(reference('kustoCluster', '2024-04-13', 'full'), 'identity'), 'principalId')]"
                    },
                    "name": {
                      "type": "string",
                      "metadata": {
                        "description": "The name of the kusto cluster."
                      },
                      "value": "[parameters('name')]"
                    },
                    "location": {
                      "type": "string",
                      "metadata": {
                        "description": "The location the resource was deployed into."
                      },
                      "value": "[reference('kustoCluster', '2024-04-13', 'full').location]"
                    },
                    "privateEndpoints": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/privateEndpointOutputType"
                      },
                      "metadata": {
                        "description": "The private endpoints of the resource."
                      },
                      "copy": {
                        "count": "[length(coalesce(parameters('privateEndpoints'), createArray()))]",
                        "input": {
                          "name": "[reference(format('kustoCluster_privateEndpoints[{0}]', copyIndex())).outputs.name.value]",
                          "resourceId": "[reference(format('kustoCluster_privateEndpoints[{0}]', copyIndex())).outputs.resourceId.value]",
                          "groupId": "[tryGet(tryGet(reference(format('kustoCluster_privateEndpoints[{0}]', copyIndex())).outputs, 'groupId'), 'value')]",
                          "customDnsConfigs": "[reference(format('kustoCluster_privateEndpoints[{0}]', copyIndex())).outputs.customDnsConfigs.value]",
                          "networkInterfaceResourceIds": "[reference(format('kustoCluster_privateEndpoints[{0}]', copyIndex())).outputs.networkInterfaceResourceIds.value]"
                        }
                      }
                    },
                    "databases": {
                      "type": "array",
                      "metadata": {
                        "description": "The databases of the kusto cluster."
                      },
                      "copy": {
                        "count": "[length(if(not(empty(parameters('databases'))), array(parameters('databases')), createArray()))]",
                        "input": {
                          "name": "[reference(format('kustoCluster_databases[{0}]', copyIndex())).outputs.name.value]",
                          "resourceId": "[reference(format('kustoCluster_databases[{0}]', copyIndex())).outputs.resourceId.value]"
                        }
                      }
                    }
                  }
                }
              },
              "dependsOn": [
                "dataFactory",
                "existingManagedIdentity",
                "managedIdentity",
                "managedNetwork"
              ]
            },
            "adxSchemaSetup": {
              "condition": "[variables('deployAdxSchema')]",
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-adx-schema', uniqueString(deployment().name, parameters('location')))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "clusterName": "[if(variables('createNewAdx'), createObject('value', reference('dataExplorer').outputs.name.value), createObject('value', variables('existingAdxClusterName')))]",
                  "rawRetentionInDays": {
                    "value": 30
                  },
                  "continueOnErrors": {
                    "value": true
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.40.2.10011",
                      "templateHash": "8471779320859794884"
                    }
                  },
                  "parameters": {
                    "clusterName": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. Name of the Azure Data Explorer cluster."
                      }
                    },
                    "rawRetentionInDays": {
                      "type": "int",
                      "defaultValue": 30,
                      "minValue": 1,
                      "maxValue": 365,
                      "metadata": {
                        "description": "Optional. Raw data retention period in days. Default: 30"
                      }
                    },
                    "continueOnErrors": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Optional. If true, script execution continues even if some commands fail. Default: true."
                      }
                    },
                    "forceUpdateTag": {
                      "type": "string",
                      "defaultValue": "[utcNow()]",
                      "metadata": {
                        "description": "Optional. Force script re-execution by changing this value."
                      }
                    }
                  },
                  "variables": {
                    "$fxv#0": "// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\n//======================================================================================================================\n// Ingestion database\n// Used for data ingestion, normalization, and cleansing.\n//======================================================================================================================\n\n// For allowed commands, see https://learn.microsoft.com/azure/data-explorer/database-script\n\n//===| ActualCosts |====================================================================================================\n// Supported versions:\n// - C360-2025-04\n//======================================================================================================================\n\n// ActualCosts_raw table -- Create the table if it doesn't exist\n.create-merge table ActualCosts_raw ( ignore: string )\n\n// ActualCosts_raw table -- Remove all columns to allow changing column types\n.alter table ActualCosts_raw ( ignore: string )\n\n// ActualCosts_raw table -- Redefine all columns\n.alter table ActualCosts_raw (\n    AccountName:            string,\n    AccountOwnerId:         string,\n    AdditionalInfo:         string,\n    AvailabilityZone:       string,\n    BillingAccountId:       string, \n    BillingAccountName:     string,\n    BillingCurrency:        string,\n    BillingPeriodEndDate:   datetime,\n    BillingPeriodStartDate: datetime,\n    BillingProfileId:       string,\n    BillingProfileName:     string,\n    ChargeType:             string,\n    ConsumedService:        string,\n    CostCenter:             string,\n    Cost:                   real,\n    Date:                   datetime,\n    EffectivePrice:         real,\n    Frequency:              string,\n    InvoiceSection:         string,\n    InvoiceSectionId:       string,\n    IsAzureCreditEligible:  bool,\n    MeterCategory:          string,\n    MeterId:                string,\n    MeterName:              string,\n    MeterRegion:            string,\n    MeterSubCategory:       string,\n    OfferId:                string,\n    PartNumber:             string,\n    PlanName:               string,\n    Product:                string,\n    ProductOrderId:         string,\n    ProductOrderName:       string,\n    PublisherName:          string,\n    PublisherType:          string,\n    Quantity:               real,\n    ReservationId:          string,\n    ReservationName:        string,\n    ResourceGroup:          string,\n    ResourceId:             string,\n    ResourceLocation:       string,\n    ResourceName:           string,\n    ServiceFamily:          string,\n    ServiceInfo1:           string,\n    ServiceInfo2:           string,\n    SubscriptionId:         string,\n    SubscriptionName:       string,\n    Tags:                   string,\n    Term:                   string,\n    UnitOfMeasure:          string,\n    UnitPrice:              real\n)\n\n// ActualCosts_raw ingestion mapping\n.create-or-alter table ActualCosts_raw ingestion parquet mapping \"ActualCosts_raw_mapping\"\n```\n[\n    { \"Column\": \"AccountName\",            \"Properties\": { \"Field\": \"AccountName\" } },\n    { \"Column\": \"AccountOwnerId\",         \"Properties\": { \"Field\": \"AccountOwnerId\" } },\n    { \"Column\": \"AdditionalInfo\",         \"Properties\": { \"Field\": \"AdditionalInfo\" } },\n    { \"Column\": \"AvailabilityZone\",       \"Properties\": { \"Field\": \"AvailabilityZone\" } },\n    { \"Column\": \"BillingAccountId\",       \"Properties\": { \"Field\": \"BillingAccountId\" } },\n    { \"Column\": \"BillingAccountName\",     \"Properties\": { \"Field\": \"BillingAccountName\" } },\n    { \"Column\": \"BillingCurrency\",        \"Properties\": { \"Field\": \"BillingCurrency\" } },\n    { \"Column\": \"BillingPeriodEndDate\",   \"Properties\": { \"Field\": \"BillingPeriodEndDate\" } },\n    { \"Column\": \"BillingPeriodStartDate\", \"Properties\": { \"Field\": \"BillingPeriodStartDate\" } },\n    { \"Column\": \"BillingProfileId\",       \"Properties\": { \"Field\": \"BillingProfileId\" } },\n    { \"Column\": \"BillingProfileName\",     \"Properties\": { \"Field\": \"BillingProfileName\" } },\n    { \"Column\": \"ChargeType\",             \"Properties\": { \"Field\": \"ChargeType\" } },\n    { \"Column\": \"ConsumedService\",        \"Properties\": { \"Field\": \"ConsumedService\" } },\n    { \"Column\": \"CostCenter\",             \"Properties\": { \"Field\": \"CostCenter\" } },\n    { \"Column\": \"Cost\",                   \"Properties\": { \"Field\": \"Cost\" } },\n    { \"Column\": \"Date\",                   \"Properties\": { \"Field\": \"Date\" } },\n    { \"Column\": \"EffectivePrice\",         \"Properties\": { \"Field\": \"EffectivePrice\" } },\n    { \"Column\": \"Frequency\",              \"Properties\": { \"Field\": \"Frequency\" } },\n    { \"Column\": \"InvoiceSection\",         \"Properties\": { \"Field\": \"InvoiceSection\" } },\n    { \"Column\": \"InvoiceSectionId\",       \"Properties\": { \"Field\": \"InvoiceSectionId\" } },\n    { \"Column\": \"IsAzureCreditEligible\",  \"Properties\": { \"Field\": \"IsAzureCreditEligible\" } },\n    { \"Column\": \"MeterCategory\",          \"Properties\": { \"Field\": \"MeterCategory\" } },\n    { \"Column\": \"MeterId\",                \"Properties\": { \"Field\": \"MeterId\" } },\n    { \"Column\": \"MeterName\",              \"Properties\": { \"Field\": \"MeterName\" } },\n    { \"Column\": \"MeterRegion\",            \"Properties\": { \"Field\": \"MeterRegion\" } },\n    { \"Column\": \"MeterSubCategory\",       \"Properties\": { \"Field\": \"MeterSubCategory\" } },\n    { \"Column\": \"OfferId\",                \"Properties\": { \"Field\": \"OfferId\" } },\n    { \"Column\": \"PartNumber\",             \"Properties\": { \"Field\": \"PartNumber\" } },\n    { \"Column\": \"PlanName\",               \"Properties\": { \"Field\": \"PlanName\" } },\n    { \"Column\": \"Product\",                \"Properties\": { \"Field\": \"Product\" } },\n    { \"Column\": \"ProductOrderId\",         \"Properties\": { \"Field\": \"ProductOrderId\" } },\n    { \"Column\": \"ProductOrderName\",       \"Properties\": { \"Field\": \"ProductOrderName\" } },\n    { \"Column\": \"PublisherName\",          \"Properties\": { \"Field\": \"PublisherName\" } },\n    { \"Column\": \"PublisherType\",          \"Properties\": { \"Field\": \"PublisherType\" } },\n    { \"Column\": \"Quantity\",               \"Properties\": { \"Field\": \"Quantity\" } },\n    { \"Column\": \"ReservationId\",          \"Properties\": { \"Field\": \"ReservationId\" } },\n    { \"Column\": \"ReservationName\",        \"Properties\": { \"Field\": \"ReservationName\" } },\n    { \"Column\": \"ResourceGroup\",          \"Properties\": { \"Field\": \"ResourceGroup\" } },\n    { \"Column\": \"ResourceId\",             \"Properties\": { \"Field\": \"ResourceId\" } },\n    { \"Column\": \"ResourceLocation\",       \"Properties\": { \"Field\": \"ResourceLocation\" } },\n    { \"Column\": \"ResourceName\",           \"Properties\": { \"Field\": \"ResourceName\" } },\n    { \"Column\": \"ServiceFamily\",          \"Properties\": { \"Field\": \"ServiceFamily\" } },\n    { \"Column\": \"ServiceInfo1\",           \"Properties\": { \"Field\": \"ServiceInfo1\" } },\n    { \"Column\": \"ServiceInfo2\",           \"Properties\": { \"Field\": \"ServiceInfo2\" } },\n    { \"Column\": \"SubscriptionId\",         \"Properties\": { \"Field\": \"SubscriptionId\" } },\n    { \"Column\": \"SubscriptionName\",       \"Properties\": { \"Field\": \"SubscriptionName\" } },\n    { \"Column\": \"Tags\",                   \"Properties\": { \"Field\": \"Tags\" } },\n    { \"Column\": \"Term\",                   \"Properties\": { \"Field\": \"Term\" } },\n    { \"Column\": \"UnitOfMeasure\",          \"Properties\": { \"Field\": \"UnitOfMeasure\" } },\n    { \"Column\": \"UnitPrice\",              \"Properties\": { \"Field\": \"UnitPrice\" } }\n]\n```\n\n// ActualCosts_raw retention policy (clear historical data)\n.alter-merge table ActualCosts_raw policy retention softdelete = 0d recoverability = disabled\n\n// ActualCosts_raw retention policy (set the user-defined retention period)\n.alter-merge table ActualCosts_raw policy retention softdelete = $$rawRetentionInDays$$d recoverability = disabled\n\n\n//===| AmortizedCosts |=================================================================================================\n// Supported versions:\n// - C360-2025-04\n//======================================================================================================================\n\n// AmortizedCosts_raw table -- Create the table if it doesn't exist\n.create-merge table AmortizedCosts_raw ( ignore: string )\n\n// AmortizedCosts_raw table -- Remove all columns to allow changing column types\n.alter table AmortizedCosts_raw ( ignore: string )\n\n// AmortizedCosts_raw table -- Redefine all columns\n.alter table AmortizedCosts_raw (\n    AccountName:            string,\n    AccountOwnerId:         string,\n    AdditionalInfo:         string,\n    AvailabilityZone:       string,\n    BillingAccountId:       string, \n    BillingAccountName:     string,\n    BillingCurrency:        string,\n    BillingPeriodEndDate:   datetime,\n    BillingPeriodStartDate: datetime,\n    BillingProfileId:       string,\n    BillingProfileName:     string,\n    ChargeType:             string,\n    ConsumedService:        string,\n    CostCenter:             string,\n    Cost:                   real,\n    Date:                   datetime,\n    EffectivePrice:         real,\n    Frequency:              string,\n    InvoiceSection:         string,\n    InvoiceSectionId:       string,\n    IsAzureCreditEligible:  bool,\n    MeterCategory:          string,\n    MeterId:                string,\n    MeterName:              string,\n    MeterRegion:            string,\n    MeterSubCategory:       string,\n    OfferId:                string,\n    PartNumber:             string,\n    PlanName:               string,\n    Product:                string,\n    ProductOrderId:         string,\n    ProductOrderName:       string,\n    PublisherName:          string,\n    PublisherType:          string,\n    Quantity:               real,\n    ReservationId:          string,\n    ReservationName:        string,\n    ResourceGroup:          string,\n    ResourceId:             string,\n    ResourceLocation:       string,\n    ResourceName:           string,\n    ServiceFamily:          string,\n    ServiceInfo1:           string,\n    ServiceInfo2:           string,\n    SubscriptionId:         string,\n    SubscriptionName:       string,\n    Tags:                   string,\n    Term:                   string,\n    UnitOfMeasure:          string,\n    UnitPrice:              real\n)\n\n// AmortizedCosts_raw ingestion mapping\n.create-or-alter table AmortizedCosts_raw ingestion parquet mapping \"AmortizedCosts_raw_mapping\"\n```\n[\n    { \"Column\": \"AccountName\",            \"Properties\": { \"Field\": \"AccountName\" } },\n    { \"Column\": \"AccountOwnerId\",         \"Properties\": { \"Field\": \"AccountOwnerId\" } },\n    { \"Column\": \"AdditionalInfo\",         \"Properties\": { \"Field\": \"AdditionalInfo\" } },\n    { \"Column\": \"AvailabilityZone\",       \"Properties\": { \"Field\": \"AvailabilityZone\" } },\n    { \"Column\": \"BillingAccountId\",       \"Properties\": { \"Field\": \"BillingAccountId\" } },\n    { \"Column\": \"BillingAccountName\",     \"Properties\": { \"Field\": \"BillingAccountName\" } },\n    { \"Column\": \"BillingCurrency\",        \"Properties\": { \"Field\": \"BillingCurrency\" } },\n    { \"Column\": \"BillingPeriodEndDate\",   \"Properties\": { \"Field\": \"BillingPeriodEndDate\" } },\n    { \"Column\": \"BillingPeriodStartDate\", \"Properties\": { \"Field\": \"BillingPeriodStartDate\" } },\n    { \"Column\": \"BillingProfileId\",       \"Properties\": { \"Field\": \"BillingProfileId\" } },\n    { \"Column\": \"BillingProfileName\",     \"Properties\": { \"Field\": \"BillingProfileName\" } },\n    { \"Column\": \"ChargeType\",             \"Properties\": { \"Field\": \"ChargeType\" } },\n    { \"Column\": \"ConsumedService\",        \"Properties\": { \"Field\": \"ConsumedService\" } },\n    { \"Column\": \"CostCenter\",             \"Properties\": { \"Field\": \"CostCenter\" } },\n    { \"Column\": \"Cost\",                   \"Properties\": { \"Field\": \"Cost\" } },\n    { \"Column\": \"Date\",                   \"Properties\": { \"Field\": \"Date\" } },\n    { \"Column\": \"EffectivePrice\",         \"Properties\": { \"Field\": \"EffectivePrice\" } },\n    { \"Column\": \"Frequency\",              \"Properties\": { \"Field\": \"Frequency\" } },\n    { \"Column\": \"InvoiceSection\",         \"Properties\": { \"Field\": \"InvoiceSection\" } },\n    { \"Column\": \"InvoiceSectionId\",       \"Properties\": { \"Field\": \"InvoiceSectionId\" } },\n    { \"Column\": \"IsAzureCreditEligible\",  \"Properties\": { \"Field\": \"IsAzureCreditEligible\" } },\n    { \"Column\": \"MeterCategory\",          \"Properties\": { \"Field\": \"MeterCategory\" } },\n    { \"Column\": \"MeterId\",                \"Properties\": { \"Field\": \"MeterId\" } },\n    { \"Column\": \"MeterName\",              \"Properties\": { \"Field\": \"MeterName\" } },\n    { \"Column\": \"MeterRegion\",            \"Properties\": { \"Field\": \"MeterRegion\" } },\n    { \"Column\": \"MeterSubCategory\",       \"Properties\": { \"Field\": \"MeterSubCategory\" } },\n    { \"Column\": \"OfferId\",                \"Properties\": { \"Field\": \"OfferId\" } },\n    { \"Column\": \"PartNumber\",             \"Properties\": { \"Field\": \"PartNumber\" } },\n    { \"Column\": \"PlanName\",               \"Properties\": { \"Field\": \"PlanName\" } },\n    { \"Column\": \"Product\",                \"Properties\": { \"Field\": \"Product\" } },\n    { \"Column\": \"ProductOrderId\",         \"Properties\": { \"Field\": \"ProductOrderId\" } },\n    { \"Column\": \"ProductOrderName\",       \"Properties\": { \"Field\": \"ProductOrderName\" } },\n    { \"Column\": \"PublisherName\",          \"Properties\": { \"Field\": \"PublisherName\" } },\n    { \"Column\": \"PublisherType\",          \"Properties\": { \"Field\": \"PublisherType\" } },\n    { \"Column\": \"Quantity\",               \"Properties\": { \"Field\": \"Quantity\" } },\n    { \"Column\": \"ReservationId\",          \"Properties\": { \"Field\": \"ReservationId\" } },\n    { \"Column\": \"ReservationName\",        \"Properties\": { \"Field\": \"ReservationName\" } },\n    { \"Column\": \"ResourceGroup\",          \"Properties\": { \"Field\": \"ResourceGroup\" } },\n    { \"Column\": \"ResourceId\",             \"Properties\": { \"Field\": \"ResourceId\" } },\n    { \"Column\": \"ResourceLocation\",       \"Properties\": { \"Field\": \"ResourceLocation\" } },\n    { \"Column\": \"ResourceName\",           \"Properties\": { \"Field\": \"ResourceName\" } },\n    { \"Column\": \"ServiceFamily\",          \"Properties\": { \"Field\": \"ServiceFamily\" } },\n    { \"Column\": \"ServiceInfo1\",           \"Properties\": { \"Field\": \"ServiceInfo1\" } },\n    { \"Column\": \"ServiceInfo2\",           \"Properties\": { \"Field\": \"ServiceInfo2\" } },\n    { \"Column\": \"SubscriptionId\",         \"Properties\": { \"Field\": \"SubscriptionId\" } },\n    { \"Column\": \"SubscriptionName\",       \"Properties\": { \"Field\": \"SubscriptionName\" } },\n    { \"Column\": \"Tags\",                   \"Properties\": { \"Field\": \"Tags\" } },\n    { \"Column\": \"Term\",                   \"Properties\": { \"Field\": \"Term\" } },\n    { \"Column\": \"UnitOfMeasure\",          \"Properties\": { \"Field\": \"UnitOfMeasure\" } },\n    { \"Column\": \"UnitPrice\",              \"Properties\": { \"Field\": \"UnitPrice\" } }\n]\n```\n\n// AmortizedCosts_raw retention policy (clear historical data)\n.alter-merge table AmortizedCosts_raw policy retention softdelete = 0d recoverability = disabled\n\n// AmortizedCosts_raw retention policy (set the user-defined retention period)\n.alter-merge table AmortizedCosts_raw policy retention softdelete = $$rawRetentionInDays$$d recoverability = disabled\n\n\n//===| CommitmentDiscountUsage |========================================================================================\n// Supported versions:\n// - MS EA reservation details: 2023-03-01  -- See https://learn.microsoft.com/azure/cost-management-billing/dataset-schema/reservation-details-ea\n// - MS MCA reservation details: 2023-03-01 -- See https://learn.microsoft.com/azure/cost-management-billing/dataset-schema/reservation-details-mca\n//======================================================================================================================\n\n// CommitmentDiscountUsage_raw table -- Create the table if it doesn't exist\n.create-merge table CommitmentDiscountUsage_raw ( ignore: string )\n\n// CommitmentDiscountUsage_raw table -- Remove all columns to allow changing column types\n.alter table CommitmentDiscountUsage_raw ( ignore: string )\n\n// CommitmentDiscountUsage_raw table -- Redefine all columns\n.alter table CommitmentDiscountUsage_raw (\n    InstanceFlexibilityGroup: string,\n    InstanceFlexibilityRatio: real,\n    InstanceId:               string,\n    Kind:                     string,\n    ReservationId:            string,\n    ReservationOrderId:       string,\n    ReservedHours:            real,\n    SkuName:                  string,\n    TotalReservedQuantity:    real,\n    UsageDate:                datetime,\n    UsedHours:                real,\n    x_SourceName:             string,    // Hubs v1_0+\n    x_SourceProvider:         string,    // Hubs v1_0+\n    x_SourceType:             string,    // Hubs v1_0+\n    x_SourceVersion:          string     // Hubs v1_0+\n)\n\n// CommitmentDiscountUsage_raw ingestion mapping\n.create-or-alter table CommitmentDiscountUsage_raw ingestion parquet mapping \"CommitmentDiscountUsage_raw_mapping\"\n```\n[\n    { \"Column\": \"InstanceFlexibilityGroup\", \"Properties\": { \"Field\": \"InstanceFlexibilityGroup\" } },\n    { \"Column\": \"InstanceFlexibilityRatio\", \"Properties\": { \"Field\": \"InstanceFlexibilityRatio\" } },\n    { \"Column\": \"InstanceId\",               \"Properties\": { \"Field\": \"InstanceId\" } },\n    { \"Column\": \"Kind\",                     \"Properties\": { \"Field\": \"Kind\" } },\n    { \"Column\": \"ReservationId\",            \"Properties\": { \"Field\": \"ReservationId\" } },\n    { \"Column\": \"ReservationOrderId\",       \"Properties\": { \"Field\": \"ReservationOrderId\" } },\n    { \"Column\": \"ReservedHours\",            \"Properties\": { \"Field\": \"ReservedHours\" } },\n    { \"Column\": \"SkuName\",                  \"Properties\": { \"Field\": \"SkuName\" } },\n    { \"Column\": \"TotalReservedQuantity\",    \"Properties\": { \"Field\": \"TotalReservedQuantity\" } },\n    { \"Column\": \"UsageDate\",                \"Properties\": { \"Field\": \"UsageDate\" } },\n    { \"Column\": \"UsedHours\",                \"Properties\": { \"Field\": \"UsedHours\" } },\n    { \"Column\": \"x_SourceName\",             \"Properties\": { \"Field\": \"x_SourceName\" } },\n    { \"Column\": \"x_SourceProvider\",         \"Properties\": { \"Field\": \"x_SourceProvider\" } },\n    { \"Column\": \"x_SourceType\",             \"Properties\": { \"Field\": \"x_SourceType\" } },\n    { \"Column\": \"x_SourceVersion\",          \"Properties\": { \"Field\": \"x_SourceVersion\" } }\n]\n```\n\n// CommitmentDiscountUsage_raw retention policy (clear historical data)\n.alter-merge table CommitmentDiscountUsage_raw policy retention softdelete = 0d recoverability = disabled\n\n// CommitmentDiscountUsage_raw retention policy (set the user-defined retention period)\n.alter-merge table CommitmentDiscountUsage_raw policy retention softdelete = $$rawRetentionInDays$$d recoverability = disabled\n\n\n//===| Costs |==========================================================================================================\n// Supported versions:\n// - MS: 1.0, 1.0-preview(v1) -- See https://aka.ms/costmgmt/exports/focus\n// - AWS: 1.0                 -- See https://docs.aws.amazon.com/cur/latest/userguide/table-dictionary-focus-1-0-aws-columns.html\n// - GCP: Jan-Jun 2024        -- See https://cloud.google.com/resources/google-cloud-focus?e=48754805&hl=en\n//                                   Links to (Aug 2024): https://services.google.com/fh/files/misc/focus_guide_v1.pdf\n//                               See also:\n//                               - https://cloud.google.com/billing/docs/how-to/export-data-bigquery-tables/standard-usage\n//                               - https://cloud.google.com/billing/docs/how-to/export-data-bigquery-tables/detailed-usage\n// - OCI: 1.0                 -- See https://docs.oracle.com/iaas/Content/Billing/Concepts/costusagereportsoverview.htm#costreports__focus-cost-report-schema\n// - Tencent: 1.0             -- See https://www.tencentcloud.com/document/product/555/67495 / https://www.tencentcloud.com/document/product/555/67496\n// - Alibaba: 1.0             -- See https://www.alibabacloud.com/help/en/user-center/user-guide/export-alibaba-cloud-standard-billing-focus\n//\n// Support for non-Azure data is limited to ingestion only. Data is not transformed across versions.\n//======================================================================================================================\n\n// Costs_raw table -- Create the table if it doesn't exist\n.create-merge table Costs_raw ( ignore: string )\n\n// Costs_raw table -- Remove all columns to allow changing column types\n.alter table Costs_raw ( ignore: string )\n\n// Costs_raw table -- Redefine all columns\n.alter table Costs_raw (\n    AvailabilityZone:           string,    // FOCUS 0.5+\n    BilledCost:                 real,      // FOCUS 0.5+\n    BillingAccountId:           string,    // FOCUS 0.5+\n    BillingAccountName:         string,    // FOCUS 0.5+\n    BillingAccountType:         string,    // Azure 1.0-preview(v1)+\n    BillingCurrency:            string,    // FOCUS 0.5+\n    BillingPeriodEnd:           datetime,  // FOCUS 0.5+\n    BillingPeriodStart:         datetime,  // FOCUS 0.5+\n    CapacityReservationId:      string,    // FOCUS 1.1+\n    CapacityReservationStatus:  string,    // FOCUS 1.1+\n    ChargeCategory:             string,    // FOCUS 1.0-preview+\n    ChargeClass:                string,    // FOCUS 1.0+\n    ChargeDescription:          string,    // FOCUS 1.0+\n    ChargeFrequency:            string,    // FOCUS 1.0+\n    ChargePeriodEnd:            datetime,  // FOCUS 0.5+\n    ChargePeriodStart:          datetime,  // FOCUS 0.5+\n    ChargeSubcategory:          string,    // FOCUS 1.0-preview only\n    CommitmentDiscountCategory: string,    // FOCUS 1.0-preview+\n    CommitmentDiscountId:       string,    // FOCUS 1.0-preview+\n    CommitmentDiscountName:     string,    // FOCUS 1.0-preview+\n    CommitmentDiscountQuantity: real,      // FOCUS 1.1+\n    CommitmentDiscountStatus:   string,    // FOCUS 1.0+\n    CommitmentDiscountType:     string,    // FOCUS 1.0-preview+\n    CommitmentDiscountUnit:     string,    // FOCUS 1.1+\n    ConsumedQuantity:           real,      // FOCUS 1.0+\n    ConsumedUnit:               string,    // FOCUS 1.0+\n    ContractedCost:             real,      // FOCUS 1.0+\n    ContractedUnitPrice:        real,      // FOCUS 1.0+\n    EffectiveCost:              real,      // FOCUS 1.0-preview+\n    InvoiceId:                  string,    // FOCUS 1.2+\n    InvoiceIssuerName:          string,    // FOCUS 0.5+\n    ListCost:                   real,      // FOCUS 1.0-preview+\n    ListUnitPrice:              real,      // FOCUS 1.0-preview+\n    PricingCategory:            string,    // FOCUS 1.0-preview+\n    PricingCurrency:            string,    // FOCUS 1.2+\n    PricingQuantity:            real,      // FOCUS 1.0-preview+\n    PricingUnit:                string,    // FOCUS 1.0-preview+\n    ProviderName:               string,    // FOCUS 0.5+\n    PublisherName:              string,    // FOCUS 0.5+\n    Region:                     string,    // FOCUS 0.5-1.0-preview (deprecated)\n    RegionId:                   string,    // FOCUS 1.0+\n    RegionName:                 string,    // FOCUS 1.0+\n    ResourceId:                 string,    // FOCUS 0.5+\n    ResourceName:               string,    // FOCUS 0.5+\n    ResourceType:               string,    // FOCUS 1.0-preview+\n    ServiceCategory:            string,    // FOCUS 0.5+\n    ServiceName:                string,    // FOCUS 0.5+\n    ServiceSubcategory:         string,    // FOCUS 1.1+\n    SkuId:                      string,    // FOCUS 1.0-preview+\n    SkuMeter:                   string,    // FOCUS 1.1+\n    SkuPriceDetails:            string,    // FOCUS 1.1+\n    SkuPriceId:                 string,    // FOCUS 1.0-preview+\n    SubAccountId:               string,    // FOCUS 0.5+\n    SubAccountName:             string,    // FOCUS 0.5+\n    SubAccountType:             string,    // Azure 1.0-preview(v1)+\n    Tags:                       string,    // FOCUS 1.0-preview+\n    UsageAmount:                real,      // GCP Jan 2024 -- Removed Mar 2024 (UsageQuantity)\n    UsageQuantity:              real,      // FOCUS 1.0-preview only\n    UsageUnit:                  string,    // FOCUS 1.0-preview only\n    x_AccountId:                string,    // Azure 1.0-preview(v1)+\n    x_AccountName:              string,    // Azure 1.0-preview(v1)+\n    x_AccountOwnerId:           string,    // Azure 1.0-preview(v1)+\n    x_AmortizationClass:        string,    // Azure 1.2-preview+\n    x_BilledCostInUsd:          real,      // Azure 1.0-preview(v1)+\n    x_BilledUnitPrice:          real,      // Azure 1.0-preview(v1)+\n    x_BillingAccountId:         string,    // Azure 1.0-preview(v1)+\n    x_BillingAccountName:       string,    // Azure 1.0-preview(v1)+\n    x_BillingExchangeRate:      real,      // Azure 1.0-preview(v1)+\n    x_BillingExchangeRateDate:  datetime,  // Azure 1.0-preview(v1)+\n    x_BillingItemCode:          string,    // Alibaba 1.0+\n    x_BillingItemName:          string,    // Alibaba 1.0+\n    x_BillingProfileId:         string,    // Azure 1.0-preview(v1)+\n    x_BillingProfileName:       string,    // Azure 1.0-preview(v1)+\n    x_ChargeId:                 string,    // Azure 1.0-preview(v1) only\n    x_CommodityCode:            string,    // Alibaba 1.0+\n    x_CommodityName:            string,    // Alibaba 1.0+\n    x_ComponentName:            string,    // Tencent 1.0+\n    x_ComponentType:            string,    // Tencent 1.0+\n    x_ContractedCostInUsd:      real,      // Azure 1.0+\n    x_Cost:                     real,      // GCP Jan 2024 -- Removed Jun 2024 (ContractedCost)\n    x_CostAllocationRuleName:   string,    // Azure 1.0-preview(v1)+\n    x_CostCategories:           string,    // AWS 1.0 (JSON)\n    x_CostCenter:               string,    // Azure 1.0-preview(v1)+\n    x_CostType:                 string,    // GCP Jan 2024\n    x_Credits:                  string,    // GCP Jan 2024\n    x_CurrencyConversionRate:   real,      // GCP Jun 2024\n    x_CustomerId:               string,    // Azure 1.0-preview(v1)+\n    x_CustomerName:             string,    // Azure 1.0-preview(v1)+\n    x_Discount:                 string,    // AWS 1.0 (JSON)\n    x_EffectiveCostInUsd:       real,      // Azure 1.0-preview(v1)+\n    x_EffectiveUnitPrice:       real,      // Azure 1.0-preview(v1)+\n    x_ExportTime:               datetime,  // GCP Jan 2024 / Tencent 1.0+\n    x_InstanceID:               string,    // Alibaba 1.0+\n    x_InvoiceId:                string,    // Azure 1.0-preview(v1)+\n    x_InvoiceIssuerId:          string,    // Azure 1.0-preview(v1)+\n    x_InvoiceSectionId:         string,    // Azure 1.0-preview(v1)+\n    x_InvoiceSectionName:       string,    // Azure 1.0-preview(v1)+\n    x_ListCostInUsd:            real,      // Azure 1.0-preview(v1)+\n    x_Location:                 string,    // GCP Jan 2024\n    x_OnDemandCost:             real,      // Azure 1.0-preview(v1) only\n    x_OnDemandCostInUsd:        real,      // Azure 1.0-preview(v1) only\n    x_OnDemandUnitPrice:        real,      // Azure 1.0-preview(v1) only\n    x_Operation:                string,    // AWS 1.0\n    x_OwnerAccountID:           string,    // Tencent 1.0+\n    x_PartnerCreditApplied:     string,    // Azure 1.0-preview(v1)+\n    x_PartnerCreditRate:        string,    // Azure 1.0-preview(v1)+\n    x_PricingBlockSize:         real,      // Azure 1.0-preview(v1)+\n    x_PricingCurrency:          string,    // Azure 1.0-preview(v1)-1.0r2\n    x_PricingSubcategory:       string,    // Azure 1.0-preview(v1)+\n    x_PricingUnitDescription:   string,    // Azure 1.0-preview(v1)+\n    x_Project:                  string,    // GCP Jan 2024\n    x_PublisherCategory:        string,    // Azure 1.0-preview(v1)+\n    x_PublisherId:              string,    // Azure 1.0-preview(v1)+\n    x_ResellerId:               string,    // Azure 1.0-preview(v1)+\n    x_ResellerName:             string,    // Azure 1.0-preview(v1)+\n    x_ResourceGroupName:        string,    // Azure 1.0-preview(v1)+\n    x_ResourceType:             string,    // Azure 1.0-preview(v1)+\n    x_ServiceCode:              string,    // AWS 1.0\n    x_ServiceId:                string,    // GCP Jan 2024\n    x_ServiceModel:             string,    // Azure 1.2-preview+\n    x_ServicePeriodEnd:         datetime,  // Azure 1.0-preview(v1)+\n    x_ServicePeriodStart:       datetime,  // Azure 1.0-preview(v1)+\n    x_SkuDescription:           string,    // Azure 1.0-preview(v1)+\n    x_SkuDetails:               string,    // Azure 1.0-preview(v1)-1.2-preview\n    x_SkuIsCreditEligible:      bool,      // Azure 1.0-preview(v1)+\n    x_SkuMeterCategory:         string,    // Azure 1.0-preview(v1)+\n    x_SkuMeterId:               string,    // Azure 1.0-preview(v1)+\n    x_SkuMeterName:             string,    // Azure 1.0-preview(v1)-1.0r2\n    x_SkuMeterSubcategory:      string,    // Azure 1.0-preview(v1)+\n    x_SkuOfferId:               string,    // Azure 1.0-preview(v1)+\n    x_SkuOrderId:               string,    // Azure 1.0-preview(v1)+\n    x_SkuOrderName:             string,    // Azure 1.0-preview(v1)+\n    x_SkuPartNumber:            string,    // Azure 1.0-preview(v1)+\n    x_SkuPlanName:              string,    // Azure 1.2-preview+\n    x_SkuRegion:                string,    // Azure 1.0-preview(v1)+\n    x_SkuServiceFamily:         string,    // Azure 1.0-preview(v1)+\n    x_SkuTerm:                  int,       // Azure 1.0-preview(v1)+\n    x_SkuTier:                  string,    // Azure 1.0-preview(v1)+\n    x_SourceName:               string,    // Hubs v1_0+\n    x_SourceProvider:           string,    // Hubs v1_0+\n    x_SourceType:               string,    // Hubs v1_0+\n    x_SourceVersion:            string,    // Hubs v1_0+\n    x_SubproductName:           string,    // Tencent 1.0+ // cSpell:ignore Subproduct\n    x_UsageType:                string     // AWS 1.0\n)\n\n// Costs_raw ingestion mapping\n.create-or-alter table Costs_raw ingestion parquet mapping \"Costs_raw_mapping\"\n```\n[\n    { \"Column\": \"AvailabilityZone\",           \"Properties\": { \"Field\": \"AvailabilityZone\" } },\n    { \"Column\": \"BilledCost\",                 \"Properties\": { \"Field\": \"BilledCost\" } },\n    { \"Column\": \"BillingAccountId\",           \"Properties\": { \"Field\": \"BillingAccountId\" } },\n    { \"Column\": \"BillingAccountName\",         \"Properties\": { \"Field\": \"BillingAccountName\" } },\n    { \"Column\": \"BillingAccountType\",         \"Properties\": { \"Field\": \"BillingAccountType\" } },\n    { \"Column\": \"BillingCurrency\",            \"Properties\": { \"Field\": \"BillingCurrency\" } },\n    { \"Column\": \"BillingPeriodEnd\",           \"Properties\": { \"Field\": \"BillingPeriodEnd\" } },\n    { \"Column\": \"BillingPeriodStart\",         \"Properties\": { \"Field\": \"BillingPeriodStart\" } },\n    { \"Column\": \"CapacityReservationId\",      \"Properties\": { \"Field\": \"CapacityReservationId\" } },\n    { \"Column\": \"CapacityReservationStatus\",  \"Properties\": { \"Field\": \"CapacityReservationStatus\" } },\n    { \"Column\": \"ChargeCategory\",             \"Properties\": { \"Field\": \"ChargeCategory\" } },\n    { \"Column\": \"ChargeClass\",                \"Properties\": { \"Field\": \"ChargeClass\" } },\n    { \"Column\": \"ChargeDescription\",          \"Properties\": { \"Field\": \"ChargeDescription\" } },\n    { \"Column\": \"ChargeFrequency\",            \"Properties\": { \"Field\": \"ChargeFrequency\" } },\n    { \"Column\": \"ChargePeriodEnd\",            \"Properties\": { \"Field\": \"ChargePeriodEnd\" } },\n    { \"Column\": \"ChargePeriodStart\",          \"Properties\": { \"Field\": \"ChargePeriodStart\" } },\n    { \"Column\": \"ChargeSubcategory\",          \"Properties\": { \"Field\": \"ChargeSubcategory\" } },\n    { \"Column\": \"CommitmentDiscountCategory\", \"Properties\": { \"Field\": \"CommitmentDiscountCategory\" } },\n    { \"Column\": \"CommitmentDiscountId\",       \"Properties\": { \"Field\": \"CommitmentDiscountId\" } },\n    { \"Column\": \"CommitmentDiscountName\",     \"Properties\": { \"Field\": \"CommitmentDiscountName\" } },\n    { \"Column\": \"CommitmentDiscountQuantity\", \"Properties\": { \"Field\": \"CommitmentDiscountQuantity\" } },\n    { \"Column\": \"CommitmentDiscountStatus\",   \"Properties\": { \"Field\": \"CommitmentDiscountStatus\" } },\n    { \"Column\": \"CommitmentDiscountType\",     \"Properties\": { \"Field\": \"CommitmentDiscountType\" } },\n    { \"Column\": \"CommitmentDiscountUnit\",     \"Properties\": { \"Field\": \"CommitmentDiscountUnit\" } },\n    { \"Column\": \"ConsumedQuantity\",           \"Properties\": { \"Field\": \"ConsumedQuantity\" } },\n    { \"Column\": \"ConsumedUnit\",               \"Properties\": { \"Field\": \"ConsumedUnit\" } },\n    { \"Column\": \"ContractedCost\",             \"Properties\": { \"Field\": \"ContractedCost\" } },\n    { \"Column\": \"ContractedUnitPrice\",        \"Properties\": { \"Field\": \"ContractedUnitPrice\" } },\n    { \"Column\": \"EffectiveCost\",              \"Properties\": { \"Field\": \"EffectiveCost\" } },\n    { \"Column\": \"InvoiceId\",                  \"Properties\": { \"Field\": \"InvoiceId\" } },\n    { \"Column\": \"InvoiceIssuerName\",          \"Properties\": { \"Field\": \"InvoiceIssuerName\" } },\n    { \"Column\": \"ListCost\",                   \"Properties\": { \"Field\": \"ListCost\" } },\n    { \"Column\": \"ListUnitPrice\",              \"Properties\": { \"Field\": \"ListUnitPrice\" } },\n    { \"Column\": \"PricingCategory\",            \"Properties\": { \"Field\": \"PricingCategory\" } },\n    { \"Column\": \"PricingCurrency\",            \"Properties\": { \"Field\": \"PricingCurrency\" } },\n    { \"Column\": \"PricingQuantity\",            \"Properties\": { \"Field\": \"PricingQuantity\" } },\n    { \"Column\": \"PricingUnit\",                \"Properties\": { \"Field\": \"PricingUnit\" } },\n    { \"Column\": \"ProviderName\",               \"Properties\": { \"Field\": \"ProviderName\" } },\n    { \"Column\": \"PublisherName\",              \"Properties\": { \"Field\": \"PublisherName\" } },\n    { \"Column\": \"Region\",                     \"Properties\": { \"Field\": \"Region\" } },\n    { \"Column\": \"RegionId\",                   \"Properties\": { \"Field\": \"RegionId\" } },\n    { \"Column\": \"RegionName\",                 \"Properties\": { \"Field\": \"RegionName\" } },\n    { \"Column\": \"ResourceId\",                 \"Properties\": { \"Field\": \"ResourceId\" } },\n    { \"Column\": \"ResourceName\",               \"Properties\": { \"Field\": \"ResourceName\" } },\n    { \"Column\": \"ResourceType\",               \"Properties\": { \"Field\": \"ResourceType\" } },\n    { \"Column\": \"ServiceCategory\",            \"Properties\": { \"Field\": \"ServiceCategory\" } },\n    { \"Column\": \"ServiceName\",                \"Properties\": { \"Field\": \"ServiceName\" } },\n    { \"Column\": \"ServiceSubcategory\",         \"Properties\": { \"Field\": \"ServiceSubcategory\" } },\n    { \"Column\": \"SkuId\",                      \"Properties\": { \"Field\": \"SkuId\" } },\n    { \"Column\": \"SkuMeter\",                   \"Properties\": { \"Field\": \"SkuMeter\" } },\n    { \"Column\": \"SkuPriceDetails\",            \"Properties\": { \"Field\": \"SkuPriceDetails\" } },\n    { \"Column\": \"SkuPriceId\",                 \"Properties\": { \"Field\": \"SkuPriceId\" } },\n    { \"Column\": \"SubAccountId\",               \"Properties\": { \"Field\": \"SubAccountId\" } },\n    { \"Column\": \"SubAccountName\",             \"Properties\": { \"Field\": \"SubAccountName\" } },\n    { \"Column\": \"SubAccountType\",             \"Properties\": { \"Field\": \"SubAccountType\" } },\n    { \"Column\": \"Tags\",                       \"Properties\": { \"Field\": \"Tags\" } },\n    { \"Column\": \"UsageAmount\",                \"Properties\": { \"Field\": \"UsageAmount\" } },\n    { \"Column\": \"UsageQuantity\",              \"Properties\": { \"Field\": \"UsageQuantity\" } },\n    { \"Column\": \"UsageUnit\",                  \"Properties\": { \"Field\": \"UsageUnit\" } },\n    { \"Column\": \"x_AccountId\",                \"Properties\": { \"Field\": \"x_AccountId\" } },\n    { \"Column\": \"x_AccountName\",              \"Properties\": { \"Field\": \"x_AccountName\" } },\n    { \"Column\": \"x_AccountOwnerId\",           \"Properties\": { \"Field\": \"x_AccountOwnerId\" } },\n    { \"Column\": \"x_AmortizationClass\",        \"Properties\": { \"Field\": \"x_AmortizationClass\" } },\n    { \"Column\": \"x_BilledCostInUsd\",          \"Properties\": { \"Field\": \"x_BilledCostInUsd\" } },\n    { \"Column\": \"x_BilledUnitPrice\",          \"Properties\": { \"Field\": \"x_BilledUnitPrice\" } },\n    { \"Column\": \"x_BillingAccountId\",         \"Properties\": { \"Field\": \"x_BillingAccountId\" } },\n    { \"Column\": \"x_BillingAccountName\",       \"Properties\": { \"Field\": \"x_BillingAccountName\" } },\n    { \"Column\": \"x_BillingExchangeRate\",      \"Properties\": { \"Field\": \"x_BillingExchangeRate\" } },\n    { \"Column\": \"x_BillingExchangeRateDate\",  \"Properties\": { \"Field\": \"x_BillingExchangeRateDate\" } },\n    { \"Column\": \"x_BillingItemCode\",          \"Properties\": { \"Field\": \"x_BillingItemCode\" } },\n    { \"Column\": \"x_BillingItemName\",          \"Properties\": { \"Field\": \"x_BillingItemName\" } },\n    { \"Column\": \"x_BillingProfileId\",         \"Properties\": { \"Field\": \"x_BillingProfileId\" } },\n    { \"Column\": \"x_BillingProfileName\",       \"Properties\": { \"Field\": \"x_BillingProfileName\" } },\n    { \"Column\": \"x_ChargeId\",                 \"Properties\": { \"Field\": \"x_ChargeId\" } },\n    { \"Column\": \"x_ContractedCostInUsd\",      \"Properties\": { \"Field\": \"x_ContractedCostInUsd\" } },\n    { \"Column\": \"x_CommodityCode\",            \"Properties\": { \"Field\": \"x_CommodityCode\" } },\n    { \"Column\": \"x_CommodityName\",            \"Properties\": { \"Field\": \"x_CommodityName\" } },\n    { \"Column\": \"x_ComponentName\",            \"Properties\": { \"Field\": \"x_ComponentName\" } },\n    { \"Column\": \"x_ComponentType\",            \"Properties\": { \"Field\": \"x_ComponentType\" } },\n    { \"Column\": \"x_Cost\",                     \"Properties\": { \"Field\": \"x_Cost\" } },\n    { \"Column\": \"x_CostAllocationRuleName\",   \"Properties\": { \"Field\": \"x_CostAllocationRuleName\" } },\n    { \"Column\": \"x_CostCategories\",           \"Properties\": { \"Field\": \"x_CostCategories\" } },\n    { \"Column\": \"x_CostCenter\",               \"Properties\": { \"Field\": \"x_CostCenter\" } },\n    { \"Column\": \"x_Credits\",                  \"Properties\": { \"Field\": \"x_Credits\" } },\n    { \"Column\": \"x_CostType\",                 \"Properties\": { \"Field\": \"x_CostType\" } },\n    { \"Column\": \"x_CurrencyConversionRate\",   \"Properties\": { \"Field\": \"x_CurrencyConversionRate\" } },\n    { \"Column\": \"x_CustomerId\",               \"Properties\": { \"Field\": \"x_CustomerId\" } },\n    { \"Column\": \"x_CustomerName\",             \"Properties\": { \"Field\": \"x_CustomerName\" } },\n    { \"Column\": \"x_Discount\",                 \"Properties\": { \"Field\": \"x_Discount\" } },\n    { \"Column\": \"x_EffectiveCostInUsd\",       \"Properties\": { \"Field\": \"x_EffectiveCostInUsd\" } },\n    { \"Column\": \"x_EffectiveUnitPrice\",       \"Properties\": { \"Field\": \"x_EffectiveUnitPrice\" } },\n    { \"Column\": \"x_ExportTime\",               \"Properties\": { \"Field\": \"x_ExportTime\" } },\n    { \"Column\": \"x_InstanceID\",               \"Properties\": { \"Field\": \"x_InstanceID\" } },\n    { \"Column\": \"x_InvoiceId\",                \"Properties\": { \"Field\": \"x_InvoiceId\" } },\n    { \"Column\": \"x_InvoiceIssuerId\",          \"Properties\": { \"Field\": \"x_InvoiceIssuerId\" } },\n    { \"Column\": \"x_InvoiceSectionId\",         \"Properties\": { \"Field\": \"x_InvoiceSectionId\" } },\n    { \"Column\": \"x_InvoiceSectionName\",       \"Properties\": { \"Field\": \"x_InvoiceSectionName\" } },\n    { \"Column\": \"x_ListCostInUsd\",            \"Properties\": { \"Field\": \"x_ListCostInUsd\" } },\n    { \"Column\": \"x_Location\",                 \"Properties\": { \"Field\": \"x_Location\" } },\n    { \"Column\": \"x_OnDemandCost\",             \"Properties\": { \"Field\": \"x_OnDemandCost\" } },\n    { \"Column\": \"x_OnDemandCostInUsd\",        \"Properties\": { \"Field\": \"x_OnDemandCostInUsd\" } },\n    { \"Column\": \"x_OnDemandUnitPrice\",        \"Properties\": { \"Field\": \"x_OnDemandUnitPrice\" } },\n    { \"Column\": \"x_Operation\",                \"Properties\": { \"Field\": \"x_Operation\" } },\n    { \"Column\": \"x_OwnerAccountID\",           \"Properties\": { \"Field\": \"x_OwnerAccountID\" } },\n    { \"Column\": \"x_PartnerCreditApplied\",     \"Properties\": { \"Field\": \"x_PartnerCreditApplied\" } },\n    { \"Column\": \"x_PartnerCreditRate\",        \"Properties\": { \"Field\": \"x_PartnerCreditRate\" } },\n    { \"Column\": \"x_PricingBlockSize\",         \"Properties\": { \"Field\": \"x_PricingBlockSize\" } },\n    { \"Column\": \"x_PricingCurrency\",          \"Properties\": { \"Field\": \"x_PricingCurrency\" } },\n    { \"Column\": \"x_PricingSubcategory\",       \"Properties\": { \"Field\": \"x_PricingSubcategory\" } },\n    { \"Column\": \"x_PricingUnitDescription\",   \"Properties\": { \"Field\": \"x_PricingUnitDescription\" } },\n    { \"Column\": \"x_Project\",                  \"Properties\": { \"Field\": \"x_Project\" } },\n    { \"Column\": \"x_PublisherCategory\",        \"Properties\": { \"Field\": \"x_PublisherCategory\" } },\n    { \"Column\": \"x_PublisherId\",              \"Properties\": { \"Field\": \"x_PublisherId\" } },\n    { \"Column\": \"x_ResellerId\",               \"Properties\": { \"Field\": \"x_ResellerId\" } },\n    { \"Column\": \"x_ResellerName\",             \"Properties\": { \"Field\": \"x_ResellerName\" } },\n    { \"Column\": \"x_ResourceGroupName\",        \"Properties\": { \"Field\": \"x_ResourceGroupName\" } },\n    { \"Column\": \"x_ResourceType\",             \"Properties\": { \"Field\": \"x_ResourceType\" } },\n    { \"Column\": \"x_ServiceCode\",              \"Properties\": { \"Field\": \"x_ServiceCode\" } },\n    { \"Column\": \"x_ServiceId\",                \"Properties\": { \"Field\": \"x_ServiceId\" } },\n    { \"Column\": \"x_ServiceModel\",             \"Properties\": { \"Field\": \"x_ServiceModel\" } },\n    { \"Column\": \"x_ServicePeriodEnd\",         \"Properties\": { \"Field\": \"x_ServicePeriodEnd\" } },\n    { \"Column\": \"x_ServicePeriodStart\",       \"Properties\": { \"Field\": \"x_ServicePeriodStart\" } },\n    { \"Column\": \"x_SkuDescription\",           \"Properties\": { \"Field\": \"x_SkuDescription\" } },\n    { \"Column\": \"x_SkuDetails\",               \"Properties\": { \"Field\": \"x_SkuDetails\" } },\n    { \"Column\": \"x_SkuIsCreditEligible\",      \"Properties\": { \"Field\": \"x_SkuIsCreditEligible\" } },\n    { \"Column\": \"x_SkuMeterCategory\",         \"Properties\": { \"Field\": \"x_SkuMeterCategory\" } },\n    { \"Column\": \"x_SkuMeterId\",               \"Properties\": { \"Field\": \"x_SkuMeterId\" } },\n    { \"Column\": \"x_SkuMeterName\",             \"Properties\": { \"Field\": \"x_SkuMeterName\" } },\n    { \"Column\": \"x_SkuMeterSubcategory\",      \"Properties\": { \"Field\": \"x_SkuMeterSubcategory\" } },\n    { \"Column\": \"x_SkuOfferId\",               \"Properties\": { \"Field\": \"x_SkuOfferId\" } },\n    { \"Column\": \"x_SkuOrderId\",               \"Properties\": { \"Field\": \"x_SkuOrderId\" } },\n    { \"Column\": \"x_SkuOrderName\",             \"Properties\": { \"Field\": \"x_SkuOrderName\" } },\n    { \"Column\": \"x_SkuPartNumber\",            \"Properties\": { \"Field\": \"x_SkuPartNumber\" } },\n    { \"Column\": \"x_SkuPlanName\",              \"Properties\": { \"Field\": \"x_SkuPlanName\" } },\n    { \"Column\": \"x_SkuRegion\",                \"Properties\": { \"Field\": \"x_SkuRegion\" } },\n    { \"Column\": \"x_SkuServiceFamily\",         \"Properties\": { \"Field\": \"x_SkuServiceFamily\" } },\n    { \"Column\": \"x_SkuTerm\",                  \"Properties\": { \"Field\": \"x_SkuTerm\" } },\n    { \"Column\": \"x_SkuTier\",                  \"Properties\": { \"Field\": \"x_SkuTier\" } },\n    { \"Column\": \"x_SourceName\",               \"Properties\": { \"Field\": \"x_SourceName\" } },\n    { \"Column\": \"x_SourceProvider\",           \"Properties\": { \"Field\": \"x_SourceProvider\" } },\n    { \"Column\": \"x_SourceType\",               \"Properties\": { \"Field\": \"x_SourceType\" } },\n    { \"Column\": \"x_SourceVersion\",            \"Properties\": { \"Field\": \"x_SourceVersion\" } },\n    { \"Column\": \"x_SubproductName\",           \"Properties\": { \"Field\": \"x_SubproductName\" } },\n    { \"Column\": \"x_UsageType\",                \"Properties\": { \"Field\": \"x_UsageType\" } }\n]\n```\n\n// Costs_raw retention policy (clear historical data)\n.alter-merge table Costs_raw policy retention softdelete = 0d recoverability = disabled\n\n// Costs_raw retention policy (set the user-defined retention period)\n.alter-merge table Costs_raw policy retention softdelete = $$rawRetentionInDays$$d recoverability = disabled\n\n\n//===| Prices |=========================================================================================================\n// NOTE: Must be before cost details.\n//\n// Supported versions:\n// - MS EA 2023-05-01  -- See https://learn.microsoft.com/azure/cost-management-billing/dataset-schema/price-sheet-ea\n// - MS MCA 2023-05-01 -- See https://learn.microsoft.com/azure/cost-management-billing/dataset-schema/price-sheet-mca\n//======================================================================================================================\n\n// Prices_raw table -- Create the table if it doesn't exist\n.create-merge table Prices_raw ( ignore: string )\n\n// Prices_raw table -- Remove all columns to allow changing column types\n.alter table Prices_raw ( ignore: string )\n\n// Prices_raw table -- Redefine all columns\n.alter table Prices_raw (\n    BasePrice:          real,     // Azure EA + MCA\n    BillingAccountId:   string,   // Azure MCA\n    BillingAccountName: string,   // Azure MCA\n    BillingCurrency:    string,   // Azure MCA\n    BillingProfileId:   string,   // Azure MCA\n    BillingProfileName: string,   // Azure MCA\n    Currency:           string,   // Azure MCA\n    CurrencyCode:       string,   // Azure EA\n    EffectiveEndDate:   datetime, // Azure MCA\n    EffectiveStartDate: datetime, // Azure EA + MCA\n    EnrollmentNumber:   string,   // Azure EA\n    IncludedQuantity:   real,     // Azure EA\n    MarketPrice:        real,     // Azure EA + MCA\n    MeterCategory:      string,   // Azure EA + MCA\n    MeterId:            string,   // Azure MCA\n    MeterID:            string,   // Azure EA\n    MeterName:          string,   // Azure EA + MCA\n    MeterRegion:        string,   // Azure EA + MCA\n    MeterSubCategory:   string,   // Azure EA + MCA\n    MeterType:          string,   // Azure EA + MCA\n    OfferID:            string,   // Azure EA\n    PartNumber:         string,   // Azure EA\n    PriceType:          string,   // Azure EA + MCA\n    Product:            string,   // Azure EA + MCA\n    ProductId:          string,   // Azure MCA\n    ProductID:          string,   // Azure EA\n    ServiceFamily:      string,   // Azure EA + MCA\n    SkuId:              string,   // Azure MCA\n    SkuID:              string,   // Azure EA\n    Term:               string,   // Azure EA + MCA\n    TierMinimumUnits:   real,     // Azure MCA\n    UnitOfMeasure:      string,   // Azure EA + MCA\n    UnitPrice:          real,     // Azure EA + MCA\n    x_SourceName:       string,   // Hubs v1_0+\n    x_SourceProvider:   string,   // Hubs v1_0+\n    x_SourceType:       string,   // Hubs v1_0+\n    x_SourceVersion:    string    // Hubs v1_0+\n)\n\n// Prices_raw ingestion mapping\n.create-or-alter table Prices_raw ingestion parquet mapping \"Prices_raw_mapping\"\n```\n[\n    { \"Column\": \"BasePrice\",          \"Properties\": { \"Field\": \"BasePrice\" } },\n    { \"Column\": \"BillingAccountId\",   \"Properties\": { \"Field\": \"BillingAccountId\" } },\n    { \"Column\": \"BillingAccountName\", \"Properties\": { \"Field\": \"BillingAccountName\" } },\n    { \"Column\": \"BillingCurrency\",    \"Properties\": { \"Field\": \"BillingCurrency\" } },\n    { \"Column\": \"BillingProfileId\",   \"Properties\": { \"Field\": \"BillingProfileId\" } },\n    { \"Column\": \"BillingProfileName\", \"Properties\": { \"Field\": \"BillingProfileName\" } },\n    { \"Column\": \"Currency\",           \"Properties\": { \"Field\": \"Currency\" } },\n    { \"Column\": \"CurrencyCode\",       \"Properties\": { \"Field\": \"CurrencyCode\" } },\n    { \"Column\": \"EffectiveEndDate\",   \"Properties\": { \"Field\": \"EffectiveEndDate\" } },\n    { \"Column\": \"EffectiveStartDate\", \"Properties\": { \"Field\": \"EffectiveStartDate\" } },\n    { \"Column\": \"EnrollmentNumber\",   \"Properties\": { \"Field\": \"EnrollmentNumber\" } },\n    { \"Column\": \"IncludedQuantity\",   \"Properties\": { \"Field\": \"IncludedQuantity\" } },\n    { \"Column\": \"MarketPrice\",        \"Properties\": { \"Field\": \"MarketPrice\" } },\n    { \"Column\": \"MeterCategory\",      \"Properties\": { \"Field\": \"MeterCategory\" } },\n    { \"Column\": \"MeterId\",            \"Properties\": { \"Field\": \"MeterId\" } },\n    { \"Column\": \"MeterID\",            \"Properties\": { \"Field\": \"MeterID\" } },\n    { \"Column\": \"MeterName\",          \"Properties\": { \"Field\": \"MeterName\" } },\n    { \"Column\": \"MeterRegion\",        \"Properties\": { \"Field\": \"MeterRegion\" } },\n    { \"Column\": \"MeterSubCategory\",   \"Properties\": { \"Field\": \"MeterSubCategory\" } },\n    { \"Column\": \"MeterType\",          \"Properties\": { \"Field\": \"MeterType\" } },\n    { \"Column\": \"OfferID\",            \"Properties\": { \"Field\": \"OfferID\" } },\n    { \"Column\": \"PartNumber\",         \"Properties\": { \"Field\": \"PartNumber\" } },\n    { \"Column\": \"PriceType\",          \"Properties\": { \"Field\": \"PriceType\" } },\n    { \"Column\": \"Product\",            \"Properties\": { \"Field\": \"Product\" } },\n    { \"Column\": \"ProductId\",          \"Properties\": { \"Field\": \"ProductId\" } },\n    { \"Column\": \"ProductID\",          \"Properties\": { \"Field\": \"ProductID\" } },\n    { \"Column\": \"ServiceFamily\",      \"Properties\": { \"Field\": \"ServiceFamily\" } },\n    { \"Column\": \"SkuId\",              \"Properties\": { \"Field\": \"SkuId\" } },\n    { \"Column\": \"SkuID\",              \"Properties\": { \"Field\": \"SkuID\" } },\n    { \"Column\": \"Term\",               \"Properties\": { \"Field\": \"Term\" } },\n    { \"Column\": \"TierMinimumUnits\",   \"Properties\": { \"Field\": \"TierMinimumUnits\" } },\n    { \"Column\": \"UnitOfMeasure\",      \"Properties\": { \"Field\": \"UnitOfMeasure\" } },\n    { \"Column\": \"UnitPrice\",          \"Properties\": { \"Field\": \"UnitPrice\" } },\n    { \"Column\": \"x_SourceName\",       \"Properties\": { \"Field\": \"x_SourceName\" } },\n    { \"Column\": \"x_SourceProvider\",   \"Properties\": { \"Field\": \"x_SourceProvider\" } },\n    { \"Column\": \"x_SourceType\",       \"Properties\": { \"Field\": \"x_SourceType\" } },\n    { \"Column\": \"x_SourceVersion\",    \"Properties\": { \"Field\": \"x_SourceVersion\" } }\n]\n```\n\n// Prices_raw retention policy (clear historical data)\n.alter-merge table Prices_raw policy retention softdelete = 0d recoverability = disabled\n\n// Prices_raw retention policy (set the user-defined retention period)\n.alter-merge table Prices_raw policy retention softdelete = $$rawRetentionInDays$$d recoverability = disabled\n\n\n//===| Recommendations |================================================================================================\n// Supported datasets/versions:\n// - MS CM EA reservation recommendations: 2023-05-01  -- See https://learn.microsoft.com/azure/cost-management-billing/dataset-schema/reservation-recommendations-ea\n// - MS CM MCA reservation recommendations: 2023-05-01 -- See https://learn.microsoft.com/azure/cost-management-billing/dataset-schema/reservation-recommendations-mca\n//======================================================================================================================\n\n// Recommendations_raw table -- Create the table if it doesn't exist\n.create-merge table Recommendations_raw ( ignore: string )\n\n// Recommendations_raw table -- Remove all columns to allow changing column types\n.alter table Recommendations_raw ( ignore: string )\n\n// Recommendations_raw table -- Redefine all columns\n.alter table Recommendations_raw (\n    CostWithNoReservedInstances:        real,      // MS CM EA resv reco 2024-05-01\n    CostWithNoReservedInstancesJson:    string,    // MS CM MCA resv reco 2024-05-01 -- Renamed to remove spaces and flag as JSON\n    FirstUsageDate:                     datetime,  // MS CM EA/MCA resv reco 2024-05-01 -- Renamed for MCA\n    InstanceFlexibilityGroup:           string,    // MS CM EA/MCA resv reco 2024-05-01 -- Renamed for MCA\n    InstanceFlexibilityRatio:           real,      // MS CM EA/MCA resv reco 2024-05-01 -- Renamed for MCA\n    Location:                           string,    // MS CM EA+MCA resv reco 2024-05-01\n    LookBackPeriod:                     string,    // MS CM EA+MCA resv reco 2024-05-01\n    MeterId:                            string,    // MS CM EA/MCA resv reco 2024-05-01 -- Renamed for MCA\n    NetSavings:                         real,      // MS CM EA resv reco 2024-05-01\n    NetSavingsJson:                     string,    // MS CM MCA resv reco 2024-05-01 -- Renamed to remove spaces and flag as JSON\n    NormalizedSize:                     string,    // MS CM EA/MCA resv reco 2024-05-01 -- Renamed for MCA\n    ProviderName:                       string,    // Hubs v1_2\n    RecommendedQuantity:                real,      // MS CM EA/MCA resv reco 2024-05-01 -- Renamed for MCA\n    RecommendedQuantityNormalized:      real,      // MS CM EA/MCA resv reco 2024-05-01 -- Renamed for MCA\n    ResourceId:                         string,    // Hubs v1_2\n    ResourceName:                       string,    // Hubs v1_2\n    ResourceType:                       string,    // Hubs v1_2, MS CM EA+MCA resv reco 2024-05-01\n    Scope:                              string,    // MS CM EA/MCA resv reco 2024-05-01 -- Renamed for MCA\n    SKU:                                string,    // MS CM EA resv reco 2024-05-01\n    SkuName:                            string,    // MS CM MCA resv reco 2024-05-01 -- Renamed to remove spaces\n    SkuProperties:                      string,    // MS CM EA/MCA resv reco 2024-05-01 -- Renamed for MCA\n    SubAccountId:                       string,    // Hubs v1_2\n    SubAccountName:                     string,    // Hubs v1_2\n    SubscriptionId:                     string,    // MS CM EA+MCA resv reco 2024-05-01\n    Term:                               string,    // MS CM EA+MCA resv reco 2024-05-01\n    TotalCostWithReservedInstances:     real,      // MS CM EA resv reco 2024-05-01\n    TotalCostWithReservedInstancesJson: string,    // MS CM MCA resv reco 2024-05-01 -- Renamed to remove spaces and flag as JSON\n    x_EffectiveCostAfter:               real,      // Hubs v1_2\n    x_EffectiveCostBefore:              real,      // Hubs v1_2\n    x_EffectiveCostSavings:             real,      // Hubs v1_2\n    x_RecommendationCategory:           string,    // Hubs v1_2\n    x_RecommendationDate:               datetime,  // Hubs v1_2\n    x_RecommendationDescription:        string,    // Hubs v1_2\n    x_RecommendationDetails:            dynamic,   // Hubs v1_2\n    x_RecommendationId:                 string,    // Hubs v1_2\n    x_ResourceGroupName:                string,    // Hubs v1_2\n    x_SourceName:                       string,    // Hubs v1_0+\n    x_SourceProvider:                   string,    // Hubs v1_0+\n    x_SourceType:                       string,    // Hubs v1_0+\n    x_SourceVersion:                    string     // Hubs v1_0+\n)\n\n// Recommendations_raw ingestion mapping\n.create-or-alter table Recommendations_raw ingestion parquet mapping \"Recommendations_raw_mapping\"\n```\n[\n    { \"Column\": \"CostWithNoReservedInstances\",        \"Properties\": { \"Field\": \"CostWithNoReservedInstances\" } },\n    { \"Column\": \"CostWithNoReservedInstancesJson\",    \"Properties\": { \"Field\": \"CostWithNoReservedInstancesJson\" } },\n    { \"Column\": \"FirstUsageDate\",                     \"Properties\": { \"Field\": \"FirstUsageDate\" } },\n    { \"Column\": \"InstanceFlexibilityGroup\",           \"Properties\": { \"Field\": \"InstanceFlexibilityGroup\" } },\n    { \"Column\": \"InstanceFlexibilityRatio\",           \"Properties\": { \"Field\": \"InstanceFlexibilityRatio\" } },\n    { \"Column\": \"Location\",                           \"Properties\": { \"Field\": \"Location\" } },\n    { \"Column\": \"LookBackPeriod\",                     \"Properties\": { \"Field\": \"LookBackPeriod\" } },\n    { \"Column\": \"MeterId\",                            \"Properties\": { \"Field\": \"MeterId\" } },\n    { \"Column\": \"NetSavings\",                         \"Properties\": { \"Field\": \"NetSavings\" } },\n    { \"Column\": \"NetSavingsJson\",                     \"Properties\": { \"Field\": \"NetSavingsJson\" } },\n    { \"Column\": \"NormalizedSize\",                     \"Properties\": { \"Field\": \"NormalizedSize\" } },\n    { \"Column\": \"ProviderName\",                       \"Properties\": { \"Field\": \"ProviderName\" } },\n    { \"Column\": \"RecommendedQuantity\",                \"Properties\": { \"Field\": \"RecommendedQuantity\" } },\n    { \"Column\": \"RecommendedQuantityNormalized\",      \"Properties\": { \"Field\": \"RecommendedQuantityNormalized\" } },\n    { \"Column\": \"ResourceId\",                         \"Properties\": { \"Field\": \"ResourceId\" } },\n    { \"Column\": \"ResourceName\",                       \"Properties\": { \"Field\": \"ResourceName\" } },\n    { \"Column\": \"ResourceType\",                       \"Properties\": { \"Field\": \"ResourceType\" } },\n    { \"Column\": \"Scope\",                              \"Properties\": { \"Field\": \"Scope\" } },\n    { \"Column\": \"SKU\",                                \"Properties\": { \"Field\": \"SKU\" } },\n    { \"Column\": \"SkuName\",                            \"Properties\": { \"Field\": \"SkuName\" } },\n    { \"Column\": \"SkuProperties\",                      \"Properties\": { \"Field\": \"SkuProperties\" } },\n    { \"Column\": \"SubAccountId\",                       \"Properties\": { \"Field\": \"SubAccountId\" } },\n    { \"Column\": \"SubAccountName\",                     \"Properties\": { \"Field\": \"SubAccountName\" } },\n    { \"Column\": \"SubscriptionId\",                     \"Properties\": { \"Field\": \"SubscriptionId\" } },\n    { \"Column\": \"Term\",                               \"Properties\": { \"Field\": \"Term\" } },\n    { \"Column\": \"TotalCostWithReservedInstances\",     \"Properties\": { \"Field\": \"TotalCostWithReservedInstances\" } },\n    { \"Column\": \"TotalCostWithReservedInstancesJson\", \"Properties\": { \"Field\": \"TotalCostWithReservedInstancesJson\" } },\n    { \"Column\": \"x_EffectiveCostAfter\",               \"Properties\": { \"Field\": \"x_EffectiveCostAfter\" } },\n    { \"Column\": \"x_EffectiveCostBefore\",              \"Properties\": { \"Field\": \"x_EffectiveCostBefore\" } },\n    { \"Column\": \"x_EffectiveCostSavings\",             \"Properties\": { \"Field\": \"x_EffectiveCostSavings\" } },\n    { \"Column\": \"x_RecommendationCategory\",           \"Properties\": { \"Field\": \"x_RecommendationCategory\" } },\n    { \"Column\": \"x_RecommendationDate\",               \"Properties\": { \"Field\": \"x_RecommendationDate\" } },\n    { \"Column\": \"x_RecommendationDescription\",        \"Properties\": { \"Field\": \"x_RecommendationDescription\" } },\n    { \"Column\": \"x_RecommendationDetails\",            \"Properties\": { \"Field\": \"x_RecommendationDetails\" } },\n    { \"Column\": \"x_RecommendationId\",                 \"Properties\": { \"Field\": \"x_RecommendationId\" } },\n    { \"Column\": \"x_ResourceGroupName\",                \"Properties\": { \"Field\": \"x_ResourceGroupName\" } },\n    { \"Column\": \"x_SourceName\",                       \"Properties\": { \"Field\": \"x_SourceName\" } },\n    { \"Column\": \"x_SourceProvider\",                   \"Properties\": { \"Field\": \"x_SourceProvider\" } },\n    { \"Column\": \"x_SourceType\",                       \"Properties\": { \"Field\": \"x_SourceType\" } },\n    { \"Column\": \"x_SourceVersion\",                    \"Properties\": { \"Field\": \"x_SourceVersion\" } }\n]\n```\n\n// Recommendations_raw retention policy (clear historical data)\n.alter-merge table Recommendations_raw policy retention softdelete = 0d recoverability = disabled\n\n// Recommendations_raw retention policy (set the user-defined retention period)\n.alter-merge table Recommendations_raw policy retention softdelete = $$rawRetentionInDays$$d recoverability = disabled\n\n\n//===| Transactions |===================================================================================================\n// Supported versions:\n// - MS CM EA reservation transactions: 2023-05-01  -- See https://learn.microsoft.com/azure/cost-management-billing/dataset-schema/reservation-transactions-ea\n// - MS CM MCA reservation transactions: 2023-05-01 -- See https://learn.microsoft.com/azure/cost-management-billing/dataset-schema/reservation-transactions-mca\n//======================================================================================================================\n\n// Transactions_raw table -- Create the table if it doesn't exist\n.create-merge table Transactions_raw ( ignore: string )\n\n// Transactions_raw table -- Remove all columns to allow changing column types\n.alter table Transactions_raw ( ignore: string )\n\n// Transactions_raw table -- Redefine all columns\n.alter table Transactions_raw (\n    AccountName:                    string,    // MS CM EA resv trans 2023-05-01\n    AccountOwnerEmail:              string,    // MS CM EA resv trans 2023-05-01\n    Amount:                         real,      // MS CM EA+MCA resv trans 2023-05-01\n    ArmSkuName:                     string,    // MS CM EA+MCA resv trans 2023-05-01\n    BillingFrequency:               string,    // MS CM EA+MCA resv trans 2023-05-01\n    BillingMonth:                   string,    // MS CM EA resv trans 2023-05-01\n    BillingProfileId:               string,    // MS CM MCA resv trans 2023-05-01\n    BillingProfileName:             string,    // MS CM MCA resv trans 2023-05-01\n    CostCenter:                     string,    // MS CM EA resv trans 2023-05-01\n    Currency:                       string,    // MS CM EA+MCA resv trans 2023-05-01\n    CurrentEnrollmentId:            string,    // MS CM EA resv trans 2023-05-01\n    DepartmentName:                 string,    // MS CM EA resv trans 2023-05-01\n    Description:                    string,    // MS CM EA+MCA resv trans 2023-05-01\n    EventDate:                      datetime,  // MS CM EA+MCA resv trans 2023-05-01\n    EventType:                      string,    // MS CM EA+MCA resv trans 2023-05-01\n    Invoice:                        string,    // MS CM EA+MCA resv trans 2023-05-01\n    InvoiceId:                      string,    // MS CM EA+MCA resv trans 2023-05-01\n    InvoiceSectionId:               string,    // MS CM MCA resv trans 2023-05-01\n    InvoiceSectionName:             string,    // MS CM MCA resv trans 2023-05-01\n    MonetaryCommitment:             real,      // MS CM EA resv trans 2023-05-01\n    Overage:                        real,      // MS CM EA resv trans 2023-05-01\n    PurchasingEnrollment:           string,    // MS CM EA resv trans 2023-05-01\n    PurchasingSubscriptionGuid:     string,    // MS CM EA+MCA resv trans 2023-05-01\n    PurchasingSubscriptionName:     string,    // MS CM EA+MCA resv trans 2023-05-01\n    Quantity:                       real,      // MS CM EA+MCA resv trans 2023-05-01\n    Region:                         string,    // MS CM EA+MCA resv trans 2023-05-01\n    ReservationOrderId:             string,    // MS CM EA+MCA resv trans 2023-05-01\n    ReservationOrderName:           string,    // MS CM EA+MCA resv trans 2023-05-01\n    Term:                           string,    // MS CM EA+MCA resv trans 2023-05-01\n    x_SourceName:                   string,    // Hubs v1_0+\n    x_SourceProvider:               string,    // Hubs v1_0+\n    x_SourceType:                   string,    // Hubs v1_0+\n    x_SourceVersion:                string     // Hubs v1_0+\n)\n\n// Transactions_raw ingestion mapping\n.create-or-alter table Transactions_raw ingestion parquet mapping \"Transactions_raw_mapping\"\n```\n[\n    { \"Column\": \"AccountName\",                \"Properties\": { \"Field\": \"AccountName\" } },\n    { \"Column\": \"AccountOwnerEmail\",          \"Properties\": { \"Field\": \"AccountOwnerEmail\" } },\n    { \"Column\": \"Amount\",                     \"Properties\": { \"Field\": \"Amount\" } },\n    { \"Column\": \"ArmSkuName\",                 \"Properties\": { \"Field\": \"ArmSkuName\" } },\n    { \"Column\": \"BillingFrequency\",           \"Properties\": { \"Field\": \"BillingFrequency\" } },\n    { \"Column\": \"BillingMonth\",               \"Properties\": { \"Field\": \"BillingMonth\" } },\n    { \"Column\": \"BillingProfileId\",           \"Properties\": { \"Field\": \"BillingProfileId\" } },\n    { \"Column\": \"BillingProfileName\",         \"Properties\": { \"Field\": \"BillingProfileName\" } },\n    { \"Column\": \"CostCenter\",                 \"Properties\": { \"Field\": \"CostCenter\" } },\n    { \"Column\": \"Currency\",                   \"Properties\": { \"Field\": \"Currency\" } },\n    { \"Column\": \"CurrentEnrollmentId\",        \"Properties\": { \"Field\": \"CurrentEnrollmentId\" } },\n    { \"Column\": \"DepartmentName\",             \"Properties\": { \"Field\": \"DepartmentName\" } },\n    { \"Column\": \"Description\",                \"Properties\": { \"Field\": \"Description\" } },\n    { \"Column\": \"EventDate\",                  \"Properties\": { \"Field\": \"EventDate\" } },\n    { \"Column\": \"EventType\",                  \"Properties\": { \"Field\": \"EventType\" } },\n    { \"Column\": \"Invoice\",                    \"Properties\": { \"Field\": \"Invoice\" } },\n    { \"Column\": \"InvoiceId\",                  \"Properties\": { \"Field\": \"InvoiceId\" } },\n    { \"Column\": \"InvoiceSectionId\",           \"Properties\": { \"Field\": \"InvoiceSectionId\" } },\n    { \"Column\": \"InvoiceSectionName\",         \"Properties\": { \"Field\": \"InvoiceSectionName\" } },\n    { \"Column\": \"MonetaryCommitment\",         \"Properties\": { \"Field\": \"MonetaryCommitment\" } },\n    { \"Column\": \"Overage\",                    \"Properties\": { \"Field\": \"Overage\" } },\n    { \"Column\": \"PurchasingEnrollment\",       \"Properties\": { \"Field\": \"PurchasingEnrollment\" } },\n    { \"Column\": \"PurchasingSubscriptionGuid\", \"Properties\": { \"Field\": \"PurchasingSubscriptionGuid\" } },\n    { \"Column\": \"PurchasingSubscriptionName\", \"Properties\": { \"Field\": \"PurchasingSubscriptionName\" } },\n    { \"Column\": \"Quantity\",                   \"Properties\": { \"Field\": \"Quantity\" } },\n    { \"Column\": \"Region\",                     \"Properties\": { \"Field\": \"Region\" } },\n    { \"Column\": \"ReservationOrderId\",         \"Properties\": { \"Field\": \"ReservationOrderId\" } },\n    { \"Column\": \"ReservationOrderName\",       \"Properties\": { \"Field\": \"ReservationOrderName\" } },\n    { \"Column\": \"Term\",                       \"Properties\": { \"Field\": \"Term\" } },\n    { \"Column\": \"x_SourceName\",               \"Properties\": { \"Field\": \"x_SourceName\" } },\n    { \"Column\": \"x_SourceProvider\",           \"Properties\": { \"Field\": \"x_SourceProvider\" } },\n    { \"Column\": \"x_SourceType\",               \"Properties\": { \"Field\": \"x_SourceType\" } },\n    { \"Column\": \"x_SourceVersion\",            \"Properties\": { \"Field\": \"x_SourceVersion\" } }\n]\n```\n\n// Transactions_raw retention policy (clear historical data)\n.alter-merge table Transactions_raw policy retention softdelete = 0d recoverability = disabled\n\n// Transactions_raw retention policy (set the user-defined retention period)\n.alter-merge table Transactions_raw policy retention softdelete = $$rawRetentionInDays$$d recoverability = disabled\n\n",
                    "$fxv#1": "// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\n.create-or-alter function \nwith (docstring = 'Return details about the specified ID.', folder = 'OpenData/Internal')\n_resource_type_1(id: string) {\n    dynamic({\n        \"arizeai.observabilityeval/organizations\": { \"SingularDisplayName\": \"Azure Native Arize AI Cloud Service\" }\n        ,\"astronomer.astro/organizations\": { \"SingularDisplayName\": \"Astro Organization\" }\n        ,\"citrix.services/xenappessentials\": { \"SingularDisplayName\": \"Citrix Virtual Apps Essentials\" }\n        ,\"citrix.services/xendesktopessentials\": { \"SingularDisplayName\": \"Citrix Virtual Desktops Essentials\" }\n        ,\"commvault.contentstore/cloudaccounts\": { \"SingularDisplayName\": \"Commvault Cloud Account\" }\n        ,\"commvault.contentstore/cloudaccounts/plans\": { \"SingularDisplayName\": \"Commvault.ContentStore cloud accounts plan\" }\n        ,\"commvault.contentstore/cloudaccounts/protectiongroups\": { \"SingularDisplayName\": \"Commvault.ContentStore cloud accounts protection group\" }\n        ,\"commvault.contentstore/cloudaccounts/protectiongroups/protecteditems\": { \"SingularDisplayName\": \"Commvault.ContentStore cloud accounts protection groups protected item\" }\n        ,\"commvault.contentstore/cloudaccounts/storages\": { \"SingularDisplayName\": \"Commvault.ContentStore cloud accounts storage\" }\n        ,\"dell.storage/filesystems\": { \"SingularDisplayName\": \"Dell PowerScale\" }\n        ,\"dynatrace.observability/monitors\": { \"SingularDisplayName\": \"Dynatrace\" }\n        ,\"github.network/networksettings\": { \"SingularDisplayName\": \"GitHub.Network network setting\" }\n        ,\"informatica.datamanagement/organizations\": { \"SingularDisplayName\": \"Informatica Organization\" }\n        ,\"lambdatest.hyperexecute/organizations\": { \"SingularDisplayName\": \"Azure Native LambdaTest - HyperExecute Cloud Service\" }\n        ,\"microsoft.aad/domainservices\": { \"SingularDisplayName\": \"Microsoft Entra Domain Services\" }\n        ,\"microsoft.aadiam/diagnosticsettings\": { \"SingularDisplayName\": \"Microsoft.aadiam diagnostic setting\" }\n        ,\"microsoft.aadiam/privatelinkforazuread\": { \"SingularDisplayName\": \"Private Link for Microsoft Entra ID\" }\n        ,\"microsoft.advisor/advisorscore\": { \"SingularDisplayName\": \"Microsoft.Advisor advisor score\" }\n        ,\"microsoft.advisor/assessments\": { \"SingularDisplayName\": \"Microsoft.Advisor assessment\" }\n        ,\"microsoft.advisor/configurations\": { \"SingularDisplayName\": \"Microsoft.Advisor configuration\" }\n        ,\"microsoft.advisor/generaterecommendations\": { \"SingularDisplayName\": \"Microsoft.Advisor generate recommendation\" }\n        ,\"microsoft.advisor/metadata\": { \"SingularDisplayName\": \"Microsoft.Advisor metadata\" }\n        ,\"microsoft.advisor/recommendations\": { \"SingularDisplayName\": \"Microsoft.Advisor recommendation\" }\n        ,\"microsoft.advisor/recommendations/suppressions\": { \"SingularDisplayName\": \"Microsoft.Advisor recommendations suppression\" }\n        ,\"microsoft.advisor/resiliencyreviews\": { \"SingularDisplayName\": \"Microsoft.Advisor resiliency review\" }\n        ,\"microsoft.agfoodplatform/farmbeats\": { \"SingularDisplayName\": \"Azure Data Manager for Agriculture\" }\n        ,\"microsoft.agfoodplatform/farmbeatsextensiondefinitions\": { \"SingularDisplayName\": \"Microsoft.AgFoodPlatform farm beats extension definition\" }\n        ,\"microsoft.agfoodplatform/farmbeatssolutiondefinitions\": { \"SingularDisplayName\": \"Microsoft.AgFoodPlatform farm beats solution definition\" }\n        ,\"microsoft.agricultureplatform/agriservices\": { \"SingularDisplayName\": \"Agriculture data solutions\" }\n        ,\"microsoft.akshybrid/agentpools\": { \"SingularDisplayName\": \"Microsoft.AksHybrid agent pool\" }\n        ,\"microsoft.akshybrid/provisionedclusters\": { \"SingularDisplayName\": \"Microsoft.AksHybrid provisioned cluster\" }\n        ,\"microsoft.akshybrid/upgradeprofiles\": { \"SingularDisplayName\": \"Microsoft.AksHybrid upgrade profile\" }\n        ,\"microsoft.alertsmanagement/actionrules\": { \"SingularDisplayName\": \"Alert processing rule\" }\n        ,\"microsoft.alertsmanagement/alerts\": { \"SingularDisplayName\": \"Microsoft.AlertsManagement alert\" }\n        ,\"microsoft.alertsmanagement/alerts/enrichments\": { \"SingularDisplayName\": \"Microsoft.AlertsManagement alerts enrichment\" }\n        ,\"microsoft.alertsmanagement/prometheusrulegroups\": { \"SingularDisplayName\": \"Prometheus rule group\" }\n        ,\"microsoft.alertsmanagement/smartdetectoralertrules\": { \"SingularDisplayName\": \"Smart detector alert rule\" }\n        ,\"microsoft.alertsmanagement/smartgroups\": { \"SingularDisplayName\": \"Microsoft.AlertsManagement smart group\" }\n        ,\"microsoft.alertsmanagement/tenantactivitylogalerts\": { \"SingularDisplayName\": \"Microsoft.AlertsManagement tenant activity log alert\" }\n        ,\"microsoft.all/arcvirtualmachines\": { \"SingularDisplayName\": \"Azure Arc virtual machine\" }\n        ,\"microsoft.all/hcivirtualmachines\": { \"SingularDisplayName\": \"Azure Local Virtual Machine - Azure Arc\" }\n        ,\"microsoft.all/virtualmachines\": { \"SingularDisplayName\": \"Virtual machine\" }\n        ,\"microsoft.analysisservices/servers\": { \"SingularDisplayName\": \"Analysis Services server\" }\n        ,\"microsoft.anybuild/clusters\": { \"SingularDisplayName\": \"AnyBuild cluster\" }\n        ,\"microsoft.apicenter/deletedservices\": { \"SingularDisplayName\": \"Microsoft.ApiCenter deleted service\" }\n        ,\"microsoft.apicenter/services\": { \"SingularDisplayName\": \"API Center\" }\n        ,\"microsoft.apicenter/services/workspaces\": { \"SingularDisplayName\": \"Workspace\" }\n        ,\"microsoft.apimanagement/gateways\": { \"SingularDisplayName\": \"API Management gateway\" }\n        ,\"microsoft.apimanagement/gateways/configconnections\": { \"SingularDisplayName\": \"Microsoft.ApiManagement gateways config connection\" }\n        ,\"microsoft.apimanagement/service\": { \"SingularDisplayName\": \"API Management service\" }\n        ,\"microsoft.apimanagement/service/workspaces\": { \"SingularDisplayName\": \"Workspace\" }\n        ,\"microsoft.apisecurity/defendersettings\": { \"SingularDisplayName\": \"Microsoft.ApiSecurity defender setting\" }\n        ,\"microsoft.app/agents\": { \"SingularDisplayName\": \"SRE Agent\" }\n        ,\"microsoft.app/builders\": { \"SingularDisplayName\": \"Microsoft.App builder\" }\n        ,\"microsoft.app/builders/builds\": { \"SingularDisplayName\": \"Microsoft.App builders build\" }\n        ,\"microsoft.app/connectedenvironments\": { \"SingularDisplayName\": \"Container Apps Connected Environment\" }\n        ,\"microsoft.app/containerapps\": { \"SingularDisplayName\": \"Container App\" }\n        ,\"microsoft.app/jobs\": { \"SingularDisplayName\": \"Container App Job\" }\n        ,\"microsoft.app/logicapps\": { \"SingularDisplayName\": \"Logic app\" }\n        ,\"microsoft.app/logicapps/workflows\": { \"SingularDisplayName\": \"Logic app workflow\" }\n        ,\"microsoft.app/managedenvironments\": { \"SingularDisplayName\": \"Container Apps Environment\" }\n        ,\"microsoft.app/sessionpools\": { \"SingularDisplayName\": \"Container App Session Pool\" }\n        ,\"microsoft.app/spaces\": { \"SingularDisplayName\": \"App Space\" }\n        ,\"microsoft.appassessment/migrateprojects\": { \"SingularDisplayName\": \"Microsoft.AppAssessment migrate project\" }\n        ,\"microsoft.appassessment/migrateprojects/assessments\": { \"SingularDisplayName\": \"Microsoft.AppAssessment migrate projects assessment\" }\n        ,\"microsoft.appassessment/migrateprojects/assessments/assessedapplications\": { \"SingularDisplayName\": \"Microsoft.AppAssessment migrate projects assessments assessed application\" }\n        ,\"microsoft.appassessment/migrateprojects/assessments/assessedmachines\": { \"SingularDisplayName\": \"Microsoft.AppAssessment migrate projects assessments assessed machine\" }\n        ,\"microsoft.appassessment/migrateprojects/assessments/machinestoassess\": { \"SingularDisplayName\": \"Microsoft.AppAssessment migrate projects assessments machines to asses\" }\n        ,\"microsoft.appassessment/migrateprojects/sites\": { \"SingularDisplayName\": \"Microsoft.AppAssessment migrate projects site\" }\n        ,\"microsoft.appassessment/migrateprojects/sites/applianceconfigurations\": { \"SingularDisplayName\": \"Microsoft.AppAssessment migrate projects sites appliance configuration\" }\n        ,\"microsoft.appcomplianceautomation/reports\": { \"SingularDisplayName\": \"Microsoft.AppComplianceAutomation report\" }\n        ,\"microsoft.appcomplianceautomation/reports/evidences\": { \"SingularDisplayName\": \"Microsoft.AppComplianceAutomation reports evidence\" }\n        ,\"microsoft.appcomplianceautomation/reports/scopingconfigurations\": { \"SingularDisplayName\": \"Microsoft.AppComplianceAutomation reports scoping configuration\" }\n        ,\"microsoft.appcomplianceautomation/reports/snapshots\": { \"SingularDisplayName\": \"Microsoft.AppComplianceAutomation reports snapshot\" }\n        ,\"microsoft.appcomplianceautomation/reports/snapshots/controls\": { \"SingularDisplayName\": \"Microsoft.AppComplianceAutomation reports snapshots control\" }\n        ,\"microsoft.appcomplianceautomation/reports/webhooks\": { \"SingularDisplayName\": \"Microsoft.AppComplianceAutomation reports webhook\" }\n        ,\"microsoft.appconfiguration/configurationstores\": { \"SingularDisplayName\": \"App Configuration\" }\n        ,\"microsoft.applicationmigration/discoveryhubs\": { \"SingularDisplayName\": \"Microsoft.ApplicationMigration discovery hub\" }\n        ,\"microsoft.applicationmigration/discoveryhubs/applications\": { \"SingularDisplayName\": \"Microsoft.ApplicationMigration discovery hubs application\" }\n        ,\"microsoft.applicationmigration/discoveryhubs/applications/members\": { \"SingularDisplayName\": \"Microsoft.ApplicationMigration discovery hubs applications member\" }\n        ,\"microsoft.applicationmigration/pgsqlsites\": { \"SingularDisplayName\": \"Microsoft.ApplicationMigration pgsqlsite\" }\n        ,\"microsoft.applicationmigration/pgsqlsites/agents\": { \"SingularDisplayName\": \"Microsoft.ApplicationMigration pgsqlsites agent\" }\n        ,\"microsoft.applicationmigration/pgsqlsites/pgsqldatabases\": { \"SingularDisplayName\": \"Microsoft.ApplicationMigration pgsqlsites pgsqldatabase\" }\n        ,\"microsoft.applicationmigration/pgsqlsites/pgsqlinstances\": { \"SingularDisplayName\": \"Microsoft.ApplicationMigration pgsqlsites pgsqlinstance\" }\n        ,\"microsoft.appplatform/spring\": { \"SingularDisplayName\": \"Azure Spring Apps\" }\n        ,\"microsoft.appsecurity/appprotectmanagedrulesetmanifests\": { \"SingularDisplayName\": \"Microsoft.AppSecurity app protect managed rule set manifest\" }\n        ,\"microsoft.appsecurity/policies\": { \"SingularDisplayName\": \"App Protect Policy\" }\n        ,\"microsoft.arc/all\": { \"SingularDisplayName\": \"Azure Arc enabled resource\" }\n        ,\"microsoft.arc/allfairfax\": { \"SingularDisplayName\": \"Azure Arc enabled resource\" }\n        ,\"microsoft.arc/kubernetesresources\": { \"SingularDisplayName\": \"Azure Arc Kubernetes cluster\" }\n        ,\"microsoft.arc/kubernetesresourcesfairfax\": { \"SingularDisplayName\": \"Azure Arc Kubernetes cluster\" }\n        ,\"microsoft.arcnetworking/arcnwloadbalancers\": { \"SingularDisplayName\": \"Microsoft.ArcNetworking arc nw load balancer\" }\n        ,\"microsoft.aszlabhardware/labservers\": { \"SingularDisplayName\": \"Microsoft.AszLabHardware labserver\" }\n        ,\"microsoft.aszlabhardware/reservations\": { \"SingularDisplayName\": \"Microsoft.AszLabHardware reservation\" }\n        ,\"microsoft.aszlabhardware/reservations/servers\": { \"SingularDisplayName\": \"Microsoft.AszLabHardware reservations server\" }\n        ,\"microsoft.aszlabhardware/servers\": { \"SingularDisplayName\": \"Microsoft.AszLabHardware server\" }\n        ,\"microsoft.attestation/attestationproviders\": { \"SingularDisplayName\": \"Attestation provider\" }\n        ,\"microsoft.authorization/accessreviewhistorydefinitions\": { \"SingularDisplayName\": \"Microsoft.Authorization access review history definition\" }\n        ,\"microsoft.authorization/accessreviewscheduledefinitions\": { \"SingularDisplayName\": \"Microsoft.Authorization access review schedule definition\" }\n        ,\"microsoft.authorization/accessreviewscheduledefinitions/instances\": { \"SingularDisplayName\": \"Microsoft.Authorization access review schedule definitions instance\" }\n        ,\"microsoft.authorization/accessreviewscheduledefinitions/instances/decisions\": { \"SingularDisplayName\": \"Microsoft.Authorization access review schedule definitions instances decision\" }\n        ,\"microsoft.authorization/accessreviewschedulesettings\": { \"SingularDisplayName\": \"Microsoft.Authorization access review schedule setting\" }\n        ,\"microsoft.authorization/datapolicymanifests\": { \"SingularDisplayName\": \"Microsoft.Authorization data policy manifest\" }\n        ,\"microsoft.authorization/denyassignments\": { \"SingularDisplayName\": \"Microsoft.Authorization deny assignment\" }\n        ,\"microsoft.authorization/locks\": { \"SingularDisplayName\": \"Microsoft.Authorization lock\" }\n        ,\"microsoft.authorization/policyassignments\": { \"SingularDisplayName\": \"Microsoft.Authorization policy assignment\" }\n        ,\"microsoft.authorization/policydefinitions\": { \"SingularDisplayName\": \"Microsoft.Authorization policy definition\" }\n        ,\"microsoft.authorization/policydefinitions/versions\": { \"SingularDisplayName\": \"Microsoft.Authorization policy definitions version\" }\n        ,\"microsoft.authorization/policyexemptions\": { \"SingularDisplayName\": \"Microsoft.Authorization policy exemption\" }\n        ,\"microsoft.authorization/policysetdefinitions\": { \"SingularDisplayName\": \"Microsoft.Authorization policy set definition\" }\n        ,\"microsoft.authorization/policysetdefinitions/versions\": { \"SingularDisplayName\": \"Microsoft.Authorization policy set definitions version\" }\n        ,\"microsoft.authorization/privatelinkassociations\": { \"SingularDisplayName\": \"Microsoft.Authorization private link association\" }\n        ,\"microsoft.authorization/provideroperations\": { \"SingularDisplayName\": \"Microsoft.Authorization provider operation\" }\n        ,\"microsoft.authorization/resourcemanagementprivatelinks\": { \"SingularDisplayName\": \"Resource management private link\" }\n        ,\"microsoft.authorization/roleassignmentapprovals\": { \"SingularDisplayName\": \"Microsoft.Authorization role assignment approval\" }\n        ,\"microsoft.authorization/roleassignmentapprovals/stages\": { \"SingularDisplayName\": \"Microsoft.Authorization role assignment approvals stage\" }\n        ,\"microsoft.authorization/roleassignments\": { \"SingularDisplayName\": \"Microsoft.Authorization role assignment\" }\n        ,\"microsoft.authorization/roleassignmentscheduleinstances\": { \"SingularDisplayName\": \"Microsoft.Authorization role assignment schedule instance\" }\n        ,\"microsoft.authorization/roleassignmentschedulerequests\": { \"SingularDisplayName\": \"Microsoft.Authorization role assignment schedule request\" }\n        ,\"microsoft.authorization/roleassignmentschedules\": { \"SingularDisplayName\": \"Microsoft.Authorization role assignment schedule\" }\n        ,\"microsoft.authorization/roledefinitions\": { \"SingularDisplayName\": \"Microsoft.Authorization role definition\" }\n        ,\"microsoft.authorization/roleeligibilityscheduleinstances\": { \"SingularDisplayName\": \"Microsoft.Authorization role eligibility schedule instance\" }\n        ,\"microsoft.authorization/roleeligibilityschedulerequests\": { \"SingularDisplayName\": \"Microsoft.Authorization role eligibility schedule request\" }\n        ,\"microsoft.authorization/roleeligibilityschedules\": { \"SingularDisplayName\": \"Microsoft.Authorization role eligibility schedule\" }\n        ,\"microsoft.authorization/rolemanagementalertconfigurations\": { \"SingularDisplayName\": \"Microsoft.Authorization role management alert configuration\" }\n        ,\"microsoft.authorization/rolemanagementalertdefinitions\": { \"SingularDisplayName\": \"Microsoft.Authorization role management alert definition\" }\n        ,\"microsoft.authorization/rolemanagementalertoperations\": { \"SingularDisplayName\": \"Microsoft.Authorization role management alert operation\" }\n        ,\"microsoft.authorization/rolemanagementalerts\": { \"SingularDisplayName\": \"Microsoft.Authorization role management alert\" }\n        ,\"microsoft.authorization/rolemanagementalerts/alertincidents\": { \"SingularDisplayName\": \"Microsoft.Authorization role management alerts alert incident\" }\n        ,\"microsoft.authorization/rolemanagementpolicies\": { \"SingularDisplayName\": \"Microsoft.Authorization role management policy\" }\n        ,\"microsoft.authorization/rolemanagementpolicyassignments\": { \"SingularDisplayName\": \"Microsoft.Authorization role management policy assignment\" }\n        ,\"microsoft.automanage/bestpractices\": { \"SingularDisplayName\": \"Microsoft.Automanage best practice\" }\n        ,\"microsoft.automanage/bestpractices/versions\": { \"SingularDisplayName\": \"Microsoft.Automanage best practices version\" }\n        ,\"microsoft.automanage/configurationprofileassignments\": { \"SingularDisplayName\": \"Microsoft.Automanage configuration profile assignment\" }\n        ,\"microsoft.automanage/configurationprofileassignments/reports\": { \"SingularDisplayName\": \"Microsoft.Automanage configuration profile assignments report\" }\n        ,\"microsoft.automanage/configurationprofiles\": { \"SingularDisplayName\": \"Microsoft.Automanage configuration profile\" }\n        ,\"microsoft.automanage/configurationprofiles/versions\": { \"SingularDisplayName\": \"Microsoft.Automanage configuration profiles version\" }\n        ,\"microsoft.automanage/serviceprincipals\": { \"SingularDisplayName\": \"ServicePrincipals\" }\n        ,\"microsoft.automation/automationaccounts\": { \"SingularDisplayName\": \"Automation account\" }\n        ,\"microsoft.automation/automationaccounts/hybridrunbookworkergroups\": { \"SingularDisplayName\": \"Automation hybrid worker group\" }\n        ,\"microsoft.automation/automationaccounts/runbooks\": { \"SingularDisplayName\": \"Automation runbook\" }\n        ,\"microsoft.autonomousdevelopmentplatform/accounts\": { \"SingularDisplayName\": \"Microsoft.AutonomousDevelopmentPlatform account\" }\n        ,\"microsoft.autonomousdevelopmentplatform/accounts/datapools\": { \"SingularDisplayName\": \"Microsoft.AutonomousDevelopmentPlatform accounts data pool\" }\n        ,\"microsoft.autonomousdevelopmentplatform/workspaces\": { \"SingularDisplayName\": \"Microsoft.AutonomousDevelopmentPlatform workspace\" }\n        ,\"microsoft.avs/privateclouds\": { \"SingularDisplayName\": \"Azure VMware Solution private cloud\" }\n        ,\"microsoft.awsconnector/accessanalyzeranalyzers\": { \"SingularDisplayName\": \"Access Analyzer Analyzer\" }\n        ,\"microsoft.awsconnector/acmcertificatesummaries\": { \"SingularDisplayName\": \"ACM Certificate Summary\" }\n        ,\"microsoft.awsconnector/apigatewayrestapis\": { \"SingularDisplayName\": \"Api Gateway Rest Api\" }\n        ,\"microsoft.awsconnector/apigatewaystages\": { \"SingularDisplayName\": \"Api Gateway Stage\" }\n        ,\"microsoft.awsconnector/applicationautoscalingscalabletargets\": { \"SingularDisplayName\": \"Application Auto Scaling Scalable Target\" }\n        ,\"microsoft.awsconnector/appsyncgraphqlapis\": { \"SingularDisplayName\": \"App Sync Graphql Api\" }\n        ,\"microsoft.awsconnector/autoscalingautoscalinggroups\": { \"SingularDisplayName\": \"Auto Scaling Auto Scaling Group\" }\n        ,\"microsoft.awsconnector/cloudformationstacks\": { \"SingularDisplayName\": \"Cloud Formation Stack\" }\n        ,\"microsoft.awsconnector/cloudformationstacksets\": { \"SingularDisplayName\": \"Cloud Formation Stack Set\" }\n        ,\"microsoft.awsconnector/cloudfrontdistributions\": { \"SingularDisplayName\": \"Cloud Front Distribution\" }\n        ,\"microsoft.awsconnector/cloudtrailtrails\": { \"SingularDisplayName\": \"Cloud Trail Trail\" }\n        ,\"microsoft.awsconnector/cloudwatchalarms\": { \"SingularDisplayName\": \"Cloud Watch Alarm\" }\n        ,\"microsoft.awsconnector/codebuildprojects\": { \"SingularDisplayName\": \"Code Build Project\" }\n        ,\"microsoft.awsconnector/codebuildsourcecredentialsinfos\": { \"SingularDisplayName\": \"Code Build Source Credentials Info\" }\n        ,\"microsoft.awsconnector/configserviceconfigurationrecorders\": { \"SingularDisplayName\": \"Config  Service Configuration Recorder\" }\n        ,\"microsoft.awsconnector/configserviceconfigurationrecorderstatuses\": { \"SingularDisplayName\": \"Config  Service Configuration Recorder Status\" }\n        ,\"microsoft.awsconnector/configservicedeliverychannels\": { \"SingularDisplayName\": \"Config  Service Delivery Channel\" }\n        ,\"microsoft.awsconnector/databasemigrationservicereplicationinstances\": { \"SingularDisplayName\": \"Database  Migration  Service Replication Instance\" }\n        ,\"microsoft.awsconnector/daxclusters\": { \"SingularDisplayName\": \"DAX Cluster\" }\n        ,\"microsoft.awsconnector/dynamodbcontinuousbackupsdescriptions\": { \"SingularDisplayName\": \"Dynamo DB Continuous Backups Description\" }\n        ,\"microsoft.awsconnector/dynamodbtables\": { \"SingularDisplayName\": \"Dynamo DB Table\" }\n        ,\"microsoft.awsconnector/ec2accountattributes\": { \"SingularDisplayName\": \"EC2 Account Attribute\" }\n        ,\"microsoft.awsconnector/ec2addresses\": { \"SingularDisplayName\": \"EC2 Address\" }\n        ,\"microsoft.awsconnector/ec2flowlogs\": { \"SingularDisplayName\": \"EC2 Flow Log\" }\n        ,\"microsoft.awsconnector/ec2images\": { \"SingularDisplayName\": \"EC2 Image\" }\n        ,\"microsoft.awsconnector/ec2instances\": { \"SingularDisplayName\": \"Microsoft.AwsConnector ec2 instance\" }\n        ,\"microsoft.awsconnector/ec2instancestatuses\": { \"SingularDisplayName\": \"EC2 Instance Status\" }\n        ,\"microsoft.awsconnector/ec2ipams\": { \"SingularDisplayName\": \"EC2 Ipam\" }\n        ,\"microsoft.awsconnector/ec2keypairs\": { \"SingularDisplayName\": \"EC2 Key Pair\" }\n        ,\"microsoft.awsconnector/ec2networkacls\": { \"SingularDisplayName\": \"EC2 Network Acl\" }\n        ,\"microsoft.awsconnector/ec2networkinterfaces\": { \"SingularDisplayName\": \"EC2 Network Interface\" }\n        ,\"microsoft.awsconnector/ec2routetables\": { \"SingularDisplayName\": \"EC2 Route Table\" }\n        ,\"microsoft.awsconnector/ec2securitygroups\": { \"SingularDisplayName\": \"EC2 Security Group\" }\n        ,\"microsoft.awsconnector/ec2snapshots\": { \"SingularDisplayName\": \"EC2 Snapshot\" }\n        ,\"microsoft.awsconnector/ec2subnets\": { \"SingularDisplayName\": \"EC2 Subnet\" }\n        ,\"microsoft.awsconnector/ec2volumes\": { \"SingularDisplayName\": \"EC2 Volume\" }\n        ,\"microsoft.awsconnector/ec2vpcendpoints\": { \"SingularDisplayName\": \"EC2 VPCEndpoint\" }\n        ,\"microsoft.awsconnector/ec2vpcpeeringconnections\": { \"SingularDisplayName\": \"EC2 VPCPeering Connection\" }\n        ,\"microsoft.awsconnector/ec2vpcs\": { \"SingularDisplayName\": \"EC2 VPC\" }\n        ,\"microsoft.awsconnector/ecrimagedetails\": { \"SingularDisplayName\": \"ECR Image Detail\" }\n        ,\"microsoft.awsconnector/ecrrepositories\": { \"SingularDisplayName\": \"ECR Repository\" }\n        ,\"microsoft.awsconnector/ecsclusters\": { \"SingularDisplayName\": \"ECS Cluster\" }\n        ,\"microsoft.awsconnector/ecsservices\": { \"SingularDisplayName\": \"ECS Service\" }\n        ,\"microsoft.awsconnector/ecstaskdefinitions\": { \"SingularDisplayName\": \"ECS Task Definition\" }\n        ,\"microsoft.awsconnector/efsfilesystems\": { \"SingularDisplayName\": \"EFS File System\" }\n        ,\"microsoft.awsconnector/efsmounttargets\": { \"SingularDisplayName\": \"EFS Mount Target\" }\n        ,\"microsoft.awsconnector/eksnodegroups\": { \"SingularDisplayName\": \"EKS Nodegroup\" }\n        ,\"microsoft.awsconnector/elasticbeanstalkapplications\": { \"SingularDisplayName\": \"Elastic Beanstalk Application\" }\n        ,\"microsoft.awsconnector/elasticbeanstalkconfigurationtemplates\": { \"SingularDisplayName\": \"Elastic Beanstalk Configuration Template\" }\n        ,\"microsoft.awsconnector/elasticbeanstalkenvironments\": { \"SingularDisplayName\": \"Elastic Beanstalk Environment\" }\n        ,\"microsoft.awsconnector/elasticloadbalancingv2listeners\": { \"SingularDisplayName\": \"Elastic Load Balancing V2 Listener\" }\n        ,\"microsoft.awsconnector/elasticloadbalancingv2loadbalancers\": { \"SingularDisplayName\": \"Elastic Load Balancing V2 Load Balancer\" }\n        ,\"microsoft.awsconnector/elasticloadbalancingv2targetgroups\": { \"SingularDisplayName\": \"Elastic Load Balancing V2 Target Group\" }\n        ,\"microsoft.awsconnector/elasticloadbalancingv2targethealthdescriptions\": { \"SingularDisplayName\": \"Elastic  Load  Balancing v2 Target Health Description\" }\n        ,\"microsoft.awsconnector/elasticsearchdomains\": { \"SingularDisplayName\": \"Elasticsearch Domain\" }\n        ,\"microsoft.awsconnector/emrclusters\": { \"SingularDisplayName\": \"EMR Cluster\" }\n        ,\"microsoft.awsconnector/guarddutydetectors\": { \"SingularDisplayName\": \"Guard Duty Detector\" }\n        ,\"microsoft.awsconnector/iamaccesskeylastuseds\": { \"SingularDisplayName\": \"IAM Access Key Last Used\" }\n        ,\"microsoft.awsconnector/iamaccesskeymetadata\": { \"SingularDisplayName\": \"IAM Access Key Metadata\" }\n        ,\"microsoft.awsconnector/iamgroups\": { \"SingularDisplayName\": \"IAM Group\" }\n        ,\"microsoft.awsconnector/iaminstanceprofiles\": { \"SingularDisplayName\": \"IAM Instance Profile\" }\n        ,\"microsoft.awsconnector/iammanagedpolicies\": { \"SingularDisplayName\": \"IAM Managed Policy\" }\n        ,\"microsoft.awsconnector/iammfadevices\": { \"SingularDisplayName\": \"IAM MFADevice\" }\n        ,\"microsoft.awsconnector/iampasswordpolicies\": { \"SingularDisplayName\": \"IAM Password Policy\" }\n        ,\"microsoft.awsconnector/iampolicyversions\": { \"SingularDisplayName\": \"IAM Policy Version\" }\n        ,\"microsoft.awsconnector/iamroles\": { \"SingularDisplayName\": \"IAM Role\" }\n        ,\"microsoft.awsconnector/iamservercertificates\": { \"SingularDisplayName\": \"IAM Server Certificate\" }\n        ,\"microsoft.awsconnector/iamuserpolicies\": { \"SingularDisplayName\": \"IAM User Policy\" }\n        ,\"microsoft.awsconnector/iamvirtualmfadevices\": { \"SingularDisplayName\": \"IAM Virtual MFADevice\" }\n        ,\"microsoft.awsconnector/kmsaliases\": { \"SingularDisplayName\": \"KMS Alias\" }\n        ,\"microsoft.awsconnector/kmskeys\": { \"SingularDisplayName\": \"KMS Key\" }\n        ,\"microsoft.awsconnector/lambdafunctioncodelocations\": { \"SingularDisplayName\": \"Lambda Function Code Location\" }\n        ,\"microsoft.awsconnector/lambdafunctionconfigurations\": { \"SingularDisplayName\": \"Microsoft.AwsConnector lambda function configuration\" }\n        ,\"microsoft.awsconnector/lambdafunctions\": { \"SingularDisplayName\": \"Lambda Function\" }\n        ,\"microsoft.awsconnector/licensemanagerlicenses\": { \"SingularDisplayName\": \"License Manager License\" }\n        ,\"microsoft.awsconnector/lightsailbuckets\": { \"SingularDisplayName\": \"Lightsail Bucket\" }\n        ,\"microsoft.awsconnector/lightsailinstances\": { \"SingularDisplayName\": \"Lightsail Instance\" }\n        ,\"microsoft.awsconnector/logsloggroups\": { \"SingularDisplayName\": \"Logs Log Group\" }\n        ,\"microsoft.awsconnector/logslogstreams\": { \"SingularDisplayName\": \"Logs Log Stream\" }\n        ,\"microsoft.awsconnector/logsmetricfilters\": { \"SingularDisplayName\": \"Logs Metric Filter\" }\n        ,\"microsoft.awsconnector/logssubscriptionfilters\": { \"SingularDisplayName\": \"Logs Subscription Filter\" }\n        ,\"microsoft.awsconnector/macie2jobsummaries\": { \"SingularDisplayName\": \"Macie2 Job Summary\" }\n        ,\"microsoft.awsconnector/macieallowlists\": { \"SingularDisplayName\": \"Macie Allow List\" }\n        ,\"microsoft.awsconnector/networkfirewallfirewallpolicies\": { \"SingularDisplayName\": \"Network Firewall Firewall Policy\" }\n        ,\"microsoft.awsconnector/networkfirewallfirewalls\": { \"SingularDisplayName\": \"Network Firewall Firewall\" }\n        ,\"microsoft.awsconnector/networkfirewallrulegroups\": { \"SingularDisplayName\": \"Network Firewall Rule Group\" }\n        ,\"microsoft.awsconnector/opensearchdomainstatuses\": { \"SingularDisplayName\": \"Open Search Domain Status\" }\n        ,\"microsoft.awsconnector/opensearchservicedomains\": { \"SingularDisplayName\": \"Open Search Service Domain\" }\n        ,\"microsoft.awsconnector/organizationsaccounts\": { \"SingularDisplayName\": \"Organizations Account\" }\n        ,\"microsoft.awsconnector/organizationsorganizations\": { \"SingularDisplayName\": \"Organizations Organization\" }\n        ,\"microsoft.awsconnector/rdsdbclusters\": { \"SingularDisplayName\": \"RDS DBCluster\" }\n        ,\"microsoft.awsconnector/rdsdbinstances\": { \"SingularDisplayName\": \"RDS DBInstance\" }\n        ,\"microsoft.awsconnector/rdsdbsnapshotattributesresults\": { \"SingularDisplayName\": \"RDS DBSnapshot Attributes Result\" }\n        ,\"microsoft.awsconnector/rdsdbsnapshots\": { \"SingularDisplayName\": \"RDS DBSnapshot\" }\n        ,\"microsoft.awsconnector/rdseventsubscriptions\": { \"SingularDisplayName\": \"RDS Event Subscription\" }\n        ,\"microsoft.awsconnector/rdsexporttasks\": { \"SingularDisplayName\": \"RDS Export Task\" }\n        ,\"microsoft.awsconnector/redshiftclusterparametergroups\": { \"SingularDisplayName\": \"Redshift Cluster Parameter Group\" }\n        ,\"microsoft.awsconnector/redshiftclusters\": { \"SingularDisplayName\": \"Redshift Cluster\" }\n        ,\"microsoft.awsconnector/route53domainsdomainsummaries\": { \"SingularDisplayName\": \"Route 53  Domains Domain Summary\" }\n        ,\"microsoft.awsconnector/route53hostedzones\": { \"SingularDisplayName\": \"Route53 Hosted Zone\" }\n        ,\"microsoft.awsconnector/route53resourcerecordsets\": { \"SingularDisplayName\": \"Route 53 Resource Record Set\" }\n        ,\"microsoft.awsconnector/s3accesscontrolpolicies\": { \"SingularDisplayName\": \"S3 Access Control Policy\" }\n        ,\"microsoft.awsconnector/s3accesspoints\": { \"SingularDisplayName\": \"S3 Access Point\" }\n        ,\"microsoft.awsconnector/s3bucketpolicies\": { \"SingularDisplayName\": \"S3 Bucket Policy\" }\n        ,\"microsoft.awsconnector/s3buckets\": { \"SingularDisplayName\": \"S3 Bucket\" }\n        ,\"microsoft.awsconnector/s3controlmultiregionaccesspointpolicydocuments\": { \"SingularDisplayName\": \"S3  Control Multi Region Access Point Policy Document\" }\n        ,\"microsoft.awsconnector/sagemakerapps\": { \"SingularDisplayName\": \"Sage Maker App\" }\n        ,\"microsoft.awsconnector/sagemakerdevices\": { \"SingularDisplayName\": \"Sage Maker Device\" }\n        ,\"microsoft.awsconnector/sagemakerimages\": { \"SingularDisplayName\": \"Sage Maker Image\" }\n        ,\"microsoft.awsconnector/sagemakernotebookinstancesummaries\": { \"SingularDisplayName\": \"Sage Maker Notebook Instance Summary\" }\n        ,\"microsoft.awsconnector/secretsmanagerresourcepolicies\": { \"SingularDisplayName\": \"Secrets Manager Resource Policy\" }\n        ,\"microsoft.awsconnector/secretsmanagersecrets\": { \"SingularDisplayName\": \"Secrets Manager Secret\" }\n        ,\"microsoft.awsconnector/snssubscriptions\": { \"SingularDisplayName\": \"SNS Subscription\" }\n        ,\"microsoft.awsconnector/snstopics\": { \"SingularDisplayName\": \"SNS Topic\" }\n        ,\"microsoft.awsconnector/sqsqueues\": { \"SingularDisplayName\": \"SQS Queue\" }\n        ,\"microsoft.awsconnector/ssminstanceinformations\": { \"SingularDisplayName\": \"SSM Instance Information\" }\n        ,\"microsoft.awsconnector/ssmparameters\": { \"SingularDisplayName\": \"SSM Parameter\" }\n        ,\"microsoft.awsconnector/ssmresourcecompliancesummaryitems\": { \"SingularDisplayName\": \"SSM Resource Compliance Summary Item\" }\n        ,\"microsoft.awsconnector/wafv2ipsets\": { \"SingularDisplayName\": \"WAFv2 IPSet\" }\n        ,\"microsoft.awsconnector/wafv2loggingconfigurations\": { \"SingularDisplayName\": \"WAFv2 Logging Configuration\" }\n        ,\"microsoft.awsconnector/wafv2webaclassociations\": { \"SingularDisplayName\": \"WAFv2 Web ACLAssociation\" }\n        ,\"microsoft.awsconnector/wafwebaclsummaries\": { \"SingularDisplayName\": \"WAF Web ACLSummary\" }\n        ,\"microsoft.azureactivedirectory/b2cdirectories\": { \"SingularDisplayName\": \"B2C tenant\" }\n        ,\"microsoft.azureactivedirectory/ciamdirectories\": { \"SingularDisplayName\": \"External Configuration Tenant\" }\n        ,\"microsoft.azureactivedirectory/guestusages\": { \"SingularDisplayName\": \"Guest Usage\" }\n        ,\"microsoft.azurearcdata/datacontrollers\": { \"SingularDisplayName\": \"Azure Arc data controller\" }\n        ,\"microsoft.azurearcdata/mysqlserver\": { \"SingularDisplayName\": \"MySql Server - Azure Arc\" }\n        ,\"microsoft.azurearcdata/postgresinstances\": { \"SingularDisplayName\": \"PostgreSQL server ? Azure Arc\" }\n        ,\"microsoft.azurearcdata/postgressqlserver\": { \"SingularDisplayName\": \"PostgresSql Server - Azure Arc\" }\n        ,\"microsoft.azurearcdata/sqlmanagedinstances\": { \"SingularDisplayName\": \"SQL managed instance - Azure Arc\" }\n        ,\"microsoft.azurearcdata/sqlserveresulicenses\": { \"SingularDisplayName\": \"SQL Server ESU license\" }\n        ,\"microsoft.azurearcdata/sqlserverinstances\": { \"SingularDisplayName\": \"SQL Server - Azure Arc\" }\n        ,\"microsoft.azurearcdata/sqlserverinstances/databases\": { \"SingularDisplayName\": \"SQL Server database - Azure Arc\" }\n        ,\"microsoft.azurearcdata/sqlserverlicenses\": { \"SingularDisplayName\": \"SQL Server License\" }\n        ,\"microsoft.azurebusinesscontinuity/deletedunifiedprotecteditems\": { \"SingularDisplayName\": \"Microsoft.AzureBusinessContinuity deleted unified protected item\" }\n        ,\"microsoft.azurebusinesscontinuity/unifiedprotecteditems\": { \"SingularDisplayName\": \"Microsoft.AzureBusinessContinuity unified protected item\" }\n        ,\"microsoft.azurecis/aadapplications\": { \"SingularDisplayName\": \"Microsoft.AzureCis AAD application\" }\n        ,\"microsoft.azurecis/addressrecords\": { \"SingularDisplayName\": \"Microsoft.AzureCis address record\" }\n        ,\"microsoft.azurecis/autopilotenvironments\": { \"SingularDisplayName\": \"Microsoft.AzureCis autopilot environment\" }\n        ,\"microsoft.azurecis/autopilotmachinefunctions\": { \"SingularDisplayName\": \"Microsoft.AzureCis autopilot machine function\" }\n        ,\"microsoft.azurecis/autopilotsoftwareloadbalancevirtualips\": { \"SingularDisplayName\": \"Microsoft.AzureCis auto pilot software load balance virtual IP\" }\n        ,\"microsoft.azurecis/azcopies\": { \"SingularDisplayName\": \"Microsoft.AzureCis az copy\" }\n        ,\"microsoft.azurecis/canonicalnamerecords\": { \"SingularDisplayName\": \"Microsoft.AzureCis canonical name record\" }\n        ,\"microsoft.azurecis/dsmsallowlists\": { \"SingularDisplayName\": \"Microsoft.AzureCis ds msallowlist\" }\n        ,\"microsoft.azurecis/dsmscertificates\": { \"SingularDisplayName\": \"Microsoft.AzureCis dsms certificate\" }\n        ,\"microsoft.azurecis/dsmsrootfolders\": { \"SingularDisplayName\": \"Microsoft.AzureCis dsms root folder\" }\n        ,\"microsoft.azurecis/dstsapplications\": { \"SingularDisplayName\": \"Microsoft.AzureCis dsts application\" }\n        ,\"microsoft.azurecis/dstsserviceaccounts\": { \"SingularDisplayName\": \"Microsoft.AzureCis dsts service account\" }\n        ,\"microsoft.azurecis/dstsserviceclientidentities\": { \"SingularDisplayName\": \"Microsoft.AzureCis dsts service client identity\" }\n        ,\"microsoft.azurecis/genericgenevaactions\": { \"SingularDisplayName\": \"Microsoft.AzureCis generic geneva action\" }\n        ,\"microsoft.azurecis/plannedquotas\": { \"SingularDisplayName\": \"Microsoft.AzureCis planned quota\" }\n        ,\"microsoft.azurecis/pointerrecords\": { \"SingularDisplayName\": \"Microsoft.AzureCis pointer record\" }\n        ,\"microsoft.azurecis/publishconfigvalues\": { \"SingularDisplayName\": \"Microsoft.AzureCis publish config value\" }\n        ,\"microsoft.azurecis/pushagentv2accounts\": { \"SingularDisplayName\": \"Microsoft.AzureCis push agent v2 account\" }\n        ,\"microsoft.azurecis/servicerecords\": { \"SingularDisplayName\": \"Microsoft.AzureCis service record\" }\n        ,\"microsoft.azurecis/sharedconfigvalues\": { \"SingularDisplayName\": \"Microsoft.AzureCis shared config value\" }\n        ,\"microsoft.azurecloudmetadata/clouds\": { \"SingularDisplayName\": \"Microsoft.AzureCloudMetadata cloud\" }\n        ,\"microsoft.azurecloudmetadata/clouds/geographies\": { \"SingularDisplayName\": \"Microsoft.AzureCloudMetadata clouds geography\" }\n        ,\"microsoft.azurecloudmetadata/clouds/geographies/regions\": { \"SingularDisplayName\": \"Microsoft.AzureCloudMetadata clouds geographies region\" }\n        ,\"microsoft.azuredatatransfer/connections\": { \"SingularDisplayName\": \"Connection\" }\n        ,\"microsoft.azuredatatransfer/connections/flows\": { \"SingularDisplayName\": \"Flow\" }\n        ,\"microsoft.azuredatatransfer/pipelines\": { \"SingularDisplayName\": \"Pipeline\" }\n        ,\"microsoft.azurefleet/fleets\": { \"SingularDisplayName\": \"Compute Fleet\" }\n        ,\"microsoft.azurefleet/fleetscomputehub\": { \"SingularDisplayName\": \"Compute Fleet\" }\n        ,\"microsoft.azureimagetestingforlinux/jobs\": { \"SingularDisplayName\": \"Microsoft.AzureImageTestingForLinux job\" }\n        ,\"microsoft.azureimagetestingforlinux/jobtemplates\": { \"SingularDisplayName\": \"Microsoft.AzureImageTestingForLinux job template\" }\n        ,\"microsoft.azurelargeinstance/azurelargeinstances\": { \"SingularDisplayName\": \"Azure Large Instance\" }\n        ,\"microsoft.azurelargeinstance/azurelargestorageinstances\": { \"SingularDisplayName\": \"Microsoft.AzureLargeInstance Azure large storage instance\" }\n        ,\"microsoft.azurepercept/accounts\": { \"SingularDisplayName\": \"Microsoft.AzurePercept account\" }\n        ,\"microsoft.azurepercept/accounts/devices\": { \"SingularDisplayName\": \"Microsoft.AzurePercept accounts device\" }\n        ,\"microsoft.azurepercept/accounts/devices/sensors\": { \"SingularDisplayName\": \"Microsoft.AzurePercept accounts devices sensor\" }\n        ,\"microsoft.azurepercept/accounts/sensors\": { \"SingularDisplayName\": \"Microsoft.AzurePercept accounts sensor\" }\n        ,\"microsoft.azurepercept/accounts/solutioninstances\": { \"SingularDisplayName\": \"Microsoft.AzurePercept accounts solutioninstance\" }\n        ,\"microsoft.azurepercept/accounts/solutions\": { \"SingularDisplayName\": \"Microsoft.AzurePercept accounts solution\" }\n        ,\"microsoft.azurepercept/accounts/targets\": { \"SingularDisplayName\": \"Microsoft.AzurePercept accounts target\" }\n        ,\"microsoft.azureplaywrightservice/accounts\": { \"SingularDisplayName\": \"Playwright Testing\" }\n        ,\"microsoft.azurescan/scanningaccounts\": { \"SingularDisplayName\": \"ESRP Scan\" }\n        ,\"microsoft.azuresphere/catalogs\": { \"SingularDisplayName\": \"Azure Sphere Catalog\" }\n        ,\"microsoft.azurespherev2/catalogs\": { \"SingularDisplayName\": \"Microsoft.AzureSphereV2 catalog\" }\n        ,\"microsoft.azurespherev2/catalogs/artifacts\": { \"SingularDisplayName\": \"Microsoft.AzureSphereV2 catalogs artifact\" }\n        ,\"microsoft.azurespherev2/catalogs/certificates\": { \"SingularDisplayName\": \"Microsoft.AzureSphereV2 catalogs certificate\" }\n        ,\"microsoft.azurespherev2/catalogs/deviceregistrations\": { \"SingularDisplayName\": \"Microsoft.AzureSphereV2 catalogs device registration\" }\n        ,\"microsoft.azurespherev2/catalogs/provisioningpackages\": { \"SingularDisplayName\": \"Microsoft.AzureSphereV2 catalogs provisioning package\" }\n        ,\"microsoft.azurespherev2/catalogs/syndicationchannels\": { \"SingularDisplayName\": \"Microsoft.AzureSphereV2 catalogs syndication channel\" }\n        ,\"microsoft.azurespherev2/catalogs/syndicationchannels/deployments\": { \"SingularDisplayName\": \"Microsoft.AzureSphereV2 catalogs syndication channels deployment\" }\n        ,\"microsoft.azurespherev2/catalogs/updatepackages\": { \"SingularDisplayName\": \"Microsoft.AzureSphereV2 catalogs update package\" }\n        ,\"microsoft.azurestack/cloudmanifestfiles\": { \"SingularDisplayName\": \"Microsoft.AzureStack cloud manifest file\" }\n        ,\"microsoft.azurestack/linkedsubscriptions\": { \"SingularDisplayName\": \"Microsoft.AzureStack linked subscription\" }\n        ,\"microsoft.azurestack/registrations\": { \"SingularDisplayName\": \"Microsoft.AzureStack registration\" }\n        ,\"microsoft.azurestack/registrations/customersubscriptions\": { \"SingularDisplayName\": \"Microsoft.AzureStack registrations customer subscription\" }\n        ,\"microsoft.azurestack/registrations/products\": { \"SingularDisplayName\": \"Microsoft.AzureStack registrations product\" }\n        ,\"microsoft.azurestackhci/clusters\": { \"SingularDisplayName\": \"Azure Local\" }\n        ,\"microsoft.azurestackhci/clusters/updates/updateruns\": { \"SingularDisplayName\": \"Azure Local\" }\n        ,\"microsoft.azurestackhci/clusters/updatesummaries\": { \"SingularDisplayName\": \"Azure Local\" }\n        ,\"microsoft.azurestackhci/devicepools\": { \"SingularDisplayName\": \"Azure Stack\" }\n        ,\"microsoft.azurestackhci/edgedevices\": { \"SingularDisplayName\": \"Microsoft.AzureStackHCI edge device\" }\n        ,\"microsoft.azurestackhci/edgedevices/jobs\": { \"SingularDisplayName\": \"Microsoft.AzureStackHCI edge devices job\" }\n        ,\"microsoft.azurestackhci/edgemachines\": { \"SingularDisplayName\": \"Microsoft.AzureStackHCI edge machine\" }\n        ,\"microsoft.azurestackhci/edgemachines/jobs\": { \"SingularDisplayName\": \"Microsoft.AzureStackHCI edge machines job\" }\n        ,\"microsoft.azurestackhci/edgenodepools\": { \"SingularDisplayName\": \"Azure Stack\" }\n        ,\"microsoft.azurestackhci/galleryimages\": { \"SingularDisplayName\": \"Azure Local Gallery image\" }\n        ,\"microsoft.azurestackhci/logicalnetworks\": { \"SingularDisplayName\": \"Azure Local Logical network\" }\n        ,\"microsoft.azurestackhci/marketplacegalleryimages\": { \"SingularDisplayName\": \"Azure Local Marketplace Gallery image\" }\n        ,\"microsoft.azurestackhci/networkinterfaces\": { \"SingularDisplayName\": \"Azure Local VM Network Interface\" }\n        ,\"microsoft.azurestackhci/networksecuritygroups\": { \"SingularDisplayName\": \"Azure Local Network Security Group\" }\n        ,\"microsoft.azurestackhci/networksecuritygroups/securityrules\": { \"SingularDisplayName\": \"Microsoft.AzureStackHCI network security groups security rule\" }\n        ,\"microsoft.azurestackhci/storagecontainers\": { \"SingularDisplayName\": \"Azure Local Storage path\" }\n        ,\"microsoft.azurestackhci/virtualharddisks\": { \"SingularDisplayName\": \"Microsoft.AzureStackHCI virtual hard disk\" }\n        ,\"microsoft.azurestackhci/virtualmachineinstances\": { \"SingularDisplayName\": \"Microsoft.AzureStackHCI virtual machine instance\" }\n        ,\"microsoft.azurestackhci/virtualmachineinstances/guestagents\": { \"SingularDisplayName\": \"Microsoft.AzureStackHCI virtual machine instances guest agent\" }\n        ,\"microsoft.azurestackhci/virtualmachineinstances/hybrididentitymetadata\": { \"SingularDisplayName\": \"Microsoft.AzureStackHCI virtual machine instances hybrid identity metadata\" }\n        ,\"microsoft.azurestackhci/virtualmachines\": { \"SingularDisplayName\": \"Azure Local virtual machine - Azure Arc\" }\n        ,\"microsoft.azurestackhci/virtualnetworks\": { \"SingularDisplayName\": \"Microsoft.AzureStackHCI virtual network\" }\n        ,\"microsoft.backupsolutions/vmwareapplications\": { \"SingularDisplayName\": \"Microsoft.BackupSolutions vmware application\" }\n        ,\"microsoft.bakeryhybrid/pies\": { \"SingularDisplayName\": \"Microsoft.BakeryHybrid py\" }\n        ,\"microsoft.bakeryhybrid/pies/nestedresourcetype\": { \"SingularDisplayName\": \"Microsoft.BakeryHybrid pies nested resource type\" }\n        ,\"microsoft.baremetal/baremetalconnections\": { \"SingularDisplayName\": \"Microsoft.BareMetal bare metal connection\" }\n        ,\"microsoft.baremetal/crayservers\": { \"SingularDisplayName\": \"Cray Server\" }\n        ,\"microsoft.baremetal/monitoringservers\": { \"SingularDisplayName\": \"Monitoring Server\" }\n        ,\"microsoft.baremetal/peeringsettings\": { \"SingularDisplayName\": \"Microsoft.BareMetal peering setting\" }\n        ,\"microsoft.baremetalinfrastructure/baremetalinstances\": { \"SingularDisplayName\": \"BareMetal Instance\" }\n        ,\"microsoft.baremetalinfrastructure/baremetalstorageinstances\": { \"SingularDisplayName\": \"Microsoft.BareMetalInfrastructure bare metal storage instance\" }\n        ,\"microsoft.batch/batchaccounts\": { \"SingularDisplayName\": \"Batch account\" }\n        ,\"microsoft.billing/billingaccounts\": { \"SingularDisplayName\": \"Microsoft.Billing billing account\" }\n        ,\"microsoft.billing/billingaccounts/agreements\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts agreement\" }\n        ,\"microsoft.billing/billingaccounts/associatedtenants\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts associated tenant\" }\n        ,\"microsoft.billing/billingaccounts/availablebalance\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts available balance\" }\n        ,\"microsoft.billing/billingaccounts/billingprofiles\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts billing profile\" }\n        ,\"microsoft.billing/billingaccounts/billingprofiles/availablebalance\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts billing profiles available balance\" }\n        ,\"microsoft.billing/billingaccounts/billingprofiles/billingroleassignments\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts billing profiles billing role assignment\" }\n        ,\"microsoft.billing/billingaccounts/billingprofiles/billingroledefinitions\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts billing profiles billing role definition\" }\n        ,\"microsoft.billing/billingaccounts/billingprofiles/billingsubscriptions\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts billing profiles billing subscription\" }\n        ,\"microsoft.billing/billingaccounts/billingprofiles/customers\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts billing profiles customer\" }\n        ,\"microsoft.billing/billingaccounts/billingprofiles/customers/billingroleassignments\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts billing profiles customers billing role assignment\" }\n        ,\"microsoft.billing/billingaccounts/billingprofiles/customers/billingroledefinitions\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts billing profiles customers billing role definition\" }\n        ,\"microsoft.billing/billingaccounts/billingprofiles/customers/transfers\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts billing profiles customers transfer\" }\n        ,\"microsoft.billing/billingaccounts/billingprofiles/instructions\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts billing profiles instruction\" }\n        ,\"microsoft.billing/billingaccounts/billingprofiles/invoices\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts billing profiles invoice\" }\n        ,\"microsoft.billing/billingaccounts/billingprofiles/invoicesections\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts billing profiles invoice section\" }\n        ,\"microsoft.billing/billingaccounts/billingprofiles/invoicesections/billingroleassignments\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts billing profiles invoice sections billing role assignment\" }\n        ,\"microsoft.billing/billingaccounts/billingprofiles/invoicesections/billingroledefinitions\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts billing profiles invoice sections billing role definition\" }\n        ,\"microsoft.billing/billingaccounts/billingprofiles/invoicesections/billingsubscriptions\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts billing profiles invoice sections billing subscription\" }\n        ,\"microsoft.billing/billingaccounts/billingprofiles/invoicesections/products\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts billing profiles invoice sections product\" }\n        ,\"microsoft.billing/billingaccounts/billingprofiles/invoicesections/transfers\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts billing profiles invoice sections transfer\" }\n        ,\"microsoft.billing/billingaccounts/billingprofiles/paymentmethodlinks\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts billing profiles payment method link\" }\n        ,\"microsoft.billing/billingaccounts/billingprofiles/policies\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts billing profiles policy\" }\n        ,\"microsoft.billing/billingaccounts/billingprofiles/transactions\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts billing profiles transaction\" }\n        ,\"microsoft.billing/billingaccounts/billingroleassignments\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts billing role assignment\" }\n        ,\"microsoft.billing/billingaccounts/billingroledefinitions\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts billing role definition\" }\n        ,\"microsoft.billing/billingaccounts/billingsubscriptionaliases\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts billing subscription aliase\" }\n        ,\"microsoft.billing/billingaccounts/billingsubscriptions\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts billing subscription\" }\n        ,\"microsoft.billing/billingaccounts/billingsubscriptions/invoices\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts billing subscriptions invoice\" }\n        ,\"microsoft.billing/billingaccounts/customers\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts customer\" }\n        ,\"microsoft.billing/billingaccounts/customers/billingsubscriptions\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts customers billing subscription\" }\n        ,\"microsoft.billing/billingaccounts/customers/policies\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts customers policy\" }\n        ,\"microsoft.billing/billingaccounts/customers/products\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts customers product\" }\n        ,\"microsoft.billing/billingaccounts/departments\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts department\" }\n        ,\"microsoft.billing/billingaccounts/departments/billingroleassignments\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts departments billing role assignment\" }\n        ,\"microsoft.billing/billingaccounts/departments/billingroledefinitions\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts departments billing role definition\" }\n        ,\"microsoft.billing/billingaccounts/departments/enrollmentaccounts\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts departments enrollment account\" }\n        ,\"microsoft.billing/billingaccounts/enrollmentaccounts\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts enrollment account\" }\n        ,\"microsoft.billing/billingaccounts/enrollmentaccounts/billingroleassignments\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts enrollment accounts billing role assignment\" }\n        ,\"microsoft.billing/billingaccounts/enrollmentaccounts/billingroledefinitions\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts enrollment accounts billing role definition\" }\n        ,\"microsoft.billing/billingaccounts/incentiveschedules\": { \"SingularDisplayName\": \"Incentive Schedule\" }\n        ,\"microsoft.billing/billingaccounts/incentiveschedules/milestones\": { \"SingularDisplayName\": \"Milestone\" }\n        ,\"microsoft.billing/billingaccounts/invoices\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts invoice\" }\n        ,\"microsoft.billing/billingaccounts/invoicesections\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts invoice section\" }\n        ,\"microsoft.billing/billingaccounts/invoicesections/billingsubscriptions\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts invoice sections billing subscription\" }\n        ,\"microsoft.billing/billingaccounts/invoicesections/products\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts invoice sections product\" }\n        ,\"microsoft.billing/billingaccounts/invoicesections/transfers\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts invoice sections transfer\" }\n        ,\"microsoft.billing/billingaccounts/lineofcredit\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts line of credit\" }\n        ,\"microsoft.billing/billingaccounts/migrations\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts migration\" }\n        ,\"microsoft.billing/billingaccounts/paymentmethods\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts payment method\" }\n        ,\"microsoft.billing/billingaccounts/policies\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts policy\" }\n        ,\"microsoft.billing/billingaccounts/products\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts product\" }\n        ,\"microsoft.billing/billingaccounts/reservationorders\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts reservation order\" }\n        ,\"microsoft.billing/billingaccounts/reservationorders/reservations\": { \"SingularDisplayName\": \"Microsoft.Billing billing accounts reservation orders reservation\" }\n        ,\"microsoft.billing/billingaccounts/savingsplanorders\": { \"SingularDisplayName\": \"Savings plan order\" }\n        ,\"microsoft.billing/billingaccounts/savingsplanorders/savingsplans\": { \"SingularDisplayName\": \"Savings plan\" }\n        ,\"microsoft.billing/billingperiods\": { \"SingularDisplayName\": \"Microsoft.Billing billing period\" }\n        ,\"microsoft.billing/billingproperty\": { \"SingularDisplayName\": \"Microsoft.Billing billing property\" }\n        ,\"microsoft.billing/billingrequests\": { \"SingularDisplayName\": \"Microsoft.Billing billing request\" }\n        ,\"microsoft.billing/billingroleassignments\": { \"SingularDisplayName\": \"Microsoft.Billing billing role assignment\" }\n        ,\"microsoft.billing/billingroledefinitions\": { \"SingularDisplayName\": \"Microsoft.Billing billing role definition\" }\n        ,\"microsoft.billing/enrollmentaccounts\": { \"SingularDisplayName\": \"Microsoft.Billing enrollment account\" }\n        ,\"microsoft.billing/paymentmethods\": { \"SingularDisplayName\": \"Microsoft.Billing payment method\" }\n        ,\"microsoft.billing/policies\": { \"SingularDisplayName\": \"Microsoft.Billing policy\" }\n        ,\"microsoft.billing/promotions\": { \"SingularDisplayName\": \"Microsoft.Billing promotion\" }\n        ,\"microsoft.billing/transfers\": { \"SingularDisplayName\": \"Microsoft.Billing transfer\" }\n        ,\"microsoft.billingbenefits/credits\": { \"SingularDisplayName\": \"Credit\" }\n        ,\"microsoft.billingbenefits/discounts\": { \"SingularDisplayName\": \"Discount\" }\n        ,\"microsoft.billingbenefits/incentiveschedules\": { \"SingularDisplayName\": \"Incentive Schedule\" }\n        ,\"microsoft.billingbenefits/incentiveschedules/milestones\": { \"SingularDisplayName\": \"Milestone\" }\n        ,\"microsoft.billingbenefits/maccs\": { \"SingularDisplayName\": \"Microsoft Azure Consumption Commitment\" }\n        ,\"microsoft.billingbenefits/reservationorderaliases\": { \"SingularDisplayName\": \"Microsoft.BillingBenefits reservation order aliase\" }\n        ,\"microsoft.billingbenefits/savingsplanorderaliases\": { \"SingularDisplayName\": \"Microsoft.BillingBenefits savings plan order aliase\" }\n        ,\"microsoft.billingbenefits/savingsplanorders\": { \"SingularDisplayName\": \"Savings plan order\" }\n        ,\"microsoft.billingbenefits/savingsplanorders/savingsplans\": { \"SingularDisplayName\": \"Savings plan\" }\n        ,\"microsoft.bing/accounts\": { \"SingularDisplayName\": \"Bing Resource\" }\n        ,\"microsoft.blockchain/blockchainmembers\": { \"SingularDisplayName\": \"Microsoft.Blockchain blockchain member\" }\n        ,\"microsoft.blockchain/blockchainmembers/transactionnodes\": { \"SingularDisplayName\": \"Microsoft.Blockchain blockchain members transaction node\" }\n        ,\"microsoft.blockchaintokens/tokenservices\": { \"SingularDisplayName\": \"Microsoft.BlockchainTokens token service\" }\n        ,\"microsoft.blockchaintokens/tokenservices/blockchainnetworks\": { \"SingularDisplayName\": \"Microsoft.BlockchainTokens token services blockchain network\" }\n        ,\"microsoft.blockchaintokens/tokenservices/groups\": { \"SingularDisplayName\": \"Microsoft.BlockchainTokens token services group\" }\n        ,\"microsoft.blockchaintokens/tokenservices/groups/accounts\": { \"SingularDisplayName\": \"Microsoft.BlockchainTokens token services groups account\" }\n        ,\"microsoft.blockchaintokens/tokenservices/tokentemplates\": { \"SingularDisplayName\": \"Microsoft.BlockchainTokens token services token template\" }\n        ,\"microsoft.bluefin/instances\": { \"SingularDisplayName\": \"Microsoft.Bluefin instance\" }\n        ,\"microsoft.bluefin/instances/datasets\": { \"SingularDisplayName\": \"Microsoft.Bluefin instances dataset\" }\n        ,\"microsoft.bluefin/instances/pipelines\": { \"SingularDisplayName\": \"Microsoft.Bluefin instances pipeline\" }\n        ,\"microsoft.blueprint/blueprintassignments\": { \"SingularDisplayName\": \"Microsoft.Blueprint blueprint assignment\" }\n        ,\"microsoft.blueprint/blueprints\": { \"SingularDisplayName\": \"Microsoft.Blueprint blueprint\" }\n        ,\"microsoft.blueprint/blueprints/artifacts\": { \"SingularDisplayName\": \"Microsoft.Blueprint blueprints artifact\" }\n        ,\"microsoft.blueprint/blueprints/versions\": { \"SingularDisplayName\": \"Microsoft.Blueprint blueprints version\" }\n        ,\"microsoft.botservice/botservices\": { \"SingularDisplayName\": \"Bot Service\" }\n        ,\"microsoft.cache/redis\": { \"SingularDisplayName\": \"Redis cache\" }\n        ,\"microsoft.cache/redisenterprise\": { \"SingularDisplayName\": \"Azure Managed Redis\" }\n        ,\"microsoft.cache/redisenterprise/databases\": { \"SingularDisplayName\": \"Redis Enterprise database\" }\n        ,\"microsoft.capacity/reservationorders\": { \"SingularDisplayName\": \"Reservation order\" }\n        ,\"microsoft.capacity/reservationorders/reservations\": { \"SingularDisplayName\": \"Reservation\" }\n        ,\"microsoft.cascade/sites\": { \"SingularDisplayName\": \"Microsoft.Cascade site\" }\n        ,\"microsoft.cdn/cdnwebapplicationfirewallpolicies\": { \"SingularDisplayName\": \"Content Delivery Network WAF policy\" }\n        ,\"microsoft.cdn/edgeactions\": { \"SingularDisplayName\": \"Edge Action\" }\n        ,\"microsoft.cdn/profiles\": { \"SingularDisplayName\": \"Front Door and CDN profile\" }\n        ,\"microsoft.cdn/profiles/afdendpoints\": { \"SingularDisplayName\": \"Endpoint\" }\n        ,\"microsoft.cdn/profiles/afdendpoints/routes\": { \"SingularDisplayName\": \"Route\" }\n        ,\"microsoft.cdn/profiles/customdomains\": { \"SingularDisplayName\": \"Custom domain\" }\n        ,\"microsoft.cdn/profiles/endpoints\": { \"SingularDisplayName\": \"CDN endpoint\" }\n        ,\"microsoft.cdn/profiles/endpoints/customdomains\": { \"SingularDisplayName\": \"CDN custom domain\" }\n        ,\"microsoft.cdn/profiles/endpoints/origins\": { \"SingularDisplayName\": \"CDN origin\" }\n        ,\"microsoft.cdn/profiles/origingroups\": { \"SingularDisplayName\": \"Origin group\" }\n        ,\"microsoft.cdn/profiles/origingroups/origins\": { \"SingularDisplayName\": \"Origin\" }\n        ,\"microsoft.cdn/profiles/rulesets\": { \"SingularDisplayName\": \"Rule set\" }\n        ,\"microsoft.cdn/profiles/rulesets/rules\": { \"SingularDisplayName\": \"Rule\" }\n        ,\"microsoft.cdn/profiles/secrets\": { \"SingularDisplayName\": \"Secret\" }\n        ,\"microsoft.cdn/profiles/securitypolicies\": { \"SingularDisplayName\": \"Security policy\" }\n        ,\"microsoft.certificateregistration/certificateorders\": { \"SingularDisplayName\": \"App Service certificate\" }\n        ,\"microsoft.certify/testsuites\": { \"SingularDisplayName\": \"Microsoft.Certify test suite\" }\n        ,\"microsoft.certify/validationjobs\": { \"SingularDisplayName\": \"Microsoft.Certify validation job\" }\n        ,\"microsoft.changeanalysis/profile\": { \"SingularDisplayName\": \"Microsoft.ChangeAnalysis profile\" }\n        ,\"microsoft.changesafety/changestates\": { \"SingularDisplayName\": \"Microsoft.ChangeSafety change state\" }\n        ,\"microsoft.changesafety/changestates/stageprogressions\": { \"SingularDisplayName\": \"Microsoft.ChangeSafety change states stage progression\" }\n        ,\"microsoft.changesafety/stagemaps\": { \"SingularDisplayName\": \"Microsoft.ChangeSafety stage map\" }\n        ,\"microsoft.changesafety/validations\": { \"SingularDisplayName\": \"Microsoft.ChangeSafety validation\" }\n        ,\"microsoft.changesafety/validators\": { \"SingularDisplayName\": \"Microsoft.ChangeSafety validator\" }\n        ,\"microsoft.changesafety/validators/versions\": { \"SingularDisplayName\": \"Microsoft.ChangeSafety validators version\" }\n        ,\"microsoft.chaos/experiments\": { \"SingularDisplayName\": \"Chaos Experiment\" }\n        ,\"microsoft.chaos/privateaccesses\": { \"SingularDisplayName\": \"Agent Private Access\" }\n        ,\"microsoft.chaos/targets\": { \"SingularDisplayName\": \"Microsoft.Chaos target\" }\n        ,\"microsoft.chaos/targets/capabilities\": { \"SingularDisplayName\": \"Microsoft.Chaos targets capability\" }\n        ,\"microsoft.classiccompute/domainnames\": { \"SingularDisplayName\": \"Cloud service (classic)\" }\n        ,\"microsoft.classiccompute/domainnames/slots/roles\": { \"SingularDisplayName\": \"Cloud service role (classic)\" }\n        ,\"microsoft.classiccompute/virtualmachines\": { \"SingularDisplayName\": \"Virtual machine (classic)\" }\n        ,\"microsoft.classicnetwork/networksecuritygroups\": { \"SingularDisplayName\": \"Network security group (classic)\" }\n        ,\"microsoft.classicnetwork/reservedips\": { \"SingularDisplayName\": \"Reserved IP address (classic)\" }\n        ,\"microsoft.classicnetwork/virtualnetworks\": { \"SingularDisplayName\": \"Virtual network (classic)\" }\n    })[tolower(id)]\n}\n",
                    "$fxv#10": "// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\n//======================================================================================================================\n// Ingestion database\n// See known issues @ https://github.com/microsoft/finops-toolkit/issues/1111\n//======================================================================================================================\n\n// For allowed commands, see https://learn.microsoft.com/azure/data-explorer/database-script\n\n//===| Prices |=========================================================================================================\n// Supported versions:\n// - MS EA 2023-05-01  -- See https://learn.microsoft.com/azure/cost-management-billing/dataset-schema/price-sheet-ea\n// - MS MCA 2023-05-01 -- See https://learn.microsoft.com/azure/cost-management-billing/dataset-schema/price-sheet-mca\n//======================================================================================================================\n\n// Prices_transform_v1_2 function\n.create-or-alter function\nwith (docstring='Transforms Prices_raw into FOCUS 1.2.', folder='Prices')\nPrices_transform_v1_2()\n{\n    // NOTE: All open issues and questions are tracked @ https://github.com/microsoft/finops-toolkit/issues/1111\n    let isoMonths = (duration: string) {\n        let number = toint(replace_regex(duration, @'[PMY]', ''));\n        toint(case(\n            duration == '', int(null),\n            duration endswith \"Y\", number * 12,\n            duration endswith \"M\", number,\n            -1\n        ))\n    };\n    let prices = materialize(\n        Prices_raw\n        | extend PricingCurrency = coalesce(Currency, CurrencyCode)  // CurrencyCode last as a fallback only\n        | extend x_SkuId = coalesce(SkuId, SkuID)\n        | extend x_SkuMeterId = coalesce(MeterId, MeterID)\n        | extend x_SkuProductId = coalesce(ProductId, ProductID)\n        | extend x_SkuTerm = isoMonths(Term)\n        | project-rename\n            SkuMeter = MeterName,\n            x_BaseUnitPrice = BasePrice,\n            x_EffectivePeriodEnd = EffectiveEndDate,\n            x_EffectivePeriodStart = EffectiveStartDate,\n            x_PricingUnitDescription = UnitOfMeasure,\n            x_SkuIncludedQuantity = IncludedQuantity,\n            x_SkuMeterCategory = MeterCategory,\n            x_SkuMeterSubcategory = MeterSubCategory,\n            x_SkuMeterType = MeterType,\n            x_SkuOfferId = OfferID,\n            x_SkuPartNumber = PartNumber,\n            x_SkuPriceType = PriceType,\n            x_SkuRegion = MeterRegion,\n            x_SkuServiceFamily = ServiceFamily,\n            x_SkuTier = TierMinimumUnits\n        | extend ContractedUnitPrice = iff(x_SkuPriceType != 'SavingsPlan', UnitPrice, real(null))  // UnitPrice for savings plan is not the on-demand unit price\n        | extend ListUnitPrice = iff(x_SkuPriceType != 'SavingsPlan', MarketPrice, real(null))  // MarketPrice for savings plan is not the list price\n        | extend ChargeCategory = case(\n            x_SkuPriceType == 'Consumption', 'Usage',\n            x_SkuPriceType == 'ReservedInstance', 'Purchase',\n            x_SkuPriceType == 'SavingsPlan', 'Usage',  // Savings plan prices are for committed usage, not the purchase\n            ''\n        )\n        | extend SkuPriceIdv2 = strcat(case(x_SkuPriceType == 'Consumption', 'OD', x_SkuPriceType == 'ReservedInstance', 'RI', x_SkuPriceType == 'SavingsPlan', 'SP', 'XX'), substring(ChargeCategory, 0, 1), x_SkuTerm, '_', x_SkuProductId, '_', x_SkuId, '_', x_SkuMeterType, '_', x_SkuTier, x_SkuOfferId)\n        | extend x_BillingAccountId = iff(BillingAccountId startswith '/', split(BillingAccountId, '/')[-1], coalesce(BillingAccountId, EnrollmentNumber))\n        | extend x_BillingProfileId = iff(BillingProfileId startswith '/', split(BillingProfileId, '/')[-1], coalesce(BillingProfileId, EnrollmentNumber))\n        | extend tmp_SavingsPlanKey = strcat(x_SkuMeterId, x_SkuProductId, x_SkuId, x_SkuTier, x_SkuOfferId)\n        //\n        // Get latest ingested row based on the unique ID\n        | extend x_IngestionTime = ingestion_time()\n    );\n    //\n    // Meters for reservations and savings plans to identify commitment eligibility\n    let riMeters = prices | where x_SkuPriceType == 'ReservedInstance' | distinct x_SkuMeterId;\n    let spMeters = prices | where x_SkuPriceType == 'SavingsPlan' | distinct x_SkuMeterId;\n    //\n    // Copy list/base/contracted prices from on-demand SKUs\n    prices\n    | where x_SkuPriceType == 'SavingsPlan'\n    // If we use join, specify the shuffle key\n    // TODO: Compare join vs. lookup perf -- | join kind=leftouter hint.strategy=shuffle (prices | where x_SkuPriceType == 'Consumption' | where x_SkuMeterId in (spMeters) | distinct tmp_SavingsPlanKey, ListUnitPrice, ContractedUnitPrice, x_BaseUnitPrice) on tmp_SavingsPlanKey\n    | lookup kind=leftouter (prices | where x_SkuPriceType == 'Consumption' | where x_SkuMeterId in (spMeters) | distinct tmp_SavingsPlanKey, ListUnitPrice, ContractedUnitPrice, x_BaseUnitPrice) on tmp_SavingsPlanKey\n    | extend ListUnitPrice = coalesce(ListUnitPrice, ListUnitPrice1)\n    | extend ContractedUnitPrice = coalesce(ContractedUnitPrice, ContractedUnitPrice1)\n    | extend x_BaseUnitPrice = coalesce(x_BaseUnitPrice, x_BaseUnitPrice1)\n    | project-away ListUnitPrice1, ContractedUnitPrice1, x_BaseUnitPrice1, tmp_SavingsPlanKey\n    | union ((prices | where x_SkuPriceType != 'SavingsPlan'))\n    //\n    // Set CommitmentDiscountCategory for reuse\n    | extend CommitmentDiscountCategory = case(\n        x_SkuPriceType == 'ReservedInstance', 'Usage',\n        x_SkuPriceType == 'SavingsPlan', 'Spend',\n        ''\n    )\n    //\n    // Calculate commitment discount eligibility\n    // TODO: Would a join be faster?\n    // TODO: Check this to ensure it's correct\n    | extend x_CommitmentDiscountSpendEligibility = iff(x_SkuMeterId in (riMeters) and x_SkuPriceType != 'ReservedInstance', 'Eligible', 'Not Eligible')\n    | extend x_CommitmentDiscountUsageEligibility = iff(x_SkuMeterId in (spMeters), 'Eligible', 'Not Eligible')\n    //\n    // TODO: Implement x_CommitmentDiscountNormalizedRatio\n    | extend x_CommitmentDiscountNormalizedRatio = real(null)\n    //\n    // Add PricingUnit and x_PricingBlockSize\n    // TODO: Compare join vs. lookup perf -- | join kind=leftouter (PricingUnits) on x_PricingUnitDescription | project-away x_PricingUnitDescription1\n    | lookup kind=leftouter (PricingUnits) on x_PricingUnitDescription\n    //\n    | extend x_EffectiveUnitPrice = iff(x_SkuPriceType == 'SavingsPlan', UnitPrice, real(null))  // Savings plan prices are for the effective price, not the contracted price\n    | extend x_EffectiveUnitPriceDiscount = ContractedUnitPrice - x_EffectiveUnitPrice\n    | extend x_ContractedUnitPriceDiscount = ListUnitPrice - ContractedUnitPrice\n    | extend x_TotalUnitPriceDiscount = ListUnitPrice - x_EffectiveUnitPrice\n    | project\n        BillingAccountId = tolower(case(\n            BillingProfileId startswith '/', BillingProfileId,\n            BillingAccountId startswith '/', BillingAccountId,\n            strcat('/providers/microsoft.billing/billingaccounts/', x_BillingAccountId, iff(x_BillingProfileId == x_BillingAccountId, '', strcat('/billingprofiles/', x_BillingProfileId)))\n        )),\n        BillingAccountName = coalesce(BillingProfileName, BillingAccountName, x_BillingProfileId),\n        BillingCurrency = coalesce(BillingCurrency, CurrencyCode, Currency),  // Currency last as a fallback only\n        ChargeCategory,\n        CommitmentDiscountCategory,\n        CommitmentDiscountType = case(\n            x_SkuPriceType == 'ReservedInstance', 'Reservation',\n            x_SkuPriceType == 'SavingsPlan', 'Savings plan',\n            ''\n        ),\n        CommitmentDiscountUnit = case(\n            isempty(CommitmentDiscountCategory), '',\n            CommitmentDiscountCategory == 'Spend', PricingCurrency,\n            CommitmentDiscountCategory == 'Usage' and x_CommitmentDiscountNormalizedRatio == real(1), PricingUnit,\n            CommitmentDiscountCategory == 'Usage' and x_CommitmentDiscountNormalizedRatio > real(1), strcat('Normalized ', PricingUnit),\n            ''\n        ),\n        ContractedUnitPrice,\n        ListUnitPrice,\n        PricingCategory = case(\n            x_SkuPriceType == 'Consumption', 'Standard',\n            x_SkuPriceType == 'ReservedInstance', 'Standard',  // Reservation purchases are tracked as \"Standard\"\n            x_SkuPriceType == 'SavingsPlan', 'Committed',\n            ''\n        ),\n        PricingCurrency,\n        PricingUnit,\n        SkuId = coalesce(ProductId, ProductID),\n        SkuMeter,\n        SkuPriceId = strcat(x_SkuProductId, '_', x_SkuId, '_', x_SkuMeterType),\n        SkuPriceIdv2,\n        x_BaseUnitPrice,\n        x_BillingAccountAgreement = case(\n            strlen(x_BillingAccountId) > 32, 'MCA',\n            strlen(x_BillingAccountId) < 32, 'EA',\n            'Unknown'\n        ),\n        x_BillingAccountId,\n        x_BillingProfileId,\n        x_CommitmentDiscountNormalizedRatio,\n        x_CommitmentDiscountSpendEligibility,\n        x_CommitmentDiscountUsageEligibility,\n        x_ContractedUnitPriceDiscount,\n        x_ContractedUnitPriceDiscountPercent = 1.0 * x_ContractedUnitPriceDiscount / ListUnitPrice * 100,\n        x_EffectivePeriodEnd = startofmonth(x_EffectivePeriodEnd + 1h),\n        x_EffectivePeriodStart,\n        x_EffectiveUnitPrice,\n        x_EffectiveUnitPriceDiscount,\n        x_EffectiveUnitPriceDiscountPercent = 1.0 * x_EffectiveUnitPriceDiscount / ContractedUnitPrice * 100,\n        x_IngestionTime,\n        x_PricingBlockSize,\n        x_PricingSubcategory = case(\n            x_SkuPriceType == 'Consumption' and (x_SkuIncludedQuantity > 0 or x_SkuTier > 0), 'Tiered',\n            x_SkuPriceType == 'Consumption', 'Standard',\n            x_SkuPriceType == 'ReservedInstance', 'Standard', // Reservation purchases are tracked as \"Standard\"\n            x_SkuPriceType == 'SavingsPlan', 'Committed Spend',\n            ''\n        ),\n        x_PricingUnitDescription,\n        x_SkuDescription = Product,\n        x_SkuId,\n        x_SkuIncludedQuantity,\n        x_SkuMeterCategory,\n        x_SkuMeterId,\n        x_SkuMeterSubcategory,\n        x_SkuMeterType,\n        x_SkuPriceType,\n        x_SkuProductId,\n        x_SkuRegion,\n        x_SkuServiceFamily,\n        x_SkuOfferId,\n        x_SkuPartNumber,\n        x_SkuTerm,\n        x_SkuTier,\n        x_SourceName = coalesce(x_SourceName, 'Cost Management'),\n        x_SourceProvider = coalesce(x_SourceProvider, 'Microsoft'),\n        x_SourceType = coalesce(x_SourceType, 'PriceSheet'),\n        x_SourceVersion = coalesce(x_SourceVersion, '2023-05-01'),\n        x_TotalUnitPriceDiscount,\n        x_TotalUnitPriceDiscountPercent = 1.0 * x_TotalUnitPriceDiscount / ListUnitPrice * 100\n}\n\n// Prices_final_v1_2 table\n.create-merge table Prices_final_v1_2 (\n    BillingAccountId:                     string,\n    BillingAccountName:                   string,\n    BillingCurrency:                      string,\n    ChargeCategory:                       string,\n    CommitmentDiscountCategory:           string,\n    CommitmentDiscountType:               string,\n    CommitmentDiscountUnit:               string,\n    ContractedUnitPrice:                  real,\n    ListUnitPrice:                        real,\n    PricingCategory:                      string,\n    PricingCurrency:                      string,    // Azure\n    PricingUnit:                          string,\n    SkuId:                                string,\n    SkuMeter:                             string,    // Azure\n    SkuPriceId:                           string,\n    SkuPriceIdv2:                         string,    // Hubs add-on\n    x_BaseUnitPrice:                      real,      // Azure\n    x_BillingAccountAgreement:            string,    // Hubs add-on\n    x_BillingAccountId:                   string,    // Azure MCA\n    x_BillingProfileId:                   string,    // Azure MCA\n    x_CommitmentDiscountNormalizedRatio:  real,      // Hubs add-on\n    x_CommitmentDiscountSpendEligibility: string,    // Hubs add-on\n    x_CommitmentDiscountUsageEligibility: string,    // Hubs add-on\n    x_ContractedUnitPriceDiscount:        real,      // Hubs add-on\n    x_ContractedUnitPriceDiscountPercent: real,      // Hubs add-on\n    x_EffectivePeriodEnd:                 datetime,  // Azure\n    x_EffectivePeriodStart:               datetime,  // Azure\n    x_EffectiveUnitPrice:                 real,      // Azure\n    x_EffectiveUnitPriceDiscount:         real,      // Hubs add-on\n    x_EffectiveUnitPriceDiscountPercent:  real,      // Hubs add-on\n    x_IngestionTime:                      datetime,  // Hubs add-on\n    x_PricingBlockSize:                   real,      // Hubs add-on\n    x_PricingSubcategory:                 string,    // Hubs add-on\n    x_PricingUnitDescription:             string,    // Azure\n    x_SkuDescription:                     string,    // Azure\n    x_SkuId:                              string,    // Azure\n    x_SkuIncludedQuantity:                real,      // Azure EA\n    x_SkuMeterCategory:                   string,    // Azure\n    x_SkuMeterId:                         string,    // Azure\n    x_SkuMeterSubcategory:                string,    // Azure\n    x_SkuMeterType:                       string,    // Azure\n    x_SkuPriceType:                       string,    // Azure\n    x_SkuProductId:                       string,    // Azure\n    x_SkuRegion:                          string,    // Azure\n    x_SkuServiceFamily:                   string,    // Azure\n    x_SkuOfferId:                         string,    // Azure EA\n    x_SkuPartNumber:                      string,    // Azure EA\n    x_SkuTerm:                            int,       // Azure\n    x_SkuTier:                            real,      // Azure MCA\n    x_SourceName:                         string,    // Hubs add-on\n    x_SourceProvider:                     string,    // Hubs add-on\n    x_SourceType:                         string,    // Hubs add-on\n    x_SourceVersion:                      string,    // Hubs add-on\n    x_TotalUnitPriceDiscount:             real,      // Hubs add-on\n    x_TotalUnitPriceDiscountPercent:      real       // Hubs add-on\n)\n\n// Update policy for Prices_raw -> Prices_final_v1_2\n.alter table Prices_final_v1_2 policy update\n```\n[{\n    \"IsEnabled\": true,\n    \"Source\": \"Prices_raw\",\n    \"Query\": \"Prices_transform_v1_2()\",\n    \"IsTransactional\": true,\n    \"PropagateIngestionProperties\": true\n}]\n```\n\n\n//===| Cost and usage |=================================================================================================\n// Supported versions:\n// - MS: 1.2-preview, 1.0, 1.0-preview(v1)\n//   https://aka.ms/costmgmt/exports/focus\n// - AWS: 1.0\n//   https://docs.aws.amazon.com/cur/latest/userguide/table-dictionary-focus-1-0-aws-columns.html\n// - GCP: Jan-Jun 2024\n//   https://cloud.google.com/resources/google-cloud-focus?e=48754805&hl=en\n//   Links to (Aug 2024): https://services.google.com/fh/files/misc/focus_guide_v1.pdf\n//   See also:\n//   - https://cloud.google.com/billing/docs/how-to/export-data-bigquery-tables/standard-usage\n//   - https://cloud.google.com/billing/docs/how-to/export-data-bigquery-tables/detailed-usage\n// - OCI: 1.0                \n//   https://docs.oracle.com/iaas/Content/Billing/Concepts/costusagereportsoverview.htm#costreports__focus-cost-report-schema\n//\n// Support for non-Azure data is limited to ingestion only. Data is not transformed across versions.\n//======================================================================================================================\n\n// Costs_transform_v1_2 function\n.create-or-alter function\nwith (docstring='All costs transformed to FOCUS 1.2.', folder='Costs')\nCosts_transform_v1_2()\n{\n    let checkString = (column: string, oldValue: string, newValue: string) {\n        iff(oldValue == newValue, dynamic({}), bag_pack(column, oldValue))\n    };\n    let checkInt = (column: string, oldValue: int, newValue: int) {\n        iff(oldValue == newValue, dynamic({}), bag_pack(column, oldValue))\n    };\n    let checkReal = (column: string, oldValue: real, newValue: real) {\n        iff(oldValue == newValue, dynamic({}), bag_pack(column, oldValue))\n    };\n    // NOTE: All open issues and questions are tracked @ https://github.com/microsoft/finops-toolkit/issues/1111\n    Costs_raw\n    //\n    // Dedupe rows\n    | extend x_IngestionTime = ingestion_time()\n    | extend x_ChargeId = ''\n    // TODO: Consider adding a unique charge ID per row\n    // hash_sha256(strcat(\n    //     // DO NOT CHANGE COLUMNS OR COLUMN ORDER\n    //     // 1. Resource hierarchy (including resource name), highest to lowest\n    //     BillingAccountId,\n    //     x_InvoiceSectionId,\n    //     x_AccountOwnerId,\n    //     SubAccountId,\n    //     x_ResourceGroupName,\n    //     ResourceName,\n    //     // 2. Resource details\n    //     ResourceId,\n    //     RegionId,\n    //     Tags,\n    //     CommitmentDiscountId,\n    //     x_CostCenter,\n    //     // 4. Meter details\n    //     SkuPriceId,\n    //     x_SkuMeterId,\n    //     x_SkuPartNumber,\n    //     x_SkuOfferId,\n    //     x_SkuDetails,\n    //     // 5. Date\n    //     ChargePeriodStart\n    // ))\n    //\n    // Identify data quality issues\n    // TODO: Remove x_SourceChanges in v1_3 (or later)\n    | extend x_SourceChanges = trim_end(',', strcat(\n        iff(ChargeCategory == 'Purchase' and isnotempty(CommitmentDiscountId) and ChargeFrequency == 'Usage-Based',                 'InvalidChargeFrequency,',           ''),\n        iff(ChargeCategory == 'Purchase' and isnotempty(CommitmentDiscountId) and EffectiveCost > 0,                                'InvalidEffectiveCost,',             ''),\n        iff((isempty(ContractedCost)      or ContractedCost == 0)      and EffectiveCost != 0,                                      'MissingContractedCost,',            ''),\n        iff((isempty(ContractedUnitPrice) or ContractedUnitPrice == 0) and x_EffectiveUnitPrice != 0,                               'MissingContractedUnitPrice,',       ''),\n        iff(ListCost < ContractedCost,                                                                                              'ListCostLessThanContractedCost,',   ''),\n        iff(ContractedCost < EffectiveCost,                                                                                         'ContractedCostLessThanEffectiveCost,', ''),\n        iff((isempty(ListCost)            or ListCost == 0)            and (ContractedCost != 0      or EffectiveCost != 0),        'MissingListCost,',                  ''),\n        iff((isempty(ListUnitPrice)       or ListUnitPrice == 0)       and (ContractedUnitPrice != 0 or x_EffectiveUnitPrice != 0), 'MissingListUnitPrice,',             ''),\n        iff((isnotempty(x_BilledUnitPrice) and x_BilledUnitPrice != 0 and isnotempty(x_EffectiveUnitPrice) and x_EffectiveUnitPrice != 0 and abs(x_BilledUnitPrice - x_EffectiveUnitPrice) < 0.0001)\n            or (isnotempty(ContractedUnitPrice) and ContractedUnitPrice != 0 and isnotempty(x_EffectiveUnitPrice) and x_EffectiveUnitPrice != 0 and abs(ContractedUnitPrice - x_EffectiveUnitPrice) < 0.0001),\n            'XEffectiveUnitPriceRoundingError,',  ''),\n        iff(ConsumedQuantity == 0 and (EffectiveCost != 0 or BilledCost != 0),                                                      'MissingConsumedQuantity,',              ''),\n        iff(PricingQuantity == 0 and (EffectiveCost != 0 or BilledCost != 0),                                                       'MissingPricingQuantity,',              ''),\n        iff(isempty(ProviderName),                                                                                                  'MissingProviderName,',              ''),\n        iff(isempty(PublisherName),                                                                                                 'MissingPublisherName,',             ''),\n        iff(ChargeCategory == 'Purchase' and isnotempty(CommitmentDiscountId) and isempty(ResourceId),                              'MissingResourceId,',                ''),\n        iff(ChargeCategory == 'Purchase' and isnotempty(CommitmentDiscountId) and isempty(ResourceName),                            'MissingResourceName,',              ''),\n        iff(ChargeCategory == 'Purchase' and isnotempty(CommitmentDiscountId) and isempty(ResourceType),                            'MissingResourceType,',              ''),\n        iff(BilledCost > 0 and x_BilledUnitPrice == 0,                                                                              'MissingXBilledUnitPrice,',          ''),\n        iff(ChargeCategory == 'Purchase' and isnotempty(CommitmentDiscountId) and isempty(x_ResourceType),                          'MissingXResourceType,',             ''),\n        iff(PricingCategory == 'Standard' and isnotempty(CommitmentDiscountId) and ChargeCategory == 'Usage',                       'PricingCategoryShouldBeCommitted,', ''),\n        iff(x_SkuTerm == '1Year' or x_SkuTerm == '3Years' or x_SkuTerm == '5Years',                                                 'SkuTermShouldBeAnInteger,',         '')\n    ))\n    //\n    // Handle provider columns that moved to FOCUS\n    | extend PricingCurrency = coalesce(PricingCurrency, x_PricingCurrency)\n    //\n    // Backup original prices/costs before the merge\n    | extend old_ContractedCost = ContractedCost\n    | extend old_ContractedUnitPrice = ContractedUnitPrice\n    | extend old_ListCost = ListCost\n    | extend old_ListUnitPrice = ListUnitPrice\n    | extend old_x_EffectiveUnitPrice = x_EffectiveUnitPrice\n    //\n    // Fix columns needed in other changes\n    | extend old_ProviderName = ProviderName, ProviderName = case(\n        isnotempty(ProviderName), ProviderName,\n        isnotempty(coalesce(x_CostCategories, x_Discount, x_Operation, x_ServiceCode, x_UsageType)), 'AWS',\n        isnotempty(coalesce(tostring(UsageAmount), tostring(x_Cost), x_Credits, x_CostType, tostring(x_CurrencyConversionRate), tostring(x_ExportTime), x_Project, x_ServiceId)), 'GCP',\n        isnotempty(coalesce(x_BillingProfileId, x_InvoiceSectionId)), 'Microsoft',\n        ''\n    )\n    //\n    // Identify source\n    | extend x_SourceName     = coalesce(x_SourceName, iff(isnotempty(x_BillingProfileId), 'Cost Management', ProviderName))\n    | extend x_SourceProvider = coalesce(x_SourceProvider, ProviderName)\n    | extend x_SourceType     = coalesce(x_SourceType, iff(isnotempty(x_BillingProfileId), 'FocusCost', ''))\n    | extend x_SourceVersion  = coalesce(x_SourceVersion, case(\n        isnotempty(coalesce(InvoiceId, SkuMeter, PricingCurrency)) and isempty(SkuPriceDetails) and isnotempty(x_SkuDetails), '1.2-preview',\n        isnotempty(coalesce(InvoiceId, SkuMeter, PricingCurrency)), '1.2',\n        isnotempty(coalesce(ChargeClass, CommitmentDiscountStatus, tostring(ConsumedQuantity), ConsumedUnit, tostring(ContractedCost), tostring(ContractedUnitPrice), RegionId, RegionName)), '1.0',\n        isnotempty(coalesce(ChargeSubcategory, Region, tostring(UsageQuantity), UsageUnit)), iff(ProviderName == 'Microsoft', '1.0-preview(v1)', '1.0-preview'),\n        ''\n    ))\n    // Append version check error code\n    | extend x_SourceChanges = iff(x_SourceVersion == '1.0', x_SourceChanges,\n        strcat(x_SourceChanges, iff(isempty(x_SourceChanges), '', ','), iff(x_SourceVersion == '', 'UnknownFocusVersion', 'LegacyFocusVersion'))\n    )\n    //\n    // Fix quantities\n    | extend old_PricingQuantity = PricingQuantity, PricingQuantity = case(\n        PricingQuantity != 0 or (EffectiveCost == 0 and BilledCost == 0), PricingQuantity,\n        PricingQuantity == 0 and isnotempty(BilledCost) and BilledCost != 0 and isnotempty(x_BilledUnitPrice) and x_BilledUnitPrice != 0, BilledCost / x_BilledUnitPrice,\n        PricingQuantity == 0 and isnotempty(BilledCost) and BilledCost != 0 and isnotempty(x_BilledUnitPrice) and x_BilledUnitPrice != 0, BilledCost / x_BilledUnitPrice,\n        PricingQuantity == 0 and isnotempty(EffectiveCost) and EffectiveCost != 0 and isnotempty(x_EffectiveUnitPrice) and x_EffectiveUnitPrice != 0, EffectiveCost / x_EffectiveUnitPrice,\n        PricingQuantity\n    )\n    | extend old_ConsumedQuantity = ConsumedQuantity, ConsumedQuantity = case(\n        isnotempty(ConsumedQuantity) and ConsumedQuantity != 0, ConsumedQuantity,\n        ChargeCategory == 'Usage', PricingQuantity / coalesce(x_PricingBlockSize, real(1)),\n        ConsumedQuantity\n    )\n    //\n    // Populate missing prices -- mapping to on-demand prices requires meter ID and offer ID\n    | extend tmp_MissingPrices = ProviderName == 'Microsoft'\n        and (isempty(ListUnitPrice) or isempty(ContractedUnitPrice) or ListUnitPrice == 0 or ContractedUnitPrice == 0)\n        and x_EffectiveUnitPrice != 0\n        and not(CommitmentDiscountCategory == 'Spend' and CommitmentDiscountStatus == 'Unused')\n        and isnotempty(strcat(x_SkuMeterId, x_SkuOfferId))\n    | as allCosts\n    | where tmp_MissingPrices\n    | extend tmp_ReservationPriceLookupKey = tolower(strcat(x_BillingProfileId, substring(ChargePeriodStart, 0, 7), x_SkuMeterId, x_SkuOfferId))\n    | as costsWithMissingPrices\n    | join kind=leftouter (\n        Prices_final_v1_2\n        | extend tmp_ReservationPriceLookupKey = tolower(strcat(x_BillingProfileId, substring(x_EffectivePeriodStart, 0, 7), x_SkuMeterId, x_SkuOfferId))\n        | where x_SkuPriceType == 'Consumption' and tmp_ReservationPriceLookupKey in ((costsWithMissingPrices | summarize by tmp_ReservationPriceLookupKey))\n        | summarize ListUnitPrice = min(ListUnitPrice), ContractedUnitPrice = min(ContractedUnitPrice) by tmp_ReservationPriceLookupKey, x_PricingBlockSize, PricingUnit\n    ) on tmp_ReservationPriceLookupKey\n    //\n    // Select the best price to use for each row\n    | extend x_EffectiveUnitPrice = case(\n        // If price is a rounding error away from the billed price, use the billed price\n        isnotempty(x_BilledUnitPrice) and x_BilledUnitPrice != 0 and isnotempty(x_EffectiveUnitPrice) and x_EffectiveUnitPrice != 0 and abs(x_BilledUnitPrice - x_EffectiveUnitPrice) < 0.0001, x_BilledUnitPrice,\n        // If price is a rounding error away from the contracted price, use the contracted price\n        isnotempty(ContractedUnitPrice) and ContractedUnitPrice != 0 and isnotempty(x_EffectiveUnitPrice) and x_EffectiveUnitPrice != 0 and abs(ContractedUnitPrice - x_EffectiveUnitPrice) < 0.0001, ContractedUnitPrice,\n        x_EffectiveUnitPrice\n    )\n    | extend ContractedUnitPrice = case(\n        // If price is already correct, keep that\n        (isnotempty(ContractedUnitPrice) and ContractedUnitPrice != 0) or (EffectiveCost == 0 and BilledCost == 0), ContractedUnitPrice,\n        // If both prices use the same scale, use the new one\n        PricingUnit == PricingUnit1 and x_PricingBlockSize == x_PricingBlockSize1, ContractedUnitPrice1 * x_BillingExchangeRate,\n        // If prices are the same unit but not the same scale, use the new one but correct the scale\n        PricingUnit == PricingUnit1 and x_PricingBlockSize != x_PricingBlockSize1 and isnotempty(x_PricingBlockSize) and isnotempty(x_PricingBlockSize1), ContractedUnitPrice1 * x_BillingExchangeRate / x_PricingBlockSize1 * x_PricingBlockSize,\n        // If billed price is available, assume the billed price is the same as contracted price to support aggregations\n        isnotempty(x_BilledUnitPrice) and x_BilledUnitPrice != 0, x_EffectiveUnitPrice,\n        // Otherwise, assume the effective price is the same as contracted price to support aggregations\n        x_EffectiveUnitPrice\n    )\n    | extend ListUnitPrice = case(\n        // If price is already correct, keep that\n        (isnotempty(ListUnitPrice) and ListUnitPrice != 0) or (EffectiveCost == 0 and BilledCost == 0), ListUnitPrice,\n        // If both prices use the same scale, use the new one\n        PricingUnit == PricingUnit1 and x_PricingBlockSize == x_PricingBlockSize1, ListUnitPrice1 * x_BillingExchangeRate,\n        // If prices are the same unit but not the same scale, use the new one but correct the scale\n        PricingUnit == PricingUnit1 and x_PricingBlockSize != x_PricingBlockSize1 and isnotempty(x_PricingBlockSize) and isnotempty(x_PricingBlockSize1), ListUnitPrice1 * x_BillingExchangeRate / x_PricingBlockSize1 * x_PricingBlockSize,\n        // Otherwise, assume the contracted price is the same as list price to support aggregations\n        ContractedUnitPrice\n    )\n    // Calculate missing costs based on new prices -- If cost is already correct, keep that; if not and price is available, recalculate the cost; otherwise, keep the existing cost\n    | extend ContractedCost = case(\n        // If not set or there's no cost, keep the original value\n        (isnotempty(ContractedCost) and ContractedCost != 0) or (EffectiveCost == 0 and BilledCost == 0), ContractedCost,\n        // ContractedCost is 0 in all other scenarios...\n        // If 0 and there's a billed cost and prices are the same, use BilledCost\n        isnotempty(BilledCost)    and BilledCost    != 0 and ContractedUnitPrice == x_BilledUnitPrice,    BilledCost,\n        // If 0 and there's a billed cost and prices are the same, use EffectiveCost\n        isnotempty(EffectiveCost) and EffectiveCost != 0 and ContractedUnitPrice == x_EffectiveUnitPrice, EffectiveCost,\n        // If 0 and there's a price, calculate the cost based on the price\n        isnotempty(ContractedUnitPrice) and ContractedUnitPrice != 0, ContractedUnitPrice * PricingQuantity,\n        // If 0 and there's no price, assume EffectiveCost\n        isempty(ContractedUnitPrice) or ContractedUnitPrice == 0, EffectiveCost,\n        // Fall back to the original value for any unhandled scenarios\n        ContractedCost\n    )\n    | extend ListCost = case(\n        // If not set or there's no cost, keep the original value\n        (isnotempty(ListCost) and ListCost != 0) or (EffectiveCost == 0 and BilledCost == 0), ListCost,\n        // ListCost is 0 in all other scenarios...\n        // If 0 and there's a contracted cost and prices are the same, use ContractedCost\n        isnotempty(ContractedCost) and ContractedCost != 0 and ListUnitPrice == ContractedUnitPrice, ContractedCost,\n        // If 0 and there's a price, calculate the cost based on the price\n        isnotempty(ListUnitPrice) and ListUnitPrice != 0, ListUnitPrice * PricingQuantity,\n        // If 0 and there's no price, assume ContractedCost\n        isempty(ListUnitPrice) or ListUnitPrice == 0, ContractedCost,\n        // Fall back to the original value for any unhandled scenarios\n        ListCost\n    )\n    // Merge the rest of the unmodified cost records and remove excess columns\n    | union (allCosts | where not(tmp_MissingPrices))\n    | project-away x_PricingBlockSize1, PricingUnit1, ListUnitPrice1, ContractedUnitPrice1, tmp_MissingPrices, tmp_ReservationPriceLookupKey, tmp_ReservationPriceLookupKey1\n    //\n    | extend SkuPriceDetails = parse_json(SkuPriceDetails)\n    | extend Tags = parse_json(Tags)\n    | extend x_SkuDetails = parse_json(x_SkuDetails)\n    //\n    // Handle FOCUS 1.0-preview\n    | extend old_ChargeSubcategory = ChargeSubcategory\n    | extend old_ChargeCategory = ChargeCategory, ChargeCategory = case(\n        // Handle FOCUS 1.0-preview ChargeSubcategory\n        ChargeSubcategory == 'Credit', 'Credit',\n        ChargeSubcategory == 'Refund', 'Purchase',  // We are assuming purchase refunds since we don't have data to indicate usage refunds\n        ChargeCategory\n    )\n    | extend old_ChargeClass = ChargeClass, ChargeClass = case(ChargeSubcategory == 'Refund', 'Correction', ChargeClass)\n    //\n    // Populate CapacityReservationId when not specified\n    | extend CapacityReservationId = coalesce(CapacityReservationId, tostring(coalesce(x_SkuDetails.VMCapacityReservationId, SkuPriceDetails.VMCapacityReservationId, SkuPriceDetails.x_VMCapacityReservationId)))\n    | extend old_CapacityReservationStatus = CapacityReservationStatus, CapacityReservationStatus = case(\n        isempty(CapacityReservationId), '',\n        isnotempty(CapacityReservationStatus), CapacityReservationStatus,\n        tolower(x_ResourceType) == 'microsoft.compute/capacityreservationgroups/capacityreservations', 'Unused',\n        'Used'\n    )\n    //\n    // BUG: ChargeFrequency shows \"Usage-Based\" for monthly recurring savings plan purchases\n    | extend old_ChargeFrequency = ChargeFrequency, ChargeFrequency = iff(ChargeCategory == 'Purchase' and isnotempty(CommitmentDiscountId) and ChargeFrequency == 'Usage-Based' and ProviderName == 'Microsoft' and x_SourceVersion startswith '1.0', 'Recurring', ChargeFrequency)\n    //\n    // Commitment discounts\n    | extend x_CommitmentDiscountNormalizedRatio = case(\n        // Calculate from CommitmentDiscountQuantity, if specified\n        isnotempty(CommitmentDiscountQuantity) and CommitmentDiscountQuantity != 0, CommitmentDiscountQuantity / PricingQuantity / coalesce(x_PricingBlockSize, real(1)),\n        // Not applicable\n        isempty(CommitmentDiscountStatus), real(null),\n        // Parse from SKU details if not specified explicitly\n        toreal(coalesce(x_SkuDetails.RINormalizationRatio, SkuPriceDetails.RINormalizationRatio, SkuPriceDetails.x_RINormalizationRatio, dynamic(1)))\n    )\n    | extend old_CommitmentDiscountQuantity = CommitmentDiscountQuantity, CommitmentDiscountQuantity = case(\n        // FOCUS 1.2\n        isnotempty(CommitmentDiscountQuantity), CommitmentDiscountQuantity,\n        // FOCUS 1.0-preview, 1.0\n        isempty(CommitmentDiscountStatus), real(null),\n        CommitmentDiscountCategory == 'Spend', EffectiveCost / coalesce(x_BillingExchangeRate, real(1)),\n        CommitmentDiscountCategory == 'Usage' and isnotempty(x_CommitmentDiscountNormalizedRatio), PricingQuantity / coalesce(x_PricingBlockSize, real(1)) * x_CommitmentDiscountNormalizedRatio,\n        real(null)\n    )\n    | extend old_CommitmentDiscountUnit = CommitmentDiscountUnit, CommitmentDiscountUnit = case(\n        // FOCUS 1.2\n        isnotempty(CommitmentDiscountUnit), CommitmentDiscountUnit,\n        // FOCUS 1.0\n        isempty(CommitmentDiscountQuantity), '',\n        CommitmentDiscountCategory == 'Spend', PricingCurrency,\n        CommitmentDiscountCategory == 'Usage' and x_CommitmentDiscountNormalizedRatio == real(1), ConsumedUnit,\n        CommitmentDiscountCategory == 'Usage' and x_CommitmentDiscountNormalizedRatio > real(1), strcat('Normalized ', ConsumedUnit),\n        ''\n    )\n    | extend old_CommitmentDiscountStatus = CommitmentDiscountStatus, CommitmentDiscountStatus = case(\n        // FOCUS 1.0+\n        isnotempty(CommitmentDiscountStatus), CommitmentDiscountStatus,\n        // FOCUS 1.0-preview\n        ChargeSubcategory == 'Used Commitment', 'Used',\n        ChargeSubcategory == 'Unused Commitment', 'Unused',\n        ''\n    )\n    | extend x_CommitmentDiscountUtilizationPotential = case(\n        ChargeCategory == 'Purchase', real(0),\n        ProviderName == 'Microsoft' and isnotempty(CommitmentDiscountCategory), EffectiveCost,\n        CommitmentDiscountCategory == 'Usage', ConsumedQuantity,\n        CommitmentDiscountCategory == 'Spend', EffectiveCost,\n        real(0)\n    )\n    | extend x_CommitmentDiscountUtilizationAmount = iff(CommitmentDiscountStatus == 'Used', x_CommitmentDiscountUtilizationPotential, real(0))\n    //\n    // Pricing\n    | extend old_x_AmortizationClass = x_AmortizationClass, x_AmortizationClass = case(\n        // FOCUS 1.2\n        isnotempty(x_AmortizationClass), x_AmortizationClass,\n        // FOCUS 1.0-preview+\n        ChargeCategory == 'Purchase' and (tolower(ResourceId) contains '/microsoft.capacity/reservationorders/' or tolower(ResourceId) contains '/microsoft.billingbenefits/savingsplanorders/'), 'Principal',\n        ChargeCategory == 'Usage' and isnotempty(CommitmentDiscountId) and isnotempty(CommitmentDiscountStatus), 'Amortized Charge',\n        ''\n    )\n    | extend old_PricingCategory = PricingCategory, PricingCategory = case(\n        // FOCUS 1.0+\n        isnotempty(PricingCategory), PricingCategory,\n        // FOCUS 1.0-preview\n        PricingCategory == 'On-Demand', 'Standard',\n        PricingCategory == 'Commitment-Based', 'Committed',\n        ''\n    )\n    //\n    // Commitment discount utilization\n    | extend x_CommitmentDiscountUtilizationPotential = case(\n        ChargeCategory == 'Purchase', real(0),\n        ProviderName == 'Microsoft' and isnotempty(CommitmentDiscountCategory), EffectiveCost,\n        CommitmentDiscountCategory == 'Usage', ConsumedQuantity,\n        CommitmentDiscountCategory == 'Spend', EffectiveCost,\n        real(0)\n    )\n    | extend x_CommitmentDiscountUtilizationAmount = iff(CommitmentDiscountStatus == 'Used', x_CommitmentDiscountUtilizationPotential, real(0))\n    //\n    // BUG: Fix ContractedCost that has bad values\n    | extend ContractedCost = iff(ProviderName == 'Microsoft' and isnotempty(PricingQuantity) and isnotempty(x_PricingBlockSize) and ContractedCost != ContractedUnitPrice * PricingQuantity, ContractedUnitPrice * PricingQuantity, ContractedCost)\n    //\n    // Handle FOCUS 1.0-preview UsageQuantity/Unit\n    | extend ConsumedQuantity = iff(ChargeCategory == 'Usage', coalesce(ConsumedQuantity, UsageQuantity, UsageAmount), real(null))\n    | extend old_ConsumedUnit = ConsumedUnit, ConsumedUnit = iff(ChargeCategory == 'Usage' and isnotempty(ConsumedQuantity), coalesce(ConsumedUnit, UsageUnit, 'Units'), '')\n    //\n    // Convert IDs to lowercase for consistency\n    | extend BillingAccountId = tolower(BillingAccountId)\n    | extend CommitmentDiscountId = tolower(CommitmentDiscountId)\n    //\n    // BUG: Remove EffectiveCost for commitment discount purchases\n    | extend old_EffectiveCost = EffectiveCost, EffectiveCost = iff(ChargeCategory == 'Purchase' and isnotempty(CommitmentDiscountId), real(0), EffectiveCost)\n    | extend old_x_EffectiveCostInUsd = x_EffectiveCostInUsd, x_EffectiveCostInUsd = iff(ChargeCategory == 'Purchase' and isnotempty(CommitmentDiscountId), real(0), x_EffectiveCostInUsd)\n    //\n    // Clean up resource columns\n    | extend old_ResourceId = ResourceId, ResourceId = case(\n        isnotempty(ResourceId), ResourceId,\n        ChargeCategory == 'Purchase' and isnotempty(CommitmentDiscountId), CommitmentDiscountId,\n        ResourceId\n    )\n    | extend old_ResourceName = ResourceName, ResourceName = tolower(case(\n        isnotempty(ResourceName), ResourceName,\n        ChargeCategory == 'Purchase' and isnotempty(CommitmentDiscountName), CommitmentDiscountName,\n        isnotempty(ResourceId), parse_resourceid(ResourceId).ResourceName,\n        ResourceName\n    ))\n    | extend old_x_ResourceType = x_ResourceType, x_ResourceType = case(\n        isnotempty(x_ResourceType), x_ResourceType,\n        isnotempty(ResourceId), parse_resourceid(ResourceId).x_ResourceType,\n        x_ResourceType\n    )\n    | extend old_ResourceType = ResourceType, ResourceType = case(\n        // Use existing resource type display name unless it's an internal resource type ID\n        isnotempty(ResourceType) and tolower(ResourceType) != tolower(x_ResourceType) and ResourceType !contains '/', ResourceType,\n        // Use CommitmentDiscountType for commitment discount purchases\n        ChargeCategory == 'Purchase' and isnotempty(CommitmentDiscountType), CommitmentDiscountType,\n        // Look up display name from internal type\n        isnotempty(x_ResourceType), coalesce(tostring(resource_type(x_ResourceType).SingularDisplayName), ResourceType, x_ResourceType),\n        ResourceType\n    )\n    //\n    // Handle missing values\n    | extend old_PublisherName = PublisherName, PublisherName = case(PublisherName == 'Microsoft Corporation', 'Microsoft', isnotempty(PublisherName), PublisherName, x_PublisherCategory == 'Cloud Provider', ProviderName, '')\n    //\n    // Handle FOCUS 1.0-preview Region column\n    | extend old_Region = Region\n    | extend old_RegionId = RegionId, RegionId = coalesce(RegionId, iff(ProviderName == 'Microsoft', replace_string(tolower(Region), ' ', ''), Region))\n    | extend RegionName = coalesce(RegionName, Region)\n    //\n    // SKU properties\n    | extend x_SkuCoreCount = toint(coalesce(SkuPriceDetails.CoreCount, SkuPriceDetails.x_VCPUs, x_SkuDetails.VCPUs, SkuPriceDetails.x_VCores, x_SkuDetails.VCores, SkuPriceDetails.x_vCores, x_SkuDetails.vCores))\n    | extend x_SkuInstanceType = tostring(coalesce(SkuPriceDetails.InstanceType, SkuPriceDetails.x_ServiceType, x_SkuDetails.ServiceType, SkuPriceDetails.x_ServerSku, x_SkuDetails.ServerSku))\n    | extend x_SkuOperatingSystem = case(\n        isnotempty(SkuPriceDetails.OperatingSystem), SkuPriceDetails.OperatingSystem,\n        coalesce(SkuPriceDetails.x_ImageType, x_SkuDetails.ImageType) == 'Canonical', 'Linux',\n        coalesce(SkuPriceDetails.x_ImageType, x_SkuDetails.ImageType) == 'Windows Server BYOL', 'Windows Server',\n        x_SkuMeterSubcategory endswith ' Series Windows', 'Windows Server',\n        coalesce(SkuPriceDetails.x_ImageType, x_SkuDetails.ImageType)\n    )\n    | extend x_ConsumedCoreHours = iff(ConsumedUnit == 'Hours' and isnotempty(x_SkuCoreCount), x_SkuCoreCount * ConsumedQuantity, real(null))\n    | extend SkuPriceDetails = case(\n        // FOCUS 1.2\n        isnotempty(SkuPriceDetails), SkuPriceDetails,\n        // FOCUS 1.0-preview, 1.0\n        parse_json(replace_regex(replace_regex(replace_regex(replace_regex(replace_regex(replace_regex(tostring(x_SkuDetails)\n            // Prefix all keys with x_ first to avoid double-prefixing\n            , @'([\\{,])\"', @'\\1\"x_')\n            // CoreCount for number of CPUs/vCPUs/cores/vCores\n            , @'\"x_(VCPUs|VCores|vCores)\":', @'\"CoreCount\":')\n            // TODO: DiskMaxIops for disk I/O operations per second (IOPS)\n            // TODO: DiskSpace for disk size in GiB\n            // TODO: DiskType for the kind of disk (e.g., SSD, HDD, NVMe)\n            // TODO: GpuCount for the number of GPUs\n            // InstanceType for the resource size/SKU (e.g., ArmSkuName)\n            , @'\"x_(ServerSku|ServiceType)\":', @'\"InstanceType\":')\n            // TODO: InstanceSeries for the size family/series\n            // TODO: MemorySize for the RAM in GiB\n            // TODO: NetworkMaxIops for network I/O operations per second (IOPS)\n            // TODO: NetworkMaxThroughput for network max throughput for data transfer in Mbps\n            // OperatingSystem for the OS name\n            , @'(\"x_ImageType\":\"Canonical\")', @'\\1,\"OperatingSystem\":\"Linux\"')\n            , @'(\"x_ImageType\":\"Windows Server( BYOL)?\")', @'\\1,\"OperatingSystem\":\"Windows Server\"')\n            , @'(\"x_ImageType\":(\"[^\"]+\"))', @'\\1,\"OperatingSystem\":\\2')\n            // TODO: Redundancy for the level of redundancy (e.g., Local, Zonal, Global)\n            // TODO: StorageClass for the tier of storage (e.g., Hot, Archive, Nearline)\n        )\n    )\n    | extend SkuPriceDetails = iff(isempty(SkuPriceDetails.OperatingSystem) and isnotempty(x_SkuOperatingSystem),\n        parse_json(replace_string(tostring(SkuPriceDetails), '}', strcat(@',\"OperatingSystem\":\"', x_SkuOperatingSystem, '\"}'))),\n        SkuPriceDetails)\n    //\n    // Azure Hybrid Benefit\n    | extend tmp_SqlAhb = tolower(coalesce(x_SkuDetails.AHB, SkuPriceDetails.x_AHB))\n    | extend x_SkuLicenseType = case(\n        ChargeCategory != 'Usage', '',\n        x_SkuMeterCategory in ('Virtual Machines', 'Virtual Machine Licenses') and (x_SkuMeterSubcategory contains 'Windows' or coalesce(SkuPriceDetails.x_ImageType, x_SkuDetails.ImageType) == 'Windows Server BYOL'), 'Windows Server',\n        isnotempty(tmp_SqlAhb) or x_SkuMeterSubcategory == 'SQL Server Azure Hybrid Benefit', 'SQL Server',\n        ''\n    )\n    | extend x_SkuLicenseStatus = case(\n        isempty(x_SkuLicenseType), '',\n        coalesce(SkuPriceDetails.x_ImageType, x_SkuDetails.ImageType) == 'Windows Server BYOL' or tmp_SqlAhb == 'true' or x_SkuMeterSubcategory contains 'Azure Hybrid Benefit', 'Enabled',\n        (x_SkuMeterSubcategory contains 'Windows') or tmp_SqlAhb == 'false', 'Not Enabled',\n        ''\n    )\n    | extend x_SkuLicenseQuantity = case(\n        isempty(x_SkuCoreCount) or isempty(x_SkuLicenseType), int(null),\n        x_SkuCoreCount <= 8, int(8),\n        x_SkuCoreCount > 8, x_SkuCoreCount,\n        int(null)\n    )\n    | extend x_SkuLicenseUnit = iff(isnotempty(x_SkuLicenseQuantity), 'Cores', '')\n    //\n    // Savings\n    | extend x_CommitmentDiscountSavings = iff(isempty(ContractedCost)      or ContractedCost      == 0 or ContractedCost      - EffectiveCost         < 0.0001, real(0), ContractedCost - EffectiveCost)\n    | extend x_NegotiatedDiscountSavings = iff(isempty(ListCost)            or ListCost            == 0 or ListCost            - ContractedCost        < 0.0001, real(0), ListCost - ContractedCost)\n    | extend x_TotalSavings              = iff(isempty(ListCost)            or ListCost            == 0 or ListCost            - EffectiveCost         < 0.0001, real(0), ListCost - EffectiveCost)\n    | extend x_CommitmentDiscountPercent = iff(isempty(ContractedUnitPrice) or ContractedUnitPrice == 0 or ContractedUnitPrice - x_EffectiveUnitPrice  < 0.0001, real(0), (ContractedUnitPrice - x_EffectiveUnitPrice) / ContractedUnitPrice)\n    | extend x_NegotiatedDiscountPercent = iff(isempty(ListUnitPrice)       or ListUnitPrice       == 0 or ListUnitPrice       - ContractedUnitPrice   < 0.0001, real(0), (ListUnitPrice - ContractedUnitPrice) / ListUnitPrice)\n    | extend x_TotalDiscountPercent      = iff(isempty(ListUnitPrice)       or ListUnitPrice       == 0 or ListUnitPrice       - x_EffectiveUnitPrice  < 0.0001, real(0), (ListUnitPrice - x_EffectiveUnitPrice) / ListUnitPrice)\n    //\n    // Minor fixes\n    | extend old_BillingPeriodEnd = BillingPeriodEnd, BillingPeriodEnd = startofmonth(BillingPeriodEnd)\n    | extend old_BillingPeriodStart = BillingPeriodStart, BillingPeriodStart = startofmonth(BillingPeriodStart)\n    //\n    // Sort columns and apply final transforms\n    | project\n        AvailabilityZone,\n        BilledCost,\n        BillingAccountId,\n        BillingAccountName,\n        BillingAccountType,\n        BillingCurrency,\n        BillingPeriodEnd,\n        BillingPeriodStart,\n        CapacityReservationId,\n        CapacityReservationStatus,\n        ChargeCategory,\n        ChargeClass,\n        ChargeDescription,\n        ChargeFrequency,\n        ChargePeriodEnd,\n        ChargePeriodStart,\n        CommitmentDiscountCategory,\n        CommitmentDiscountId,\n        CommitmentDiscountName,\n        CommitmentDiscountQuantity,\n        CommitmentDiscountStatus,\n        CommitmentDiscountType,\n        CommitmentDiscountUnit,\n        ConsumedQuantity,\n        ConsumedUnit,\n        ContractedCost = coalesce(ContractedCost, x_OnDemandCost, x_Cost),\n        ContractedUnitPrice = coalesce(ContractedUnitPrice, x_OnDemandUnitPrice),\n        EffectiveCost,\n        InvoiceId = coalesce(InvoiceId, x_InvoiceId),\n        InvoiceIssuerName,\n        ListCost,\n        ListUnitPrice,\n        PricingCategory,\n        PricingCurrency = coalesce(PricingCurrency, x_PricingCurrency),\n        PricingQuantity,\n        PricingUnit,\n        ProviderName,\n        PublisherName,\n        RegionId,\n        RegionName,\n        ResourceId,\n        ResourceName,\n        ResourceType,\n        ServiceCategory,\n        ServiceName,\n        ServiceSubcategory,  // TODO: Populate ServiceSubcategory from ServiceName when missing\n        SkuId,\n        SkuMeter = coalesce(SkuMeter, x_SkuMeterName),\n        SkuPriceDetails,\n        SkuPriceId,\n        SubAccountId,\n        SubAccountName = iff(isempty(SubAccountId), '', SubAccountName),\n        SubAccountType,\n        Tags,\n        x_AccountId      = iff(x_AccountId == '-2', '', x_AccountId),\n        x_AccountName    = iff(x_AccountId == '-2', '', x_AccountName),\n        x_AccountOwnerId = iff(x_AccountId == '-2', '', x_AccountOwnerId),\n        x_AmortizationClass,\n        x_BilledCostInUsd,\n        x_BilledUnitPrice,\n        x_BillingAccountAgreement = case(\n            ProviderName == 'Microsoft' and x_BillingAccountId == x_BillingProfileId, 'EA',\n            ProviderName == 'Microsoft' and x_BillingAccountId != x_BillingProfileId, 'MCA',\n            ProviderName\n        ),\n        x_BillingAccountId,\n        x_BillingAccountName,\n        x_BillingExchangeRate,\n        x_BillingExchangeRateDate,\n        x_BillingItemCode,\n        x_BillingItemName,\n        x_BillingProfileId,\n        x_BillingProfileName,\n        x_ChargeId,\n        x_CommitmentDiscountNormalizedRatio,\n        x_CommitmentDiscountPercent,\n        x_CommitmentDiscountSavings,\n        x_CommitmentDiscountSpendEligibility = '',  // TODO: Add x_CommitmentDiscountSpendEligibility for Costs\n        x_CommitmentDiscountUsageEligibility = '',  // TODO: Add x_CommitmentDiscountUsageEligibility for Costs\n        x_CommitmentDiscountUtilizationAmount,\n        x_CommitmentDiscountUtilizationPotential,\n        x_CommodityCode,\n        x_CommodityName,\n        x_ComponentName,\n        x_ComponentType,\n        x_ConsumedCoreHours,\n        x_ContractedCostInUsd = coalesce(x_ContractedCostInUsd, x_OnDemandCostInUsd),\n        x_CostAllocationRuleName,\n        x_CostCategories = parse_json(x_CostCategories),\n        x_CostCenter,\n        x_CostType,\n        x_Credits = parse_json(x_Credits),\n        x_CurrencyConversionRate,\n        x_CustomerId,\n        x_CustomerName,\n        x_Discount = parse_json(x_Discount),\n        x_EffectiveCostInUsd,\n        x_EffectiveUnitPrice,\n        x_ExportTime,\n        x_IngestionTime,\n        x_InstanceID,\n        x_InvoiceIssuerId,\n        x_InvoiceSectionId = case(\n            x_InvoiceSectionId == '-2', '',\n            x_InvoiceSectionId\n        ),\n        x_InvoiceSectionName = case(\n            x_InvoiceSectionName == 'Unassigned', '',\n            x_InvoiceSectionName\n        ),\n        x_ListCostInUsd,\n        x_Location,\n        x_NegotiatedDiscountPercent,\n        x_NegotiatedDiscountSavings,\n        x_Operation,\n        x_OwnerAccountID,\n        x_PartnerCreditApplied,\n        x_PartnerCreditRate,\n        x_PricingBlockSize,\n        x_PricingSubcategory,\n        x_PricingUnitDescription = iff(x_PricingUnitDescription == 'Unassigned', '', x_PricingUnitDescription),\n        x_Project,\n        x_PublisherCategory,\n        x_PublisherId,\n        x_ResellerId,\n        x_ResellerName,\n        x_ResourceGroupName = tolower(x_ResourceGroupName),\n        x_ResourceType,\n        x_ServiceCode,\n        x_ServiceId,\n        x_ServiceModel,  // TODO: Populate from ServiceName when missing\n        x_ServicePeriodEnd,\n        x_ServicePeriodStart,\n        x_SkuCoreCount,\n        x_SkuDescription,\n        x_SkuDetails,\n        x_SkuInstanceType,\n        x_SkuIsCreditEligible,\n        x_SkuLicenseQuantity,\n        x_SkuLicenseStatus,\n        x_SkuLicenseType,\n        x_SkuLicenseUnit,\n        x_SkuMeterCategory,\n        x_SkuMeterId,\n        x_SkuMeterSubcategory,\n        x_SkuOfferId,\n        x_SkuOperatingSystem,\n        x_SkuOrderId,\n        x_SkuOrderName,\n        x_SkuPartNumber,\n        x_SkuPlanName,\n        x_SkuRegion,\n        x_SkuServiceFamily,\n        x_SkuTerm,\n        x_SkuTier,\n        x_SourceChanges,\n        x_SourceName,\n        x_SourceProvider,\n        x_SourceType,\n        x_SourceValues = bag_merge(\n            checkString('BillingPeriodEnd',           old_BillingPeriodEnd,           BillingPeriodEnd),\n            checkString('BillingPeriodStart',         old_BillingPeriodStart,         BillingPeriodStart),\n            checkString('CapacityReservationStatus',  old_CapacityReservationStatus,  CapacityReservationStatus),\n            checkString('ChargeCategory',             old_ChargeCategory,             ChargeCategory),\n            checkString('ChargeClass',                old_ChargeClass,                ChargeClass),\n            checkString('ChargeSubcategory',          old_ChargeSubcategory,          ''),  // Not included in final schema; use empty string\n            checkString('ChargeFrequency',            old_ChargeFrequency,            ChargeFrequency),\n            checkReal('CommitmentDiscountQuantity',   old_CommitmentDiscountQuantity, CommitmentDiscountQuantity),\n            checkString('CommitmentDiscountUnit',     old_CommitmentDiscountUnit,     CommitmentDiscountUnit),\n            checkString('CommitmentDiscountStatus',   old_CommitmentDiscountStatus,   CommitmentDiscountStatus),\n            checkReal('ConsumedQuantity',             old_ConsumedQuantity,           ConsumedQuantity),\n            checkString('ConsumedUnit',               old_ConsumedUnit,               ConsumedUnit),\n            checkReal('ContractedCost',               old_ContractedCost,             ContractedCost),\n            checkReal('ContractedUnitPrice',          old_ContractedUnitPrice,        ContractedUnitPrice),\n            checkReal('EffectiveCost',                old_EffectiveCost,              EffectiveCost),\n            checkReal('ListCost',                     old_ListCost,                   ListCost),\n            checkReal('ListUnitPrice',                old_ListUnitPrice,              ListUnitPrice),\n            checkString('PricingCategory',            old_PricingCategory,            PricingCategory),\n            checkReal('PricingQuantity',              old_PricingQuantity,            PricingQuantity),\n            checkString('ProviderName',               old_ProviderName,               ProviderName),\n            checkString('PublisherName',              old_PublisherName,              PublisherName),\n            checkString('Region',                     old_Region,                     ''),  // Not included in final schema; use empty string\n            checkString('RegionId',                   old_RegionId,                   RegionId),\n            checkString('ResourceId',                 old_ResourceId,                 ResourceId),\n            checkString('ResourceName',               old_ResourceName,               ResourceName),\n            checkString('ResourceType',               old_ResourceType,               ResourceType),\n            checkString('x_AmortizationClass',        old_x_AmortizationClass,        x_AmortizationClass),\n            checkReal('x_EffectiveCostInUsd',         old_x_EffectiveCostInUsd,       x_EffectiveCostInUsd),\n            checkReal('x_EffectiveUnitPrice',         old_x_EffectiveUnitPrice,       x_EffectiveUnitPrice),\n            checkString('x_ResourceType',             old_x_ResourceType,             x_ResourceType)\n        ),\n        x_SourceVersion,\n        x_SubproductName,\n        x_TotalDiscountPercent,\n        x_TotalSavings,\n        x_UsageType\n}\n\n// Costs_final_v1_2 table\n.create-merge table Costs_final_v1_2 (\n    AvailabilityZone:           string,\n    BilledCost:                 real,\n    BillingAccountId:           string,\n    BillingAccountName:         string,\n    BillingAccountType:         string,\n    BillingCurrency:            string,\n    BillingPeriodEnd:           datetime,\n    BillingPeriodStart:         datetime,\n    CapacityReservationId:      string,\n    CapacityReservationStatus:  string,\n    ChargeCategory:             string,\n    ChargeClass:                string,\n    ChargeDescription:          string,\n    ChargeFrequency:            string,\n    ChargePeriodEnd:            datetime,\n    ChargePeriodStart:          datetime,\n    CommitmentDiscountCategory: string,\n    CommitmentDiscountId:       string,\n    CommitmentDiscountName:     string,\n    CommitmentDiscountQuantity: real,\n    CommitmentDiscountStatus:   string,\n    CommitmentDiscountType:     string,\n    CommitmentDiscountUnit:     string,\n    ConsumedQuantity:           real,\n    ConsumedUnit:               string,\n    ContractedCost:             real,\n    ContractedUnitPrice:        real,\n    EffectiveCost:              real,\n    InvoiceId:                  string,\n    InvoiceIssuerName:          string,\n    ListCost:                   real,\n    ListUnitPrice:              real,\n    PricingCategory:            string,\n    PricingCurrency:            string,\n    PricingQuantity:            real,\n    PricingUnit:                string,\n    ProviderName:               string,\n    PublisherName:              string,\n    RegionId:                   string,\n    RegionName:                 string,\n    ResourceId:                 string,\n    ResourceName:               string,\n    ResourceType:               string,\n    ServiceCategory:            string,\n    ServiceName:                string,\n    ServiceSubcategory:         string,\n    SkuId:                      string,\n    SkuMeter:                   string,\n    SkuPriceDetails:            dynamic,\n    SkuPriceId:                 string,\n    SubAccountId:               string,\n    SubAccountName:             string,\n    SubAccountType:             string,\n    Tags:                       dynamic,\n    x_AccountId:                string,    // Azure 1.0-preview(v1)+\n    x_AccountName:              string,    // Azure 1.0-preview(v1)+\n    x_AccountOwnerId:           string,    // Azure 1.0-preview(v1)+\n    x_AmortizationClass:        string,    // Azure 1.2-preview+\n    x_BilledCostInUsd:          real,      // Azure 1.0-preview(v1)+\n    x_BilledUnitPrice:          real,      // Azure 1.0-preview(v1)+\n    x_BillingAccountAgreement:  string,    // Hubs add-on\n    x_BillingAccountId:         string,    // Azure 1.0-preview(v1)+\n    x_BillingAccountName:       string,    // Azure 1.0-preview(v1)+\n    x_BillingExchangeRate:      real,      // Azure 1.0-preview(v1)+\n    x_BillingExchangeRateDate:  datetime,  // Azure 1.0-preview(v1)+\n    x_BillingItemCode:          string,    // Alibaba 1.0\n    x_BillingItemName:          string,    // Alibaba 1.0\n    x_BillingProfileId:         string,    // Azure 1.0-preview(v1)+\n    x_BillingProfileName:       string,    // Azure 1.0-preview(v1)+\n    x_ChargeId:                 string,    // Azure 1.0-preview(v1) only\n    x_CommitmentDiscountNormalizedRatio:      real,    // Azure 1.2-preview+\n    x_CommitmentDiscountPercent:              real,    // Hubs add-on\n    x_CommitmentDiscountSavings:              real,    // Hubs add-on\n    x_CommitmentDiscountSpendEligibility:     string,  // Hubs add-on\n    x_CommitmentDiscountUsageEligibility:     string,  // Hubs add-on\n    x_CommitmentDiscountUtilizationAmount:    real,    // Hubs add-on\n    x_CommitmentDiscountUtilizationPotential: real,    // Hubs add-on\n    x_CommodityCode:            string,    // Alibaba 1.0\n    x_CommodityName:            string,    // Alibaba 1.0\n    x_ComponentName:            string,    // Tencent 1.0\n    x_ComponentType:            string,    // Tencent 1.0\n    x_ConsumedCoreHours:        real,      // Hubs add-on\n    x_ContractedCostInUsd:      real,      // Azure 1.0+\n    x_CostAllocationRuleName:   string,    // Azure 1.0-preview(v1)+\n    x_CostCategories:           dynamic,   // AWS 1.0 (JSON)\n    x_CostCenter:               string,    // Azure 1.0-preview(v1)+\n    x_CostType:                 string,    // GCP Jan 2024\n    x_Credits:                  dynamic,   // GCP Jan 2024\n    x_CurrencyConversionRate:   real,      // GCP Jun 2024\n    x_CustomerId:               string,    // Azure 1.0-preview(v1)+\n    x_CustomerName:             string,    // Azure 1.0-preview(v1)+\n    x_Discount:                 dynamic,   // AWS 1.0 (JSON)\n    x_EffectiveCostInUsd:       real,      // Azure 1.0-preview(v1)+\n    x_EffectiveUnitPrice:       real,      // Azure 1.0-preview(v1)+\n    x_ExportTime:               datetime,  // GCP Jan 2024 / Tencent 1.0\n    x_IngestionTime:            datetime,  // Hubs add-on\n    x_InstanceID:               string,    // Alibaba 1.0\n    x_InvoiceIssuerId:          string,    // Azure 1.0-preview(v1)+\n    x_InvoiceSectionId:         string,    // Azure 1.0-preview(v1)+\n    x_InvoiceSectionName:       string,    // Azure 1.0-preview(v1)+\n    x_ListCostInUsd:            real,      // Azure 1.0-preview(v1)+\n    x_Location:                 string,    // GCP Jan 2024\n    x_NegotiatedDiscountPercent:real,      // Hubs add-on\n    x_NegotiatedDiscountSavings:real,      // Hubs add-on\n    x_Operation:                string,    // AWS 1.0\n    x_OwnerAccountID:           string,    // Tencent 1.0\n    x_PartnerCreditApplied:     string,    // Azure 1.0-preview(v1)+\n    x_PartnerCreditRate:        string,    // Azure 1.0-preview(v1)+\n    x_PricingBlockSize:         real,      // Azure 1.0-preview(v1)+\n    x_PricingSubcategory:       string,    // Azure 1.0-preview(v1)+\n    x_PricingUnitDescription:   string,    // Azure 1.0-preview(v1)+\n    x_Project:                  string,    // GCP Jan 2024\n    x_PublisherCategory:        string,    // Azure 1.0-preview(v1)+\n    x_PublisherId:              string,    // Azure 1.0-preview(v1)+\n    x_ResellerId:               string,    // Azure 1.0-preview(v1)+\n    x_ResellerName:             string,    // Azure 1.0-preview(v1)+\n    x_ResourceGroupName:        string,    // Azure 1.0-preview(v1)+\n    x_ResourceType:             string,    // Azure 1.0-preview(v1)+\n    x_ServiceCode:              string,    // AWS 1.0\n    x_ServiceId:                string,    // GCP Jan 2024\n    x_ServiceModel:             string,    // Azure 1.2-preview+\n    x_ServicePeriodEnd:         datetime,  // Azure 1.0-preview(v1)+\n    x_ServicePeriodStart:       datetime,  // Azure 1.0-preview(v1)+\n    x_SkuCoreCount:             int,       // Hubs add-on\n    x_SkuDescription:           string,    // Azure 1.0-preview(v1)+\n    x_SkuDetails:               dynamic,   // Azure 1.0-preview(v1)+\n    x_SkuInstanceType:          string,    // Hubs add-on\n    x_SkuIsCreditEligible:      bool,      // Azure 1.0-preview(v1)+\n    x_SkuLicenseQuantity:       int,       // Hubs add-on\n    x_SkuLicenseStatus:         string,    // Hubs add-on\n    x_SkuLicenseType:           string,    // Hubs add-on\n    x_SkuLicenseUnit:           string,    // Hubs add-on\n    x_SkuMeterCategory:         string,    // Azure 1.0-preview(v1)+\n    x_SkuMeterId:               string,    // Azure 1.0-preview(v1)+\n    x_SkuMeterSubcategory:      string,    // Azure 1.0-preview(v1)+\n    x_SkuOfferId:               string,    // Azure 1.0-preview(v1)+\n    x_SkuOperatingSystem:       string,    // Hubs add-on\n    x_SkuOrderId:               string,    // Azure 1.0-preview(v1)+\n    x_SkuOrderName:             string,    // Azure 1.0-preview(v1)+\n    x_SkuPartNumber:            string,    // Azure 1.0-preview(v1)+\n    x_SkuPlanName:              string,    // Azure 1.2-preview+\n    x_SkuRegion:                string,    // Azure 1.0-preview(v1)+\n    x_SkuServiceFamily:         string,    // Azure 1.0-preview(v1)+\n    x_SkuTerm:                  int,       // Azure 1.0-preview(v1)+\n    x_SkuTier:                  string,    // Azure 1.0-preview(v1)+\n    x_SourceChanges:            string,    // Hubs add-on\n    x_SourceName:               string,    // Hubs add-on\n    x_SourceProvider:           string,    // Hubs add-on\n    x_SourceType:               string,    // Hubs add-on\n    x_SourceValues:             dynamic,   // Hubs add-on\n    x_SourceVersion:            string,    // Hubs add-on\n    x_SubproductName:           string,    // Tencent 1.0\n    x_TotalDiscountPercent:     real,      // Hubs add-on\n    x_TotalSavings:             real,      // Hubs add-on\n    x_UsageType:                string     // AWS 1.0\n)\n\n// Update policy for Costs_raw -> Costs_final_v1_2 table\n.alter table Costs_final_v1_2 policy update\n```\n[{\n    \"IsEnabled\": true,\n    \"Source\": \"Costs_raw\",\n    \"Query\": \"Costs_transform_v1_2()\",\n    \"IsTransactional\": true,\n    \"PropagateIngestionProperties\": true\n}]\n```\n\n\n//===| Actual costs |===================================================================================================\n// Supported versions:\n// - C360-2025-04\n//======================================================================================================================\n\n// ActualCosts_transform_v1_2 function\n.create-or-alter function\nwith (docstring='ActualCost exports transformed to FOCUS 1.2.', folder='Costs')\nActualCosts_transform_v1_2()\n{\n    // NOTE: All open issues and questions are tracked @ https://github.com/microsoft/finops-toolkit/issues/1111\n    ActualCosts_raw\n    | where ChargeType in ('Purchase', 'Refund') and isnotempty(ReservationId)\n    //\n    //\n    // !!! The rest of the query is reused for both the ActualCosts and AmortizedCosts queries -- Copy all changes in both transform functions !!!\n    //\n    //\n    | extend x_AmortizationClass = case(\n        ChargeType in ('Purchase', 'Refund') and (tolower(ResourceId) contains '/microsoft.capacity/reservationorders/' or tolower(ResourceId) contains '/microsoft.billingbenefits/savingsplanorders/'), 'Principal',\n        ChargeType == 'Usage' and isnotempty(ReservationId) and ChargeType != 'UnusedSavingsPlan', 'Amortized Charge',\n        ''\n    )\n    | extend tmp_ResourceInfo = parse_resourceid(ResourceId)\n    // TODO: PricingCategory needs to include savings plan usage and spot usage\n    | extend PricingCategory = case(\n        x_AmortizationClass == 'Amortized Charge', 'Committed',\n        ChargeType in ('Usage', 'Purchase'), 'Standard',\n        ''\n    )\n    | extend x_ResourceType = tostring(tmp_ResourceInfo.x_ResourceType)\n    | project-rename\n        PricingQuantity = Quantity,\n        x_PricingUnitDescription = UnitOfMeasure\n    | join kind=leftouter (PricingUnits) on x_PricingUnitDescription\n    | join kind=leftouter (Regions) on ResourceLocation\n    | join kind=leftouter (ResourceTypes | project x_ResourceType, ResourceType = SingularDisplayName) on x_ResourceType\n    // TODO: Add the following in 1.2: PublisherName, x_PublisherCategory, x_Environment\n    | join kind=leftouter (Services | where isnotempty(x_ResourceType) | project x_ResourceType, ServiceName, ServiceCategory, ServiceSubcategory, x_ServiceModel) on x_ResourceType\n    | join kind=leftouter (Services | where isnotempty(x_ConsumedService) | summarize take_any(ServiceName), take_any(ServiceCategory), take_any(ServiceSubcategory), take_any(x_ServiceModel) by ConsumedService = x_ConsumedService) on ConsumedService\n    | extend CommitmentDiscountCategory = iff(isnotempty(ReservationId), 'Usage', '')  // TODO: CommitmentDiscountCategory needs to handle savings plans\n    | project\n        AvailabilityZone = AvailabilityZone,\n        BilledCost = iff(x_AmortizationClass == 'Amortized Charge', real(0), Cost),\n        BillingAccountId = strcat('/providers/microsoft.billing/billingaccounts/', BillingAccountId, iff(BillingAccountId == BillingProfileId or isempty(BillingProfileId), '', strcat('/billingprofiles/', BillingProfileId))),\n        BillingAccountName = coalesce(BillingProfileName, BillingAccountName),\n        BillingAccountType = iff(BillingAccountId == BillingProfileId or isempty(BillingProfileId), 'Billing Profile', 'Billing Account'),\n        BillingCurrency,\n        BillingPeriodEnd = startofmonth(BillingPeriodEndDate, 1),\n        BillingPeriodStart = startofmonth(BillingPeriodStartDate),\n        CapacityReservationId = '',\n        CapacityReservationStatus = '',\n        ChargeCategory = case(\n            ChargeType in ('Usage', 'Purchase', 'Credit', 'Tax'), ChargeType,\n            ChargeType in ('UnusedReservation', 'UnusedSavingsPlan'), 'Usage',\n            ChargeType == 'Refund', 'Purchase',\n            'Adjustment'\n        ),\n        ChargeClass = iff(ChargeType == 'Refund', 'Correction', ''),\n        ChargeDescription = Product,\n        ChargeFrequency = case(\n            Frequency == 'UsageBased', 'Usage-Based',\n            Frequency == 'OneTime', 'One-Time',\n            Frequency  // \"Recurring\" and any fallback\n        ),\n        ChargePeriodEnd = Date + 1d,\n        ChargePeriodStart = Date,\n        ChargeSubcategory = '',\n        // TODO: CommitmentDiscount* columns need to handle savings plans\n        CommitmentDiscountCategory,\n        CommitmentDiscountId = iff(isnotempty(ReservationId), strcat('/providers/microsoft.capacity/reservationorders/', ProductOrderId, '/reservations/', ReservationId), ''),\n        CommitmentDiscountName = ReservationName,\n        CommitmentDiscountQuantity = real(null),\n        CommitmentDiscountStatus = case(\n            isempty(ReservationId), '',\n            isnotempty(ReservationId) and ChargeType == 'Usage', 'Used',\n            ChargeType startswith 'Unused', 'Unused',\n            'Unused'\n        ),\n        CommitmentDiscountType = iff(isnotempty(ReservationId), 'Reservation', ''),\n        CommitmentDiscountUnit = '',\n        ConsumedQuantity = PricingQuantity * x_PricingBlockSize,\n        ConsumedUnit = PricingUnit,\n        ContractedCost = UnitPrice * PricingQuantity,\n        ContractedUnitPrice = UnitPrice,\n        EffectiveCost = iff(x_AmortizationClass == 'Principal', real(0), Cost),\n        InvoiceId = '',\n        InvoiceIssuerName = 'Microsoft',\n        ListCost = real(null),\n        ListUnitPrice = real(null),\n        PricingCategory,\n        PricingCurrency = iff(BillingAccountId == BillingProfileId, BillingCurrency, ''),\n        PricingQuantity,\n        PricingUnit,\n        ProviderName = 'Microsoft',\n        PublisherName = iff(PublisherType == 'Marketplace', PublisherName, 'Microsoft'),\n        Region = '',\n        RegionId,\n        RegionName,\n        ResourceId = tostring(tmp_ResourceInfo.ResourceId),\n        ResourceName = tostring(tmp_ResourceInfo.ResourceName),\n        ResourceType,\n        ServiceCategory,\n        ServiceName,\n        ServiceSubcategory,\n        SkuId = '',\n        SkuMeter = MeterName,\n        SkuPriceDetails = '',\n        SkuPriceId = '',\n        SubAccountId = strcat('/subscriptions/', SubscriptionId),\n        SubAccountName = iff(isempty(SubscriptionId), '', SubscriptionName),\n        SubAccountType = iff(isempty(SubscriptionId), '', 'Subscription'),\n        Tags = iff(Tags startswith '{', Tags, strcat('{', Tags, '}')),\n        UsageAmount = real(null),\n        UsageQuantity = real(null),\n        UsageUnit = '',\n        x_AccountId = '',\n        x_AccountName = AccountName,\n        x_AccountOwnerId = AccountOwnerId,\n        x_AmortizationClass = '',\n        x_BilledCostInUsd = real(null),\n        x_BilledUnitPrice = iff(ChargeType == 'Usage' and isnotempty(ReservationId) and ChargeType != 'UnusedSavingsPlan', real(0), UnitPrice),\n        x_BillingAccountId = BillingAccountId,\n        x_BillingAccountName = BillingAccountName,\n        x_BillingExchangeRate = real(null),\n        x_BillingExchangeRateDate = datetime(null),\n        x_BillingItemCode = '',\n        x_BillingItemName = '',\n        x_BillingProfileId = BillingProfileId,\n        x_BillingProfileName = BillingProfileName,\n        x_ChargeId = '',\n        x_CommodityCode = '',\n        x_CommodityName = '',\n        x_ComponentType = '',\n        x_ComponentName = '',\n        x_ContractedCostInUsd = real(null),\n        x_Cost = real(null),\n        x_CostAllocationRuleName = '',\n        x_CostCategories = '',\n        x_CostCenter = CostCenter,\n        x_CostType = '',\n        x_Credits = '',\n        x_CurrencyConversionRate = real(null),\n        x_CustomerId = '',\n        x_CustomerName = '',\n        x_Discount = '',\n        x_EffectiveCostInUsd = real(null),\n        x_EffectiveUnitPrice = iff(ChargeType == 'Usage' and isnotempty(ReservationId) and ChargeType != 'UnusedSavingsPlan', real(0), EffectivePrice),\n        x_ExportTime = datetime(null),\n        x_InstanceID = '',\n        x_InvoiceId = '',\n        x_InvoiceIssuerId = '',\n        x_InvoiceSectionId = InvoiceSectionId,\n        x_InvoiceSectionName = InvoiceSection,\n        x_ListCostInUsd = real(null),\n        x_Location = '',\n        x_OnDemandCost = real(null),\n        x_OnDemandCostInUsd = real(null),\n        x_OnDemandUnitPrice = real(null),\n        x_Operation = '',\n        x_OwnerAccountID = '',\n        x_PartnerCreditApplied = '',\n        x_PartnerCreditRate = '',\n        x_PricingBlockSize,\n        x_PricingCurrency = '',\n        x_PricingSubcategory = case(\n            // TODO: Add x_SkuTier when supported by C360 -- PricingCategory == 'Standard' and isnotempty(x_SkuTier), 'Tiered',\n            PricingCategory == 'Standard', 'Standard',\n            PricingCategory == 'Committed', strcat('Committed ', CommitmentDiscountCategory),\n            PricingCategory == 'Dynamic', 'Spot',\n            ''\n        ),\n        x_PricingUnitDescription,\n        x_Project = '',\n        x_PublisherCategory = iff(PublisherType == 'Marketplace', 'Vendor', 'Cloud Provider'),\n        x_PublisherId = '',\n        x_ResellerId = '',\n        x_ResellerName = '',\n        x_ResourceGroupName = ResourceGroup,\n        x_ResourceType,\n        x_ServiceCode = '',\n        x_ServiceId = '',\n        x_ServiceModel,\n        x_ServicePeriodEnd = datetime(null),\n        x_ServicePeriodStart = datetime(null),\n        x_SkuDescription = Product,\n        x_SkuDetails = iff(AdditionalInfo startswith '{', AdditionalInfo, strcat('{', AdditionalInfo, '}')),\n        x_SkuIsCreditEligible = IsAzureCreditEligible,\n        x_SkuMeterCategory = MeterCategory,\n        x_SkuMeterId = MeterId,\n        x_SkuMeterName = MeterName,\n        x_SkuMeterSubcategory = MeterSubCategory,\n        x_SkuOfferId = OfferId,\n        x_SkuOrderId = ProductOrderId,\n        x_SkuOrderName = ProductOrderName,\n        x_SkuPartNumber = PartNumber,\n        x_SkuPlanName = '',\n        x_SkuRegion = MeterRegion,\n        x_SkuServiceFamily = ServiceFamily,\n        x_SkuTerm = toint(Term),\n        x_SkuTier = '',\n        x_SourceName = 'C360',\n        x_SourceProvider = 'Microsoft',\n        x_SourceType = 'ActualCost',\n        x_SourceVersion = 'C360-2025-04',\n        x_SubproductName = '',\n        x_UsageType = ''\n}\n\n// Update policy for ActualCosts_raw -> Costs_raw table\n.alter table Costs_raw policy update\n``` \n[{\n    \"IsEnabled\": true,\n    \"Source\": \"ActualCosts_raw\",\n    \"Query\": \"ActualCosts_transform_v1_2()\",\n    \"IsTransactional\": true,\n    \"PropagateIngestionProperties\": true\n}]\n```\n\n\n//===| Amortized costs |================================================================================================\n// Supported versions:\n// - C360-2025-04\n//======================================================================================================================\n\n// AmortizedCosts_transform_v1_2 function\n.create-or-alter function\nwith (docstring='ActualCost exports transformed to FOCUS 1.2.', folder='Costs')\nAmortizedCosts_transform_v1_2()\n{\n    // NOTE: All open issues and questions are tracked @ https://github.com/microsoft/finops-toolkit/issues/1111\n    AmortizedCosts_raw\n    //\n    //\n    // !!! The rest of the query is reused for both the ActualCosts and AmortizedCosts queries -- Copy all changes in both transform functions !!!\n    //\n    //\n    | extend x_AmortizationClass = case(\n        ChargeType in ('Purchase', 'Refund') and (tolower(ResourceId) contains '/microsoft.capacity/reservationorders/' or tolower(ResourceId) contains '/microsoft.billingbenefits/savingsplanorders/'), 'Principal',\n        ChargeType == 'Usage' and isnotempty(ReservationId) and ChargeType != 'UnusedSavingsPlan', 'Amortized Charge',\n        ''\n    )\n    | extend tmp_ResourceInfo = parse_resourceid(ResourceId)\n    // TODO: PricingCategory needs to include savings plan usage and spot usage\n    | extend PricingCategory = case(\n        x_AmortizationClass == 'Amortized Charge', 'Committed',\n        ChargeType in ('Usage', 'Purchase'), 'Standard',\n        ''\n    )\n    | extend x_ResourceType = tostring(tmp_ResourceInfo.x_ResourceType)\n    | project-rename\n        PricingQuantity = Quantity,\n        x_PricingUnitDescription = UnitOfMeasure\n    | join kind=leftouter (PricingUnits) on x_PricingUnitDescription\n    | join kind=leftouter (Regions) on ResourceLocation\n    | join kind=leftouter (ResourceTypes | project x_ResourceType, ResourceType = SingularDisplayName) on x_ResourceType\n    // TODO: Add the following in 1.2: PublisherName, x_PublisherCategory, x_Environment\n    | join kind=leftouter (Services | where isnotempty(x_ResourceType) | project x_ResourceType, ServiceName, ServiceCategory, ServiceSubcategory, x_ServiceModel) on x_ResourceType\n    | join kind=leftouter (Services | where isnotempty(x_ConsumedService) | summarize take_any(ServiceName), take_any(ServiceCategory), take_any(ServiceSubcategory), take_any(x_ServiceModel) by ConsumedService = x_ConsumedService) on ConsumedService\n    | extend CommitmentDiscountCategory = iff(isnotempty(ReservationId), 'Usage', '')  // TODO: CommitmentDiscountCategory needs to handle savings plans\n    | project\n        AvailabilityZone = AvailabilityZone,\n        BilledCost = iff(x_AmortizationClass == 'Amortized Charge', real(0), Cost),\n        BillingAccountId = strcat('/providers/microsoft.billing/billingaccounts/', BillingAccountId, iff(BillingAccountId == BillingProfileId or isempty(BillingProfileId), '', strcat('/billingprofiles/', BillingProfileId))),\n        BillingAccountName = coalesce(BillingProfileName, BillingAccountName),\n        BillingAccountType = iff(BillingAccountId == BillingProfileId or isempty(BillingProfileId), 'Billing Profile', 'Billing Account'),\n        BillingCurrency,\n        BillingPeriodEnd = startofmonth(BillingPeriodEndDate, 1),\n        BillingPeriodStart = startofmonth(BillingPeriodStartDate),\n        CapacityReservationId = '',\n        CapacityReservationStatus = '',\n        ChargeCategory = case(\n            ChargeType in ('Usage', 'Purchase', 'Credit', 'Tax'), ChargeType,\n            ChargeType in ('UnusedReservation', 'UnusedSavingsPlan'), 'Usage',\n            ChargeType == 'Refund', 'Purchase',\n            'Adjustment'\n        ),\n        ChargeClass = iff(ChargeType == 'Refund', 'Correction', ''),\n        ChargeDescription = Product,\n        ChargeFrequency = case(\n            Frequency == 'UsageBased', 'Usage-Based',\n            Frequency == 'OneTime', 'One-Time',\n            Frequency  // \"Recurring\" and any fallback\n        ),\n        ChargePeriodEnd = Date + 1d,\n        ChargePeriodStart = Date,\n        ChargeSubcategory = '',\n        // TODO: CommitmentDiscount* columns need to handle savings plans\n        CommitmentDiscountCategory,\n        CommitmentDiscountId = iff(isnotempty(ReservationId), strcat('/providers/microsoft.capacity/reservationorders/', ProductOrderId, '/reservations/', ReservationId), ''),\n        CommitmentDiscountName = ReservationName,\n        CommitmentDiscountQuantity = real(null),\n        CommitmentDiscountStatus = case(\n            isempty(ReservationId), '',\n            isnotempty(ReservationId) and ChargeType == 'Usage', 'Used',\n            ChargeType startswith 'Unused', 'Unused',\n            'Unused'\n        ),\n        CommitmentDiscountType = iff(isnotempty(ReservationId), 'Reservation', ''),\n        CommitmentDiscountUnit = '',\n        ConsumedQuantity = PricingQuantity * x_PricingBlockSize,\n        ConsumedUnit = PricingUnit,\n        ContractedCost = UnitPrice * PricingQuantity,\n        ContractedUnitPrice = UnitPrice,\n        EffectiveCost = iff(x_AmortizationClass == 'Principal', real(0), Cost),\n        InvoiceId = '',\n        InvoiceIssuerName = 'Microsoft',\n        ListCost = real(null),\n        ListUnitPrice = real(null),\n        PricingCategory,\n        PricingCurrency = iff(BillingAccountId == BillingProfileId, BillingCurrency, ''),\n        PricingQuantity,\n        PricingUnit,\n        ProviderName = 'Microsoft',\n        PublisherName = iff(PublisherType == 'Marketplace', PublisherName, 'Microsoft'),\n        Region = '',\n        RegionId,\n        RegionName,\n        ResourceId = tostring(tmp_ResourceInfo.ResourceId),\n        ResourceName = tostring(tmp_ResourceInfo.ResourceName),\n        ResourceType,\n        ServiceCategory,\n        ServiceName,\n        ServiceSubcategory,\n        SkuId = '',\n        SkuMeter = MeterName,\n        SkuPriceDetails = '',\n        SkuPriceId = '',\n        SubAccountId = strcat('/subscriptions/', SubscriptionId),\n        SubAccountName = iff(isempty(SubscriptionId), '', SubscriptionName),\n        SubAccountType = iff(isempty(SubscriptionId), '', 'Subscription'),\n        Tags = iff(Tags startswith '{', Tags, strcat('{', Tags, '}')),\n        UsageAmount = real(null),\n        UsageQuantity = real(null),\n        UsageUnit = '',\n        x_AccountId = '',\n        x_AccountName = AccountName,\n        x_AccountOwnerId = AccountOwnerId,\n        x_AmortizationClass = '',\n        x_BilledCostInUsd = real(null),\n        x_BilledUnitPrice = iff(ChargeType == 'Usage' and isnotempty(ReservationId) and ChargeType != 'UnusedSavingsPlan', real(0), UnitPrice),\n        x_BillingAccountId = BillingAccountId,\n        x_BillingAccountName = BillingAccountName,\n        x_BillingExchangeRate = real(null),\n        x_BillingExchangeRateDate = datetime(null),\n        x_BillingItemCode = '',\n        x_BillingItemName = '',\n        x_BillingProfileId = BillingProfileId,\n        x_BillingProfileName = BillingProfileName,\n        x_ChargeId = '',\n        x_CommodityCode = '',\n        x_CommodityName = '',\n        x_ComponentType = '',\n        x_ComponentName = '',\n        x_ContractedCostInUsd = real(null),\n        x_Cost = real(null),\n        x_CostAllocationRuleName = '',\n        x_CostCategories = '',\n        x_CostCenter = CostCenter,\n        x_CostType = '',\n        x_Credits = '',\n        x_CurrencyConversionRate = real(null),\n        x_CustomerId = '',\n        x_CustomerName = '',\n        x_Discount = '',\n        x_EffectiveCostInUsd = real(null),\n        x_EffectiveUnitPrice = iff(ChargeType == 'Usage' and isnotempty(ReservationId) and ChargeType != 'UnusedSavingsPlan', real(0), EffectivePrice),\n        x_ExportTime = datetime(null),\n        x_InstanceID = '',\n        x_InvoiceId = '',\n        x_InvoiceIssuerId = '',\n        x_InvoiceSectionId = InvoiceSectionId,\n        x_InvoiceSectionName = InvoiceSection,\n        x_ListCostInUsd = real(null),\n        x_Location = '',\n        x_OnDemandCost = real(null),\n        x_OnDemandCostInUsd = real(null),\n        x_OnDemandUnitPrice = real(null),\n        x_Operation = '',\n        x_OwnerAccountID = '',\n        x_PartnerCreditApplied = '',\n        x_PartnerCreditRate = '',\n        x_PricingBlockSize,\n        x_PricingCurrency = '',\n        x_PricingSubcategory = case(\n            // TODO: Add x_SkuTier when supported by C360 -- PricingCategory == 'Standard' and isnotempty(x_SkuTier), 'Tiered',\n            PricingCategory == 'Standard', 'Standard',\n            PricingCategory == 'Committed', strcat('Committed ', CommitmentDiscountCategory),\n            PricingCategory == 'Dynamic', 'Spot',\n            ''\n        ),\n        x_PricingUnitDescription,\n        x_Project = '',\n        x_PublisherCategory = iff(PublisherType == 'Marketplace', 'Vendor', 'Cloud Provider'),\n        x_PublisherId = '',\n        x_ResellerId = '',\n        x_ResellerName = '',\n        x_ResourceGroupName = ResourceGroup,\n        x_ResourceType,\n        x_ServiceCode = '',\n        x_ServiceId = '',\n        x_ServiceModel,\n        x_ServicePeriodEnd = datetime(null),\n        x_ServicePeriodStart = datetime(null),\n        x_SkuDescription = Product,\n        x_SkuDetails = iff(AdditionalInfo startswith '{', AdditionalInfo, strcat('{', AdditionalInfo, '}')),\n        x_SkuIsCreditEligible = IsAzureCreditEligible,\n        x_SkuMeterCategory = MeterCategory,\n        x_SkuMeterId = MeterId,\n        x_SkuMeterName = MeterName,\n        x_SkuMeterSubcategory = MeterSubCategory,\n        x_SkuOfferId = OfferId,\n        x_SkuOrderId = ProductOrderId,\n        x_SkuOrderName = ProductOrderName,\n        x_SkuPartNumber = PartNumber,\n        x_SkuPlanName = '',\n        x_SkuRegion = MeterRegion,\n        x_SkuServiceFamily = ServiceFamily,\n        x_SkuTerm = toint(Term),\n        x_SkuTier = '',\n        x_SourceName = 'C360',\n        x_SourceProvider = 'Microsoft',\n        x_SourceType = 'ActualCost',\n        x_SourceVersion = 'C360-2025-04',\n        x_SubproductName = '',\n        x_UsageType = ''\n}\n\n// Update policy for AmortizedCosts_raw -> Costs_raw table\n.alter table Costs_raw policy update\n``` \n[{\n    \"IsEnabled\": true,\n    \"Source\": \"AmortizedCosts_raw\",\n    \"Query\": \"AmortizedCosts_transform_v1_2()\",\n    \"IsTransactional\": true,\n    \"PropagateIngestionProperties\": true\n}]\n```\n\n\n//===| CommitmentDiscountUsage |========================================================================================\n// Supported versions:\n// - MS EA reservation details: 2023-03-01  -- See https://learn.microsoft.com/azure/cost-management-billing/dataset-schema/reservation-details-ea\n// - MS MCA reservation details: 2023-03-01 -- See https://learn.microsoft.com/azure/cost-management-billing/dataset-schema/reservation-details-mca\n//======================================================================================================================\n\n// CommitmentDiscountUsage_transform_v1_2 function\n.create-or-alter function\nwith (docstring='All commitment discount usage transformed to FOCUS 1.2. This includes reservationdeatils_raw.', folder='Commitment discounts')\nCommitmentDiscountUsage_transform_v1_2()\n{\n    // NOTE: All open issues and questions are tracked @ https://github.com/microsoft/finops-toolkit/issues/1111\n    CommitmentDiscountUsage_raw\n    //\n    // Set ProviderName\n    | extend ProviderName = 'Microsoft'\n    //\n    // Handle resource columns\n    | extend ResourceId = tolower(InstanceId)\n    | extend tmp_ResourceDetails = parse_resourceid(ResourceId)\n    | extend ResourceName        = tostring(tmp_ResourceDetails.ResourceName)\n    | extend SubAccountId        = tostring(tmp_ResourceDetails.SubAccountId)\n    | extend x_ResourceGroupName = tostring(tmp_ResourceDetails.x_ResourceGroupName)\n    | extend x_ResourceType      = tostring(tmp_ResourceDetails.x_ResourceType)\n    | lookup kind=leftouter (ResourceTypes | distinct x_ResourceType, ResourceType = SingularDisplayName) on x_ResourceType\n    | lookup kind=leftouter (Services | distinct x_ResourceType, ServiceName, ServiceCategory, ServiceSubcategory, x_ServiceModel) on x_ResourceType\n    //\n    // Sort columns and apply final transforms\n    | project\n        ChargePeriodEnd                     = UsageDate + 1d,\n        ChargePeriodStart                   = UsageDate,\n        CommitmentDiscountCategory          = 'Usage',\n        CommitmentDiscountId                = tolower(strcat('/providers/microsoft.capacity/reservationorders/', ReservationOrderId, '/reservations/', ReservationId)),\n        CommitmentDiscountQuantity          = UsedHours * InstanceFlexibilityRatio,\n        CommitmentDiscountType              = 'Reservation',\n        CommitmentDiscountUnit              = case(\n            InstanceFlexibilityRatio == 1, 'Hours',\n            InstanceFlexibilityRatio != 1, 'Normalized Hours',\n            ''\n        ),\n        ConsumedQuantity                    = UsedHours,\n        ProviderName,\n        ResourceId,\n        ResourceName,\n        ResourceType,\n        ServiceCategory,\n        ServiceName,\n        ServiceSubcategory,\n        SubAccountId,\n        x_CommitmentDiscountCommittedCount  = TotalReservedQuantity,\n        x_CommitmentDiscountCommittedAmount = ReservedHours,\n        // TODO: Is this needed? -- x_CommitmentDiscountKind            = Kind,\n        x_CommitmentDiscountNormalizedGroup = iff(InstanceFlexibilityGroup == 'NA', '', InstanceFlexibilityGroup),\n        x_CommitmentDiscountNormalizedRatio = InstanceFlexibilityRatio,\n        x_IngestionTime                     = ingestion_time(),\n        x_ResourceGroupName,\n        x_ResourceType,\n        // x_RowId = hash_sha256(strcat(\n        //     // DO NOT CHANGE COLUMNS OR COLUMN ORDER\n        //     CommitmentDiscountId,\n        //     ResourceId,\n        //     ChargePeriodStart\n        // )),\n        x_ServiceModel,\n        x_SkuOrderId                        = ReservationOrderId,\n        x_SkuSize                           = iff(SkuName == 'NA', '', SkuName),\n        x_SourceName                        = coalesce(x_SourceName, iff(ProviderName == 'Microsoft', 'Cost Management', ProviderName)),\n        x_SourceProvider                    = coalesce(x_SourceProvider, ProviderName),\n        x_SourceType                        = coalesce(x_SourceType, iff(ProviderName == 'Microsoft', 'ReservationDetails', '')),\n        x_SourceVersion                     = coalesce(x_SourceVersion, iff(ProviderName == 'Microsoft', '2024-03-01', ''))\n}\n\n// CommitmentDiscountUsage_final_v1_2 table\n.create-merge table CommitmentDiscountUsage_final_v1_2 (\n    ChargePeriodEnd:                     datetime,  // Hubs add-on\n    ChargePeriodStart:                   datetime,  // MS 2023-03-01\n    CommitmentDiscountCategory:          string,    // Hubs add-on\n    CommitmentDiscountId:                string,    // MS 2023-03-01\n    CommitmentDiscountQuantity:          real,      // MS 2023-03-01\n    CommitmentDiscountType:              string,    // Hubs add-on\n    CommitmentDiscountUnit:              string,    // Hubs add-on\n    ConsumedQuantity:                    real,      // MS 2023-03-01\n    ProviderName:                        string,    // Hubs add-on\n    ResourceId:                          string,    // MS 2023-03-01\n    ResourceName:                        string,    // Hubs add-on\n    ResourceType:                        string,    // Hubs add-on\n    ServiceCategory:                     string,    // Hubs add-on\n    ServiceName:                         string,    // Hubs add-on\n    ServiceSubcategory:                  string,    // Hubs add-on\n    SubAccountId:                        string,    // Hubs add-on\n    x_CommitmentDiscountCommittedCount:  real,      // MS 2023-03-01\n    x_CommitmentDiscountCommittedAmount: real,      // MS 2023-03-01\n    x_CommitmentDiscountNormalizedGroup: string,    // MS 2023-03-01\n    x_CommitmentDiscountNormalizedRatio: real,      // MS 2023-03-01\n    x_IngestionTime:                     datetime,  // Hubs add-on\n    x_ResourceGroupName:                 string,    // Hubs add-on\n    x_ResourceType:                      string,    // Hubs add-on\n    x_ServiceModel:                      string,    // Hubs add-on\n    x_SkuOrderId:                        string,    // MS 2023-03-01\n    x_SkuSize:                           string,    // MS 2023-03-01\n    x_SourceName:                        string,    // Hubs add-on\n    x_SourceProvider:                    string,    // Hubs add-on\n    x_SourceType:                        string,    // Hubs add-on\n    x_SourceVersion:                     string     // Hubs add-on\n)\n\n// Update policy for CommitmentDiscountUsage_raw -> CommitmentDiscountUsage_final_v1_2 table\n.alter table CommitmentDiscountUsage_final_v1_2 policy update\n```\n[{\n    \"IsEnabled\": true,\n    \"Source\": \"CommitmentDiscountUsage_raw\",\n    \"Query\": \"CommitmentDiscountUsage_transform_v1_2()\",\n    \"IsTransactional\": true,\n    \"PropagateIngestionProperties\": true\n}]\n```\n\n\n//===| Recommendations |================================================================================================\n// Supported datasets/versions:\n// - MS CM EA reservation recommendations: 2023-05-01  -- See https://learn.microsoft.com/azure/cost-management-billing/dataset-schema/reservation-recommendations-ea\n// - MS CM MCA reservation recommendations: 2023-05-01 -- See https://learn.microsoft.com/azure/cost-management-billing/dataset-schema/reservation-recommendations-mca\n//======================================================================================================================\n\n// Recommendations_transform_v1_2 function\n.create-or-alter function\nwith (docstring='All recommendations transformed to FOCUS 1.2.', folder='Recommendations')\nRecommendations_transform_v1_2()\n{\n    // NOTE: All open issues and questions are tracked @ https://github.com/microsoft/finops-toolkit/issues/1111\n    let isoMonths = (duration: string) {\n        let number = toint(replace_regex(duration, @'[PMY]', ''));\n        toint(case(\n            duration == '', int(null),\n            duration endswith \"Y\", number * 12,\n            duration endswith \"M\", number,\n            -1\n        ))\n    };\n    Recommendations_raw\n    | extend x_IngestionTime = ingestion_time()\n    //\n    // Set ProviderName\n    | extend ProviderName = 'Microsoft'\n    //\n    // Set source columns\n    | extend x_SourceName     = coalesce(x_SourceName, iff(ProviderName == 'Microsoft', 'Cost Management', ProviderName))\n    | extend x_SourceProvider = coalesce(x_SourceProvider, ProviderName)\n    | extend x_SourceType     = coalesce(x_SourceType, iff(ProviderName == 'Microsoft', 'ReservationRecommendations', ''))\n    | extend x_SourceVersion  = coalesce(x_SourceVersion, iff(ProviderName == 'Microsoft', '2023-05-01', ''))\n    //\n    // Convert JSON cost columns to real\n    | extend CostWithNoReservedInstances    = case(isnotempty(CostWithNoReservedInstances),    CostWithNoReservedInstances,    isnotempty(CostWithNoReservedInstancesJson),    toreal(extract(@'\"value\":([0-9\\.]+)', 1, CostWithNoReservedInstancesJson)),    CostWithNoReservedInstances)\n    | extend NetSavings                     = case(isnotempty(NetSavings),                     NetSavings,                     isnotempty(NetSavingsJson),                     toreal(extract(@'\"value\":([0-9\\.]+)', 1, NetSavingsJson)),                     NetSavings)\n    | extend TotalCostWithReservedInstances = case(isnotempty(TotalCostWithReservedInstances), TotalCostWithReservedInstances, isnotempty(TotalCostWithReservedInstancesJson), toreal(extract(@'\"value\":([0-9\\.]+)', 1, TotalCostWithReservedInstancesJson)), TotalCostWithReservedInstances)\n    //\n    // Build recommendation details\n    | lookup kind=leftouter (Regions | summarize RegionName = make_set(RegionName)[0] by Location = RegionId) on Location\n    | extend x_RecommendationDetails = case(\n        // Use incoming x_RecommendationDetails first\n        isnotempty(x_RecommendationDetails), x_RecommendationDetails,\n        // Create one for reservation recommendations if needed\n        x_SourceType == 'ReservationRecommendations', bag_pack(\n            'CommitmentDiscountNormalizedGroup', InstanceFlexibilityGroup,\n            'CommitmentDiscountNormalizedRatio', InstanceFlexibilityRatio,\n            'CommitmentDiscountNormalizedSize', NormalizedSize,\n            'CommitmentDiscountResourceType', ResourceType,\n            'CommitmentDiscountScope', Scope,\n            'LookbackPeriodDuration', case(\n                LookBackPeriod matches regex @'^Last([0-9]+)Days$', replace_regex(LookBackPeriod, @'^Last([0-9]+)Days$', @'P\\1D'),\n                LookBackPeriod matches regex @'^[0-9]+$',           strcat('P', LookBackPeriod, 'D'),\n                ''\n            ),\n            'LookbackPeriodStart', FirstUsageDate,\n            'RecommendedQuantity', RecommendedQuantity,\n            'RecommendedQuantityNormalized', RecommendedQuantityNormalized,\n            'RegionId', Location,\n            'RegionName', RegionName,\n            'SkuMeterId', MeterId,\n            'SkuPriceDetails', SkuProperties,\n            'SkuSize', coalesce(SKU, SkuName),\n            'SkuTerm', isoMonths(Term)\n        ),\n        dynamic({})\n    )\n    //\n    // Prefer specified date, then fall back to generating a date based on reservation recommendation lookback period, then validate to ensure it's not in the future\n    | extend x_RecommendationDate = coalesce(x_RecommendationDate, FirstUsageDate + (toint(extract(@'^P([0-9]+)D$', 1, tostring(x_RecommendationDetails.LookbackPeriodDuration))) * 1d))\n    | extend x_RecommendationDate = iff(x_RecommendationDate > now(), startofday(now()), x_RecommendationDate)\n    //\n    | project\n        ProviderName,\n        ResourceId,\n        ResourceName,\n        ResourceType,\n        SubAccountId = coalesce(SubAccountId, iff(isnotempty(SubscriptionId), strcat('/subscriptions/', SubscriptionId), '')),\n        SubAccountName,\n        x_EffectiveCostAfter = coalesce(x_EffectiveCostAfter, TotalCostWithReservedInstances),\n        x_EffectiveCostBefore = coalesce(x_EffectiveCostBefore, CostWithNoReservedInstances),\n        x_EffectiveCostSavings = coalesce(x_EffectiveCostSavings, NetSavings),\n        x_IngestionTime,\n        x_RecommendationCategory,  // TODO: Set for reservation recommendations\n        x_RecommendationDate,\n        x_RecommendationDescription,\n        x_RecommendationDetails,\n        x_RecommendationId,        // TODO: Set for reservation recommendations\n        x_ResourceGroupName,\n        x_SourceName,\n        x_SourceProvider,\n        x_SourceType,\n        x_SourceVersion\n}\n\n// Recommendations_final_v1_2 table\n.create-merge table Recommendations_final_v1_2 (\n    ProviderName:                string,\n    ResourceId:                  string,\n    ResourceName:                string,\n    ResourceType:                string,\n    SubAccountId:                string,\n    SubAccountName:              string,\n    x_EffectiveCostAfter:        real,\n    x_EffectiveCostBefore:       real,\n    x_EffectiveCostSavings:      real,\n    x_IngestionTime:             datetime,\n    x_RecommendationCategory:    string,\n    x_RecommendationDate:        datetime,\n    x_RecommendationDescription: string,\n    x_RecommendationDetails:     dynamic,\n    x_RecommendationId:          string,\n    x_ResourceGroupName:         string,\n    x_SourceName:                string,\n    x_SourceProvider:            string,\n    x_SourceType:                string,\n    x_SourceVersion:             string\n)\n\n// Update policy for Recommendations_raw -> Recommendations_final_v1_2 table\n.alter table Recommendations_final_v1_2 policy update\n```\n[{\n    \"IsEnabled\": true,\n    \"Source\": \"Recommendations_raw\",\n    \"Query\": \"Recommendations_transform_v1_2()\",\n    \"IsTransactional\": true,\n    \"PropagateIngestionProperties\": true\n}]\n```\n\n\n//===| Transactions |===================================================================================================\n// Supported versions:\n// - MS CM EA reservation transactions: 2023-05-01  -- See https://learn.microsoft.com/azure/cost-management-billing/dataset-schema/reservation-transactions-ea\n// - MS CM MCA reservation transactions: 2023-05-01 -- See https://learn.microsoft.com/azure/cost-management-billing/dataset-schema/reservation-transactions-mca\n//======================================================================================================================\n\n// Transactions_transform_v1_2 function\n.create-or-alter function\nwith (docstring='All transactions transformed to FOCUS 1.2.', folder='Transactions')\nTransactions_transform_v1_2()\n{\n    // NOTE: All open issues and questions are tracked @ https://github.com/microsoft/finops-toolkit/issues/1111\n    let isoMonths = (duration: string) {\n        let number = toint(replace_regex(duration, @'[PMY]', ''));\n        toint(case(\n            duration == '', int(null),\n            duration endswith \"Y\", number * 12,\n            duration endswith \"M\", number,\n            -1\n        ))\n    };\n    Transactions_raw\n    //\n    // Set ProviderName\n    | extend ProviderName = 'Microsoft'\n    //\n    // Set source columns\n    | extend x_SourceName     = coalesce(x_SourceName, iff(ProviderName == 'Microsoft', 'Cost Management', ProviderName))\n    | extend x_SourceProvider = coalesce(x_SourceProvider, ProviderName)\n    | extend x_SourceType     = coalesce(x_SourceType, iff(ProviderName == 'Microsoft', 'ReservationTransactions', ''))\n    | extend x_SourceVersion  = coalesce(x_SourceVersion, iff(ProviderName == 'Microsoft', '2023-05-01', ''))\n    //\n    // Handle BillingPeriodStart/End\n    | extend BillingMonth = tostring(BillingMonth)\n    | extend BillingPeriodStart = iff(isempty(BillingMonth), datetime(null), todatetime(strcat(substring(BillingMonth, 0, 4), \"-\", substring(BillingMonth, 4, 2), \"-\", substring(BillingMonth, 6, 2))))\n    | extend BillingPeriodEnd = iff(isempty(BillingMonth), datetime(null), startofmonth(endofmonth(BillingPeriodStart) + 1d))\n    //\n    // Sort columns and apply final transforms\n    | project\n        BilledCost = Amount,\n        BillingAccountId = case(\n            BillingProfileId startswith '/', BillingProfileId,\n            isnotempty(CurrentEnrollmentId), strcat('/providers/Microsoft.Billing/billingAccounts/', CurrentEnrollmentId),\n            isnotempty(BillingProfileId), strcat('/providers/Microsoft.Billing/billingProfiles/', BillingProfileId),\n            ''\n        ),\n        BillingAccountName = coalesce(BillingProfileName, CurrentEnrollmentId),\n        BillingCurrency = Currency,\n        BillingPeriodEnd,\n        BillingPeriodStart,\n        ChargeCategory = case(\n            EventType in ('Cancel', 'Purchase', 'Refund'), 'Purchase',\n            'Adjustment'\n        ),\n        ChargeClass = case(\n            EventType == 'Cancel', 'Cancel',  // FOCUS does not handle this scenario\n            EventType == 'Refund', 'Correction',\n            ''\n        ),\n        ChargeDescription = Description,\n        ChargeFrequency   = case(\n            BillingFrequency == 'OneTime', 'One-Time',\n            BillingFrequency == 'Recurring', 'Recurring',\n            BillingFrequency\n        ),\n        ChargePeriodStart    = EventDate,\n        InvoiceId,\n        PricingQuantity      = Quantity,\n        PricingUnit          = 'Reservations',\n        ProviderName,\n        RegionId             = Region,\n        RegionName           = Region,\n        SubAccountId         = iff(isempty(PurchasingSubscriptionGuid), '', strcat('/subscriptions/', PurchasingSubscriptionGuid)),\n        SubAccountName       = iff(isempty(PurchasingSubscriptionGuid), '', PurchasingSubscriptionName),\n        x_AccountName        = AccountName,\n        x_AccountOwnerId     = AccountOwnerEmail,\n        x_CostCenter         = CostCenter,\n        x_InvoiceNumber      = Invoice,\n        x_InvoiceSectionId   = InvoiceSectionId,\n        x_InvoiceSectionName = coalesce(InvoiceSectionName, DepartmentName),\n        x_IngestionTime      = ingestion_time(),\n        x_MonetaryCommitment = MonetaryCommitment,\n        x_Overage            = Overage,\n        x_PurchasingBillingAccountId = PurchasingEnrollment,\n        x_SkuOrderId         = ReservationOrderId,\n        x_SkuOrderName       = ReservationOrderName,\n        x_SkuSize            = ArmSkuName,\n        x_SkuTerm            = isoMonths(Term),\n        x_SourceName,\n        x_SourceProvider,\n        x_SourceType,\n        x_SourceVersion,\n        x_SubscriptionId  = PurchasingSubscriptionGuid,\n        x_TransactionType = EventType\n}\n\n// Transactions_final_v1_2 table\n.create-merge table Transactions_final_v1_2 (\n    BilledCost:                   real,      // MS CM EA+MCA 2023-05-01\n    BillingAccountId:             string,    // MS CM EA+MCA 2023-05-01\n    BillingAccountName:           string,    // MS CM EA+MCA 2023-05-01\n    BillingCurrency:              string,    // MS CM EA+MCA 2023-05-01\n    BillingPeriodEnd:             datetime,  // MS CM EA+MCA 2023-05-01\n    BillingPeriodStart:           datetime,  // MS CM EA+MCA 2023-05-01\n    ChargeCategory:               string,    // Hubs add-on\n    ChargeClass:                  string,    // Hubs add-on\n    ChargeDescription:            string,    // MS CM EA+MCA 2023-05-01\n    ChargeFrequency:              string,    // MS CM EA+MCA 2023-05-01\n    ChargePeriodStart:            datetime,  // MS CM EA+MCA 2023-05-01\n    InvoiceId:                    string,    // MS CM MCA 2023-05-01\n    PricingQuantity:              real,      // MS CM EA+MCA 2023-05-01\n    PricingUnit:                  string,    // Hubs add-on\n    ProviderName:                 string,    // Hubs add-on\n    RegionId:                     string,    // MS CM EA+MCA 2023-05-01\n    RegionName:                   string,    // MS CM EA+MCA 2023-05-01\n    SubAccountId:                 string,    // MS CM EA+MCA 2023-05-01\n    SubAccountName:               string,    // MS CM EA+MCA 2023-05-01\n    x_AccountName:                string,    // MS CM EA 2023-05-01\n    x_AccountOwnerId:             string,    // MS CM EA 2023-05-01\n    x_CostCenter:                 string,    // MS CM EA 2023-05-01\n    x_InvoiceNumber:              string,    // MS CM MCA 2023-05-01\n    x_InvoiceSectionId:           string,    // MS CM MCA 2023-05-01\n    x_InvoiceSectionName:         string,    // MS CM MCA 2023-05-01\n    x_IngestionTime:              datetime,  // Hubs add-on\n    x_MonetaryCommitment:         real,      // MS CM EA 2023-05-01\n    x_Overage:                    real,      // MS CM EA 2023-05-01\n    x_PurchasingBillingAccountId: string,    // MS CM EA 2023-05-01\n    x_SkuOrderId:                 string,    // MS CM EA+MCA 2023-05-01\n    x_SkuOrderName:               string,    // MS CM EA+MCA 2023-05-01\n    x_SkuSize:                    string,    // MS CM EA+MCA 2023-05-01\n    x_SkuTerm:                    int,       // MS CM EA+MCA 2023-05-01\n    x_SourceName:                 string,    // Hubs add-on\n    x_SourceProvider:             string,    // Hubs add-on\n    x_SourceType:                 string,    // Hubs add-on\n    x_SourceVersion:              string,    // Hubs add-on\n    x_SubscriptionId:             string,    // MS CM EA+MCA 2023-05-01\n    x_TransactionType:            string     // MS CM EA+MCA 2023-05-01\n)\n\n// Update policy for Transactions_raw -> Transactions_final_v1_2 table\n.alter table Transactions_final_v1_2 policy update\n```\n[{\n    \"IsEnabled\": true,\n    \"Source\": \"Transactions_raw\",\n    \"Query\": \"Transactions_transform_v1_2()\",\n    \"IsTransactional\": true,\n    \"PropagateIngestionProperties\": true\n}]\n```\n",
                    "$fxv#11": "// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\n//======================================================================================================================\n// Common utility functions\n//\n// TIP: Use Ctrl+K,Ctrl+0 to collapse all regions in VS Code\n//======================================================================================================================\n\n\n//===| Date functions |=================================================================================================\n\n// monthstring\n.create-or-alter function \nwith (docstring = @'Returns the name of the month for the specified date (e.g. Jan or January)', folder =@'Common') \nmonthstring(['date']: datetime, length: int = 9)\n{\n    substring(dynamic(['January','February','March','April','May','June','July','August','September','October','November','December'])[getmonth(['date']) - 1], 0, length)\n}\n\n// datestring\n.create-or-alter function \nwith (docstring = @'Converts 2 dates into a simple, user-friendly date range (e.g. Jan 1-Jan 3)', folder =@'Common') \ndatestring(start: datetime, end: datetime = datetime('0001-01-01'))\n{\n    let month = (d: datetime) { monthstring(d, 3) };\n    let endDate = iff(end == datetime('0001-01-01'), start, end);\n    let sameDate = startofday(start) == startofday(endDate);\n    let sameMonth = startofmonth(start) == startofmonth(endDate);\n    let sameYear = startofyear(start) == startofyear(endDate);\n    let fullMonth = startofday(start) == startofmonth(start) and startofday(endDate) == startofday(endofmonth(endDate));\n    let fullYear = startofday(start) == startofyear(start) and startofday(endDate) == startofday(endofyear(endDate));\n    let currentYear = sameYear and startofyear(start) == startofyear(now());\n    case(\n        // Full year             | yyyy (same year) / yyyy-yyyy (diff years)\n        fullYear,\n            strcat(getyear(start), iff(sameYear, '', strcat('-', getyear(endDate)))),\n        // 1 full mo, same year  | Mmm yyyy\n        fullMonth and sameMonth and sameYear,\n            strcat(month(start), ' ', getyear(start)),\n        // 2+ full mo, same year | Mmm-Mmm (current year) / Mmm-Mmm yyyy (other year)\n        fullMonth and sameYear,\n            strcat(month(start), '-', month(endDate), iff(currentYear, '', strcat(' ', getyear(endDate)))),\n        // Full mo, diff year    | Mmm yyyy-Mmm yyyy\n        fullMonth and not(sameYear),\n            strcat(month(start), ' ', getyear(start), '-', month(endDate), ' ', getyear(endDate)),\n        // Same date             | Mmm d (current year) / Mmm d, yyyy (other year)\n        sameDate,\n            strcat(month(start), ' ', dayofmonth(start), iff(currentYear, '', strcat(', ', getyear(endDate)))),\n        // 1 partial M, same Y   | Mmm d-d (current year) / Mmm d-d, yyyy (other year)\n        not(fullMonth) and sameMonth and sameYear,\n            strcat(month(start), ' ', dayofmonth(start), '-', dayofmonth(endDate), iff(currentYear, '', strcat(' ', getyear(endDate)))),\n        // 2+ partial M, same Y  | Mmm d-Mmm d (current year) / Mmm d-Mmm d, yyyy (other year)\n        not(fullMonth) and not(sameMonth) and sameYear,\n            strcat(month(start), ' ', dayofmonth(start), '-', month(endDate), ' ', dayofmonth(endDate), iff(currentYear, '', strcat(', ', getyear(endDate)))),\n        // All other cases       | Mmm d, yyyy-Mmm d, yyyy\n        strcat(month(start), ' ', dayofmonth(start), ', ', getyear(start), '-', month(endDate), ' ', dayofmonth(endDate), ', ', getyear(endDate))\n    )\n}\n\n// daterange\n.create-or-alter function \nwith (docstring = @'DEPRECATED: Please use datestring(); function will be removed on or after the Jan 2026 release', folder =@'Common') \ndaterange(start: datetime, end: datetime = datetime('0001-01-01'))\n{\n    datestring(start, end)\n}\n\n// monthsago\n.create-or-alter function \nwith (docstring = 'DEPRECATED: Please use startofmonth(now(), -<# of months>); function will be removed on or after the Jan 2026 release', folder = 'Common')\nmonthsago(months: int)\n{\n    datetime_add('month', -months, startofmonth(now()))\n}\n\n\n//===| Number functions |===============================================================================================\n// NOTE: Must be defined before string converters\n\n// delta\n.create-or-alter function \nwith (docstring = @'Compares 2 values and returns the percentage change from oldval to newval', folder =@'Common') \ndelta(oldval: double, newval: double)\n{\n    (newval - todouble(oldval))/oldval\n}\n\n// percentOfTotal\n// NOTE: Must be before percent() function\n.create-or-alter function \nwith (docstring = @'Calculates the percentage of each record based on a required Count column', folder =@'Common') \npercentOfTotal(t: (Count: long), tot: long)\n{\n    let total = todouble(tot);\n    t \n    | extend Percent = round(Count / total * 100, 3) \n    | order by Count desc\n}\n\n// percent\n.create-or-alter function \nwith (docstring = @'Calculates the percentage of each record based on a required Count column', folder =@'Common') \npercent(t: (Count: long))\n{\n    let total = todouble(toscalar(t | summarize sum(Count)));\n    percentOfTotal(t, total)\n}\n\n// plusminus\n.create-or-alter function \nwith (docstring = 'Shows a +/- sign based on the direction of the number', folder = 'Common')\nplusminus(val: string)\n{\n    let neg = substring(val, 0, 1) == '-';\n    iff(neg, val, strcat('+', val))\n}\n\n// updown\n.create-or-alter function \nwith (docstring = 'Shows an up/down indicator based on the direction of the number', folder = 'Common')\nupdown(val: string)\n{\n    // TODO: Handle 0\n    let neg = substring(val, 0, 1) == '-';\n    iff(neg, strcat('(v)', substring(val, 1)), strcat('(^)', val))\n}\n\n\n//===| String functions |===============================================================================================\n\n// percentstring\n// NOTE: Must be defined before deltastring\n.create-or-alter function \nwith (docstring = 'Calculate a percentage and render as a string', folder = 'Common')\npercentstring(num: double, total: double = 1.0, places: int = 9)\n{\n    let value = 1.0 * num / total * 100;\n    strcat(case(\n        places != 9, round(value, places),\n        value < 10,  round(value, 2),\n        round(value, 1)\n    ), '%')\n}\n\n//----------------------------------------------------------------------------------------------------------------------\n\n// arraystring\n.create-or-alter function \nwith (docstring = 'Convert an array to a comma-delimited string', folder = 'Common')\narraystring(arr: dynamic)\n{\n    replace_string(replace_regex(replace_regex(replace_regex(replace_regex(replace_regex(\n        tostring(arr)\n        , @'^\\[\"', '')\n        , @'\"\\]$', '')\n        , @'^, ', '')\n        , @', $', '')\n        , @'^\\[]$', '')\n        , '\",\"', ', ')\n}\n\n// deltastring\n.create-or-alter function \nwith (docstring = 'Calculate a delta percentage and render as a string', folder = 'Common')\ndeltastring(oldval: double, newval: double, places: int = 1, useArrows: bool = false)\n{\n    let d = delta(oldval, newval);\n    strcat(case(useArrows and d > 0, '(^)', useArrows and d < 0, '(v)', d < 0, '-', ''), percentstring(abs(d), 1, places))\n}\n\n// diffstring\n.create-or-alter function \nwith (docstring = 'Calculate the difference and render as a string', folder = 'Common')\ndiffstring(oldval: double, newval: double, places: int = 1)\n{\n    plusminus(round(newval - oldval, places))\n}\n\n// numberstring\n.create-or-alter function \nwith (docstring = 'Convert a number to a string', folder = 'Common')\nnumberstring(num: double, abbrev: bool = true)\n{\n    replace_regex(case(\n        num >= 10000000000000, strcat(round(1.0 * num / 1000000000000, 1), 'T'),\n        num >= 1000000000000,  strcat(round(1.0 * num / 1000000000000, 2), 'T'),\n        num >= 10000000000,    strcat(round(1.0 * num / 1000000000, 1), 'B'),\n        num >= 1000000000,     strcat(round(1.0 * num / 1000000000, 2), 'B'),\n        num >= 10000000,       strcat(round(1.0 * num / 1000000, 1), 'M'),\n        num >= 1000000,        strcat(round(1.0 * num / 1000000, 2), 'M'),\n        num >= 10000,          strcat(round(1.0 * num / 1000, 1), 'K'),\n        // Kusto doesn't support back-refs yet -- num > 1000, replace_regex(tostring(num), @'(\\d)(?=(\\d{3})+\\.)', @'\\1,'), // See https://docs.microsoft.com/azure/data-explorer/kusto/query/re2-library\n        num > 1000, replace_regex(tostring(num), @'([0-9]{3})$', @',\\1'), //num / 1000, ',', substring(tostring(num), 0) - (num / 1000 * 1000)),\n        tostring(num)\n    ), @'\\.0$', '')\n}\n\n\n//===| Other |==========================================================================================================\n\n// ifempty\n.create-or-alter function \nwith (docstring = 'Replaces an empty value with the specified default value', folder = 'Common')\nifempty(val: dynamic, defaultVal: dynamic)\n{\n    iff(isempty(val), defaultVal, val)\n}\n",
                    "$fxv#12": "// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\n//======================================================================================================================\n// Hub database / Open data functions\n// Wrap Ingestion database tables for easy access.\n//======================================================================================================================\n\n// For allowed commands, see https://learn.microsoft.com/azure/data-explorer/database-script\n\n\n// PricingUnits\n.create-or-alter function\nwith (docstring = 'Gets pricing units from the FinOps toolkit PricingUnits open data.', folder = 'OpenData')\nPricingUnits()\n{\n    database('Ingestion').PricingUnits\n}\n\n// Regions\n.create-or-alter function\nwith (docstring = 'Gets regions from the FinOps toolkit Regions open data.', folder = 'OpenData')\nRegion()\n{\n    database('Ingestion').Regions\n}\n\n// ResourceTypes\n.create-or-alter function\nwith (docstring = 'Gets resource types from the FinOps toolkit ResourceTypes open data.', folder = 'OpenData')\nResourceType()\n{\n    database('Ingestion').ResourceTypes\n}\n\n// Services\n.create-or-alter function\nwith (docstring = 'Gets services from the FinOps toolkit Services open data.', folder = 'OpenData')\nServices()\n{\n    database('Ingestion').Services\n}\n",
                    "$fxv#13": "// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\n//======================================================================================================================\n// Hub database / FOCUS 1.0 functions\n// Used for reporting with backward compatibility.\n//======================================================================================================================\n\n// For allowed commands, see https://learn.microsoft.com/azure/data-explorer/database-script\n\n\n// CommitmentDiscountUsage_final_v1_0\n.create-or-alter function\nwith (docstring = 'Gets all commitment discount usage records aligned to FOCUS 1.0.', folder = 'CommitmentDiscountUsage')\nCommitmentDiscountUsage_v1_0()\n{\n    database('Ingestion').CommitmentDiscountUsage_final_v1_0\n    | union (\n        database('Ingestion').CommitmentDiscountUsage_final_v1_2\n        // Convert real to decimal\n        | extend\n            CommitmentDiscountQuantity          = todecimal(CommitmentDiscountQuantity),\n            ConsumedQuantity                    = todecimal(ConsumedQuantity),\n            x_CommitmentDiscountCommittedCount  = todecimal(x_CommitmentDiscountCommittedCount),\n            x_CommitmentDiscountCommittedAmount = todecimal(x_CommitmentDiscountCommittedAmount),\n            x_CommitmentDiscountNormalizedRatio = todecimal(x_CommitmentDiscountNormalizedRatio)\n    )\n    | project\n        ChargePeriodEnd,\n        ChargePeriodStart,\n        CommitmentDiscountCategory,\n        CommitmentDiscountId,\n        CommitmentDiscountType,\n        ConsumedQuantity,\n        ProviderName,\n        ResourceId,\n        ResourceName,\n        ResourceType,\n        ServiceCategory,\n        ServiceName,\n        SubAccountId,\n        x_CommitmentDiscountCommittedCount,\n        x_CommitmentDiscountCommittedAmount,\n        x_CommitmentDiscountNormalizedGroup,\n        x_CommitmentDiscountNormalizedRatio,\n        x_CommitmentDiscountQuantity,\n        x_IngestionTime,\n        x_ResourceGroupName,\n        x_ResourceType,\n        x_ServiceModel,\n        x_SkuOrderId,\n        x_SkuSize,\n        x_SourceName,\n        x_SourceProvider,\n        x_SourceType,\n        x_SourceVersion\n}\n\n\n// Costs_final_v1_0\n.create-or-alter function\nwith (docstring = 'Gets all cost and usage records aligned to FOCUS 1.0.', folder = 'Costs')\nCosts_v1_0()\n{\n    database('Ingestion').Costs_final_v1_0\n    | union (\n        database('Ingestion').Costs_final_v1_2\n        // Convert real to decimal\n        | extend\n            BilledCost                          = todecimal(BilledCost),\n            CommitmentDiscountQuantity          = todecimal(CommitmentDiscountQuantity),\n            ConsumedQuantity                    = todecimal(ConsumedQuantity),\n            ContractedCost                      = todecimal(ContractedCost),\n            ContractedUnitPrice                 = todecimal(ContractedUnitPrice),\n            EffectiveCost                       = todecimal(EffectiveCost),\n            ListCost                            = todecimal(ListCost),\n            ListUnitPrice                       = todecimal(ListUnitPrice),\n            PricingQuantity                     = todecimal(PricingQuantity),\n            x_BilledCostInUsd                   = todecimal(x_BilledCostInUsd),\n            x_BilledUnitPrice                   = todecimal(x_BilledUnitPrice),\n            x_BillingExchangeRate               = todecimal(x_BillingExchangeRate),\n            x_CommitmentDiscountNormalizedRatio = todecimal(x_CommitmentDiscountNormalizedRatio),\n            x_ContractedCostInUsd               = todecimal(x_ContractedCostInUsd),\n            x_CurrencyConversionRate            = todecimal(x_CurrencyConversionRate),\n            x_EffectiveCostInUsd                = todecimal(x_EffectiveCostInUsd),\n            x_EffectiveUnitPrice                = todecimal(x_EffectiveUnitPrice),\n            x_ListCostInUsd                     = todecimal(x_ListCostInUsd),\n            x_PricingBlockSize                  = todecimal(x_PricingBlockSize)\n        // Rename columns\n        | project-rename\n            x_InvoiceId = InvoiceId,\n            x_PricingCurrency = PricingCurrency,\n            x_SkuMeterName = SkuMeter\n        // Generate historical x_SkuDetails format from SkuPriceDetails\n        | extend x_SkuDetails = iff(isnotempty(x_SkuDetails), x_SkuDetails, parse_json(replace_regex(tostring(SkuPriceDetails), @'([\\{,])\"x_', @'\\1\"')))\n    )\n    | project\n        AvailabilityZone,\n        BilledCost,\n        BillingAccountId,\n        BillingAccountName,\n        BillingAccountType,\n        BillingCurrency,\n        BillingPeriodEnd,\n        BillingPeriodStart,\n        ChargeCategory,\n        ChargeClass,\n        ChargeDescription,\n        ChargeFrequency,\n        ChargePeriodEnd,\n        ChargePeriodStart,\n        CommitmentDiscountCategory,\n        CommitmentDiscountId,\n        CommitmentDiscountName,\n        CommitmentDiscountStatus,\n        CommitmentDiscountType,\n        ConsumedQuantity,\n        ConsumedUnit,\n        ContractedCost,\n        ContractedUnitPrice,\n        EffectiveCost,\n        InvoiceIssuerName,\n        ListCost,\n        ListUnitPrice,\n        PricingCategory,\n        PricingQuantity,\n        PricingUnit,\n        ProviderName,\n        PublisherName,\n        RegionId,\n        RegionName,\n        ResourceId,\n        ResourceName,\n        ResourceType,\n        ServiceCategory,\n        ServiceName,\n        SkuId,\n        SkuPriceId,\n        SubAccountId,\n        SubAccountName,\n        SubAccountType,\n        Tags,\n        x_AccountId,\n        x_AccountName,\n        x_AccountOwnerId,\n        x_BilledCostInUsd,\n        x_BilledUnitPrice,\n        x_BillingAccountAgreement,\n        x_BillingAccountId,\n        x_BillingAccountName,\n        x_BillingExchangeRate,\n        x_BillingExchangeRateDate,\n        x_BillingProfileId,\n        x_BillingProfileName,\n        x_ChargeId,\n        x_ContractedCostInUsd,\n        x_CostAllocationRuleName,\n        x_CostCategories,\n        x_CostCenter,\n        x_Credits,\n        x_CostType,\n        x_CurrencyConversionRate,\n        x_CustomerId,\n        x_CustomerName,\n        x_Discount,\n        x_EffectiveCostInUsd,\n        x_EffectiveUnitPrice,\n        x_ExportTime,\n        x_IngestionTime,\n        x_InvoiceId,\n        x_InvoiceIssuerId,\n        x_InvoiceSectionId,\n        x_InvoiceSectionName,\n        x_ListCostInUsd,\n        x_Location,\n        x_Operation,\n        x_PartnerCreditApplied,\n        x_PartnerCreditRate,\n        x_PricingBlockSize,\n        x_PricingCurrency,\n        x_PricingSubcategory,\n        x_PricingUnitDescription,\n        x_Project,\n        x_PublisherCategory,\n        x_PublisherId,\n        x_ResellerId,\n        x_ResellerName,\n        x_ResourceGroupName,\n        x_ResourceType,\n        x_ServiceCode,\n        x_ServiceId,\n        x_ServicePeriodEnd,\n        x_ServicePeriodStart,\n        x_SkuDescription,\n        x_SkuDetails,\n        x_SkuIsCreditEligible,\n        x_SkuMeterCategory,\n        x_SkuMeterId,\n        x_SkuMeterName,\n        x_SkuMeterSubcategory,\n        x_SkuOfferId,\n        x_SkuOrderId,\n        x_SkuOrderName,\n        x_SkuPartNumber,\n        x_SkuRegion,\n        x_SkuServiceFamily,\n        x_SkuTerm,\n        x_SkuTier,\n        x_SourceChanges,\n        x_SourceName,\n        x_SourceProvider,\n        x_SourceType,\n        x_SourceVersion,\n        x_UsageType\n}\n\n\n// Prices_final_v1_0\n.create-or-alter function\nwith (docstring = 'Gets all prices aligned to FOCUS 1.0.', folder = 'Prices')\nPrices_v1_0()\n{\n    database('Ingestion').Prices_final_v1_0\n    | union (\n        database('Ingestion').Prices_final_v1_2\n        // Convert real to decimal\n        | extend\n            ContractedUnitPrice                  = todecimal(ContractedUnitPrice),\n            ListUnitPrice                        = todecimal(ListUnitPrice),\n            x_BaseUnitPrice                      = todecimal(x_BaseUnitPrice),\n            x_CommitmentDiscountNormalizedRatio  = todecimal(x_CommitmentDiscountNormalizedRatio),\n            x_ContractedUnitPriceDiscount        = todecimal(x_ContractedUnitPriceDiscount),\n            x_ContractedUnitPriceDiscountPercent = todecimal(x_ContractedUnitPriceDiscountPercent),\n            x_EffectiveUnitPrice                 = todecimal(x_EffectiveUnitPrice),\n            x_EffectiveUnitPriceDiscount         = todecimal(x_EffectiveUnitPriceDiscount),\n            x_EffectiveUnitPriceDiscountPercent  = todecimal(x_EffectiveUnitPriceDiscountPercent),\n            x_PricingBlockSize                   = todecimal(x_PricingBlockSize),\n            x_SkuIncludedQuantity                = todecimal(x_SkuIncludedQuantity),\n            x_SkuTier                            = todecimal(x_SkuTier),\n            x_TotalUnitPriceDiscount             = todecimal(x_TotalUnitPriceDiscount),\n            x_TotalUnitPriceDiscountPercent      = todecimal(x_TotalUnitPriceDiscountPercent) \n        // Rename columns\n        | project-rename\n            x_PricingCurrency = PricingCurrency,\n            x_SkuMeterName = SkuMeter\n    )\n    | project\n        BillingAccountId,\n        BillingAccountName,\n        BillingCurrency,\n        ChargeCategory,\n        CommitmentDiscountCategory,\n        CommitmentDiscountType,\n        ContractedUnitPrice,\n        ListUnitPrice,\n        PricingCategory,\n        PricingUnit,\n        SkuId,\n        SkuPriceId,\n        SkuPriceIdv2,\n        x_BaseUnitPrice,\n        x_BillingAccountAgreement,\n        x_BillingAccountId,\n        x_BillingProfileId,\n        x_CommitmentDiscountSpendEligibility,\n        x_CommitmentDiscountUsageEligibility,\n        x_ContractedUnitPriceDiscount,\n        x_ContractedUnitPriceDiscountPercent,\n        x_EffectivePeriodEnd,\n        x_EffectivePeriodStart,\n        x_EffectiveUnitPrice,\n        x_EffectiveUnitPriceDiscount,\n        x_EffectiveUnitPriceDiscountPercent,\n        x_IngestionTime,\n        x_PricingBlockSize,\n        x_PricingCurrency,\n        x_PricingSubcategory,\n        x_PricingUnitDescription,\n        x_SkuDescription,\n        x_SkuId,\n        x_SkuIncludedQuantity,\n        x_SkuMeterCategory,\n        x_SkuMeterId,\n        x_SkuMeterName,\n        x_SkuMeterSubcategory,\n        x_SkuMeterType,\n        x_SkuPriceType,\n        x_SkuProductId,\n        x_SkuRegion,\n        x_SkuServiceFamily,\n        x_SkuOfferId,\n        x_SkuPartNumber,\n        x_SkuTerm,\n        x_SkuTier,\n        x_SourceName,\n        x_SourceProvider,\n        x_SourceType,\n        x_SourceVersion,\n        x_TotalUnitPriceDiscount,\n        x_TotalUnitPriceDiscountPercent\n}\n\n\n// Recommendations_final_v1_0\n.create-or-alter function\nwith (docstring = 'Gets all recommendations aligned to FOCUS 1.0.', folder = 'Recommendations')\nRecommendations_v1_0()\n{\n    database('Ingestion').Recommendations_final_v1_0\n    | union (\n        database('Ingestion').Recommendations_final_v1_2\n        // Convert real to decimal\n        | extend\n            x_EffectiveCostAfter   = todecimal(x_EffectiveCostAfter),\n            x_EffectiveCostBefore  = todecimal(x_EffectiveCostBefore),\n            x_EffectiveCostSavings = todecimal(x_EffectiveCostSavings)\n    )\n    | project\n        ProviderName,\n        SubAccountId,\n        x_IngestionTime,\n        x_EffectiveCostAfter,\n        x_EffectiveCostBefore,\n        x_EffectiveCostSavings,\n        x_RecommendationDate,\n        x_RecommendationDetails,\n        x_SourceName,\n        x_SourceProvider,\n        x_SourceType,\n        x_SourceVersion\n}\n\n\n// Transactions_final_v1_0\n.create-or-alter function\nwith (docstring = 'Gets all transactions aligned to FOCUS 1.0.', folder = 'Transactions')\nTransactions_v1_0()\n{\n    database('Ingestion').Transactions_final_v1_0\n    | union (\n        database('Ingestion').Transactions_final_v1_2\n        // Convert real to decimal\n        | extend\n            BilledCost           = todecimal(BilledCost),\n            PricingQuantity      = todecimal(PricingQuantity),\n            x_MonetaryCommitment = todecimal(x_MonetaryCommitment),\n            x_Overage            = todecimal(x_Overage)\n        // Rename columns\n        | project-rename\n            x_InvoiceId = InvoiceId\n    )\n    | project\n        BilledCost,\n        BillingAccountId,\n        BillingAccountName,\n        BillingCurrency,\n        BillingPeriodEnd,\n        BillingPeriodStart,\n        ChargeCategory,\n        ChargeClass,\n        ChargeDescription,\n        ChargeFrequency,\n        ChargePeriodStart,\n        PricingQuantity,\n        PricingUnit,\n        ProviderName,\n        RegionId,\n        RegionName,\n        SubAccountId,\n        SubAccountName,\n        x_AccountName,\n        x_AccountOwnerId,\n        x_CostCenter,\n        x_InvoiceId,\n        x_InvoiceNumber,\n        x_InvoiceSectionId,\n        x_InvoiceSectionName,\n        x_IngestionTime,\n        x_MonetaryCommitment,\n        x_Overage,\n        x_PurchasingBillingAccountId,\n        x_SkuOrderId,\n        x_SkuOrderName,\n        x_SkuSize,\n        x_SkuTerm,\n        x_SourceName,\n        x_SourceProvider,\n        x_SourceType,\n        x_SourceVersion,\n        x_SubscriptionId,\n        x_TransactionType\n}\n",
                    "$fxv#14": "// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\n//======================================================================================================================\n// Hub database / FOCUS 1.2 functions\n// Used for reporting with backward compatibility.\n//======================================================================================================================\n\n// For allowed commands, see https://learn.microsoft.com/azure/data-explorer/database-script\n\n\n// CommitmentDiscountUsage_final_v1_2\n.create-or-alter function\nwith (docstring = 'Gets all commitment discount usage records aligned to FOCUS 1.2.', folder = 'CommitmentDiscountUsage')\nCommitmentDiscountUsage_v1_2()\n{\n    database('Ingestion').CommitmentDiscountUsage_final_v1_2\n    | union (\n        database('Ingestion').CommitmentDiscountUsage_final_v1_0\n        // Convert decimal to real\n        | extend\n            ConsumedQuantity                    = toreal(ConsumedQuantity),\n            x_CommitmentDiscountCommittedCount  = toreal(x_CommitmentDiscountCommittedCount),\n            x_CommitmentDiscountCommittedAmount = toreal(x_CommitmentDiscountCommittedAmount),\n            x_CommitmentDiscountNormalizedRatio = toreal(x_CommitmentDiscountNormalizedRatio)\n        // Add new columns\n        | lookup kind=leftouter (Services | distinct x_ResourceType, ServiceSubcategory) on x_ResourceType\n        | extend CommitmentDiscountQuantity = ConsumedQuantity * x_CommitmentDiscountNormalizedRatio\n        | extend CommitmentDiscountUnit = case(\n            x_CommitmentDiscountNormalizedRatio == 1, 'Hours',\n            x_CommitmentDiscountNormalizedRatio > 1, 'Normalized Hours',\n            ''\n        )\n    )\n    | project\n        ChargePeriodEnd,\n        ChargePeriodStart,\n        CommitmentDiscountCategory,\n        CommitmentDiscountId,\n        CommitmentDiscountQuantity,\n        CommitmentDiscountType,\n        CommitmentDiscountUnit,\n        ConsumedQuantity,\n        ProviderName,\n        ResourceId,\n        ResourceName,\n        ResourceType,\n        ServiceCategory,\n        ServiceName,\n        ServiceSubcategory,\n        SubAccountId,\n        x_CommitmentDiscountCommittedCount,\n        x_CommitmentDiscountCommittedAmount,\n        x_CommitmentDiscountNormalizedGroup,\n        x_CommitmentDiscountNormalizedRatio,\n        x_IngestionTime,\n        x_ResourceGroupName,\n        x_ResourceType,\n        x_ServiceModel,\n        x_SkuOrderId,\n        x_SkuSize,\n        x_SourceName,\n        x_SourceProvider,\n        x_SourceType,\n        x_SourceVersion\n}\n\n\n// Costs_final_v1_2\n.create-or-alter function\nwith (docstring = 'Gets all cost and usage records aligned to FOCUS 1.2.', folder = 'Costs')\nCosts_v1_2()\n{\n    database('Ingestion').Costs_final_v1_2\n    | union (\n        database('Ingestion').Costs_final_v1_0\n        // Convert decimal to real\n        | extend\n            BilledCost                          = toreal(BilledCost),\n            ConsumedQuantity                    = toreal(ConsumedQuantity),\n            ContractedCost                      = toreal(ContractedCost),\n            ContractedUnitPrice                 = toreal(ContractedUnitPrice),\n            EffectiveCost                       = toreal(EffectiveCost),\n            ListCost                            = toreal(ListCost),\n            ListUnitPrice                       = toreal(ListUnitPrice),\n            PricingQuantity                     = toreal(PricingQuantity),\n            x_BilledCostInUsd                   = toreal(x_BilledCostInUsd),\n            x_BilledUnitPrice                   = toreal(x_BilledUnitPrice),\n            x_BillingExchangeRate               = toreal(x_BillingExchangeRate),\n            x_ContractedCostInUsd               = toreal(x_ContractedCostInUsd),\n            x_CurrencyConversionRate            = toreal(x_CurrencyConversionRate),\n            x_EffectiveCostInUsd                = toreal(x_EffectiveCostInUsd),\n            x_EffectiveUnitPrice                = toreal(x_EffectiveUnitPrice),\n            x_ListCostInUsd                     = toreal(x_ListCostInUsd),\n            x_PricingBlockSize                  = toreal(x_PricingBlockSize)\n        // Rename columns\n        | project-rename\n            InvoiceId = x_InvoiceId,\n            PricingCurrency = x_PricingCurrency,\n            SkuMeter = x_SkuMeterName\n        // Add new columns\n        | lookup kind=leftouter (Services | where isnotempty(x_ResourceType) | summarize take_any(ServiceSubcategory), take_any(x_ServiceModel) by x_ResourceType) on x_ResourceType\n        | extend CapacityReservationId = tostring(x_SkuDetails.VMCapacityReservationId)\n        | extend CapacityReservationStatus = case(\n            isempty(CapacityReservationId), '',\n            tolower(x_ResourceType) == 'microsoft.compute/capacityreservationgroups/capacityreservations', 'Unused',\n            'Used'\n        )\n        | extend x_CommitmentDiscountNormalizedRatio = case(\n            // Not applicable\n            isempty(CommitmentDiscountStatus), real(null),\n            // Parse from SKU details if not specified explicitly\n            toreal(coalesce(x_SkuDetails.RINormalizationRatio, dynamic(1)))\n        )\n        | extend CommitmentDiscountQuantity = case(\n            isempty(CommitmentDiscountStatus), real(null),\n            CommitmentDiscountCategory == 'Spend', EffectiveCost / coalesce(x_BillingExchangeRate, real(1)),\n            CommitmentDiscountCategory == 'Usage' and isnotempty(x_CommitmentDiscountNormalizedRatio), PricingQuantity / coalesce(x_PricingBlockSize, real(1)) * x_CommitmentDiscountNormalizedRatio,\n            real(null)\n        )\n        | extend CommitmentDiscountUnit = case(\n            isempty(CommitmentDiscountQuantity), '',\n            CommitmentDiscountCategory == 'Spend', PricingCurrency,\n            CommitmentDiscountCategory == 'Usage' and x_CommitmentDiscountNormalizedRatio == real(1), ConsumedUnit,\n            CommitmentDiscountCategory == 'Usage' and x_CommitmentDiscountNormalizedRatio > real(1), strcat('Normalized ', ConsumedUnit),\n            ''\n        )\n        | extend x_AmortizationClass = case(\n            ChargeCategory == 'Purchase' and (tolower(ResourceId) contains '/microsoft.capacity/reservationorders/' or tolower(ResourceId) contains '/microsoft.billingbenefits/savingsplanorders/'), 'Principal',\n            ChargeCategory == 'Usage' and isnotempty(CommitmentDiscountId) and isnotempty(CommitmentDiscountStatus), 'Amortized Charge',\n            ''\n        )\n        // Hubs add-ons\n        | extend x_CommitmentDiscountUtilizationPotential = case(\n            ChargeCategory == 'Purchase', real(0),\n            ProviderName == 'Microsoft' and isnotempty(CommitmentDiscountCategory), EffectiveCost,\n            CommitmentDiscountCategory == 'Usage', ConsumedQuantity,\n            CommitmentDiscountCategory == 'Spend', EffectiveCost,\n            real(0)\n        )\n        | extend x_CommitmentDiscountUtilizationAmount = iff(CommitmentDiscountStatus == 'Used', x_CommitmentDiscountUtilizationPotential, real(0))\n        | extend x_SkuCoreCount = toint(coalesce(x_SkuDetails.VCPUs, x_SkuDetails.VCores, x_SkuDetails.vCores))\n        | extend x_SkuInstanceType = tostring(coalesce(x_SkuDetails.ServiceType, x_SkuDetails.ServerSku))\n        | extend x_SkuOperatingSystem = case(\n            x_SkuDetails.ImageType == 'Canonical', 'Linux',\n            x_SkuDetails.ImageType == 'Windows Server BYOL', 'Windows Server',\n            x_SkuMeterSubcategory endswith ' Series Windows', 'Windows Server',\n            x_SkuDetails.ImageType\n        )\n        | extend x_ConsumedCoreHours = iff(ConsumedUnit == 'Hours' and isnotempty(x_SkuCoreCount), x_SkuCoreCount * ConsumedQuantity, real(null))\n        | extend tmp_SqlAhb = tolower(x_SkuDetails.AHB)\n        | extend x_SkuLicenseType = case(\n            x_SkuDetails.ImageType contains 'Windows Server BYOL', 'Windows Server',\n            x_SkuMeterSubcategory == 'SQL Server Azure Hybrid Benefit', 'SQL Server',\n            ''\n        )\n        | extend x_SkuLicenseStatus = case(\n            isnotempty(x_SkuLicenseType) or tmp_SqlAhb == 'true' or (x_SkuMeterSubcategory contains 'Azure Hybrid Benefit'), 'Enabled',\n            (x_SkuMeterSubcategory contains 'Windows') or tmp_SqlAhb == 'false', 'Not enabled',\n            ''\n        )\n        | extend x_SkuLicenseQuantity = case(\n            isempty(x_SkuCoreCount), int(null),\n            x_SkuCoreCount <= 8, int(8),\n            x_SkuCoreCount > 8, x_SkuCoreCount,\n            int(null)\n        )\n        | extend x_SkuLicenseUnit = iff(isnotempty(x_SkuLicenseQuantity), 'Cores', '')\n        | extend x_CommitmentDiscountSavings = iff(ContractedCost < EffectiveCost,  real(0), ContractedCost - EffectiveCost)\n        | extend x_NegotiatedDiscountSavings = iff(ListCost       < ContractedCost, real(0), ListCost - ContractedCost)\n        | extend x_TotalSavings              = iff(ListCost       < EffectiveCost,  real(0), ListCost - EffectiveCost)\n        | extend x_CommitmentDiscountPercent = iff(ContractedUnitPrice == 0,        real(0), (ContractedUnitPrice - x_EffectiveUnitPrice) / ContractedUnitPrice)\n        | extend x_NegotiatedDiscountPercent = iff(ListUnitPrice == 0,              real(0), (ListUnitPrice - ContractedUnitPrice) / ListUnitPrice)\n        | extend x_TotalDiscountPercent      = iff(ListUnitPrice == 0,              real(0), (ListUnitPrice - x_EffectiveUnitPrice) / ListUnitPrice)\n        // SkuPriceDetails conversion -- Must be after hubs add-ons\n        | extend SkuPriceDetails = parse_json(replace_regex(replace_regex(replace_regex(replace_regex(replace_regex(replace_regex(tostring(x_SkuDetails)\n            // Prefix all keys with x_ first to avoid double-prefixing\n            , @'([\\{,])\"', @'\\1\"x_')\n            // CoreCount for number of CPUs/vCPUs/cores/vCores\n            , @'\"x_(VCPUs|VCores|vCores)\":', @'\"CoreCount\":')\n            // TODO: DiskMaxIops for disk I/O operations per second (IOPS)\n            // TODO: DiskSpace for disk size in GiB\n            // TODO: DiskType for the kind of disk (e.g., SSD, HDD, NVMe)\n            // TODO: GpuCount for the number of GPUs\n            // InstanceType for the resource size/SKU (e.g., ArmSkuName)\n            , @'\"x_(ServerSku|ServiceType)\":', @'\"InstanceType\":')\n            // TODO: InstanceSeries for the size family/series\n            // TODO: MemorySize for the RAM in GiB\n            // TODO: NetworkMaxIops for network I/O operations per second (IOPS)\n            // TODO: NetworkMaxThroughput for network max throughput for data transfer in Mbps\n            // OperatingSystem for the OS name\n            , @'(\"x_ImageType\":\"Canonical\")', @'\\1,\"OperatingSystem\":\"Linux\"')\n            , @'(\"x_ImageType\":\"Windows Server( BYOL)?\")', @'\\1,\"OperatingSystem\":\"Windows Server\"')\n            , @'(\"x_ImageType\":(\"[^\"]+\"))', @'\\1,\"OperatingSystem\":\\2')\n            // TODO: Redundancy for the level of redundancy (e.g., Local, Zonal, Global)\n            // TODO: StorageClass for the tier of storage (e.g., Hot, Archive, Nearline)\n        )\n        | extend SkuPriceDetails = iff(isempty(SkuPriceDetails.OperatingSystem) and isnotempty(x_SkuOperatingSystem),\n            parse_json(replace_string(tostring(SkuPriceDetails), '}', strcat(@',\"OperatingSystem\":\"', x_SkuOperatingSystem, '\"}'))),\n            SkuPriceDetails)\n    )\n    | extend SkuPriceDetails = iff(isnotempty(SkuPriceDetails), SkuPriceDetails, parse_json(replace_regex(tostring(x_SkuDetails), @'([\\{,])\"', @'\\1\"x_')))\n    | project\n        AvailabilityZone,\n        BilledCost,\n        BillingAccountId,\n        BillingAccountName,\n        BillingAccountType,\n        BillingCurrency,\n        BillingPeriodEnd,\n        BillingPeriodStart,\n        CapacityReservationId,\n        CapacityReservationStatus,\n        ChargeCategory,\n        ChargeClass,\n        ChargeDescription,\n        ChargeFrequency,\n        ChargePeriodEnd,\n        ChargePeriodStart,\n        CommitmentDiscountCategory,\n        CommitmentDiscountId,\n        CommitmentDiscountName,\n        CommitmentDiscountQuantity,\n        CommitmentDiscountStatus,\n        CommitmentDiscountType,\n        CommitmentDiscountUnit,\n        ConsumedQuantity,\n        ConsumedUnit,\n        ContractedCost,\n        ContractedUnitPrice,\n        EffectiveCost,\n        InvoiceId,\n        InvoiceIssuerName,\n        ListCost,\n        ListUnitPrice,\n        PricingCategory,\n        PricingCurrency,\n        PricingQuantity,\n        PricingUnit,\n        ProviderName,\n        PublisherName,\n        RegionId,\n        RegionName,\n        ResourceId,\n        ResourceName,\n        ResourceType,\n        ServiceCategory,\n        ServiceName,\n        ServiceSubcategory,\n        SkuId,\n        SkuMeter,\n        SkuPriceDetails,\n        SkuPriceId,\n        SubAccountId,\n        SubAccountName,\n        SubAccountType,\n        Tags,\n        x_AccountId,\n        x_AccountName,\n        x_AccountOwnerId,\n        x_AmortizationClass,\n        x_BilledCostInUsd,\n        x_BilledUnitPrice,\n        x_BillingAccountAgreement,\n        x_BillingAccountId,\n        x_BillingAccountName,\n        x_BillingExchangeRate,\n        x_BillingExchangeRateDate,\n        x_BillingItemCode,\n        x_BillingItemName,\n        x_BillingProfileId,\n        x_BillingProfileName,\n        x_ChargeId,\n        x_CommitmentDiscountNormalizedRatio,\n        x_CommitmentDiscountPercent,\n        x_CommitmentDiscountSavings,\n        x_CommitmentDiscountSpendEligibility,\n        x_CommitmentDiscountUsageEligibility,\n        x_CommitmentDiscountUtilizationAmount,\n        x_CommitmentDiscountUtilizationPotential,\n        x_CommodityCode,\n        x_CommodityName,\n        x_ComponentName,\n        x_ComponentType,\n        x_ConsumedCoreHours,\n        x_ContractedCostInUsd,\n        x_CostAllocationRuleName,\n        x_CostCategories,\n        x_CostCenter,\n        x_CostType,\n        x_Credits,\n        x_CurrencyConversionRate,\n        x_CustomerId,\n        x_CustomerName,\n        x_Discount,\n        x_EffectiveCostInUsd,\n        x_EffectiveUnitPrice,\n        x_ExportTime,\n        x_IngestionTime,\n        x_InstanceID,\n        x_InvoiceIssuerId,\n        x_InvoiceSectionId,\n        x_InvoiceSectionName,\n        x_ListCostInUsd,\n        x_Location,\n        x_NegotiatedDiscountPercent,\n        x_NegotiatedDiscountSavings,\n        x_Operation,\n        x_OwnerAccountID,\n        x_PartnerCreditApplied,\n        x_PartnerCreditRate,\n        x_PricingBlockSize,\n        x_PricingSubcategory,\n        x_PricingUnitDescription,\n        x_Project,\n        x_PublisherCategory,\n        x_PublisherId,\n        x_ResellerId,\n        x_ResellerName,\n        x_ResourceGroupName,\n        x_ResourceType,\n        x_ServiceCode,\n        x_ServiceId,\n        x_ServiceModel,\n        x_ServicePeriodEnd,\n        x_ServicePeriodStart,\n        x_SkuCoreCount,\n        x_SkuDescription,\n        x_SkuDetails,\n        x_SkuInstanceType,\n        x_SkuIsCreditEligible,\n        x_SkuLicenseQuantity,\n        x_SkuLicenseStatus,\n        x_SkuLicenseType,\n        x_SkuLicenseUnit,\n        x_SkuMeterCategory,\n        x_SkuMeterId,\n        x_SkuMeterSubcategory,\n        x_SkuOfferId,\n        x_SkuOperatingSystem,\n        x_SkuOrderId,\n        x_SkuOrderName,\n        x_SkuPartNumber,\n        x_SkuPlanName,\n        x_SkuRegion,\n        x_SkuServiceFamily,\n        x_SkuTerm,\n        x_SkuTier,\n        x_SourceChanges,\n        x_SourceName,\n        x_SourceProvider,\n        x_SourceType,\n        x_SourceValues,\n        x_SourceVersion,\n        x_SubproductName,\n        x_TotalDiscountPercent,\n        x_TotalSavings,\n        x_UsageType\n}\n\n\n// Prices_final_v1_2\n.create-or-alter function\nwith (docstring = 'Gets all prices aligned to FOCUS 1.2.', folder = 'Prices')\nPrices_v1_2()\n{\n    database('Ingestion').Prices_final_v1_2\n    | union (\n        database('Ingestion').Prices_final_v1_0\n        // Convert decimal to real\n        | extend\n            ContractedUnitPrice                  = toreal(ContractedUnitPrice),\n            ListUnitPrice                        = toreal(ListUnitPrice),\n            x_BaseUnitPrice                      = toreal(x_BaseUnitPrice),\n            x_ContractedUnitPriceDiscount        = toreal(x_ContractedUnitPriceDiscount),\n            x_ContractedUnitPriceDiscountPercent = toreal(x_ContractedUnitPriceDiscountPercent),\n            x_EffectiveUnitPrice                 = toreal(x_EffectiveUnitPrice),\n            x_EffectiveUnitPriceDiscount         = toreal(x_EffectiveUnitPriceDiscount),\n            x_EffectiveUnitPriceDiscountPercent  = toreal(x_EffectiveUnitPriceDiscountPercent),\n            x_PricingBlockSize                   = toreal(x_PricingBlockSize),\n            x_SkuIncludedQuantity                = toreal(x_SkuIncludedQuantity),\n            x_SkuTier                            = toreal(x_SkuTier),\n            x_TotalUnitPriceDiscount             = toreal(x_TotalUnitPriceDiscount),\n            x_TotalUnitPriceDiscountPercent      = toreal(x_TotalUnitPriceDiscountPercent) \n        // Rename columns\n        | project-rename\n            PricingCurrency = x_PricingCurrency,\n            SkuMeter = x_SkuMeterName\n    )\n    | project\n        BillingAccountId,\n        BillingAccountName,\n        BillingCurrency,\n        ChargeCategory,\n        CommitmentDiscountCategory,\n        CommitmentDiscountType,\n        CommitmentDiscountUnit,\n        ContractedUnitPrice,\n        ListUnitPrice,\n        PricingCategory,\n        PricingCurrency,\n        PricingUnit,\n        SkuId,\n        SkuMeter,\n        SkuPriceId,\n        SkuPriceIdv2,\n        x_BaseUnitPrice,\n        x_BillingAccountAgreement,\n        x_BillingAccountId,\n        x_BillingProfileId,\n        x_CommitmentDiscountNormalizedRatio,\n        x_CommitmentDiscountSpendEligibility,\n        x_CommitmentDiscountUsageEligibility,\n        x_ContractedUnitPriceDiscount,\n        x_ContractedUnitPriceDiscountPercent,\n        x_EffectivePeriodEnd,\n        x_EffectivePeriodStart,\n        x_EffectiveUnitPrice,\n        x_EffectiveUnitPriceDiscount,\n        x_EffectiveUnitPriceDiscountPercent,\n        x_IngestionTime,\n        x_PricingBlockSize,\n        x_PricingSubcategory,\n        x_PricingUnitDescription,\n        x_SkuDescription,\n        x_SkuId,\n        x_SkuIncludedQuantity,\n        x_SkuMeterCategory,\n        x_SkuMeterId,\n        x_SkuMeterSubcategory,\n        x_SkuMeterType,\n        x_SkuPriceType,\n        x_SkuProductId,\n        x_SkuRegion,\n        x_SkuServiceFamily,\n        x_SkuOfferId,\n        x_SkuPartNumber,\n        x_SkuTerm,\n        x_SkuTier,\n        x_SourceName,\n        x_SourceProvider,\n        x_SourceType,\n        x_SourceVersion,\n        x_TotalUnitPriceDiscount,\n        x_TotalUnitPriceDiscountPercent\n}\n\n\n// Recommendations_final_v1_2\n.create-or-alter function\nwith (docstring = 'Gets all recommendations aligned to FOCUS 1.2.', folder = 'Recommendations')\nRecommendations_v1_2()\n{\n    database('Ingestion').Recommendations_final_v1_2\n    | union (\n        database('Ingestion').Recommendations_final_v1_0\n        // Convert decimal to real\n        | extend\n            x_EffectiveCostAfter   = toreal(x_EffectiveCostAfter),\n            x_EffectiveCostBefore  = toreal(x_EffectiveCostBefore),\n            x_EffectiveCostSavings = toreal(x_EffectiveCostSavings)\n    )\n    | project\n        ProviderName,\n        SubAccountId,\n        x_IngestionTime,\n        x_EffectiveCostAfter,\n        x_EffectiveCostBefore,\n        x_EffectiveCostSavings,\n        x_RecommendationDate,\n        x_RecommendationDetails,\n        x_SourceName,\n        x_SourceProvider,\n        x_SourceType,\n        x_SourceVersion\n}\n\n\n// Transactions_final_v1_2\n.create-or-alter function\nwith (docstring = 'Gets all transactions aligned to FOCUS 1.2.', folder = 'Transactions')\nTransactions_v1_2()\n{\n    database('Ingestion').Transactions_final_v1_2\n    | union (\n        database('Ingestion').Transactions_final_v1_0\n        // Convert decimal to real\n        | extend\n            BilledCost           = toreal(BilledCost),\n            PricingQuantity      = toreal(PricingQuantity),\n            x_MonetaryCommitment = toreal(x_MonetaryCommitment),\n            x_Overage            = toreal(x_Overage)\n        // Rename columns\n        | project-rename\n            InvoiceId = x_InvoiceId\n    )\n    | project\n        BilledCost,\n        BillingAccountId,\n        BillingAccountName,\n        BillingCurrency,\n        BillingPeriodEnd,\n        BillingPeriodStart,\n        ChargeCategory,\n        ChargeClass,\n        ChargeDescription,\n        ChargeFrequency,\n        ChargePeriodStart,\n        InvoiceId,\n        PricingQuantity,\n        PricingUnit,\n        ProviderName,\n        RegionId,\n        RegionName,\n        SubAccountId,\n        SubAccountName,\n        x_AccountName,\n        x_AccountOwnerId,\n        x_CostCenter,\n        x_InvoiceNumber,\n        x_InvoiceSectionId,\n        x_InvoiceSectionName,\n        x_IngestionTime,\n        x_MonetaryCommitment,\n        x_Overage,\n        x_PurchasingBillingAccountId,\n        x_SkuOrderId,\n        x_SkuOrderName,\n        x_SkuSize,\n        x_SkuTerm,\n        x_SourceName,\n        x_SourceProvider,\n        x_SourceType,\n        x_SourceVersion,\n        x_SubscriptionId,\n        x_TransactionType\n}\n\n\n//======================================================================================================================\n// Latest FOCUS version\n//======================================================================================================================\n\n.create-or-alter function\nwith (docstring = 'Gets all commitment discount usage records with the latest supported version of the FOCUS schema.', folder = 'CommitmentDiscountUsage')\nCommitmentDiscountUsage()\n{\n    CommitmentDiscountUsage_v1_2()\n}\n\n\n.create-or-alter function\nwith (docstring = 'Gets all cost and usage records with the latest supported version of the FOCUS schema.', folder = 'Costs')\nCosts()\n{\n    Costs_v1_2()\n}\n\n\n.create-or-alter function\nwith (docstring = 'Gets all prices with the latest supported version of the FOCUS schema.', folder = 'Prices')\nPrices()\n{\n    Prices_v1_2()\n}\n\n\n.create-or-alter function\nwith (docstring = 'Gets all recommendations with the latest supported version of the FOCUS schema.', folder = 'Recommendations')\nRecommendations()\n{\n    Recommendations_v1_2()\n}\n\n\n.create-or-alter function\nwith (docstring = 'Gets all transactions with the latest supported version of the FOCUS schema.', folder = 'Transactions')\nTransactions()\n{\n    Transactions_v1_2()\n}\n",
                    "$fxv#15": "// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\n//======================================================================================================================\n// Hub database / Latest FOCUS version functions\n// Used for ad hoc queries.\n//======================================================================================================================\n\n// For allowed commands, see https://learn.microsoft.com/azure/data-explorer/database-script\n\n\n.create-or-alter function\nwith (docstring = 'Gets all commitment discount usage records with the latest supported version of the FOCUS schema.', folder = 'CommitmentDiscountUsage')\nCommitmentDiscountUsage()\n{\n    CommitmentDiscountUsage_v1_2()\n}\n\n\n.create-or-alter function\nwith (docstring = 'Gets all cost and usage records with the latest supported version of the FOCUS schema.', folder = 'Costs')\nCosts()\n{\n    Costs_v1_2()\n}\n\n\n.create-or-alter function\nwith (docstring = 'Gets all prices with the latest supported version of the FOCUS schema.', folder = 'Prices')\nPrices()\n{\n    Prices_v1_2()\n}\n\n\n.create-or-alter function\nwith (docstring = 'Gets all recommendations with the latest supported version of the FOCUS schema.', folder = 'Recommendations')\nRecommendations()\n{\n    Recommendations_v1_2()\n}\n\n\n.create-or-alter function\nwith (docstring = 'Gets all transactions with the latest supported version of the FOCUS schema.', folder = 'Transactions')\nTransactions()\n{\n    Transactions_v1_2()\n}\n",
                    "$fxv#2": "// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\n.create-or-alter function \nwith (docstring = 'Return details about the specified ID.', folder = 'OpenData/Internal')\n_resource_type_2(id: string) {\n    dynamic({\n        \"microsoft.classicstorage/storageaccounts\": { \"SingularDisplayName\": \"Storage account (classic)\" }\n        ,\"microsoft.classicstorage/storageaccounts/disks\": { \"SingularDisplayName\": \"Disk (classic)\" }\n        ,\"microsoft.classicstorage/storageaccounts/osimages\": { \"SingularDisplayName\": \"OS image (classic)\" }\n        ,\"microsoft.classicstorage/storageaccounts/vmimages\": { \"SingularDisplayName\": \"VM image (classic)\" }\n        ,\"microsoft.cleanroom/cleanrooms\": { \"SingularDisplayName\": \"Microsoft.CleanRoom cleanroom\" }\n        ,\"microsoft.cleanroom/collaborations\": { \"SingularDisplayName\": \"Microsoft.CleanRoom collaboration\" }\n        ,\"microsoft.cleanroom/collaborations/contracts\": { \"SingularDisplayName\": \"Microsoft.CleanRoom collaborations contract\" }\n        ,\"microsoft.cleanroom/consortiums\": { \"SingularDisplayName\": \"Microsoft.CleanRoom consortium\" }\n        ,\"microsoft.cleanroom/microservices\": { \"SingularDisplayName\": \"Microsoft.CleanRoom microservice\" }\n        ,\"microsoft.cloud/hubs\": { \"SingularDisplayName\": \"FinOps hub\" }\n        ,\"microsoft.clouddeviceplatform/delegatedidentities\": { \"SingularDisplayName\": \"Microsoft.CloudDevicePlatform delegated identity\" }\n        ,\"microsoft.cloudhealth/healthmodels\": { \"SingularDisplayName\": \"Health Model\" }\n        ,\"microsoft.cloudtest/accounts\": { \"SingularDisplayName\": \"CloudTest Account\" }\n        ,\"microsoft.cloudtest/buildcaches\": { \"SingularDisplayName\": \"1ES Build Cache\" }\n        ,\"microsoft.cloudtest/hostedpools\": { \"SingularDisplayName\": \"1ES Hosted Pool\" }\n        ,\"microsoft.cloudtest/images\": { \"SingularDisplayName\": \"1ES Image\" }\n        ,\"microsoft.cloudtest/pools\": { \"SingularDisplayName\": \"CloudTest Pool\" }\n        ,\"microsoft.clusterstor/nodes\": { \"SingularDisplayName\": \"ClusterStor\" }\n        ,\"microsoft.codesigning/codesigningaccounts\": { \"SingularDisplayName\": \"Trusted Signing Account\" }\n        ,\"microsoft.codespaces/plans\": { \"SingularDisplayName\": \"Microsoft.Codespaces plan\" }\n        ,\"microsoft.cognitiveservices/accounts\": { \"SingularDisplayName\": \"Azure AI Foundry\" }\n        ,\"microsoft.cognitiveservices/accounts/projects\": { \"SingularDisplayName\": \"Azure AI Foundry project\" }\n        ,\"microsoft.cognitiveservices/commitmentplans\": { \"SingularDisplayName\": \"Microsoft.CognitiveServices commitment plan\" }\n        ,\"microsoft.cognitiveservices/commitmentplans/accountassociations\": { \"SingularDisplayName\": \"Microsoft.CognitiveServices commitment plans account association\" }\n        ,\"microsoft.communication/communicationservices\": { \"SingularDisplayName\": \"Communication Service\" }\n        ,\"microsoft.communication/emailservices\": { \"SingularDisplayName\": \"Email Communication Service\" }\n        ,\"microsoft.communication/emailservices/domains\": { \"SingularDisplayName\": \"Email Communication Services Domain\" }\n        ,\"microsoft.community/communitytrainings\": { \"SingularDisplayName\": \"Community Training\" }\n        ,\"microsoft.compositesolutions/compositesolutiondefinitions\": { \"SingularDisplayName\": \"Microsoft.CompositeSolutions composite solution definition\" }\n        ,\"microsoft.compositesolutions/compositesolutions\": { \"SingularDisplayName\": \"Microsoft.CompositeSolutions composite solution\" }\n        ,\"microsoft.compute/availabilitysets\": { \"SingularDisplayName\": \"Availability set\" }\n        ,\"microsoft.compute/capacityreservationgroups\": { \"SingularDisplayName\": \"Capacity Reservation Group\" }\n        ,\"microsoft.compute/capacityreservationgroups/capacityreservations\": { \"SingularDisplayName\": \"Capacity reservation\" }\n        ,\"microsoft.compute/capacityreservationgroupscomputehub\": { \"SingularDisplayName\": \"Capacity Reservation Group\" }\n        ,\"microsoft.compute/cloudservices\": { \"SingularDisplayName\": \"Cloud service (extended support)\" }\n        ,\"microsoft.compute/computefleetinstances\": { \"SingularDisplayName\": \"Instance\" }\n        ,\"microsoft.compute/computefleetscalesets\": { \"SingularDisplayName\": \"Virtual machine scale set\" }\n        ,\"microsoft.compute/diskaccesses\": { \"SingularDisplayName\": \"Disk Access\" }\n        ,\"microsoft.compute/diskencryptionsets\": { \"SingularDisplayName\": \"Disk Encryption Set\" }\n        ,\"microsoft.compute/disks\": { \"SingularDisplayName\": \"Disk\" }\n        ,\"microsoft.compute/galleries\": { \"SingularDisplayName\": \"Azure compute gallery\" }\n        ,\"microsoft.compute/galleries/applications\": { \"SingularDisplayName\": \"VM application definition\" }\n        ,\"microsoft.compute/galleries/applications/versions\": { \"SingularDisplayName\": \"VM application version\" }\n        ,\"microsoft.compute/galleries/images\": { \"SingularDisplayName\": \"VM image definition\" }\n        ,\"microsoft.compute/galleries/images/versions\": { \"SingularDisplayName\": \"VM image version\" }\n        ,\"microsoft.compute/galleries/imagescomputehub\": { \"SingularDisplayName\": \"VM image definition\" }\n        ,\"microsoft.compute/hostgroups\": { \"SingularDisplayName\": \"Host group\" }\n        ,\"microsoft.compute/hostgroups/hosts\": { \"SingularDisplayName\": \"Host\" }\n        ,\"microsoft.compute/hostgroupscomputehub\": { \"SingularDisplayName\": \"Host group\" }\n        ,\"microsoft.compute/images\": { \"SingularDisplayName\": \"Image\" }\n        ,\"microsoft.compute/imagescomputehub\": { \"SingularDisplayName\": \"Image\" }\n        ,\"microsoft.compute/locations/communitygalleries/images\": { \"SingularDisplayName\": \"Community image\" }\n        ,\"microsoft.compute/locations/communitygalleries/imagescomputehub\": { \"SingularDisplayName\": \"Community image\" }\n        ,\"microsoft.compute/proximityplacementgroups\": { \"SingularDisplayName\": \"Proximity placement group\" }\n        ,\"microsoft.compute/proximityplacementgroupscomputehub\": { \"SingularDisplayName\": \"Proximity placement group\" }\n        ,\"microsoft.compute/restorepointcollections\": { \"SingularDisplayName\": \"Restore Point Collection\" }\n        ,\"microsoft.compute/restorepointcollections/restorepoints\": { \"SingularDisplayName\": \"Restore Point\" }\n        ,\"microsoft.compute/snapshots\": { \"SingularDisplayName\": \"Snapshot\" }\n        ,\"microsoft.compute/sshpublickeys\": { \"SingularDisplayName\": \"SSH key\" }\n        ,\"microsoft.compute/standbypoolinstance\": { \"SingularDisplayName\": \"Standby pool\" }\n        ,\"microsoft.compute/virtualmachinecomputehub\": { \"SingularDisplayName\": \"Virtual machine\" }\n        ,\"microsoft.compute/virtualmachineflexinstances\": { \"SingularDisplayName\": \"Instance\" }\n        ,\"microsoft.compute/virtualmachines\": { \"SingularDisplayName\": \"Virtual machine\" }\n        ,\"microsoft.compute/virtualmachines/providers/guestconfigurationassignments\": { \"SingularDisplayName\": \"Guest Assignment\" }\n        ,\"microsoft.compute/virtualmachinescalesets\": { \"SingularDisplayName\": \"Virtual machine scale set\" }\n        ,\"microsoft.compute/virtualmachinescalesets/providers/guestconfigurationassignments\": { \"SingularDisplayName\": \"Guest Assignment\" }\n        ,\"microsoft.compute/virtualmachinescalesets/virtualmachines\": { \"SingularDisplayName\": \"Virtual machine scale set instance\" }\n        ,\"microsoft.compute/virtualmachinescalesets/virtualmachines/networkinterfaces/ipconfigurations/publicipaddresses\": { \"SingularDisplayName\": \"Public IP address\" }\n        ,\"microsoft.compute/virtualmachinescalesetscomputehub\": { \"SingularDisplayName\": \"Virtual machine scale set\" }\n        ,\"microsoft.computehub/advisorcost\": { \"SingularDisplayName\": \"Recommendations\" }\n        ,\"microsoft.computehub/advisoroperationalexcellence\": { \"SingularDisplayName\": \"Recommendations\" }\n        ,\"microsoft.computehub/advisorperformance\": { \"SingularDisplayName\": \"Recommendations\" }\n        ,\"microsoft.computehub/advisorreliability\": { \"SingularDisplayName\": \"Recommendations\" }\n        ,\"microsoft.computehub/advisorsecurity\": { \"SingularDisplayName\": \"Recommendations\" }\n        ,\"microsoft.computehub/all\": { \"SingularDisplayName\": \"All resources\" }\n        ,\"microsoft.computehub/backup\": { \"SingularDisplayName\": \"Backup job\" }\n        ,\"microsoft.computehub/computehubmain\": { \"SingularDisplayName\": \"Compute infrastructure\" }\n        ,\"microsoft.computehub/healthevents\": { \"SingularDisplayName\": \"Health events\" }\n        ,\"microsoft.computehub/linuxostype\": { \"SingularDisplayName\": \"Linux OS\" }\n        ,\"microsoft.computehub/microsoftdefenderfreetrialsubscription\": { \"SingularDisplayName\": \"Microsoft defender\" }\n        ,\"microsoft.computehub/microsoftdefenderstandardsubscription\": { \"SingularDisplayName\": \"Microsoft defender\" }\n        ,\"microsoft.computehub/outages\": { \"SingularDisplayName\": \"Outages\" }\n        ,\"microsoft.computehub/powerstatedeallocated\": { \"SingularDisplayName\": \"Power states\" }\n        ,\"microsoft.computehub/powerstaterunning\": { \"SingularDisplayName\": \"Power states\" }\n        ,\"microsoft.computehub/powerstatestopped\": { \"SingularDisplayName\": \"Power states\" }\n        ,\"microsoft.computehub/provisioningstatefailedresources\": { \"SingularDisplayName\": \"Provisioning states\" }\n        ,\"microsoft.computehub/provisioningstatesucceededresources\": { \"SingularDisplayName\": \"Provisioning states\" }\n        ,\"microsoft.computehub/windowsostype\": { \"SingularDisplayName\": \"Windows OS\" }\n        ,\"microsoft.computeschedule/autoactions\": { \"SingularDisplayName\": \"Automatic Action\" }\n        ,\"microsoft.computeschedule/autoactions/occurrences\": { \"SingularDisplayName\": \"Microsoft.ComputeSchedule auto actions occurrence\" }\n        ,\"microsoft.confidentialledger/ledgers\": { \"SingularDisplayName\": \"Confidential Ledger\" }\n        ,\"microsoft.confidentialledger/managedccfs\": { \"SingularDisplayName\": \"Managed CCF App\" }\n        ,\"microsoft.confluent/agreements\": { \"SingularDisplayName\": \"Microsoft.Confluent agreement\" }\n        ,\"microsoft.confluent/organizations\": { \"SingularDisplayName\": \"Confluent organization\" }\n        ,\"microsoft.connectedcache/cachenodes\": { \"SingularDisplayName\": \"Connected Cache for ISP\" }\n        ,\"microsoft.connectedcache/enterprisecustomers\": { \"SingularDisplayName\": \"Connected Cache for Enterprise & Education\" }\n        ,\"microsoft.connectedcache/enterprisemcccustomers\": { \"SingularDisplayName\": \"Connected Cache for Enterprise & Education\" }\n        ,\"microsoft.connectedcache/enterprisemcccustomers/enterprisemcccachenodes\": { \"SingularDisplayName\": \"MCC CacheNode for Enterprise\" }\n        ,\"microsoft.connectedcache/ispcustomers\": { \"SingularDisplayName\": \"Connected Cache for ISP\" }\n        ,\"microsoft.connectedcredentials/credentials\": { \"SingularDisplayName\": \"Microsoft.ConnectedCredentials credential\" }\n        ,\"microsoft.connectedvehicle/platformaccounts\": { \"SingularDisplayName\": \"Microsoft.ConnectedVehicle platform account\" }\n        ,\"microsoft.connectedvmwarevsphere/clusters\": { \"SingularDisplayName\": \"Microsoft.ConnectedVMwarevSphere cluster\" }\n        ,\"microsoft.connectedvmwarevsphere/datastores\": { \"SingularDisplayName\": \"Microsoft.ConnectedVMwarevSphere datastore\" }\n        ,\"microsoft.connectedvmwarevsphere/hosts\": { \"SingularDisplayName\": \"Microsoft.ConnectedVMwarevSphere host\" }\n        ,\"microsoft.connectedvmwarevsphere/resourcepools\": { \"SingularDisplayName\": \"Microsoft.ConnectedVMwarevSphere resource pool\" }\n        ,\"microsoft.connectedvmwarevsphere/vcenters\": { \"SingularDisplayName\": \"VMware vCenter\" }\n        ,\"microsoft.connectedvmwarevsphere/virtualmachineinstances\": { \"SingularDisplayName\": \"Microsoft.ConnectedVMwarevSphere virtual machine instance\" }\n        ,\"microsoft.connectedvmwarevsphere/virtualmachineinstances/guestagents\": { \"SingularDisplayName\": \"Microsoft.ConnectedVMwarevSphere virtual machine instances guest agent\" }\n        ,\"microsoft.connectedvmwarevsphere/virtualmachineinstances/hybrididentitymetadata\": { \"SingularDisplayName\": \"Microsoft.ConnectedVMwarevSphere virtual machine instances hybrid identity metadata\" }\n        ,\"microsoft.connectedvmwarevsphere/virtualmachines\": { \"SingularDisplayName\": \"VMware + AVS virtual machine\" }\n        ,\"microsoft.connectedvmwarevsphere/virtualmachines/providers/guestconfigurationassignments\": { \"SingularDisplayName\": \"Guest Assignment\" }\n        ,\"microsoft.connectedvmwarevsphere/virtualmachinetemplates\": { \"SingularDisplayName\": \"Microsoft.ConnectedVMwarevSphere virtual machine template\" }\n        ,\"microsoft.connectedvmwarevsphere/virtualnetworks\": { \"SingularDisplayName\": \"Microsoft.ConnectedVMwarevSphere virtual network\" }\n        ,\"microsoft.consumption/budgets\": { \"SingularDisplayName\": \"Microsoft.Consumption budget\" }\n        ,\"microsoft.consumption/credits\": { \"SingularDisplayName\": \"Microsoft.Consumption credit\" }\n        ,\"microsoft.consumption/pricesheets\": { \"SingularDisplayName\": \"Microsoft.Consumption pricesheet\" }\n        ,\"microsoft.containerinstance/containergroupprofiles\": { \"SingularDisplayName\": \"Microsoft.ContainerInstance container group profile\" }\n        ,\"microsoft.containerinstance/containergroupprofiles/revisions\": { \"SingularDisplayName\": \"Microsoft.ContainerInstance container group profiles revision\" }\n        ,\"microsoft.containerinstance/containergroups\": { \"SingularDisplayName\": \"Container instances\" }\n        ,\"microsoft.containerinstance/ngroups\": { \"SingularDisplayName\": \"Microsoft.ContainerInstance ngroup\" }\n        ,\"microsoft.containerregistry/registries\": { \"SingularDisplayName\": \"Container registry\" }\n        ,\"microsoft.containerregistry/registries/replications\": { \"SingularDisplayName\": \"Container registry replication\" }\n        ,\"microsoft.containerregistry/registries/scopemaps\": { \"SingularDisplayName\": \"Container registry scope map\" }\n        ,\"microsoft.containerregistry/registries/tokens\": { \"SingularDisplayName\": \"Container registry token\" }\n        ,\"microsoft.containerregistry/registries/webhooks\": { \"SingularDisplayName\": \"Container registry webhook\" }\n        ,\"microsoft.containerservice/fleets\": { \"SingularDisplayName\": \"Kubernetes fleet manager\" }\n        ,\"microsoft.containerservice/managedclusters\": { \"SingularDisplayName\": \"Kubernetes service\" }\n        ,\"microsoft.containerservice/managedclusters/managednamespaces\": { \"SingularDisplayName\": \"Managed namespace\" }\n        ,\"microsoft.containerservice/managedclusters/microsoft.kubernetesconfiguration/extensions\": { \"SingularDisplayName\": \"Kubernetes service extension\" }\n        ,\"microsoft.containerservice/managedclusters/microsoft.kubernetesconfiguration/fluxconfigurations\": { \"SingularDisplayName\": \"GitOps configuration\" }\n        ,\"microsoft.containerservice/managedclusters/microsoft.kubernetesconfiguration/namespaces\": { \"SingularDisplayName\": \"Kubernetes namespace\" }\n        ,\"microsoft.containerservice/managedclusters/namespaces\": { \"SingularDisplayName\": \"Managed namespace\" }\n        ,\"microsoft.containerservice/managedclustersnapshots\": { \"SingularDisplayName\": \"Microsoft.ContainerService managedclustersnapshot\" }\n        ,\"microsoft.containerservice/snapshots\": { \"SingularDisplayName\": \"Microsoft.ContainerService snapshot\" }\n        ,\"microsoft.containerstorage/pools\": { \"SingularDisplayName\": \"Container storage\" }\n        ,\"microsoft.costmanagement/alerts\": { \"SingularDisplayName\": \"Microsoft.CostManagement alert\" }\n        ,\"microsoft.costmanagement/budgets\": { \"SingularDisplayName\": \"Microsoft.CostManagement budget\" }\n        ,\"microsoft.costmanagement/cloudconnectors\": { \"SingularDisplayName\": \"Microsoft.CostManagement cloud connector\" }\n        ,\"microsoft.costmanagement/connectors\": { \"SingularDisplayName\": \"Microsoft.CostManagement connector\" }\n        ,\"microsoft.costmanagement/costallocationrules\": { \"SingularDisplayName\": \"Microsoft.CostManagement cost allocation rule\" }\n        ,\"microsoft.costmanagement/costdetailsoperationresults\": { \"SingularDisplayName\": \"Microsoft.CostManagement cost details operation result\" }\n        ,\"microsoft.costmanagement/exports\": { \"SingularDisplayName\": \"Microsoft.CostManagement export\" }\n        ,\"microsoft.costmanagement/externalbillingaccounts\": { \"SingularDisplayName\": \"Microsoft.CostManagement external billing account\" }\n        ,\"microsoft.costmanagement/externalsubscriptions\": { \"SingularDisplayName\": \"Microsoft.CostManagement external subscription\" }\n        ,\"microsoft.costmanagement/markuprules\": { \"SingularDisplayName\": \"Microsoft.CostManagement markup rule\" }\n        ,\"microsoft.costmanagement/operationstatus\": { \"SingularDisplayName\": \"Microsoft.CostManagement operation statu\" }\n        ,\"microsoft.costmanagement/reportconfigs\": { \"SingularDisplayName\": \"Microsoft.CostManagement reportconfig\" }\n        ,\"microsoft.costmanagement/reports\": { \"SingularDisplayName\": \"Microsoft.CostManagement report\" }\n        ,\"microsoft.costmanagement/scheduledactions\": { \"SingularDisplayName\": \"Microsoft.CostManagement scheduled action\" }\n        ,\"microsoft.costmanagement/settings\": { \"SingularDisplayName\": \"Microsoft.CostManagement setting\" }\n        ,\"microsoft.costmanagement/views\": { \"SingularDisplayName\": \"Microsoft.CostManagement view\" }\n        ,\"microsoft.customerlockbox/requests\": { \"SingularDisplayName\": \"Microsoft.CustomerLockbox request\" }\n        ,\"microsoft.customerlockbox/tenantoptedin\": { \"SingularDisplayName\": \"Microsoft.CustomerLockbox tenant opted in\" }\n        ,\"microsoft.customproviders/associations\": { \"SingularDisplayName\": \"Microsoft.CustomProviders association\" }\n        ,\"microsoft.customproviders/resourceproviders\": { \"SingularDisplayName\": \"Microsoft.CustomProviders resource provider\" }\n        ,\"microsoft.dashboard/dashboards\": { \"SingularDisplayName\": \"Azure Monitor dashboards with Grafana\" }\n        ,\"microsoft.dashboard/grafana\": { \"SingularDisplayName\": \"Azure Managed Grafana\" }\n        ,\"microsoft.dataaccelerator/indexclusters\": { \"SingularDisplayName\": \"Microsoft.DataAccelerator index cluster\" }\n        ,\"microsoft.databasefleetmanager/fleets\": { \"SingularDisplayName\": \"Database fleet manager\" }\n        ,\"microsoft.databasefleetmanager/fleets/fleetspaces\": { \"SingularDisplayName\": \"Fleetspaces\" }\n        ,\"microsoft.databasefleetmanager/fleets/fleetspaces/databases\": { \"SingularDisplayName\": \"Fleet managed database\" }\n        ,\"microsoft.databasefleetmanager/fleets/tiers\": { \"SingularDisplayName\": \"tier\" }\n        ,\"microsoft.databasewatcher/watchers\": { \"SingularDisplayName\": \"Database watcher\" }\n        ,\"microsoft.databox/jobs\": { \"SingularDisplayName\": \"Azure Data Box\" }\n        ,\"microsoft.databoxedge/databoxedgedevices\": { \"SingularDisplayName\": \"Azure Stack Edge / Data Box Gateway\" }\n        ,\"microsoft.databricks/accessconnectors\": { \"SingularDisplayName\": \"Access Connector for Azure Databricks\" }\n        ,\"microsoft.databricks/workspaces\": { \"SingularDisplayName\": \"Azure Databricks Service\" }\n        ,\"microsoft.datacatalog/catalogs\": { \"SingularDisplayName\": \"Data catalog\" }\n        ,\"microsoft.datacollaboration/workspaces\": { \"SingularDisplayName\": \"Project CI\" }\n        ,\"microsoft.datadog/agreements\": { \"SingularDisplayName\": \"Microsoft.Datadog agreement\" }\n        ,\"microsoft.datadog/monitors\": { \"SingularDisplayName\": \"Datadog\" }\n        ,\"microsoft.datadog/subscriptionstatuses\": { \"SingularDisplayName\": \"Microsoft.Datadog subscription statuse\" }\n        ,\"microsoft.datafactory/datafactories\": { \"SingularDisplayName\": \"Data factory\" }\n        ,\"microsoft.datafactory/factories\": { \"SingularDisplayName\": \"Data factory (V2)\" }\n        ,\"microsoft.datafactory/factories/pipelines\": { \"SingularDisplayName\": \"Data Factory pipeline\" }\n        ,\"microsoft.datafactory/factories/triggers\": { \"SingularDisplayName\": \"Data Factory trigger\" }\n        ,\"microsoft.datalakeanalytics/accounts\": { \"SingularDisplayName\": \"Data Lake Analytics account\" }\n        ,\"microsoft.datalakestore/accounts\": { \"SingularDisplayName\": \"Data Lake Storage Gen1\" }\n        ,\"microsoft.datamigration/databasemigrations\": { \"SingularDisplayName\": \"Microsoft.DataMigration database migration\" }\n        ,\"microsoft.datamigration/migrationservices\": { \"SingularDisplayName\": \"Microsoft.DataMigration migration service\" }\n        ,\"microsoft.datamigration/services\": { \"SingularDisplayName\": \"Azure Database Migration Service (classic)\" }\n        ,\"microsoft.datamigration/services/projects\": { \"SingularDisplayName\": \"Azure Database Migration Project\" }\n        ,\"microsoft.datamigration/sqlmigrationservices\": { \"SingularDisplayName\": \"Azure Database Migration Service\" }\n        ,\"microsoft.dataprotection/backupvaults\": { \"SingularDisplayName\": \"Backup vault\" }\n        ,\"microsoft.dataprotection/resourceguards\": { \"SingularDisplayName\": \"Resource Guard\" }\n        ,\"microsoft.datareplication/replicationfabrics\": { \"SingularDisplayName\": \"Microsoft.DataReplication replication fabric\" }\n        ,\"microsoft.datareplication/replicationfabrics/fabricagents\": { \"SingularDisplayName\": \"Microsoft.DataReplication replication fabrics fabric agent\" }\n        ,\"microsoft.datareplication/replicationfabrics/fabricagents/operations\": { \"SingularDisplayName\": \"Microsoft.DataReplication replication fabrics fabric agents operation\" }\n        ,\"microsoft.datareplication/replicationfabrics/operations\": { \"SingularDisplayName\": \"Microsoft.DataReplication replication fabrics operation\" }\n        ,\"microsoft.datareplication/replicationvaults\": { \"SingularDisplayName\": \"Data replication vault\" }\n        ,\"microsoft.datareplication/replicationvaults/alertsettings\": { \"SingularDisplayName\": \"Microsoft.DataReplication replication vaults alert setting\" }\n        ,\"microsoft.datareplication/replicationvaults/events\": { \"SingularDisplayName\": \"Microsoft.DataReplication replication vaults event\" }\n        ,\"microsoft.datareplication/replicationvaults/jobs\": { \"SingularDisplayName\": \"Microsoft.DataReplication replication vaults job\" }\n        ,\"microsoft.datareplication/replicationvaults/jobs/operations\": { \"SingularDisplayName\": \"Microsoft.DataReplication replication vaults jobs operation\" }\n        ,\"microsoft.datareplication/replicationvaults/operations\": { \"SingularDisplayName\": \"Microsoft.DataReplication replication vaults operation\" }\n        ,\"microsoft.datareplication/replicationvaults/privateendpointconnectionproxies\": { \"SingularDisplayName\": \"Microsoft.DataReplication replication vaults private endpoint connection proxy\" }\n        ,\"microsoft.datareplication/replicationvaults/privateendpointconnections\": { \"SingularDisplayName\": \"Microsoft.DataReplication replication vaults private endpoint connection\" }\n        ,\"microsoft.datareplication/replicationvaults/privatelinkresources\": { \"SingularDisplayName\": \"Microsoft.DataReplication replication vaults private link resource\" }\n        ,\"microsoft.datareplication/replicationvaults/protecteditems\": { \"SingularDisplayName\": \"Microsoft.DataReplication replication vaults protected item\" }\n        ,\"microsoft.datareplication/replicationvaults/protecteditems/operations\": { \"SingularDisplayName\": \"Microsoft.DataReplication replication vaults protected items operation\" }\n        ,\"microsoft.datareplication/replicationvaults/protecteditems/recoverypoints\": { \"SingularDisplayName\": \"Microsoft.DataReplication replication vaults protected items recovery point\" }\n        ,\"microsoft.datareplication/replicationvaults/replicationextensions\": { \"SingularDisplayName\": \"Microsoft.DataReplication replication vaults replication extension\" }\n        ,\"microsoft.datareplication/replicationvaults/replicationextensions/operations\": { \"SingularDisplayName\": \"Microsoft.DataReplication replication vaults replication extensions operation\" }\n        ,\"microsoft.datareplication/replicationvaults/replicationpolicies\": { \"SingularDisplayName\": \"Microsoft.DataReplication replication vaults replication policy\" }\n        ,\"microsoft.datareplication/replicationvaults/replicationpolicies/operations\": { \"SingularDisplayName\": \"Microsoft.DataReplication replication vaults replication policies operation\" }\n        ,\"microsoft.datashare/accounts\": { \"SingularDisplayName\": \"Data Share\" }\n        ,\"microsoft.dbformariadb/servers\": { \"SingularDisplayName\": \"Azure Database for MariaDB server\" }\n        ,\"microsoft.dbformysql/flexibleservers\": { \"SingularDisplayName\": \"Azure Database for MySQL flexible server\" }\n        ,\"microsoft.dbformysql/servers\": { \"SingularDisplayName\": \"MySQL server\" }\n        ,\"microsoft.dbforpostgresql/flexibleservers\": { \"SingularDisplayName\": \"Azure Database for PostgreSQL flexible server\" }\n        ,\"microsoft.dbforpostgresql/servergroupsv2\": { \"SingularDisplayName\": \"Azure Cosmos DB for PostgreSQL Cluster\" }\n        ,\"microsoft.dbforpostgresql/servers\": { \"SingularDisplayName\": \"PostgreSQL server\" }\n        ,\"microsoft.delegatednetwork/controller\": { \"SingularDisplayName\": \"Microsoft.DelegatedNetwork controller\" }\n        ,\"microsoft.delegatednetwork/delegatedsubnets\": { \"SingularDisplayName\": \"Microsoft.DelegatedNetwork delegated subnet\" }\n        ,\"microsoft.delegatednetwork/orchestrators\": { \"SingularDisplayName\": \"Microsoft.DelegatedNetwork orchestrator\" }\n        ,\"microsoft.dependencymap/maps\": { \"SingularDisplayName\": \"Microsoft.DependencyMap map\" }\n        ,\"microsoft.dependencymap/maps/discoverysources\": { \"SingularDisplayName\": \"Microsoft.DependencyMap maps discovery source\" }\n        ,\"microsoft.deploymentmanager/artifactsources\": { \"SingularDisplayName\": \"Microsoft.DeploymentManager artifact source\" }\n        ,\"microsoft.deploymentmanager/rollouts\": { \"SingularDisplayName\": \"Rollout\" }\n        ,\"microsoft.deploymentmanager/servicetopologies\": { \"SingularDisplayName\": \"Microsoft.DeploymentManager service topology\" }\n        ,\"microsoft.deploymentmanager/servicetopologies/services\": { \"SingularDisplayName\": \"Microsoft.DeploymentManager service topologies service\" }\n        ,\"microsoft.deploymentmanager/servicetopologies/services/serviceunits\": { \"SingularDisplayName\": \"Microsoft.DeploymentManager service topologies services service unit\" }\n        ,\"microsoft.deploymentmanager/steps\": { \"SingularDisplayName\": \"Microsoft.DeploymentManager step\" }\n        ,\"microsoft.desktopvirtualization/appattachpackages\": { \"SingularDisplayName\": \"App attach package\" }\n        ,\"microsoft.desktopvirtualization/applicationgroups\": { \"SingularDisplayName\": \"Application group\" }\n        ,\"microsoft.desktopvirtualization/hostpools\": { \"SingularDisplayName\": \"Host pool\" }\n        ,\"microsoft.desktopvirtualization/scalingplans\": { \"SingularDisplayName\": \"Scaling plan\" }\n        ,\"microsoft.desktopvirtualization/workspaces\": { \"SingularDisplayName\": \"Workspace\" }\n        ,\"microsoft.devai/instances\": { \"SingularDisplayName\": \"Microsoft.DevAI instance\" }\n        ,\"microsoft.devai/instances/experiments\": { \"SingularDisplayName\": \"Microsoft.DevAI instances experiment\" }\n        ,\"microsoft.devai/instances/sandboxes\": { \"SingularDisplayName\": \"Microsoft.DevAI instances sandbox\" }\n        ,\"microsoft.devai/instances/sandboxes/experiments\": { \"SingularDisplayName\": \"Microsoft.DevAI instances sandboxes experiment\" }\n        ,\"microsoft.devcenter/devcenters\": { \"SingularDisplayName\": \"Dev center\" }\n        ,\"microsoft.devcenter/devcenters/devboxdefinitions\": { \"SingularDisplayName\": \"Dev Box definition\" }\n        ,\"microsoft.devcenter/networkconnections\": { \"SingularDisplayName\": \"Network connection\" }\n        ,\"microsoft.devcenter/plans\": { \"SingularDisplayName\": \"Dev center plan\" }\n        ,\"microsoft.devcenter/projects\": { \"SingularDisplayName\": \"Project\" }\n        ,\"microsoft.devcenter/projects/pools\": { \"SingularDisplayName\": \"Pool\" }\n        ,\"microsoft.developmentwindows365/developmentcloudpcdelegatedmsis\": { \"SingularDisplayName\": \"Microsoft.DevelopmentWindows365 development cloud pc delegated msi\" }\n        ,\"microsoft.devhub/iacprofiles\": { \"SingularDisplayName\": \"Infrastructure as Code Automation\" }\n        ,\"microsoft.devhub/templates\": { \"SingularDisplayName\": \"Microsoft.DevHub template\" }\n        ,\"microsoft.devhub/templates/versions\": { \"SingularDisplayName\": \"Microsoft.DevHub templates version\" }\n        ,\"microsoft.devhub/workflows\": { \"SingularDisplayName\": \"Microsoft.DevHub workflow\" }\n        ,\"microsoft.deviceonboarding/discoveryservices\": { \"SingularDisplayName\": \"Microsoft.DeviceOnboarding discovery service\" }\n        ,\"microsoft.deviceonboarding/discoveryservices/ownershipvoucherpublickeys\": { \"SingularDisplayName\": \"Microsoft.DeviceOnboarding discovery services ownership voucher public key\" }\n        ,\"microsoft.deviceonboarding/onboardingservices\": { \"SingularDisplayName\": \"Microsoft.DeviceOnboarding onboarding service\" }\n        ,\"microsoft.deviceonboarding/onboardingservices/policies\": { \"SingularDisplayName\": \"Microsoft.DeviceOnboarding onboarding services policy\" }\n        ,\"microsoft.deviceregistry/assetendpointprofiles\": { \"SingularDisplayName\": \"IoT Asset Endpoint Profile\" }\n        ,\"microsoft.deviceregistry/assets\": { \"SingularDisplayName\": \"IoT Asset\" }\n        ,\"microsoft.deviceregistry/billingcontainers\": { \"SingularDisplayName\": \"Microsoft.DeviceRegistry billing container\" }\n        ,\"microsoft.deviceregistry/devices\": { \"SingularDisplayName\": \"IoT Device\" }\n        ,\"microsoft.deviceregistry/discoveredassetendpointprofiles\": { \"SingularDisplayName\": \"Microsoft.DeviceRegistry discovered asset endpoint profile\" }\n        ,\"microsoft.deviceregistry/discoveredassets\": { \"SingularDisplayName\": \"Microsoft.DeviceRegistry discovered asset\" }\n        ,\"microsoft.deviceregistry/namespaces\": { \"SingularDisplayName\": \"Microsoft.DeviceRegistry namespace\" }\n        ,\"microsoft.deviceregistry/namespaces/assetendpointprofiles\": { \"SingularDisplayName\": \"Microsoft.DeviceRegistry namespaces asset endpoint profile\" }\n        ,\"microsoft.deviceregistry/namespaces/assets\": { \"SingularDisplayName\": \"Microsoft.DeviceRegistry namespaces asset\" }\n        ,\"microsoft.deviceregistry/namespaces/devices\": { \"SingularDisplayName\": \"Microsoft.DeviceRegistry namespaces device\" }\n        ,\"microsoft.deviceregistry/namespaces/discoveredassetendpointprofiles\": { \"SingularDisplayName\": \"Microsoft.DeviceRegistry namespaces discovered asset endpoint profile\" }\n        ,\"microsoft.deviceregistry/namespaces/discoveredassets\": { \"SingularDisplayName\": \"Microsoft.DeviceRegistry namespaces discovered asset\" }\n        ,\"microsoft.deviceregistry/schemaregistries\": { \"SingularDisplayName\": \"IoT Schema Registry\" }\n        ,\"microsoft.deviceregistry/schemaregistries/schemas\": { \"SingularDisplayName\": \"Microsoft.DeviceRegistry schema registries schema\" }\n        ,\"microsoft.deviceregistry/schemaregistries/schemas/schemaversions\": { \"SingularDisplayName\": \"Microsoft.DeviceRegistry schema registries schemas schema version\" }\n        ,\"microsoft.devices/iothubs\": { \"SingularDisplayName\": \"IoT hub\" }\n        ,\"microsoft.devices/provisioningservices\": { \"SingularDisplayName\": \"Azure IoT Hub Device Provisioning Service (DPS)\" }\n        ,\"microsoft.deviceupdate/accounts\": { \"SingularDisplayName\": \"Device Update for IoT Hub\" }\n        ,\"microsoft.deviceupdate/updateaccounts\": { \"SingularDisplayName\": \"Device Update Account\" }\n        ,\"microsoft.deviceupdate/updateaccounts/activedeployments\": { \"SingularDisplayName\": \"Device Update Active Deployment\" }\n        ,\"microsoft.deviceupdate/updateaccounts/agents\": { \"SingularDisplayName\": \"Device Update Agent\" }\n        ,\"microsoft.deviceupdate/updateaccounts/deployments\": { \"SingularDisplayName\": \"Device Update Deployment\" }\n        ,\"microsoft.deviceupdate/updateaccounts/deviceclasses\": { \"SingularDisplayName\": \"Device Update Device Class\" }\n        ,\"microsoft.deviceupdate/updateaccounts/updates\": { \"SingularDisplayName\": \"Device Update\" }\n        ,\"microsoft.devops/pipelines\": { \"SingularDisplayName\": \"Microsoft.DevOps pipeline\" }\n        ,\"microsoft.devopsinfrastructure/pools\": { \"SingularDisplayName\": \"Managed DevOps Pool\" }\n        ,\"microsoft.devspaces/controllers\": { \"SingularDisplayName\": \"Microsoft.DevSpaces controller\" }\n        ,\"microsoft.devtestlab/labs\": { \"SingularDisplayName\": \"DevTest lab\" }\n        ,\"microsoft.devtestlab/labs/virtualmachines\": { \"SingularDisplayName\": \"DevTest Lab virtual machine\" }\n        ,\"microsoft.devtestlab/schedules\": { \"SingularDisplayName\": \"Microsoft.DevTestLab schedule\" }\n        ,\"microsoft.devtunnels/tunnelplans\": { \"SingularDisplayName\": \"Dev Tunnels Domain\" }\n        ,\"microsoft.diagnostics/apollo\": { \"SingularDisplayName\": \"Microsoft.Diagnostics apollo\" }\n        ,\"microsoft.digitaltwins/digitaltwinsinstances\": { \"SingularDisplayName\": \"Azure Digital Twins\" }\n        ,\"microsoft.discovery/agents\": { \"SingularDisplayName\": \"Microsoft Discovery Agent\" }\n        ,\"microsoft.discovery/bookshelves\": { \"SingularDisplayName\": \"Microsoft Discovery Bookshelf\" }\n        ,\"microsoft.discovery/datacontainers\": { \"SingularDisplayName\": \"Microsoft Discovery Data Container\" }\n        ,\"microsoft.discovery/datacontainers/dataassets\": { \"SingularDisplayName\": \"Data asset\" }\n        ,\"microsoft.discovery/models\": { \"SingularDisplayName\": \"Microsoft Discovery Model\" }\n        ,\"microsoft.discovery/storages\": { \"SingularDisplayName\": \"Microsoft Discovery Storage\" }\n        ,\"microsoft.discovery/supercomputers\": { \"SingularDisplayName\": \"Microsoft Discovery Supercomputer\" }\n        ,\"microsoft.discovery/supercomputers/nodepools\": { \"SingularDisplayName\": \"Nodepool\" }\n        ,\"microsoft.discovery/tools\": { \"SingularDisplayName\": \"Microsoft Discovery Tool\" }\n        ,\"microsoft.discovery/workflows\": { \"SingularDisplayName\": \"Microsoft Discovery Workflow\" }\n        ,\"microsoft.discovery/workspaces\": { \"SingularDisplayName\": \"Microsoft Discovery Workspace\" }\n        ,\"microsoft.discovery/workspaces/projects\": { \"SingularDisplayName\": \"Microsoft Discovery Project\" }\n        ,\"microsoft.documentdb/cassandraclusters\": { \"SingularDisplayName\": \"Azure Managed Instance for Apache Cassandra\" }\n        ,\"microsoft.documentdb/databaseaccounts\": { \"SingularDisplayName\": \"Cosmos DB account\" }\n        ,\"microsoft.documentdb/fleets\": { \"SingularDisplayName\": \"Azure Cosmos DB Fleet\" }\n        ,\"microsoft.documentdb/fleetspacepotentialdatabaseaccounts\": { \"SingularDisplayName\": \"Potential Azure Cosmos DB account\" }\n        ,\"microsoft.documentdb/fleetspacepotentialdatabaseaccountswithlocations\": { \"SingularDisplayName\": \"Potential Azure Cosmos DB account\" }\n        ,\"microsoft.documentdb/mongoclusters\": { \"SingularDisplayName\": \"Azure Cosmos DB for MongoDB (vCore)\" }\n        ,\"microsoft.documentdb/throughputpools\": { \"SingularDisplayName\": \"Microsoft.DocumentDB throughput pool\" }\n        ,\"microsoft.documentdb/throughputpools/throughputpoolaccounts\": { \"SingularDisplayName\": \"Microsoft.DocumentDB throughput pools throughput pool account\" }\n        ,\"microsoft.domainregistration/domains\": { \"SingularDisplayName\": \"App Service Domain\" }\n        ,\"microsoft.domainregistration/topleveldomains\": { \"SingularDisplayName\": \"Microsoft.DomainRegistration top level domain\" }\n        ,\"microsoft.durabletask/namespaces\": { \"SingularDisplayName\": \"Microsoft.DurableTask namespace\" }\n        ,\"microsoft.durabletask/namespaces/taskhubs\": { \"SingularDisplayName\": \"Task Hub\" }\n        ,\"microsoft.durabletask/schedulers\": { \"SingularDisplayName\": \"Durable Task Scheduler\" }\n        ,\"microsoft.durabletask/schedulers/taskhubs\": { \"SingularDisplayName\": \"Task Hub\" }\n        ,\"microsoft.dynamics365fraudprotection/instances\": { \"SingularDisplayName\": \"Microsoft.Dynamics365FraudProtection instance\" }\n        ,\"microsoft.easm/workspaces\": { \"SingularDisplayName\": \"Microsoft Defender EASM\" }\n        ,\"microsoft.edge/configurations\": { \"SingularDisplayName\": \"Site configuration\" }\n        ,\"microsoft.edge/configurations/arcgatewayconfigurations\": { \"SingularDisplayName\": \"Microsoft.Edge configurations arc gateway configuration\" }\n        ,\"microsoft.edge/configurations/connectivityconfigurations\": { \"SingularDisplayName\": \"Microsoft.Edge configurations connectivity configuration\" }\n        ,\"microsoft.edge/configurations/dynamicconfigurations\": { \"SingularDisplayName\": \"Microsoft.Edge configurations dynamic configuration\" }\n        ,\"microsoft.edge/configurations/dynamicconfigurations/versions\": { \"SingularDisplayName\": \"Microsoft.Edge configurations dynamic configurations version\" }\n        ,\"microsoft.edge/configurations/networkconfigurations\": { \"SingularDisplayName\": \"Microsoft.Edge configurations network configuration\" }\n        ,\"microsoft.edge/configurations/securityconfigurations\": { \"SingularDisplayName\": \"Microsoft.Edge configurations security configuration\" }\n        ,\"microsoft.edge/configurations/timeserverconfigurations\": { \"SingularDisplayName\": \"Microsoft.Edge configurations time server configuration\" }\n        ,\"microsoft.edge/connectivitystatuses\": { \"SingularDisplayName\": \"Microsoft.Edge connectivity statuse\" }\n        ,\"microsoft.edge/disconnectedoperations\": { \"SingularDisplayName\": \"Azure Local - disconnected operations\" }\n        ,\"microsoft.edge/siteawareresourcetypes\": { \"SingularDisplayName\": \"Microsoft.Edge site aware resource type\" }\n        ,\"microsoft.edge/sites\": { \"SingularDisplayName\": \"Site manager - Azure Arc\" }\n        ,\"microsoft.edge/updates\": { \"SingularDisplayName\": \"Microsoft.Edge update\" }\n        ,\"microsoft.edgemarketplace/offers\": { \"SingularDisplayName\": \"Microsoft.EdgeMarketplace offer\" }\n        ,\"microsoft.edgemarketplace/publishers\": { \"SingularDisplayName\": \"Microsoft.EdgeMarketplace publisher\" }\n        ,\"microsoft.edgeorder/addresses\": { \"SingularDisplayName\": \"Azure Edge Hardware Center Address\" }\n        ,\"microsoft.edgeorder/bootstrapconfigurations\": { \"SingularDisplayName\": \"Site Key\" }\n        ,\"microsoft.edgeorder/orderitems\": { \"SingularDisplayName\": \"Azure Edge Hardware Center\" }\n        ,\"microsoft.edgeorder/virtual_orderitems\": { \"SingularDisplayName\": \"Device\" }\n        ,\"microsoft.edgezones/extendedzones\": { \"SingularDisplayName\": \"Microsoft.EdgeZones extended zone\" }\n        ,\"microsoft.education/grants\": { \"SingularDisplayName\": \"Microsoft.Education grant\" }\n        ,\"microsoft.education/labs\": { \"SingularDisplayName\": \"Microsoft.Education lab\" }\n        ,\"microsoft.education/labs/joinrequests\": { \"SingularDisplayName\": \"Microsoft.Education labs join request\" }\n        ,\"microsoft.education/labs/students\": { \"SingularDisplayName\": \"Microsoft.Education labs student\" }\n        ,\"microsoft.education/studentlabs\": { \"SingularDisplayName\": \"Microsoft.Education student lab\" }\n        ,\"microsoft.elastic/monitors\": { \"SingularDisplayName\": \"Elastic Cloud Resource\" }\n        ,\"microsoft.elasticsan/elasticsans\": { \"SingularDisplayName\": \"Elastic SAN\" }\n        ,\"microsoft.energydataplatform/energyservices\": { \"SingularDisplayName\": \"Microsoft.EnergyDataPlatform energy service\" }\n        ,\"microsoft.enterpriseknowledgegraph/services\": { \"SingularDisplayName\": \"Microsoft.EnterpriseKnowledgeGraph service\" }\n        ,\"microsoft.enterprisesupport/enterprisesupports\": { \"SingularDisplayName\": \"Microsoft.EnterpriseSupport enterprise support\" }\n        ,\"microsoft.eventgrid/domains\": { \"SingularDisplayName\": \"Event Grid Domain\" }\n        ,\"microsoft.eventgrid/domains/topics\": { \"SingularDisplayName\": \"Event Grid Domain Topic\" }\n        ,\"microsoft.eventgrid/eventsubscriptions\": { \"SingularDisplayName\": \"Microsoft.EventGrid event subscription\" }\n        ,\"microsoft.eventgrid/extensiontopics\": { \"SingularDisplayName\": \"Event Grid extension topic\" }\n        ,\"microsoft.eventgrid/namespaces\": { \"SingularDisplayName\": \"Event Grid Namespace\" }\n        ,\"microsoft.eventgrid/namespaces/topics\": { \"SingularDisplayName\": \"Event Grid Namespace Topic\" }\n        ,\"microsoft.eventgrid/namespaces/topics/eventsubscriptions\": { \"SingularDisplayName\": \"Event Subscription\" }\n        ,\"microsoft.eventgrid/namespaces/topicspaces\": { \"SingularDisplayName\": \"Event Grid Topic Space\" }\n        ,\"microsoft.eventgrid/partnerconfigurations\": { \"SingularDisplayName\": \"Event Grid Partner Configuration\" }\n        ,\"microsoft.eventgrid/partnerdestinations\": { \"SingularDisplayName\": \"Event Grid Partner Destination\" }\n        ,\"microsoft.eventgrid/partnernamespaces\": { \"SingularDisplayName\": \"Event Grid Partner Namespace\" }\n        ,\"microsoft.eventgrid/partnernamespaces/channels\": { \"SingularDisplayName\": \"Event Grid Channel\" }\n        ,\"microsoft.eventgrid/partnerregistrations\": { \"SingularDisplayName\": \"Event Grid Partner Registration\" }\n        ,\"microsoft.eventgrid/partnertopics\": { \"SingularDisplayName\": \"Event Grid Partner Topic\" }\n        ,\"microsoft.eventgrid/systemtopics\": { \"SingularDisplayName\": \"Event Grid System Topic\" }\n        ,\"microsoft.eventgrid/systemtopics/eventsubscriptions\": { \"SingularDisplayName\": \"Event Grid Subscriptions\" }\n        ,\"microsoft.eventgrid/topics\": { \"SingularDisplayName\": \"Event Grid Topic\" }\n        ,\"microsoft.eventgrid/topictypes\": { \"SingularDisplayName\": \"Microsoft.EventGrid topic type\" }\n        ,\"microsoft.eventgrid/verifiedpartners\": { \"SingularDisplayName\": \"Microsoft.EventGrid verified partner\" }\n        ,\"microsoft.eventhub/clusters\": { \"SingularDisplayName\": \"Event Hubs Cluster\" }\n        ,\"microsoft.eventhub/namespaces\": { \"SingularDisplayName\": \"Event Hubs namespace\" }\n        ,\"microsoft.eventhub/namespaces/disasterrecoveryconfigs\": { \"SingularDisplayName\": \"Event Hubs Geo-DR Alias\" }\n        ,\"microsoft.eventhub/namespaces/eventhubs\": { \"SingularDisplayName\": \"Event Hubs Instance\" }\n        ,\"microsoft.eventhub/namespaces/providers/diagnosticsettings\": { \"SingularDisplayName\": \"Diagnostic settings\" }\n        ,\"microsoft.eventhub/namespaces/schemagroups\": { \"SingularDisplayName\": \"Schema Group\" }\n        ,\"microsoft.experimentation/experimentworkspaces\": { \"SingularDisplayName\": \"Experiment Workspace\" }\n        ,\"microsoft.extendedlocation/customlocations\": { \"SingularDisplayName\": \"Custom location\" }\n        ,\"microsoft.fabric/capacities\": { \"SingularDisplayName\": \"Fabric Capacity\" }\n        ,\"microsoft.fabric/privatelinkservicesforfabric\": { \"SingularDisplayName\": \"Microsoft.Fabric private link services for fabric\" }\n        ,\"microsoft.fabric/privatelinkservicesforfabric/operationresults\": { \"SingularDisplayName\": \"Microsoft.Fabric private link services for fabric operation result\" }\n        ,\"microsoft.fabric/privatelinkservicesforfabric/privateendpointconnections\": { \"SingularDisplayName\": \"Microsoft.Fabric private link services for fabric private endpoint connection\" }\n        ,\"microsoft.fabric/privatelinkservicesforfabric/privatelinkresources\": { \"SingularDisplayName\": \"Microsoft.Fabric private link services for fabric private link resource\" }\n        ,\"microsoft.fairfieldgardens/deviceprovisioningstates\": { \"SingularDisplayName\": \"Microsoft.FairfieldGardens device provisioning state\" }\n        ,\"microsoft.fairfieldgardens/provisioningresources\": { \"SingularDisplayName\": \"Fairfield Gardens\" }\n        ,\"microsoft.fairfieldgardens/provisioningresources/provisioningpolicies\": { \"SingularDisplayName\": \"Provisioning policy\" }\n        ,\"microsoft.falcon/namespaces\": { \"SingularDisplayName\": \"Microsoft.Falcon namespace\" }\n        ,\"microsoft.features/featureprovidernamespaces/featureconfigurations\": { \"SingularDisplayName\": \"Preview features\" }\n        ,\"microsoft.fidalgo/devcenters\": { \"SingularDisplayName\": \"Microsoft.Fidalgo devcenter\" }\n        ,\"microsoft.fidalgo/devcenters/attachednetworks\": { \"SingularDisplayName\": \"Microsoft.Fidalgo devcenters attachednetwork\" }\n        ,\"microsoft.fidalgo/devcenters/catalogs\": { \"SingularDisplayName\": \"Microsoft.Fidalgo devcenters catalog\" }\n        ,\"microsoft.fidalgo/devcenters/catalogs/items\": { \"SingularDisplayName\": \"Microsoft.Fidalgo devcenters catalogs item\" }\n        ,\"microsoft.fidalgo/devcenters/devboxdefinitions\": { \"SingularDisplayName\": \"Microsoft.Fidalgo devcenters devboxdefinition\" }\n        ,\"microsoft.fidalgo/devcenters/environmenttypes\": { \"SingularDisplayName\": \"Microsoft.Fidalgo devcenters environment type\" }\n        ,\"microsoft.fidalgo/devcenters/galleries\": { \"SingularDisplayName\": \"Microsoft.Fidalgo devcenters gallery\" }\n        ,\"microsoft.fidalgo/devcenters/galleries/images\": { \"SingularDisplayName\": \"Microsoft.Fidalgo devcenters galleries image\" }\n        ,\"microsoft.fidalgo/devcenters/galleries/images/versions\": { \"SingularDisplayName\": \"Microsoft.Fidalgo devcenters galleries images version\" }\n        ,\"microsoft.fidalgo/devcenters/mappings\": { \"SingularDisplayName\": \"Microsoft.Fidalgo devcenters mapping\" }\n        ,\"microsoft.fidalgo/machinedefinitions\": { \"SingularDisplayName\": \"Microsoft.Fidalgo machinedefinition\" }\n        ,\"microsoft.fidalgo/networksettings\": { \"SingularDisplayName\": \"Microsoft.Fidalgo networksetting\" }\n        ,\"microsoft.fidalgo/networksettings/healthchecks\": { \"SingularDisplayName\": \"Microsoft.Fidalgo networksettings healthcheck\" }\n        ,\"microsoft.fidalgo/projects\": { \"SingularDisplayName\": \"Microsoft.Fidalgo project\" }\n        ,\"microsoft.fidalgo/projects/attachednetworks\": { \"SingularDisplayName\": \"Microsoft.Fidalgo projects attachednetwork\" }\n        ,\"microsoft.fidalgo/projects/devboxdefinitions\": { \"SingularDisplayName\": \"Microsoft.Fidalgo projects devboxdefinition\" }\n        ,\"microsoft.fidalgo/projects/environments\": { \"SingularDisplayName\": \"Microsoft.Fidalgo projects environment\" }\n        ,\"microsoft.fidalgo/projects/pools\": { \"SingularDisplayName\": \"Microsoft.Fidalgo projects pool\" }\n        ,\"microsoft.fileshares/fileshares\": { \"SingularDisplayName\": \"File share\" }\n        ,\"microsoft.fluidrelay/fluidrelayservers\": { \"SingularDisplayName\": \"Fluid Relay\" }\n        ,\"microsoft.footprintmonitoring/profiles\": { \"SingularDisplayName\": \"Microsoft.FootprintMonitoring profile\" }\n        ,\"microsoft.footprintmonitoring/profiles/experiments\": { \"SingularDisplayName\": \"Microsoft.FootprintMonitoring profiles experiment\" }\n        ,\"microsoft.footprintmonitoring/profiles/measurementendpoints\": { \"SingularDisplayName\": \"Microsoft.FootprintMonitoring profiles measurement endpoint\" }\n        ,\"microsoft.footprintmonitoring/profiles/measurementendpoints/conditions\": { \"SingularDisplayName\": \"Microsoft.FootprintMonitoring profiles measurement endpoints condition\" }\n        ,\"microsoft.gallery/myareas/galleryitems\": { \"SingularDisplayName\": \"Template\" }\n        ,\"microsoft.genomics/accounts\": { \"SingularDisplayName\": \"Genomics account\" }\n        ,\"microsoft.graph/azureadapplication\": { \"SingularDisplayName\": \"Entra application\" }\n        ,\"microsoft.graph/azureadapplicationprototype\": { \"SingularDisplayName\": \"Microsoft.Graph Azure ad application prototype\" }\n        ,\"microsoft.graphservices/accounts\": { \"SingularDisplayName\": \"Metered API account\" }\n        ,\"microsoft.guestconfiguration/guestconfigurationassignments\": { \"SingularDisplayName\": \"Microsoft.GuestConfiguration guest configuration assignment\" }\n        ,\"microsoft.guestconfiguration/guestconfigurationassignments/reports\": { \"SingularDisplayName\": \"Microsoft.GuestConfiguration guest configuration assignments report\" }\n        ,\"microsoft.hanaonazure/hanainstances\": { \"SingularDisplayName\": \"SAP HANA on Azure\" }\n        ,\"microsoft.hanaonazure/sapmonitors\": { \"SingularDisplayName\": \"Azure Monitor for SAP Solutions (classic)\" }\n        ,\"microsoft.hardware/orders\": { \"SingularDisplayName\": \"Microsoft.Hardware order\" }\n        ,\"microsoft.hardwaresecuritymodules/cloudhsmclusters\": { \"SingularDisplayName\": \"Azure Cloud HSM\" }\n        ,\"microsoft.hdinsight/clusterpools\": { \"SingularDisplayName\": \"Azure HDInsight on AKS cluster pool\" }\n        ,\"microsoft.hdinsight/clusterpools/clusters\": { \"SingularDisplayName\": \"Azure HDInsight on AKS cluster\" }\n        ,\"microsoft.hdinsight/clusterpools/clusters/instanceviews\": { \"SingularDisplayName\": \"Microsoft.HDInsight clusterpools clusters instance view\" }\n        ,\"microsoft.hdinsight/clusters\": { \"SingularDisplayName\": \"HDInsight cluster\" }\n        ,\"microsoft.healthbot/healthbots\": { \"SingularDisplayName\": \"Healthcare agent service\" }\n        ,\"microsoft.healthcareapis/services\": { \"SingularDisplayName\": \"Azure API for FHIR\" }\n        ,\"microsoft.healthcareapis/workspaces\": { \"SingularDisplayName\": \"Health Data Services workspace\" }\n        ,\"microsoft.healthcareapis/workspaces/dicomservices\": { \"SingularDisplayName\": \"DICOM service\" }\n        ,\"microsoft.healthcareapis/workspaces/fhirservices\": { \"SingularDisplayName\": \"FHIR service\" }\n        ,\"microsoft.healthcareapis/workspaces/iotconnectors\": { \"SingularDisplayName\": \"MedTech service\" }\n        ,\"microsoft.healthdataaiservices/deidservices\": { \"SingularDisplayName\": \"De-identification Service\" }\n        ,\"microsoft.healthmodel/healthmodels\": { \"SingularDisplayName\": \"Health Model\" }\n        ,\"microsoft.healthplatform/accounts\": { \"SingularDisplayName\": \"Microsoft.HealthPlatform account\" }\n        ,\"microsoft.help/diagnostics\": { \"SingularDisplayName\": \"Microsoft.Help diagnostic\" }\n        ,\"microsoft.help/selfhelp\": { \"SingularDisplayName\": \"Microsoft.Help self help\" }\n        ,\"microsoft.help/simplifiedsolutions\": { \"SingularDisplayName\": \"Microsoft.Help simplified solution\" }\n        ,\"microsoft.help/solutions\": { \"SingularDisplayName\": \"Microsoft.Help solution\" }\n        ,\"microsoft.help/troubleshooters\": { \"SingularDisplayName\": \"Microsoft.Help troubleshooter\" }\n        ,\"microsoft.hpcworkbench/instances\": { \"SingularDisplayName\": \"Microsoft.HpcWorkbench instance\" }\n        ,\"microsoft.hpcworkbench/instances/chambers\": { \"SingularDisplayName\": \"Microsoft.HpcWorkbench instances chamber\" }\n        ,\"microsoft.hpcworkbench/instances/chambers/accessprofiles\": { \"SingularDisplayName\": \"Microsoft.HpcWorkbench instances chambers access profile\" }\n        ,\"microsoft.hpcworkbench/instances/chambers/filerequests\": { \"SingularDisplayName\": \"Microsoft.HpcWorkbench instances chambers file request\" }\n        ,\"microsoft.hpcworkbench/instances/chambers/files\": { \"SingularDisplayName\": \"Microsoft.HpcWorkbench instances chambers file\" }\n        ,\"microsoft.hpcworkbench/instances/chambers/storages\": { \"SingularDisplayName\": \"Microsoft.HpcWorkbench instances chambers storage\" }\n        ,\"microsoft.hpcworkbench/instances/chambers/workloads\": { \"SingularDisplayName\": \"Microsoft.HpcWorkbench instances chambers workload\" }\n        ,\"microsoft.hpcworkbench/instances/consortiums\": { \"SingularDisplayName\": \"Microsoft.HpcWorkbench instances consortium\" }\n        ,\"microsoft.hybridcloud/cloudconnections\": { \"SingularDisplayName\": \"Microsoft.HybridCloud cloud connection\" }\n        ,\"microsoft.hybridcloud/cloudconnectors\": { \"SingularDisplayName\": \"Microsoft.HybridCloud cloud connector\" }\n        ,\"microsoft.hybridcompute/arcgatewayassociatedresources\": { \"SingularDisplayName\": \"Arc gateway associated resource\" }\n        ,\"microsoft.hybridcompute/arcserverwithwac\": { \"SingularDisplayName\": \"Machine - Azure Arc\" }\n        ,\"microsoft.hybridcompute/gateways\": { \"SingularDisplayName\": \"Arc gateway\" }\n        ,\"microsoft.hybridcompute/licenses\": { \"SingularDisplayName\": \"Extended Security Updates - Windows Server 2012/R2\" }\n        ,\"microsoft.hybridcompute/machines\": { \"SingularDisplayName\": \"Machine - Azure Arc\" }\n        ,\"microsoft.hybridcompute/machines/microsoft.awsconnector/ec2instances\": { \"SingularDisplayName\": \"Microsoft.AwsConnector ec2 instance\" }\n        ,\"microsoft.hybridcompute/machines/microsoft.connectedvmwarevsphere/virtualmachineinstances\": { \"SingularDisplayName\": \"VMware + AVS virtual machine\" }\n        ,\"microsoft.hybridcompute/machines/providers/guestconfigurationassignments\": { \"SingularDisplayName\": \"Guest Assignment\" }\n        ,\"microsoft.hybridcompute/machinesesu\": { \"SingularDisplayName\": \"Machine - Azure Arc\" }\n        ,\"microsoft.hybridcompute/machinespaygo\": { \"SingularDisplayName\": \"Machine - Azure Arc\" }\n        ,\"microsoft.hybridcompute/machinessoftwareassurance\": { \"SingularDisplayName\": \"Machine - Azure Arc\" }\n        ,\"microsoft.hybridcompute/machinessovereign\": { \"SingularDisplayName\": \"Machine - Azure Arc\" }\n        ,\"microsoft.hybridcompute/privatelinkscopes\": { \"SingularDisplayName\": \"Azure Arc Private Link Scope\" }\n        ,\"microsoft.hybridcompute/settings\": { \"SingularDisplayName\": \"Microsoft.HybridCompute setting\" }\n        ,\"microsoft.hybridconnectivity/endpoints\": { \"SingularDisplayName\": \"Microsoft.HybridConnectivity endpoint\" }\n        ,\"microsoft.hybridconnectivity/endpoints/serviceconfigurations\": { \"SingularDisplayName\": \"Microsoft.HybridConnectivity endpoints service configuration\" }\n        ,\"microsoft.hybridconnectivity/publiccloudconnectors\": { \"SingularDisplayName\": \"Multicloud connector\" }\n        ,\"microsoft.hybridconnectivity/solutionconfigurations\": { \"SingularDisplayName\": \"Microsoft.HybridConnectivity solution configuration\" }\n        ,\"microsoft.hybridconnectivity/solutionconfigurations/inventory\": { \"SingularDisplayName\": \"Microsoft.HybridConnectivity solution configurations inventory\" }\n        ,\"microsoft.hybridconnectivity/solutiontypes\": { \"SingularDisplayName\": \"Microsoft.HybridConnectivity solution type\" }\n        ,\"microsoft.hybridcontainerservice/kubernetesversions\": { \"SingularDisplayName\": \"Microsoft.HybridContainerService kubernetes version\" }\n        ,\"microsoft.hybridcontainerservice/provisionedclusterinstances\": { \"SingularDisplayName\": \"Microsoft.HybridContainerService provisioned cluster instance\" }\n        ,\"microsoft.hybridcontainerservice/provisionedclusterinstances/agentpools\": { \"SingularDisplayName\": \"Microsoft.HybridContainerService provisioned cluster instances agent pool\" }\n        ,\"microsoft.hybridcontainerservice/provisionedclusterinstances/hybrididentitymetadata\": { \"SingularDisplayName\": \"Microsoft.HybridContainerService provisioned cluster instances hybrid identity metadata\" }\n        ,\"microsoft.hybridcontainerservice/provisionedclusterinstances/upgradeprofiles\": { \"SingularDisplayName\": \"Microsoft.HybridContainerService provisioned cluster instances upgrade profile\" }\n        ,\"microsoft.hybridcontainerservice/provisionedclusters\": { \"SingularDisplayName\": \"Kubernetes hybrid - Azure Arc\" }\n        ,\"microsoft.hybridcontainerservice/skus\": { \"SingularDisplayName\": \"Microsoft.HybridContainerService SKU\" }\n        ,\"microsoft.hybridcontainerservice/storagespaces\": { \"SingularDisplayName\": \"Microsoft.HybridContainerService storage space\" }\n        ,\"microsoft.hybridcontainerservice/virtualnetworks\": { \"SingularDisplayName\": \"Microsoft.HybridContainerService virtual network\" }\n        ,\"microsoft.hybriddata/datamanagers\": { \"SingularDisplayName\": \"Microsoft.HybridData data manager\" }\n        ,\"microsoft.hybriddata/datamanagers/dataservices\": { \"SingularDisplayName\": \"Microsoft.HybridData data managers data service\" }\n        ,\"microsoft.hybriddata/datamanagers/dataservices/jobdefinitions\": { \"SingularDisplayName\": \"Microsoft.HybridData data managers data services job definition\" }\n        ,\"microsoft.hybriddata/datamanagers/dataservices/jobdefinitions/jobs\": { \"SingularDisplayName\": \"Microsoft.HybridData data managers data services job definitions job\" }\n        ,\"microsoft.hybriddata/datamanagers/datastores\": { \"SingularDisplayName\": \"Microsoft.HybridData data managers data store\" }\n        ,\"microsoft.hybriddata/datamanagers/datastoretypes\": { \"SingularDisplayName\": \"Microsoft.HybridData data managers data store type\" }\n        ,\"microsoft.hybriddata/datamanagers/publickeys\": { \"SingularDisplayName\": \"Microsoft.HybridData data managers public key\" }\n        ,\"microsoft.hybridnetwork/configurationgroupvalues\": { \"SingularDisplayName\": \"Configuration Group Value\" }\n        ,\"microsoft.hybridnetwork/devices\": { \"SingularDisplayName\": \"Azure Network Function Manager ? Device\" }\n        ,\"microsoft.hybridnetwork/networkfunctions\": { \"SingularDisplayName\": \"Azure Network Function Manager ? Network Function\" }\n        ,\"microsoft.hybridnetwork/proxypublishers\": { \"SingularDisplayName\": \"Microsoft.HybridNetwork proxy publisher\" }\n        ,\"microsoft.hybridnetwork/proxypublishers/artifactstores\": { \"SingularDisplayName\": \"Microsoft.HybridNetwork proxy publishers artifact store\" }\n        ,\"microsoft.hybridnetwork/proxypublishers/configurationgroupschemas\": { \"SingularDisplayName\": \"Microsoft.HybridNetwork proxy publishers configuration group schema\" }\n        ,\"microsoft.hybridnetwork/proxypublishers/networkfunctiondefinitiongroups\": { \"SingularDisplayName\": \"Microsoft.HybridNetwork proxy publishers network function definition group\" }\n        ,\"microsoft.hybridnetwork/proxypublishers/networkfunctiondefinitiongroups/networkfunctiondefinitionversions\": { \"SingularDisplayName\": \"Microsoft.HybridNetwork proxy publishers network function definition groups network function definition version\" }\n        ,\"microsoft.hybridnetwork/proxypublishers/networkservicedesigngroups\": { \"SingularDisplayName\": \"Microsoft.HybridNetwork proxy publishers network service design group\" }\n        ,\"microsoft.hybridnetwork/proxypublishers/networkservicedesigngroups/networkservicedesignversions\": { \"SingularDisplayName\": \"Microsoft.HybridNetwork proxy publishers network service design groups network service design version\" }\n        ,\"microsoft.hybridnetwork/publishers\": { \"SingularDisplayName\": \"Publisher\" }\n        ,\"microsoft.hybridnetwork/publishers/artifactstores\": { \"SingularDisplayName\": \"Publisher Artifact Store\" }\n        ,\"microsoft.hybridnetwork/publishers/artifactstores/artifactmanifests\": { \"SingularDisplayName\": \"Publisher Artifact Manifest\" }\n        ,\"microsoft.hybridnetwork/publishers/configurationgroupschemas\": { \"SingularDisplayName\": \"Configuration Group Schema\" }\n        ,\"microsoft.hybridnetwork/publishers/networkfunctiondefinitiongroups\": { \"SingularDisplayName\": \"Network Function Definition\" }\n        ,\"microsoft.hybridnetwork/publishers/networkfunctiondefinitiongroups/networkfunctiondefinitionversions\": { \"SingularDisplayName\": \"Network Function Definition Version\" }\n        ,\"microsoft.hybridnetwork/publishers/networkservicedesigngroups\": { \"SingularDisplayName\": \"Network Service Design\" }\n        ,\"microsoft.hybridnetwork/publishers/networkservicedesigngroups/networkservicedesignversions\": { \"SingularDisplayName\": \"Network Service Design Version\" }\n        ,\"microsoft.hybridnetwork/servicemanagementcontainers\": { \"SingularDisplayName\": \"Microsoft.HybridNetwork service management container\" }\n        ,\"microsoft.hybridnetwork/servicemanagementcontainers/rolloutsequences\": { \"SingularDisplayName\": \"Microsoft.HybridNetwork service management containers rollout sequence\" }\n        ,\"microsoft.hybridnetwork/servicemanagementcontainers/rollouttiers\": { \"SingularDisplayName\": \"Microsoft.HybridNetwork service management containers rollout tier\" }\n        ,\"microsoft.hybridnetwork/servicemanagementcontainers/updatespecifications\": { \"SingularDisplayName\": \"Microsoft.HybridNetwork service management containers update specification\" }\n        ,\"microsoft.hybridnetwork/servicemanagementcontainers/updatespecifications/rollouts\": { \"SingularDisplayName\": \"Microsoft.HybridNetwork service management containers update specifications rollout\" }\n        ,\"microsoft.hybridnetwork/servicemanagementcontainers/updatespecifications/rollouts/statuses\": { \"SingularDisplayName\": \"Microsoft.HybridNetwork service management containers update specifications rollouts statuse\" }\n        ,\"microsoft.hybridnetwork/sitenetworkservices\": { \"SingularDisplayName\": \"Site Network Service\" }\n        ,\"microsoft.hybridnetwork/sites\": { \"SingularDisplayName\": \"Site\" }\n    })[tolower(id)]\n}\n",
                    "$fxv#3": "// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\n.create-or-alter function \nwith (docstring = 'Return details about the specified ID.', folder = 'OpenData/Internal')\n_resource_type_3(id: string) {\n    dynamic({\n        \"microsoft.hybridnetwork/vendors\": { \"SingularDisplayName\": \"Azure Network Function Manager ? vendor\" }\n        ,\"microsoft.hybridonboarding/extensionmanagers\": { \"SingularDisplayName\": \"Microsoft.HybridOnboarding extension manager\" }\n        ,\"microsoft.impact/connectors\": { \"SingularDisplayName\": \"Impact Reporting Connector\" }\n        ,\"microsoft.impact/impactcategories\": { \"SingularDisplayName\": \"Microsoft.Impact impact category\" }\n        ,\"microsoft.impact/topologyimpacts\": { \"SingularDisplayName\": \"Microsoft.Impact topology impact\" }\n        ,\"microsoft.impact/workloadimpacts\": { \"SingularDisplayName\": \"Microsoft.Impact workload impact\" }\n        ,\"microsoft.impact/workloadimpacts/insights\": { \"SingularDisplayName\": \"Microsoft.Impact workload impacts insight\" }\n        ,\"microsoft.importexport/jobs\": { \"SingularDisplayName\": \"Microsoft.ImportExport job\" }\n        ,\"microsoft.insights/actiongroups\": { \"SingularDisplayName\": \"Action group\" }\n        ,\"microsoft.insights/activitylogalerts\": { \"SingularDisplayName\": \"Activity log alert rule\" }\n        ,\"microsoft.insights/alertrules\": { \"SingularDisplayName\": \"Microsoft.Insights alertrule\" }\n        ,\"microsoft.insights/alertrules/incidents\": { \"SingularDisplayName\": \"Microsoft.insights alertrules incident\" }\n        ,\"microsoft.insights/autoscalesettings\": { \"SingularDisplayName\": \"Microsoft.Insights autoscalesetting\" }\n        ,\"microsoft.insights/components\": { \"SingularDisplayName\": \"Application Insights app\" }\n        ,\"microsoft.insights/datacollectionendpoints\": { \"SingularDisplayName\": \"Data collection endpoint\" }\n        ,\"microsoft.insights/datacollectionruleassociations\": { \"SingularDisplayName\": \"Microsoft.Insights data collection rule association\" }\n        ,\"microsoft.insights/datacollectionrules\": { \"SingularDisplayName\": \"Data collection rule\" }\n        ,\"microsoft.insights/datacollectionrulesresources\": { \"SingularDisplayName\": \"Data collection rule associated resource\" }\n        ,\"microsoft.insights/diagnosticsettings\": { \"SingularDisplayName\": \"Diagnostic settings\" }\n        ,\"microsoft.insights/diagnosticsettingscategories\": { \"SingularDisplayName\": \"Microsoft.Insights diagnostic settings category\" }\n        ,\"microsoft.insights/guestdiagnosticsettings\": { \"SingularDisplayName\": \"Microsoft.insights guest diagnostic setting\" }\n        ,\"microsoft.insights/guestdiagnosticsettingsassociation\": { \"SingularDisplayName\": \"Microsoft.insights guest diagnostic settings association\" }\n        ,\"microsoft.insights/logprofiles\": { \"SingularDisplayName\": \"Microsoft.Insights logprofile\" }\n        ,\"microsoft.insights/metricalerts\": { \"SingularDisplayName\": \"Metric alert rule\" }\n        ,\"microsoft.insights/notificationstatus\": { \"SingularDisplayName\": \"Microsoft.Insights notification statu\" }\n        ,\"microsoft.insights/privatelinkscopeoperationstatuses\": { \"SingularDisplayName\": \"Microsoft.insights private link scope operation statuse\" }\n        ,\"microsoft.insights/privatelinkscopes\": { \"SingularDisplayName\": \"Azure Monitor Private Link Scope\" }\n        ,\"microsoft.insights/scheduledqueryrules\": { \"SingularDisplayName\": \"Log search alert rule\" }\n        ,\"microsoft.insights/tenantactiongroups\": { \"SingularDisplayName\": \"Microsoft.Insights tenant action group\" }\n        ,\"microsoft.insights/tenantactiongroups/notificationstatus\": { \"SingularDisplayName\": \"Microsoft.Insights tenant action groups notification statu\" }\n        ,\"microsoft.insights/vminsightsonboardingstatuses\": { \"SingularDisplayName\": \"Microsoft.Insights VM insights onboarding statuse\" }\n        ,\"microsoft.insights/webtests\": { \"SingularDisplayName\": \"Application Insights availability test\" }\n        ,\"microsoft.insights/workbooks\": { \"SingularDisplayName\": \"Azure Workbook\" }\n        ,\"microsoft.insights/workbooktemplates\": { \"SingularDisplayName\": \"Azure Workbook Template\" }\n        ,\"microsoft.integrationspaces/spaces\": { \"SingularDisplayName\": \"Integration Environment\" }\n        ,\"microsoft.intelligentitdigitaltwin/digitaltwins\": { \"SingularDisplayName\": \"Microsoft.IntelligentITDigitalTwin digital twin\" }\n        ,\"microsoft.intelligentitdigitaltwin/digitaltwins/assets\": { \"SingularDisplayName\": \"Microsoft.IntelligentITDigitalTwin digital twins asset\" }\n        ,\"microsoft.intelligentitdigitaltwin/digitaltwins/executionplans\": { \"SingularDisplayName\": \"Microsoft.IntelligentITDigitalTwin digital twins execution plan\" }\n        ,\"microsoft.intelligentitdigitaltwin/digitaltwins/testplans\": { \"SingularDisplayName\": \"Microsoft.IntelligentITDigitalTwin digital twins test plan\" }\n        ,\"microsoft.intelligentitdigitaltwin/digitaltwins/tests\": { \"SingularDisplayName\": \"Microsoft.IntelligentITDigitalTwin digital twins test\" }\n        ,\"microsoft.inventory/subscriptioninternalproperties\": { \"SingularDisplayName\": \"Microsoft.Inventory subscription internal property\" }\n        ,\"microsoft.iotcentral/iotapps\": { \"SingularDisplayName\": \"IoT Central Application\" }\n        ,\"microsoft.iotfirmwaredefense/workspaces\": { \"SingularDisplayName\": \"Firmware analysis workspace\" }\n        ,\"microsoft.iotfirmwaredefense/workspaces/firmwares\": { \"SingularDisplayName\": \"Microsoft.IoTFirmwareDefense workspaces firmware\" }\n        ,\"microsoft.iotfirmwaredefense/workspaces/firmwares/summaries\": { \"SingularDisplayName\": \"Microsoft.IoTFirmwareDefense workspaces firmwares summary\" }\n        ,\"microsoft.iotoperations/instances\": { \"SingularDisplayName\": \"Azure IoT Operations\" }\n        ,\"microsoft.iotoperations/instances/brokers\": { \"SingularDisplayName\": \"Microsoft.IoTOperations instances broker\" }\n        ,\"microsoft.iotoperations/instances/brokers/authentications\": { \"SingularDisplayName\": \"Microsoft.IoTOperations instances brokers authentication\" }\n        ,\"microsoft.iotoperations/instances/brokers/authorizations\": { \"SingularDisplayName\": \"Microsoft.IoTOperations instances brokers authorization\" }\n        ,\"microsoft.iotoperations/instances/brokers/listeners\": { \"SingularDisplayName\": \"Microsoft.IoTOperations instances brokers listener\" }\n        ,\"microsoft.iotoperations/instances/dataflowendpoints\": { \"SingularDisplayName\": \"Microsoft.IoTOperations instances dataflow endpoint\" }\n        ,\"microsoft.iotoperations/instances/dataflowprofiles\": { \"SingularDisplayName\": \"Microsoft.IoTOperations instances dataflow profile\" }\n        ,\"microsoft.iotoperations/instances/dataflowprofiles/dataflows\": { \"SingularDisplayName\": \"Microsoft.IoTOperations instances dataflow profiles dataflow\" }\n        ,\"microsoft.iotoperationsdataprocessor/instances\": { \"SingularDisplayName\": \"Microsoft.IoTOperationsDataProcessor instance\" }\n        ,\"microsoft.iotoperationsdataprocessor/instances/datasets\": { \"SingularDisplayName\": \"Microsoft.IoTOperationsDataProcessor instances dataset\" }\n        ,\"microsoft.iotoperationsdataprocessor/instances/pipelines\": { \"SingularDisplayName\": \"Microsoft.IoTOperationsDataProcessor instances pipeline\" }\n        ,\"microsoft.iotoperationsmq/mq\": { \"SingularDisplayName\": \"IoT Operations Ops MQ\" }\n        ,\"microsoft.iotoperationsmq/mq/broker\": { \"SingularDisplayName\": \"Microsoft.IoTOperationsMQ mq broker\" }\n        ,\"microsoft.iotoperationsmq/mq/broker/authentication\": { \"SingularDisplayName\": \"Microsoft.IoTOperationsMQ mq broker authentication\" }\n        ,\"microsoft.iotoperationsmq/mq/broker/authorization\": { \"SingularDisplayName\": \"Microsoft.IoTOperationsMQ mq broker authorization\" }\n        ,\"microsoft.iotoperationsmq/mq/broker/listener\": { \"SingularDisplayName\": \"Microsoft.IoTOperationsMQ mq broker listener\" }\n        ,\"microsoft.iotoperationsmq/mq/datalakeconnector\": { \"SingularDisplayName\": \"Microsoft.IoTOperationsMQ mq data lake connector\" }\n        ,\"microsoft.iotoperationsmq/mq/datalakeconnector/topicmap\": { \"SingularDisplayName\": \"Microsoft.IoTOperationsMQ mq data lake connector topic map\" }\n        ,\"microsoft.iotoperationsmq/mq/diagnosticservice\": { \"SingularDisplayName\": \"Microsoft.IoTOperationsMQ mq diagnostic service\" }\n        ,\"microsoft.iotoperationsmq/mq/kafkaconnector\": { \"SingularDisplayName\": \"Microsoft.IoTOperationsMQ mq kafka connector\" }\n        ,\"microsoft.iotoperationsmq/mq/kafkaconnector/topicmap\": { \"SingularDisplayName\": \"Microsoft.IoTOperationsMQ mq kafka connector topic map\" }\n        ,\"microsoft.iotoperationsmq/mq/mqttbridgeconnector\": { \"SingularDisplayName\": \"Microsoft.IoTOperationsMQ mq mqtt bridge connector\" }\n        ,\"microsoft.iotoperationsmq/mq/mqttbridgeconnector/topicmap\": { \"SingularDisplayName\": \"Microsoft.IoTOperationsMQ mq mqtt bridge connector topic map\" }\n        ,\"microsoft.iotoperationsorchestrator/instances\": { \"SingularDisplayName\": \"Microsoft.IoTOperationsOrchestrator instance\" }\n        ,\"microsoft.iotoperationsorchestrator/solutions\": { \"SingularDisplayName\": \"Microsoft.IoTOperationsOrchestrator solution\" }\n        ,\"microsoft.iotoperationsorchestrator/targets\": { \"SingularDisplayName\": \"Microsoft.IoTOperationsOrchestrator target\" }\n        ,\"microsoft.iotsecurity/alerttypes\": { \"SingularDisplayName\": \"Microsoft.IoTSecurity alert type\" }\n        ,\"microsoft.iotsecurity/defendersettings\": { \"SingularDisplayName\": \"Microsoft.IoTSecurity defender setting\" }\n        ,\"microsoft.iotsecurity/onpremisesensors\": { \"SingularDisplayName\": \"Microsoft.IoTSecurity on premise sensor\" }\n        ,\"microsoft.iotsecurity/recommendationtypes\": { \"SingularDisplayName\": \"Microsoft.IoTSecurity recommendation type\" }\n        ,\"microsoft.iotsecurity/sensors\": { \"SingularDisplayName\": \"Microsoft.IoTSecurity sensor\" }\n        ,\"microsoft.iotsecurity/sites\": { \"SingularDisplayName\": \"Microsoft.IoTSecurity site\" }\n        ,\"microsoft.keyvault/managedhsms\": { \"SingularDisplayName\": \"Azure Key Vault Managed HSM\" }\n        ,\"microsoft.keyvault/vaults\": { \"SingularDisplayName\": \"Key vault\" }\n        ,\"microsoft.kubernetes/connectedclusters\": { \"SingularDisplayName\": \"Kubernetes - Azure Arc\" }\n        ,\"microsoft.kubernetes/connectedclusters/microsoft.kubernetesconfiguration/extensions\": { \"SingularDisplayName\": \"Kubernetes - Azure Arc extension\" }\n        ,\"microsoft.kubernetes/connectedclusters/microsoft.kubernetesconfiguration/fluxconfigurations\": { \"SingularDisplayName\": \"GitOps configuration\" }\n        ,\"microsoft.kubernetes/connectedclusters/microsoft.kubernetesconfiguration/namespaces\": { \"SingularDisplayName\": \"Kubernetes - Azure Arc namespace\" }\n        ,\"microsoft.kubernetesconfiguration/extensions\": { \"SingularDisplayName\": \"Kubernetes service extension\" }\n        ,\"microsoft.kubernetesconfiguration/extensiontypes\": { \"SingularDisplayName\": \"Microsoft.KubernetesConfiguration extension type\" }\n        ,\"microsoft.kubernetesconfiguration/extensiontypes/versions\": { \"SingularDisplayName\": \"Microsoft.KubernetesConfiguration extension types version\" }\n        ,\"microsoft.kubernetesconfiguration/fluxconfigurations\": { \"SingularDisplayName\": \"Microsoft.KubernetesConfiguration flux configuration\" }\n        ,\"microsoft.kubernetesconfiguration/fluxconfigurations/operations\": { \"SingularDisplayName\": \"Microsoft.KubernetesConfiguration flux configurations operation\" }\n        ,\"microsoft.kubernetesconfiguration/privatelinkscopes\": { \"SingularDisplayName\": \"Microsoft.KubernetesConfiguration private link scope\" }\n        ,\"microsoft.kubernetesconfiguration/privatelinkscopes/privateendpointconnections\": { \"SingularDisplayName\": \"Microsoft.KubernetesConfiguration private link scopes private endpoint connection\" }\n        ,\"microsoft.kubernetesconfiguration/privatelinkscopes/privatelinkresources\": { \"SingularDisplayName\": \"Microsoft.KubernetesConfiguration private link scopes private link resource\" }\n        ,\"microsoft.kubernetesconfiguration/sourcecontrolconfigurations\": { \"SingularDisplayName\": \"Microsoft.KubernetesConfiguration source control configuration\" }\n        ,\"microsoft.kubernetesruntime/bgppeers\": { \"SingularDisplayName\": \"Microsoft.KubernetesRuntime bgp peer\" }\n        ,\"microsoft.kubernetesruntime/loadbalancers\": { \"SingularDisplayName\": \"Arc Load Balancer\" }\n        ,\"microsoft.kubernetesruntime/services\": { \"SingularDisplayName\": \"Microsoft.KubernetesRuntime service\" }\n        ,\"microsoft.kubernetesruntime/storageclasses\": { \"SingularDisplayName\": \"Microsoft.KubernetesRuntime storage class\" }\n        ,\"microsoft.kusto/clusters\": { \"SingularDisplayName\": \"Azure Data Explorer Cluster\" }\n        ,\"microsoft.kusto/clusters/databases\": { \"SingularDisplayName\": \"Azure Data Explorer Database\" }\n        ,\"microsoft.labservices/labaccounts\": { \"SingularDisplayName\": \"Lab account\" }\n        ,\"microsoft.labservices/labaccounts/labs\": { \"SingularDisplayName\": \"Lab\" }\n        ,\"microsoft.labservices/labplans\": { \"SingularDisplayName\": \"Lab plan\" }\n        ,\"microsoft.labservices/labs\": { \"SingularDisplayName\": \"Lab\" }\n        ,\"microsoft.liftrpilot/organizations\": { \"SingularDisplayName\": \"Azure Pilot\" }\n        ,\"microsoft.loadtestservice/loadtestmappings\": { \"SingularDisplayName\": \"Microsoft.LoadTestService load test mapping\" }\n        ,\"microsoft.loadtestservice/loadtestprofilemappings\": { \"SingularDisplayName\": \"Microsoft.LoadTestService load test profile mapping\" }\n        ,\"microsoft.loadtestservice/loadtests\": { \"SingularDisplayName\": \"Azure Load Testing\" }\n        ,\"microsoft.loadtestservice/playwrightworkspaces\": { \"SingularDisplayName\": \"Playwright Workspace\" }\n        ,\"microsoft.logic/businessprocesses\": { \"SingularDisplayName\": \"Business Process\" }\n        ,\"microsoft.logic/integrationaccounts\": { \"SingularDisplayName\": \"Logic app integration account\" }\n        ,\"microsoft.logic/integrationserviceenvironments\": { \"SingularDisplayName\": \"Integration Service Environment\" }\n        ,\"microsoft.logic/integrationserviceenvironments/health\": { \"SingularDisplayName\": \"Microsoft.Logic integration service environments health\" }\n        ,\"microsoft.logic/integrationserviceenvironments/managedapis\": { \"SingularDisplayName\": \"Managed Connector\" }\n        ,\"microsoft.logic/templates\": { \"SingularDisplayName\": \"Logic Apps Template\" }\n        ,\"microsoft.logic/workflows\": { \"SingularDisplayName\": \"Logic app\" }\n        ,\"microsoft.logz/monitors\": { \"SingularDisplayName\": \"Logz.io\" }\n        ,\"microsoft.logz/monitors/accounts\": { \"SingularDisplayName\": \"Logz sub account\" }\n        ,\"microsoft.m365/m365resources\": { \"SingularDisplayName\": \"Microsoft.M365 m365 resource\" }\n        ,\"microsoft.m365consumptionservices/services\": { \"SingularDisplayName\": \"Microsoft.M365ConsumptionServices service\" }\n        ,\"microsoft.machinelearning/commitmentplans\": { \"SingularDisplayName\": \"Microsoft.MachineLearning commitment plan\" }\n        ,\"microsoft.machinelearning/commitmentplans/commitmentassociations\": { \"SingularDisplayName\": \"Microsoft.MachineLearning commitment plans commitment association\" }\n        ,\"microsoft.machinelearning/webservices\": { \"SingularDisplayName\": \"Machine Learning Studio (classic) web service\" }\n        ,\"microsoft.machinelearning/workspaces\": { \"SingularDisplayName\": \"Machine Learning Studio (classic) workspace\" }\n        ,\"microsoft.machinelearningexperimentation/accounts\": { \"SingularDisplayName\": \"Microsoft.MachineLearningExperimentation account\" }\n        ,\"microsoft.machinelearningexperimentation/accounts/workspaces\": { \"SingularDisplayName\": \"Microsoft.MachineLearningExperimentation accounts workspace\" }\n        ,\"microsoft.machinelearningexperimentation/accounts/workspaces/projects\": { \"SingularDisplayName\": \"Microsoft.MachineLearningExperimentation accounts workspaces project\" }\n        ,\"microsoft.machinelearningservices/aistudio\": { \"SingularDisplayName\": \"Azure AI Foundry\" }\n        ,\"microsoft.machinelearningservices/aistudiocreate\": { \"SingularDisplayName\": \"Azure AI Foundry\" }\n        ,\"microsoft.machinelearningservices/registries\": { \"SingularDisplayName\": \"Azure Machine Learning registry\" }\n        ,\"microsoft.machinelearningservices/workspaces\": { \"SingularDisplayName\": \"Azure Machine Learning workspace\" }\n        ,\"microsoft.machinelearningservices/workspaces/onlineendpoints\": { \"SingularDisplayName\": \"Machine learning online endpoint\" }\n        ,\"microsoft.machinelearningservices/workspaces/onlineendpoints/deployments\": { \"SingularDisplayName\": \"Machine learning online deployment\" }\n        ,\"microsoft.machinelearningservices/workspacescreate\": { \"SingularDisplayName\": \"Azure Machine Learning workspace\" }\n        ,\"microsoft.maintenance/configurationassignments\": { \"SingularDisplayName\": \"Microsoft.Maintenance configuration assignment\" }\n        ,\"microsoft.maintenance/maintenanceconfigurations\": { \"SingularDisplayName\": \"Maintenance Configuration\" }\n        ,\"microsoft.maintenance/maintenanceconfigurationsaumbladeresource\": { \"SingularDisplayName\": \"Maintenance configuration\" }\n        ,\"microsoft.maintenance/maintenanceconfigurationsbladeresource\": { \"SingularDisplayName\": \"Maintenance configuration\" }\n        ,\"microsoft.maintenance/publicmaintenanceconfigurations\": { \"SingularDisplayName\": \"Microsoft.Maintenance public maintenance configuration\" }\n        ,\"microsoft.managedidentity/identities\": { \"SingularDisplayName\": \"Microsoft.ManagedIdentity identity\" }\n        ,\"microsoft.managedidentity/userassignedidentities\": { \"SingularDisplayName\": \"Managed Identity\" }\n        ,\"microsoft.managednetwork/managednetworks\": { \"SingularDisplayName\": \"Microsoft.ManagedNetwork managed network\" }\n        ,\"microsoft.managednetwork/managednetworks/managednetworkgroups\": { \"SingularDisplayName\": \"Microsoft.ManagedNetwork managed networks managed network group\" }\n        ,\"microsoft.managednetwork/managednetworks/managednetworkpeeringpolicies\": { \"SingularDisplayName\": \"Microsoft.ManagedNetwork managed networks managed network peering policy\" }\n        ,\"microsoft.managednetworkfabric/accesscontrollists\": { \"SingularDisplayName\": \"Access Control List (Operator Nexus)\" }\n        ,\"microsoft.managednetworkfabric/internetgatewayrules\": { \"SingularDisplayName\": \"Internet Gateway Rule (Operator Nexus)\" }\n        ,\"microsoft.managednetworkfabric/internetgateways\": { \"SingularDisplayName\": \"Internet Gateway (Operator Nexus)\" }\n        ,\"microsoft.managednetworkfabric/ipcommunities\": { \"SingularDisplayName\": \"IP Community (Operator Nexus)\" }\n        ,\"microsoft.managednetworkfabric/ipextendedcommunities\": { \"SingularDisplayName\": \"IP Extended Community (Operator Nexus)\" }\n        ,\"microsoft.managednetworkfabric/ipprefixes\": { \"SingularDisplayName\": \"IP Prefix (Operator Nexus)\" }\n        ,\"microsoft.managednetworkfabric/l2isolationdomains\": { \"SingularDisplayName\": \"Layer 2 Isolation Domain (Operator Nexus)\" }\n        ,\"microsoft.managednetworkfabric/l3isolationdomains\": { \"SingularDisplayName\": \"Layer 3 Isolation Domain (Operator Nexus)\" }\n        ,\"microsoft.managednetworkfabric/l3isolationdomains/externalnetworks\": { \"SingularDisplayName\": \"External Network (Operator Nexus)\" }\n        ,\"microsoft.managednetworkfabric/l3isolationdomains/internalnetworks\": { \"SingularDisplayName\": \"Internal Network (Operator Nexus)\" }\n        ,\"microsoft.managednetworkfabric/neighborgroups\": { \"SingularDisplayName\": \"Neighbor Group (Operator Nexus)\" }\n        ,\"microsoft.managednetworkfabric/networkdevices\": { \"SingularDisplayName\": \"Network Device (Operator Nexus)\" }\n        ,\"microsoft.managednetworkfabric/networkdevices/networkinterfaces\": { \"SingularDisplayName\": \"Network Interface (Operator Nexus)\" }\n        ,\"microsoft.managednetworkfabric/networkfabriccontrollers\": { \"SingularDisplayName\": \"Network Fabric Controller (Operator Nexus)\" }\n        ,\"microsoft.managednetworkfabric/networkfabrics\": { \"SingularDisplayName\": \"Network Fabric (Operator Nexus)\" }\n        ,\"microsoft.managednetworkfabric/networkfabrics/networktonetworkinterconnects\": { \"SingularDisplayName\": \"Network to Network Interconnect (Operator Nexus)\" }\n        ,\"microsoft.managednetworkfabric/networkfabricskus\": { \"SingularDisplayName\": \"Network Fabric SKU (Operator Nexus)\" }\n        ,\"microsoft.managednetworkfabric/networkmonitors\": { \"SingularDisplayName\": \"Microsoft.ManagedNetworkFabric network monitor\" }\n        ,\"microsoft.managednetworkfabric/networkpacketbrokers\": { \"SingularDisplayName\": \"Network Packet Broker (Operator Nexus)\" }\n        ,\"microsoft.managednetworkfabric/networkracks\": { \"SingularDisplayName\": \"Network Rack (Operator Nexus)\" }\n        ,\"microsoft.managednetworkfabric/networktaprules\": { \"SingularDisplayName\": \"Network Tap Rule (Operator Nexus)\" }\n        ,\"microsoft.managednetworkfabric/networktaps\": { \"SingularDisplayName\": \"Network Tap (Operator Nexus)\" }\n        ,\"microsoft.managednetworkfabric/routepolicies\": { \"SingularDisplayName\": \"Route Policy (Operator Nexus)\" }\n        ,\"microsoft.managedservices/marketplaceregistrationdefinitions\": { \"SingularDisplayName\": \"Microsoft.ManagedServices marketplace registration definition\" }\n        ,\"microsoft.managedservices/registrationassignments\": { \"SingularDisplayName\": \"Microsoft.ManagedServices registration assignment\" }\n        ,\"microsoft.managedservices/registrationdefinitions\": { \"SingularDisplayName\": \"Azure Lighthouse\" }\n        ,\"microsoft.management/managementgroups\": { \"SingularDisplayName\": \"Microsoft.Management management group\" }\n        ,\"microsoft.management/managementgroups/microsoft.resources/deploymentstacks\": { \"SingularDisplayName\": \"Deployment stack\" }\n        ,\"microsoft.management/managementgroups/providers/privatelinkassociations\": { \"SingularDisplayName\": \"Application Gateway\" }\n        ,\"microsoft.management/managementgroups/providers/templatespecs\": { \"SingularDisplayName\": \"Template spec\" }\n        ,\"microsoft.management/managementgroups/settings\": { \"SingularDisplayName\": \"Microsoft.Management management groups setting\" }\n        ,\"microsoft.management/managementgroups/subscriptions\": { \"SingularDisplayName\": \"Microsoft.Management management groups subscription\" }\n        ,\"microsoft.management/servicegroups\": { \"SingularDisplayName\": \"Service group\" }\n        ,\"microsoft.managementpartner/partners\": { \"SingularDisplayName\": \"Microsoft.ManagementPartner partner\" }\n        ,\"microsoft.manufacturingplatform/manufacturingdataservices\": { \"SingularDisplayName\": \"Factory Operations Agent in Azure AI Foundry\" }\n        ,\"microsoft.maps/accounts\": { \"SingularDisplayName\": \"Azure Maps Account\" }\n        ,\"microsoft.maps/accounts/creators\": { \"SingularDisplayName\": \"Azure Maps Creator Resource\" }\n        ,\"microsoft.marketplace/privatestores\": { \"SingularDisplayName\": \"Microsoft.Marketplace private store\" }\n        ,\"microsoft.marketplace/privatestores/adminrequestapprovals\": { \"SingularDisplayName\": \"Microsoft.Marketplace private stores admin request approval\" }\n        ,\"microsoft.marketplace/privatestores/collections\": { \"SingularDisplayName\": \"Microsoft.Marketplace private stores collection\" }\n        ,\"microsoft.marketplace/privatestores/collections/offers\": { \"SingularDisplayName\": \"Microsoft.Marketplace private stores collections offer\" }\n        ,\"microsoft.marketplace/privatestores/offers\": { \"SingularDisplayName\": \"Microsoft.Marketplace private stores offer\" }\n        ,\"microsoft.marketplace/privatestores/requestapprovals\": { \"SingularDisplayName\": \"Microsoft.Marketplace private stores request approval\" }\n        ,\"microsoft.media/mediaservices\": { \"SingularDisplayName\": \"Media service\" }\n        ,\"microsoft.media/mediaservices/accountfilters\": { \"SingularDisplayName\": \"Microsoft.Media media services account filter\" }\n        ,\"microsoft.media/mediaservices/assets\": { \"SingularDisplayName\": \"Microsoft.Media media services asset\" }\n        ,\"microsoft.media/mediaservices/assets/assetfilters\": { \"SingularDisplayName\": \"Microsoft.Media media services assets asset filter\" }\n        ,\"microsoft.media/mediaservices/assets/tracks\": { \"SingularDisplayName\": \"Microsoft.Media media services assets track\" }\n        ,\"microsoft.media/mediaservices/assets/tracks/operationresults\": { \"SingularDisplayName\": \"Microsoft.Media media services assets tracks operation result\" }\n        ,\"microsoft.media/mediaservices/assets/tracks/operationstatuses\": { \"SingularDisplayName\": \"Microsoft.Media media services assets tracks operation statuse\" }\n        ,\"microsoft.media/mediaservices/contentkeypolicies\": { \"SingularDisplayName\": \"Microsoft.Media media services content key policy\" }\n        ,\"microsoft.media/mediaservices/liveevents\": { \"SingularDisplayName\": \"Live event\" }\n        ,\"microsoft.media/mediaservices/liveevents/liveoutputs\": { \"SingularDisplayName\": \"Microsoft.Media mediaservices live events live output\" }\n        ,\"microsoft.media/mediaservices/privateendpointconnections\": { \"SingularDisplayName\": \"Microsoft.Media mediaservices private endpoint connection\" }\n        ,\"microsoft.media/mediaservices/privatelinkresources\": { \"SingularDisplayName\": \"Microsoft.Media mediaservices private link resource\" }\n        ,\"microsoft.media/mediaservices/streamingendpoints\": { \"SingularDisplayName\": \"Streaming Endpoint\" }\n        ,\"microsoft.media/mediaservices/streaminglocators\": { \"SingularDisplayName\": \"Microsoft.Media media services streaming locator\" }\n        ,\"microsoft.media/mediaservices/streamingpolicies\": { \"SingularDisplayName\": \"Microsoft.Media media services streaming policy\" }\n        ,\"microsoft.media/mediaservices/transforms\": { \"SingularDisplayName\": \"Microsoft.Media media services transform\" }\n        ,\"microsoft.media/mediaservices/transforms/jobs\": { \"SingularDisplayName\": \"Microsoft.Media media services transforms job\" }\n        ,\"microsoft.mesh/worlds\": { \"SingularDisplayName\": \"Microsoft.Mesh world\" }\n        ,\"microsoft.mesh/worlds/events\": { \"SingularDisplayName\": \"Microsoft.Mesh worlds event\" }\n        ,\"microsoft.mesh/worlds/events/accesspolicies\": { \"SingularDisplayName\": \"Microsoft.Mesh worlds events access policy\" }\n        ,\"microsoft.mesh/worlds/spaces\": { \"SingularDisplayName\": \"Microsoft.Mesh worlds space\" }\n        ,\"microsoft.mesh/worlds/spaces/accesspolicies\": { \"SingularDisplayName\": \"Microsoft.Mesh worlds spaces access policy\" }\n        ,\"microsoft.mesh/worlds/templates\": { \"SingularDisplayName\": \"Microsoft.Mesh worlds template\" }\n        ,\"microsoft.mesh/worlds/templates/accesspolicies\": { \"SingularDisplayName\": \"Microsoft.Mesh worlds templates access policy\" }\n        ,\"microsoft.messagingcatalog/catalogs\": { \"SingularDisplayName\": \"Microsoft.MessagingCatalog catalog\" }\n        ,\"microsoft.messagingconnectors/connectors\": { \"SingularDisplayName\": \"Microsoft.MessagingConnectors connector\" }\n        ,\"microsoft.metaverse/metaverses\": { \"SingularDisplayName\": \"Microsoft.Metaverse metaverse\" }\n        ,\"microsoft.metaverse/metaverses/events\": { \"SingularDisplayName\": \"Microsoft.Metaverse metaverses event\" }\n        ,\"microsoft.metaverse/metaverses/events/accesspolicies\": { \"SingularDisplayName\": \"Microsoft.Metaverse metaverses events access policy\" }\n        ,\"microsoft.metaverse/metaverses/spaces\": { \"SingularDisplayName\": \"Microsoft.Metaverse metaverses space\" }\n        ,\"microsoft.metaverse/metaverses/spaces/accesspolicies\": { \"SingularDisplayName\": \"Microsoft.Metaverse metaverses spaces access policy\" }\n        ,\"microsoft.metaverse/metaverses/templates\": { \"SingularDisplayName\": \"Microsoft.Metaverse metaverses template\" }\n        ,\"microsoft.metaverse/metaverses/templates/accesspolicies\": { \"SingularDisplayName\": \"Microsoft.Metaverse metaverses templates access policy\" }\n        ,\"microsoft.migrate/assessmentprojects\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment project\" }\n        ,\"microsoft.migrate/assessmentprojects/aksassessmentoptions\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects aks assessment option\" }\n        ,\"microsoft.migrate/assessmentprojects/aksassessments\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects aks assessment\" }\n        ,\"microsoft.migrate/assessmentprojects/aksassessments/assessedwebapps\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects aks assessments assessed web app\" }\n        ,\"microsoft.migrate/assessmentprojects/aksassessments/clusters\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects aks assessments cluster\" }\n        ,\"microsoft.migrate/assessmentprojects/aksassessments/summaries\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects aks assessments summary\" }\n        ,\"microsoft.migrate/assessmentprojects/assessmentoptions\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects assessment option\" }\n        ,\"microsoft.migrate/assessmentprojects/assessments\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects assessment\" }\n        ,\"microsoft.migrate/assessmentprojects/assessments/assessedmachines\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects assessments assessed machine\" }\n        ,\"microsoft.migrate/assessmentprojects/assessments/summaries\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects assessments summary\" }\n        ,\"microsoft.migrate/assessmentprojects/avsassessmentoptions\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects avs assessment option\" }\n        ,\"microsoft.migrate/assessmentprojects/avsassessments\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects avs assessment\" }\n        ,\"microsoft.migrate/assessmentprojects/avsassessments/avsassessedmachines\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects avs assessments avs assessed machine\" }\n        ,\"microsoft.migrate/assessmentprojects/avsassessments/summaries\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects avs assessments summary\" }\n        ,\"microsoft.migrate/assessmentprojects/businesscases\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects business case\" }\n        ,\"microsoft.migrate/assessmentprojects/businesscases/avssummaries\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects business cases avs summary\" }\n        ,\"microsoft.migrate/assessmentprojects/businesscases/evaluatedavsmachines\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects business cases evaluated avs machine\" }\n        ,\"microsoft.migrate/assessmentprojects/businesscases/evaluatedmachines\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects business cases evaluated machine\" }\n        ,\"microsoft.migrate/assessmentprojects/businesscases/evaluatedsqlentities\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects business cases evaluated sql entity\" }\n        ,\"microsoft.migrate/assessmentprojects/businesscases/evaluatedwebapps\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects business cases evaluated web app\" }\n        ,\"microsoft.migrate/assessmentprojects/businesscases/iaassummaries\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects business cases iaas summary\" }\n        ,\"microsoft.migrate/assessmentprojects/businesscases/overviewsummaries\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects business cases overview summary\" }\n        ,\"microsoft.migrate/assessmentprojects/businesscases/paassummaries\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects business cases paas summary\" }\n        ,\"microsoft.migrate/assessmentprojects/groups\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects group\" }\n        ,\"microsoft.migrate/assessmentprojects/groups/assessments\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects groups assessment\" }\n        ,\"microsoft.migrate/assessmentprojects/groups/assessments/assessedmachines\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects groups assessments assessed machine\" }\n        ,\"microsoft.migrate/assessmentprojects/groups/avsassessments\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects groups avs assessment\" }\n        ,\"microsoft.migrate/assessmentprojects/groups/avsassessments/avsassessedmachines\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects groups avs assessments avs assessed machine\" }\n        ,\"microsoft.migrate/assessmentprojects/groups/sqlassessments\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects groups sql assessment\" }\n        ,\"microsoft.migrate/assessmentprojects/groups/sqlassessments/assessedsqldatabases\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects groups sql assessments assessed sql database\" }\n        ,\"microsoft.migrate/assessmentprojects/groups/sqlassessments/assessedsqlinstances\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects groups sql assessments assessed sql instance\" }\n        ,\"microsoft.migrate/assessmentprojects/groups/sqlassessments/assessedsqlmachines\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects groups sql assessments assessed sql machine\" }\n        ,\"microsoft.migrate/assessmentprojects/groups/sqlassessments/recommendedassessedentities\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects groups sql assessments recommended assessed entity\" }\n        ,\"microsoft.migrate/assessmentprojects/groups/sqlassessments/summaries\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects groups sql assessments summary\" }\n        ,\"microsoft.migrate/assessmentprojects/groups/webappassessments\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects groups web app assessment\" }\n        ,\"microsoft.migrate/assessmentprojects/groups/webappassessments/assessedwebapps\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects groups web app assessments assessed web app\" }\n        ,\"microsoft.migrate/assessmentprojects/groups/webappassessments/summaries\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects groups web app assessments summary\" }\n        ,\"microsoft.migrate/assessmentprojects/groups/webappassessments/webappserviceplans\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects groups web app assessments web app service plan\" }\n        ,\"microsoft.migrate/assessmentprojects/heterogeneousassessments\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects heterogeneous assessment\" }\n        ,\"microsoft.migrate/assessmentprojects/heterogeneousassessments/summaries\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects heterogeneous assessments summary\" }\n        ,\"microsoft.migrate/assessmentprojects/hypervcollectors\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects hypervcollector\" }\n        ,\"microsoft.migrate/assessmentprojects/importcollectors\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects importcollector\" }\n        ,\"microsoft.migrate/assessmentprojects/importsqlcollectors\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects import sql collector\" }\n        ,\"microsoft.migrate/assessmentprojects/machines\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects machine\" }\n        ,\"microsoft.migrate/assessmentprojects/privateendpointconnections\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects private endpoint connection\" }\n        ,\"microsoft.migrate/assessmentprojects/privatelinkresources\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects private link resource\" }\n        ,\"microsoft.migrate/assessmentprojects/projectsummary\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects project summary\" }\n        ,\"microsoft.migrate/assessmentprojects/servercollectors\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects servercollector\" }\n        ,\"microsoft.migrate/assessmentprojects/sqlassessmentoptions\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects sql assessment option\" }\n        ,\"microsoft.migrate/assessmentprojects/sqlassessments\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects sql assessment\" }\n        ,\"microsoft.migrate/assessmentprojects/sqlassessments/assessedsqldatabases\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects sql assessments assessed sql database\" }\n        ,\"microsoft.migrate/assessmentprojects/sqlassessments/assessedsqlinstances\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects sql assessments assessed sql instance\" }\n        ,\"microsoft.migrate/assessmentprojects/sqlassessments/assessedsqlmachines\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects sql assessments assessed sql machine\" }\n        ,\"microsoft.migrate/assessmentprojects/sqlassessments/summaries\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects sql assessments summary\" }\n        ,\"microsoft.migrate/assessmentprojects/sqlcollectors\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects sqlcollector\" }\n        ,\"microsoft.migrate/assessmentprojects/vmwarecollectors\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects vmwarecollector\" }\n        ,\"microsoft.migrate/assessmentprojects/webappassessmentoptions\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects web app assessment option\" }\n        ,\"microsoft.migrate/assessmentprojects/webappassessments\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects web app assessment\" }\n        ,\"microsoft.migrate/assessmentprojects/webappassessments/assessedwebapps\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects web app assessments assessed web app\" }\n        ,\"microsoft.migrate/assessmentprojects/webappassessments/summaries\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects web app assessments summary\" }\n        ,\"microsoft.migrate/assessmentprojects/webappassessments/webappserviceplans\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects web app assessments web app service plan\" }\n        ,\"microsoft.migrate/assessmentprojects/webappcollectors\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects web app collector\" }\n        ,\"microsoft.migrate/assessmentprojects/webappcompoundassessments\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects web app compound assessment\" }\n        ,\"microsoft.migrate/assessmentprojects/webappcompoundassessments/summaries\": { \"SingularDisplayName\": \"Microsoft.Migrate assessment projects web app compound assessments summary\" }\n        ,\"microsoft.migrate/migrateprojects\": { \"SingularDisplayName\": \"Microsoft.Migrate migrate project\" }\n        ,\"microsoft.migrate/migrateprojects/databaseinstances\": { \"SingularDisplayName\": \"Microsoft.Migrate migrate projects database instance\" }\n        ,\"microsoft.migrate/migrateprojects/databases\": { \"SingularDisplayName\": \"Microsoft.Migrate migrate projects database\" }\n        ,\"microsoft.migrate/migrateprojects/machines\": { \"SingularDisplayName\": \"Microsoft.Migrate migrate projects machine\" }\n        ,\"microsoft.migrate/migrateprojects/migrateevents\": { \"SingularDisplayName\": \"Microsoft.Migrate migrate projects migrate event\" }\n        ,\"microsoft.migrate/migrateprojects/solutions\": { \"SingularDisplayName\": \"Microsoft.Migrate migrate projects solution\" }\n        ,\"microsoft.migrate/modernizeprojects\": { \"SingularDisplayName\": \"Microsoft.Migrate modernize project\" }\n        ,\"microsoft.migrate/modernizeprojects/deployedresources\": { \"SingularDisplayName\": \"Microsoft.Migrate modernize projects deployed resource\" }\n        ,\"microsoft.migrate/modernizeprojects/jobs\": { \"SingularDisplayName\": \"Microsoft.Migrate modernize projects job\" }\n        ,\"microsoft.migrate/modernizeprojects/jobs/operations\": { \"SingularDisplayName\": \"Microsoft.Migrate modernize projects jobs operation\" }\n        ,\"microsoft.migrate/modernizeprojects/migrateagents\": { \"SingularDisplayName\": \"Microsoft.Migrate modernize projects migrate agent\" }\n        ,\"microsoft.migrate/modernizeprojects/migrateagents/operations\": { \"SingularDisplayName\": \"Microsoft.Migrate modernize projects migrate agents operation\" }\n        ,\"microsoft.migrate/modernizeprojects/operations\": { \"SingularDisplayName\": \"Microsoft.Migrate modernize projects operation\" }\n        ,\"microsoft.migrate/modernizeprojects/workloaddeployments\": { \"SingularDisplayName\": \"Microsoft.Migrate modernize projects workload deployment\" }\n        ,\"microsoft.migrate/modernizeprojects/workloaddeployments/operations\": { \"SingularDisplayName\": \"Microsoft.Migrate modernize projects workload deployments operation\" }\n        ,\"microsoft.migrate/modernizeprojects/workloadinstances\": { \"SingularDisplayName\": \"Microsoft.Migrate modernize projects workload instance\" }\n        ,\"microsoft.migrate/modernizeprojects/workloadinstances/operations\": { \"SingularDisplayName\": \"Microsoft.Migrate modernize projects workload instances operation\" }\n        ,\"microsoft.migrate/movecollections\": { \"SingularDisplayName\": \"Microsoft.Migrate move collection\" }\n        ,\"microsoft.migrate/movecollections/moveresources\": { \"SingularDisplayName\": \"Microsoft.Migrate move collections move resource\" }\n        ,\"microsoft.migrate/projects\": { \"SingularDisplayName\": \"Migration project\" }\n        ,\"microsoft.mission/approvals\": { \"SingularDisplayName\": \"Approval\" }\n        ,\"microsoft.mission/catalogs\": { \"SingularDisplayName\": \"Catalog\" }\n        ,\"microsoft.mission/communities\": { \"SingularDisplayName\": \"Community\" }\n        ,\"microsoft.mission/communities/communityendpoints\": { \"SingularDisplayName\": \"Community endpoint\" }\n        ,\"microsoft.mission/communities/transithubs\": { \"SingularDisplayName\": \"Transit hub\" }\n        ,\"microsoft.mission/enclaveconnections\": { \"SingularDisplayName\": \"Enclave connection\" }\n        ,\"microsoft.mission/externalconnections\": { \"SingularDisplayName\": \"Microsoft.Mission external connection\" }\n        ,\"microsoft.mission/internalconnections\": { \"SingularDisplayName\": \"Microsoft.Mission internal connection\" }\n        ,\"microsoft.mission/virtualenclaves\": { \"SingularDisplayName\": \"Enclave\" }\n        ,\"microsoft.mission/virtualenclaves/enclaveendpoints\": { \"SingularDisplayName\": \"Enclave endpoint\" }\n        ,\"microsoft.mission/virtualenclaves/endpoints\": { \"SingularDisplayName\": \"Endpoint\" }\n        ,\"microsoft.mission/virtualenclaves/workloads\": { \"SingularDisplayName\": \"Workload\" }\n        ,\"microsoft.mixedreality/objectanchorsaccounts\": { \"SingularDisplayName\": \"Object Anchors Account\" }\n        ,\"microsoft.mixedreality/objectunderstandingaccounts\": { \"SingularDisplayName\": \"Object Understanding Account\" }\n        ,\"microsoft.mixedreality/remoterenderingaccounts\": { \"SingularDisplayName\": \"Remote Rendering Account\" }\n        ,\"microsoft.mixedreality/spatialanchorsaccounts\": { \"SingularDisplayName\": \"Spatial Anchors Account\" }\n        ,\"microsoft.mixedreality/spatialmapsaccounts\": { \"SingularDisplayName\": \"Microsoft.MixedReality spatial maps account\" }\n        ,\"microsoft.mobilenetwork/amfdeployments\": { \"SingularDisplayName\": \"Microsoft.MobileNetwork amf deployment\" }\n        ,\"microsoft.mobilenetwork/clusterservices\": { \"SingularDisplayName\": \"Microsoft.MobileNetwork cluster service\" }\n        ,\"microsoft.mobilenetwork/mobilenetworks\": { \"SingularDisplayName\": \"Mobile Network\" }\n        ,\"microsoft.mobilenetwork/mobilenetworks/datanetworks\": { \"SingularDisplayName\": \"Data Network\" }\n        ,\"microsoft.mobilenetwork/mobilenetworks/services\": { \"SingularDisplayName\": \"Service\" }\n        ,\"microsoft.mobilenetwork/mobilenetworks/simpolicies\": { \"SingularDisplayName\": \"SIM Policy\" }\n        ,\"microsoft.mobilenetwork/mobilenetworks/sites\": { \"SingularDisplayName\": \"Mobile Network Site\" }\n        ,\"microsoft.mobilenetwork/mobilenetworks/slices\": { \"SingularDisplayName\": \"Slice\" }\n        ,\"microsoft.mobilenetwork/nrfdeployments\": { \"SingularDisplayName\": \"Microsoft.MobileNetwork nrf deployment\" }\n        ,\"microsoft.mobilenetwork/nssfdeployments\": { \"SingularDisplayName\": \"Microsoft.MobileNetwork nssf deployment\" }\n        ,\"microsoft.mobilenetwork/observabilityservices\": { \"SingularDisplayName\": \"Microsoft.MobileNetwork observability service\" }\n        ,\"microsoft.mobilenetwork/packetcorecontrolplanes\": { \"SingularDisplayName\": \"Packet Core Control Plane\" }\n        ,\"microsoft.mobilenetwork/packetcorecontrolplanes/packetcoredataplanes\": { \"SingularDisplayName\": \"Packet Core Data Plane\" }\n        ,\"microsoft.mobilenetwork/packetcorecontrolplanes/packetcoredataplanes/attacheddatanetworks\": { \"SingularDisplayName\": \"Attached Data Network\" }\n        ,\"microsoft.mobilenetwork/packetcorecontrolplaneversions\": { \"SingularDisplayName\": \"Microsoft.MobileNetwork packet core control plane version\" }\n        ,\"microsoft.mobilenetwork/radioaccessnetworks\": { \"SingularDisplayName\": \"Radio Access Network Insights\" }\n        ,\"microsoft.mobilenetwork/sdmdeployments\": { \"SingularDisplayName\": \"Microsoft.MobileNetwork sdm deployment\" }\n        ,\"microsoft.mobilenetwork/simgroups\": { \"SingularDisplayName\": \"SIM Group\" }\n        ,\"microsoft.mobilenetwork/simgroups/sims\": { \"SingularDisplayName\": \"SIM\" }\n        ,\"microsoft.mobilenetwork/sims\": { \"SingularDisplayName\": \"Microsoft.MobileNetwork sim\" }\n        ,\"microsoft.mobilenetwork/smfdeployments\": { \"SingularDisplayName\": \"Microsoft.MobileNetwork smf deployment\" }\n        ,\"microsoft.mobilenetwork/upfdeployments\": { \"SingularDisplayName\": \"Microsoft.MobileNetwork upf deployment\" }\n        ,\"microsoft.mobilenetwork/virtualizedmmedeployments\": { \"SingularDisplayName\": \"Microsoft.MobileNetwork virtualized mme deployment\" }\n        ,\"microsoft.mobilenetwork/vnfagentdeployments\": { \"SingularDisplayName\": \"Microsoft.MobileNetwork vnf agent deployment\" }\n        ,\"microsoft.mobilepacketcore/amfdeployments\": { \"SingularDisplayName\": \"Microsoft.MobilePacketCore amf deployment\" }\n        ,\"microsoft.mobilepacketcore/clusterservices\": { \"SingularDisplayName\": \"Microsoft.MobilePacketCore cluster service\" }\n        ,\"microsoft.mobilepacketcore/networkfunctions\": { \"SingularDisplayName\": \"Microsoft.MobilePacketCore network function\" }\n        ,\"microsoft.mobilepacketcore/nrfdeployments\": { \"SingularDisplayName\": \"Microsoft.MobilePacketCore nrf deployment\" }\n        ,\"microsoft.mobilepacketcore/nssfdeployments\": { \"SingularDisplayName\": \"Microsoft.MobilePacketCore nssf deployment\" }\n        ,\"microsoft.mobilepacketcore/observabilityservices\": { \"SingularDisplayName\": \"Microsoft.MobilePacketCore observability service\" }\n        ,\"microsoft.mobilepacketcore/smfdeployments\": { \"SingularDisplayName\": \"Microsoft.MobilePacketCore smf deployment\" }\n        ,\"microsoft.mobilepacketcore/upfdeployments\": { \"SingularDisplayName\": \"Microsoft.MobilePacketCore upf deployment\" }\n        ,\"microsoft.modsimworkbench/workbenches\": { \"SingularDisplayName\": \"Modeling and Simulation Workbench\" }\n        ,\"microsoft.modsimworkbench/workbenches/chambers\": { \"SingularDisplayName\": \"Chamber\" }\n        ,\"microsoft.modsimworkbench/workbenches/chambers/connectors\": { \"SingularDisplayName\": \"Chamber Connector\" }\n        ,\"microsoft.modsimworkbench/workbenches/chambers/filerequests\": { \"SingularDisplayName\": \"Chamber Data Pipeline File Request\" }\n        ,\"microsoft.modsimworkbench/workbenches/chambers/files\": { \"SingularDisplayName\": \"Chamber Data Pipeline File\" }\n        ,\"microsoft.modsimworkbench/workbenches/chambers/licenses\": { \"SingularDisplayName\": \"Chamber License\" }\n        ,\"microsoft.modsimworkbench/workbenches/chambers/storages\": { \"SingularDisplayName\": \"Chamber Storage\" }\n        ,\"microsoft.modsimworkbench/workbenches/chambers/workloads\": { \"SingularDisplayName\": \"Chamber VM\" }\n        ,\"microsoft.modsimworkbench/workbenches/sharedstorages\": { \"SingularDisplayName\": \"Shared Storage\" }\n        ,\"microsoft.monitor/accounts\": { \"SingularDisplayName\": \"Azure Monitor workspace\" }\n        ,\"microsoft.monitor/investigations\": { \"SingularDisplayName\": \"Microsoft.Monitor investigation\" }\n        ,\"microsoft.monitor/pipelinegroups\": { \"SingularDisplayName\": \"Azure Monitor pipeline\" }\n        ,\"microsoft.mysqldiscovery/mysqlsites\": { \"SingularDisplayName\": \"Microsoft.MySQLDiscovery my sqlsite\" }\n        ,\"microsoft.mysqldiscovery/mysqlsites/agents\": { \"SingularDisplayName\": \"Microsoft.MySQLDiscovery my sqlsites agent\" }\n        ,\"microsoft.mysqldiscovery/mysqlsites/errorsummaries\": { \"SingularDisplayName\": \"Microsoft.MySQLDiscovery my sqlsites error summary\" }\n        ,\"microsoft.mysqldiscovery/mysqlsites/mysqlservers\": { \"SingularDisplayName\": \"Microsoft.MySQLDiscovery my sqlsites my sqlserver\" }\n        ,\"microsoft.mysqldiscovery/mysqlsites/summaries\": { \"SingularDisplayName\": \"Microsoft.MySQLDiscovery my sqlsites summary\" }\n        ,\"microsoft.netapp/netappaccounts\": { \"SingularDisplayName\": \"NetApp account\" }\n        ,\"microsoft.netapp/netappaccounts/backuppolicies\": { \"SingularDisplayName\": \"Backup Policy\" }\n        ,\"microsoft.netapp/netappaccounts/backupvaults\": { \"SingularDisplayName\": \"Backup vault\" }\n        ,\"microsoft.netapp/netappaccounts/capacitypools\": { \"SingularDisplayName\": \"Capacity pool\" }\n        ,\"microsoft.netapp/netappaccounts/capacitypools/volumes\": { \"SingularDisplayName\": \"Volume\" }\n        ,\"microsoft.netapp/netappaccounts/capacitypools/volumes/snapshots\": { \"SingularDisplayName\": \"Snapshot\" }\n        ,\"microsoft.netapp/netappaccounts/capacitypools/volumes/volumequotarules\": { \"SingularDisplayName\": \"User and group quota\" }\n        ,\"microsoft.netapp/netappaccounts/snapshotpolicies\": { \"SingularDisplayName\": \"Snapshot policy\" }\n        ,\"microsoft.netapp/netappaccounts/volumegroups\": { \"SingularDisplayName\": \"VolumeGroup\" }\n        ,\"microsoft.network/applicationgatewayavailablessloptions\": { \"SingularDisplayName\": \"Microsoft.Network application gateway available ssl option\" }\n        ,\"microsoft.network/applicationgatewayavailablessloptions/predefinedpolicies\": { \"SingularDisplayName\": \"Microsoft.Network application gateway available ssl options predefined policy\" }\n        ,\"microsoft.network/applicationgateways\": { \"SingularDisplayName\": \"Application gateway\" }\n        ,\"microsoft.network/applicationgatewaywebapplicationfirewallpolicies\": { \"SingularDisplayName\": \"Application Gateway WAF policy\" }\n        ,\"microsoft.network/applicationsecuritygroups\": { \"SingularDisplayName\": \"Application security group\" }\n        ,\"microsoft.network/azurefirewalls\": { \"SingularDisplayName\": \"Firewall\" }\n        ,\"microsoft.network/azurewebcategories\": { \"SingularDisplayName\": \"Microsoft.Network Azure web category\" }\n        ,\"microsoft.network/bastionhosts\": { \"SingularDisplayName\": \"Bastion\" }\n        ,\"microsoft.network/cloudserviceslots\": { \"SingularDisplayName\": \"Microsoft.Network cloud service slot\" }\n        ,\"microsoft.network/connections\": { \"SingularDisplayName\": \"Connection\" }\n        ,\"microsoft.network/customipprefixes\": { \"SingularDisplayName\": \"Custom IP Prefix\" }\n        ,\"microsoft.network/ddoscustompolicies\": { \"SingularDisplayName\": \"Microsoft.Network DDoS custom policy\" }\n        ,\"microsoft.network/ddosprotectionplans\": { \"SingularDisplayName\": \"DDoS protection plan\" }\n        ,\"microsoft.network/dnsforwardingrulesets\": { \"SingularDisplayName\": \"DNS forwarding ruleset\" }\n        ,\"microsoft.network/dnsresolverdomainlists\": { \"SingularDisplayName\": \"DNS Domain List\" }\n        ,\"microsoft.network/dnsresolverpolicies\": { \"SingularDisplayName\": \"DNS Security Policy\" }\n        ,\"microsoft.network/dnsresolvers\": { \"SingularDisplayName\": \"DNS private resolver\" }\n        ,\"microsoft.network/dnszones\": { \"SingularDisplayName\": \"DNS zone\" }\n        ,\"microsoft.network/dscpconfigurations\": { \"SingularDisplayName\": \"Microsoft.Network DSCP configuration\" }\n        ,\"microsoft.network/expressroutecircuits\": { \"SingularDisplayName\": \"ExpressRoute circuit\" }\n        ,\"microsoft.network/expressroutecrossconnections\": { \"SingularDisplayName\": \"Microsoft.Network express route cross connection\" }\n        ,\"microsoft.network/expressroutecrossconnections/peerings\": { \"SingularDisplayName\": \"Microsoft.Network express route cross connections peering\" }\n        ,\"microsoft.network/expressroutegateways\": { \"SingularDisplayName\": \"ExpressRoute Gateway\" }\n        ,\"microsoft.network/expressroutegateways/expressrouteconnections\": { \"SingularDisplayName\": \"Microsoft.Network express route gateways express route connection\" }\n        ,\"microsoft.network/expressrouteports\": { \"SingularDisplayName\": \"ExpressRoute Direct\" }\n        ,\"microsoft.network/expressrouteportslocations\": { \"SingularDisplayName\": \"Microsoft.Network express route ports location\" }\n        ,\"microsoft.network/firewallpolicies\": { \"SingularDisplayName\": \"Firewall Policy\" }\n        ,\"microsoft.network/frontdoors\": { \"SingularDisplayName\": \"Front Door and CDN profiles\" }\n        ,\"microsoft.network/frontdoorwebapplicationfirewallpolicies\": { \"SingularDisplayName\": \"Front Door WAF policy\" }\n        ,\"microsoft.network/ipallocations\": { \"SingularDisplayName\": \"Microsoft.Network IP allocation\" }\n        ,\"microsoft.network/ipgroups\": { \"SingularDisplayName\": \"IP Group\" }\n        ,\"microsoft.network/loadbalancers\": { \"SingularDisplayName\": \"Load balancer\" }\n        ,\"microsoft.network/localnetworkgateways\": { \"SingularDisplayName\": \"Local network gateway\" }\n        ,\"microsoft.network/natgateways\": { \"SingularDisplayName\": \"NAT gateway\" }\n        ,\"microsoft.network/networkexperimentprofiles\": { \"SingularDisplayName\": \"Microsoft.Network network experiment profile\" }\n        ,\"microsoft.network/networkexperimentprofiles/experiments\": { \"SingularDisplayName\": \"Microsoft.Network network experiment profiles experiment\" }\n        ,\"microsoft.network/networkinterfaces\": { \"SingularDisplayName\": \"Network interface\" }\n        ,\"microsoft.network/networkmanagerconnections\": { \"SingularDisplayName\": \"Microsoft.Network network manager connection\" }\n        ,\"microsoft.network/networkmanagers\": { \"SingularDisplayName\": \"Network manager\" }\n        ,\"microsoft.network/networkmanagers/connectivityconfigurations\": { \"SingularDisplayName\": \"Network manager\" }\n        ,\"microsoft.network/networkmanagers/ipampools\": { \"SingularDisplayName\": \"IP address pool\" }\n        ,\"microsoft.network/networkmanagers/networkgroups\": { \"SingularDisplayName\": \"Network manager\" }\n        ,\"microsoft.network/networkmanagers/routingconfigurations\": { \"SingularDisplayName\": \"Network manager\" }\n        ,\"microsoft.network/networkmanagers/securityadminconfigurations\": { \"SingularDisplayName\": \"Network manager\" }\n        ,\"microsoft.network/networkmanagers/securityuserconfigurations\": { \"SingularDisplayName\": \"Network manager\" }\n        ,\"microsoft.network/networkmanagers/verifierworkspaces\": { \"SingularDisplayName\": \"Verifier Workspace\" }\n        ,\"microsoft.network/networkprofiles\": { \"SingularDisplayName\": \"Microsoft.Network network profile\" }\n        ,\"microsoft.network/networksecuritygroups\": { \"SingularDisplayName\": \"Network security group\" }\n        ,\"microsoft.network/networksecurityperimeters\": { \"SingularDisplayName\": \"Network Security Perimeter\" }\n        ,\"microsoft.network/networksecurityperimeters/profiles\": { \"SingularDisplayName\": \"Network Security Perimeter Profile\" }\n        ,\"microsoft.network/networkverifiers\": { \"SingularDisplayName\": \"Virtual Network Verifier\" }\n        ,\"microsoft.network/networkvirtualappliances\": { \"SingularDisplayName\": \"Microsoft.Network network virtual appliance\" }\n        ,\"microsoft.network/networkwatchers\": { \"SingularDisplayName\": \"Network Watcher\" }\n        ,\"microsoft.network/networkwatchers/flowlogs\": { \"SingularDisplayName\": \"Flow log\" }\n        ,\"microsoft.network/p2svpngateways\": { \"SingularDisplayName\": \"VPN Gateway (Point to Site)\" }\n        ,\"microsoft.network/privatednszones\": { \"SingularDisplayName\": \"Private DNS zone\" }\n        ,\"microsoft.network/privatednszones/virtualnetworklinks\": { \"SingularDisplayName\": \"Virtual network link\" }\n        ,\"microsoft.network/privateendpoints\": { \"SingularDisplayName\": \"Private endpoint\" }\n        ,\"microsoft.network/privatelinkservices\": { \"SingularDisplayName\": \"Private link service\" }\n        ,\"microsoft.network/publicipaddresses\": { \"SingularDisplayName\": \"Public IP address\" }\n        ,\"microsoft.network/publicipprefixes\": { \"SingularDisplayName\": \"Public IP Prefix\" }\n        ,\"microsoft.network/routefilters\": { \"SingularDisplayName\": \"Route filter\" }\n        ,\"microsoft.network/routetables\": { \"SingularDisplayName\": \"Route table\" }\n        ,\"microsoft.network/securitypartnerproviders\": { \"SingularDisplayName\": \"Microsoft.Network security partner provider\" }\n        ,\"microsoft.network/serviceendpointpolicies\": { \"SingularDisplayName\": \"Service endpoint policy\" }\n        ,\"microsoft.network/trafficmanagergeographichierarchies\": { \"SingularDisplayName\": \"Microsoft.Network traffic manager geographic hierarchy\" }\n        ,\"microsoft.network/trafficmanagerprofiles\": { \"SingularDisplayName\": \"Traffic Manager profile\" }\n        ,\"microsoft.network/trafficmanagerusermetricskeys\": { \"SingularDisplayName\": \"Microsoft.Network traffic manager user metrics key\" }\n        ,\"microsoft.network/virtualhubs\": { \"SingularDisplayName\": \"Microsoft.Network/virtualHub\" }\n        ,\"microsoft.network/virtualnetworkgateways\": { \"SingularDisplayName\": \"Virtual network gateway\" }\n        ,\"microsoft.network/virtualnetworks\": { \"SingularDisplayName\": \"Virtual network\" }\n        ,\"microsoft.network/virtualnetworktaps\": { \"SingularDisplayName\": \"Virtual network terminal access point\" }\n        ,\"microsoft.network/virtualrouters\": { \"SingularDisplayName\": \"Microsoft.Network virtual router\" }\n        ,\"microsoft.network/virtualrouters/peerings\": { \"SingularDisplayName\": \"Microsoft.Network virtual routers peering\" }\n        ,\"microsoft.network/virtualwans\": { \"SingularDisplayName\": \"Virtual WAN\" }\n        ,\"microsoft.network/vpngateways\": { \"SingularDisplayName\": \"VPN Gateway (Site to Site)\" }\n        ,\"microsoft.network/vpngateways/vpnconnections\": { \"SingularDisplayName\": \"Microsoft.Network VPN gateways VPN connection\" }\n        ,\"microsoft.network/vpngateways/vpnconnections/vpnlinkconnections\": { \"SingularDisplayName\": \"Microsoft.Network VPN gateways VPN connections VPN link connection\" }\n        ,\"microsoft.network/vpnserverconfigurations\": { \"SingularDisplayName\": \"Microsoft.Network VPN server configuration\" }\n        ,\"microsoft.network/vpnsites\": { \"SingularDisplayName\": \"Microsoft.Network VPN site\" }\n        ,\"microsoft.network/vpnsites/vpnsitelinks\": { \"SingularDisplayName\": \"Microsoft.Network VPN sites VPN site link\" }\n        ,\"microsoft.networkanalytics/dataconnectors\": { \"SingularDisplayName\": \"AIOps - Data Connector\" }\n        ,\"microsoft.networkanalytics/datalakehouses\": { \"SingularDisplayName\": \"AIOps - Data LakeHouse\" }\n        ,\"microsoft.networkanalytics/dataproducts\": { \"SingularDisplayName\": \"Azure Operator Insights ? Data Product\" }\n        ,\"microsoft.networkanalytics/dataproducts/datatypes\": { \"SingularDisplayName\": \"Data Type\" }\n        ,\"microsoft.networkanalytics/dataproductscatalogs\": { \"SingularDisplayName\": \"Microsoft.NetworkAnalytics data products catalog\" }\n        ,\"microsoft.networkanalytics/metricsingestionendpoints\": { \"SingularDisplayName\": \"Microsoft.NetworkAnalytics metrics ingestion endpoint\" }\n        ,\"microsoft.networkanalytics/networkanalyticsproducts\": { \"SingularDisplayName\": \"Microsoft.NetworkAnalytics network analytics product\" }\n        ,\"microsoft.networkcloud/baremetalmachines\": { \"SingularDisplayName\": \"Bare Metal Machine (Operator Nexus)\" }\n        ,\"microsoft.networkcloud/cloudservicesnetworks\": { \"SingularDisplayName\": \"Cloud Services Network (Operator Nexus)\" }\n        ,\"microsoft.networkcloud/clustermanagers\": { \"SingularDisplayName\": \"Cluster Manager (Operator Nexus)\" }\n        ,\"microsoft.networkcloud/clusters\": { \"SingularDisplayName\": \"Cluster (Operator Nexus)\" }\n        ,\"microsoft.networkcloud/clusters/baremetalmachinekeysets\": { \"SingularDisplayName\": \"Cluster Bare Metal Machine Key Set (Operator Nexus)\" }\n        ,\"microsoft.networkcloud/clusters/bmckeysets\": { \"SingularDisplayName\": \"Cluster Baseboard Management Controller Key Set (Operator Nexus)\" }\n        ,\"microsoft.networkcloud/clusters/metricsconfigurations\": { \"SingularDisplayName\": \"Cluster Metrics Configuration (Operator Nexus)\" }\n        ,\"microsoft.networkcloud/edgeclustermachineskus\": { \"SingularDisplayName\": \"Microsoft.NetworkCloud edge cluster machine SKU\" }\n        ,\"microsoft.networkcloud/edgeclusterruntimeversions\": { \"SingularDisplayName\": \"Microsoft.NetworkCloud edge cluster runtime version\" }\n        ,\"microsoft.networkcloud/edgeclusters\": { \"SingularDisplayName\": \"Microsoft.NetworkCloud edge cluster\" }\n        ,\"microsoft.networkcloud/edgeclusters/nodes\": { \"SingularDisplayName\": \"Microsoft.NetworkCloud edge clusters node\" }\n        ,\"microsoft.networkcloud/edgeclusterskus\": { \"SingularDisplayName\": \"Microsoft.NetworkCloud edge cluster SKU\" }\n        ,\"microsoft.networkcloud/kubernetesclusters\": { \"SingularDisplayName\": \"Kubernetes Cluster (Operator Nexus)\" }\n        ,\"microsoft.networkcloud/kubernetesclusters/agentpools\": { \"SingularDisplayName\": \"Agent Pool (Operator Nexus)\" }\n        ,\"microsoft.networkcloud/kubernetesclusters/features\": { \"SingularDisplayName\": \"Kubernetes Cluster Feature (Operator Nexus)\" }\n        ,\"microsoft.networkcloud/l2networks\": { \"SingularDisplayName\": \"Layer 2 Network (Operator Nexus)\" }\n        ,\"microsoft.networkcloud/l3networks\": { \"SingularDisplayName\": \"Layer 3 Network (Operator Nexus)\" }\n        ,\"microsoft.networkcloud/racks\": { \"SingularDisplayName\": \"Compute Rack (Operator Nexus)\" }\n        ,\"microsoft.networkcloud/rackskus\": { \"SingularDisplayName\": \"Microsoft.NetworkCloud rack SKU\" }\n        ,\"microsoft.networkcloud/registrationhubs\": { \"SingularDisplayName\": \"Microsoft.NetworkCloud registration hub\" }\n        ,\"microsoft.networkcloud/registrationhubs/images\": { \"SingularDisplayName\": \"Microsoft.NetworkCloud registration hubs image\" }\n        ,\"microsoft.networkcloud/registrationhubs/machines\": { \"SingularDisplayName\": \"Microsoft.NetworkCloud registration hubs machine\" }\n        ,\"microsoft.networkcloud/storageappliances\": { \"SingularDisplayName\": \"Storage Appliance (Operator Nexus)\" }\n        ,\"microsoft.networkcloud/trunkednetworks\": { \"SingularDisplayName\": \"Trunked Network (Operator Nexus)\" }\n        ,\"microsoft.networkcloud/virtualmachines\": { \"SingularDisplayName\": \"Virtual Machine (Operator Nexus)\" }\n        ,\"microsoft.networkcloud/virtualmachines/consoles\": { \"SingularDisplayName\": \"Virtual Machine Console (Operator Nexus)\" }\n        ,\"microsoft.networkcloud/volumes\": { \"SingularDisplayName\": \"Volume (Operator Nexus)\" }\n        ,\"microsoft.networkfunction/azuretrafficcollectors\": { \"SingularDisplayName\": \"ExpressRoute traffic collector\" }\n        ,\"microsoft.networkfunction/meshvpns\": { \"SingularDisplayName\": \"Mesh VPN\" }\n        ,\"microsoft.nexusidentity/identitycontrollers\": { \"SingularDisplayName\": \"Microsoft.NexusIdentity identity controller\" }\n        ,\"microsoft.nexusidentity/identitysets\": { \"SingularDisplayName\": \"Microsoft.NexusIdentity identity set\" }\n        ,\"microsoft.notebooks/notebookproxies\": { \"SingularDisplayName\": \"Microsoft.Notebooks notebook proxy\" }\n        ,\"microsoft.notificationhubs/namespaces\": { \"SingularDisplayName\": \"Notification Hub Namespace\" }\n        ,\"microsoft.notificationhubs/namespaces/notificationhubs\": { \"SingularDisplayName\": \"Notification Hub\" }\n        ,\"microsoft.objectstore/osnamespaces\": { \"SingularDisplayName\": \"Microsoft.ObjectStore os namespace\" }\n    })[tolower(id)]\n}\n",
                    "$fxv#4": "// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\n.create-or-alter function \nwith (docstring = 'Return details about the specified ID.', folder = 'OpenData/Internal')\n_resource_type_4(id: string) {\n    dynamic({\n        \"microsoft.offazure/hypervsites\": { \"SingularDisplayName\": \"Microsoft.OffAzure hyperv site\" }\n        ,\"microsoft.offazure/hypervsites/clusters\": { \"SingularDisplayName\": \"Microsoft.OffAzure hyperv sites cluster\" }\n        ,\"microsoft.offazure/hypervsites/hosts\": { \"SingularDisplayName\": \"Microsoft.OffAzure hyperv sites host\" }\n        ,\"microsoft.offazure/hypervsites/jobs\": { \"SingularDisplayName\": \"Microsoft.OffAzure hyperv sites job\" }\n        ,\"microsoft.offazure/hypervsites/machines\": { \"SingularDisplayName\": \"Microsoft.OffAzure hyperv sites machine\" }\n        ,\"microsoft.offazure/hypervsites/machines/softwareinventories\": { \"SingularDisplayName\": \"Microsoft.OffAzure hyperv sites machines software inventory\" }\n        ,\"microsoft.offazure/hypervsites/operationsstatus\": { \"SingularDisplayName\": \"Microsoft.OffAzure hyperv sites operations statu\" }\n        ,\"microsoft.offazure/hypervsites/runasaccounts\": { \"SingularDisplayName\": \"Microsoft.OffAzure hyperv sites run as account\" }\n        ,\"microsoft.offazure/importsites\": { \"SingularDisplayName\": \"Microsoft.OffAzure import site\" }\n        ,\"microsoft.offazure/importsites/deletejobs\": { \"SingularDisplayName\": \"Microsoft.OffAzure import sites delete job\" }\n        ,\"microsoft.offazure/importsites/exportjobs\": { \"SingularDisplayName\": \"Microsoft.OffAzure import sites export job\" }\n        ,\"microsoft.offazure/importsites/importjobs\": { \"SingularDisplayName\": \"Microsoft.OffAzure import sites import job\" }\n        ,\"microsoft.offazure/importsites/jobs\": { \"SingularDisplayName\": \"Microsoft.OffAzure import sites job\" }\n        ,\"microsoft.offazure/importsites/machines\": { \"SingularDisplayName\": \"Microsoft.OffAzure import sites machine\" }\n        ,\"microsoft.offazure/mastersites\": { \"SingularDisplayName\": \"Microsoft.OffAzure master site\" }\n        ,\"microsoft.offazure/mastersites/operationsstatus\": { \"SingularDisplayName\": \"Microsoft.OffAzure master sites operations statu\" }\n        ,\"microsoft.offazure/mastersites/privateendpointconnections\": { \"SingularDisplayName\": \"Microsoft.OffAzure master sites private endpoint connection\" }\n        ,\"microsoft.offazure/mastersites/privatelinkresources\": { \"SingularDisplayName\": \"Microsoft.OffAzure master sites private link resource\" }\n        ,\"microsoft.offazure/mastersites/sqlsites\": { \"SingularDisplayName\": \"Microsoft.OffAzure master sites sql site\" }\n        ,\"microsoft.offazure/mastersites/sqlsites/discoverysitedatasources\": { \"SingularDisplayName\": \"Microsoft.OffAzure master sites sql sites discovery site data source\" }\n        ,\"microsoft.offazure/mastersites/sqlsites/jobs\": { \"SingularDisplayName\": \"Microsoft.OffAzure master sites sql sites job\" }\n        ,\"microsoft.offazure/mastersites/sqlsites/operationsstatus\": { \"SingularDisplayName\": \"Microsoft.OffAzure master sites sql sites operations statu\" }\n        ,\"microsoft.offazure/mastersites/sqlsites/runasaccounts\": { \"SingularDisplayName\": \"Microsoft.OffAzure master sites sql sites run as account\" }\n        ,\"microsoft.offazure/mastersites/sqlsites/sqlavailabilitygroups\": { \"SingularDisplayName\": \"Microsoft.OffAzure master sites sql sites sql availability group\" }\n        ,\"microsoft.offazure/mastersites/sqlsites/sqldatabases\": { \"SingularDisplayName\": \"Microsoft.OffAzure master sites sql sites sql database\" }\n        ,\"microsoft.offazure/mastersites/sqlsites/sqlservers\": { \"SingularDisplayName\": \"Microsoft.OffAzure master sites sql sites sql server\" }\n        ,\"microsoft.offazure/mastersites/webappsites\": { \"SingularDisplayName\": \"Microsoft.OffAzure master sites web app site\" }\n        ,\"microsoft.offazure/mastersites/webappsites/discoverysitedatasources\": { \"SingularDisplayName\": \"Microsoft.OffAzure master sites web app sites discovery site data source\" }\n        ,\"microsoft.offazure/mastersites/webappsites/extendedmachines\": { \"SingularDisplayName\": \"Microsoft.OffAzure master sites web app sites extended machine\" }\n        ,\"microsoft.offazure/mastersites/webappsites/iiswebapplications\": { \"SingularDisplayName\": \"Microsoft.OffAzure master sites web app sites iis web application\" }\n        ,\"microsoft.offazure/mastersites/webappsites/iiswebservers\": { \"SingularDisplayName\": \"Microsoft.OffAzure master sites web app sites iis web server\" }\n        ,\"microsoft.offazure/mastersites/webappsites/runasaccounts\": { \"SingularDisplayName\": \"Microsoft.OffAzure master sites web app sites runasaccount\" }\n        ,\"microsoft.offazure/mastersites/webappsites/tomcatwebapplications\": { \"SingularDisplayName\": \"Microsoft.OffAzure master sites web app sites tomcat web application\" }\n        ,\"microsoft.offazure/mastersites/webappsites/tomcatwebservers\": { \"SingularDisplayName\": \"Microsoft.OffAzure master sites web app sites tomcat web server\" }\n        ,\"microsoft.offazure/serversites\": { \"SingularDisplayName\": \"Microsoft.OffAzure server site\" }\n        ,\"microsoft.offazure/serversites/jobs\": { \"SingularDisplayName\": \"Microsoft.OffAzure server sites job\" }\n        ,\"microsoft.offazure/serversites/machines\": { \"SingularDisplayName\": \"Microsoft.OffAzure server sites machine\" }\n        ,\"microsoft.offazure/serversites/machines/softwareinventories\": { \"SingularDisplayName\": \"Microsoft.OffAzure server sites machines software inventory\" }\n        ,\"microsoft.offazure/serversites/operationsstatus\": { \"SingularDisplayName\": \"Microsoft.OffAzure server sites operations statu\" }\n        ,\"microsoft.offazure/serversites/runasaccounts\": { \"SingularDisplayName\": \"Microsoft.OffAzure server sites run as account\" }\n        ,\"microsoft.offazure/vmwaresites\": { \"SingularDisplayName\": \"Microsoft.OffAzure vmware site\" }\n        ,\"microsoft.offazure/vmwaresites/hosts\": { \"SingularDisplayName\": \"Microsoft.OffAzure vmware sites host\" }\n        ,\"microsoft.offazure/vmwaresites/jobs\": { \"SingularDisplayName\": \"Microsoft.OffAzure vmware sites job\" }\n        ,\"microsoft.offazure/vmwaresites/machines\": { \"SingularDisplayName\": \"Microsoft.OffAzure vmware sites machine\" }\n        ,\"microsoft.offazure/vmwaresites/machines/softwareinventories\": { \"SingularDisplayName\": \"Microsoft.OffAzure vmware sites machines software inventory\" }\n        ,\"microsoft.offazure/vmwaresites/operationsstatus\": { \"SingularDisplayName\": \"Microsoft.OffAzure vmware sites operations statu\" }\n        ,\"microsoft.offazure/vmwaresites/runasaccounts\": { \"SingularDisplayName\": \"Microsoft.OffAzure vmware sites run as account\" }\n        ,\"microsoft.offazure/vmwaresites/vcenters\": { \"SingularDisplayName\": \"Microsoft.OffAzure vmware sites vcenter\" }\n        ,\"microsoft.offazurespringboot/springbootsites\": { \"SingularDisplayName\": \"Microsoft.OffAzureSpringBoot springbootsite\" }\n        ,\"microsoft.offazurespringboot/springbootsites/errorsummaries\": { \"SingularDisplayName\": \"Microsoft.OffAzureSpringBoot springbootsites error summary\" }\n        ,\"microsoft.offazurespringboot/springbootsites/springbootapps\": { \"SingularDisplayName\": \"Microsoft.OffAzureSpringBoot springbootsites springbootapp\" }\n        ,\"microsoft.offazurespringboot/springbootsites/springbootservers\": { \"SingularDisplayName\": \"Microsoft.OffAzureSpringBoot springbootsites springbootserver\" }\n        ,\"microsoft.offazurespringboot/springbootsites/summaries\": { \"SingularDisplayName\": \"Microsoft.OffAzureSpringBoot springbootsites summary\" }\n        ,\"microsoft.onlineexperimentation/workspaces\": { \"SingularDisplayName\": \"Online Experimentation Workspace\" }\n        ,\"microsoft.openenergyplatform/energyservices\": { \"SingularDisplayName\": \"Azure Data Manager for Energy\" }\n        ,\"microsoft.openlogisticsplatform/workspaces\": { \"SingularDisplayName\": \"Microsoft.OpenLogisticsPlatform workspace\" }\n        ,\"microsoft.openlogisticsplatform/workspaces/applicationregistrations\": { \"SingularDisplayName\": \"Microsoft.OpenLogisticsPlatform workspaces application registration\" }\n        ,\"microsoft.openlogisticsplatform/workspaces/applications\": { \"SingularDisplayName\": \"Microsoft.OpenLogisticsPlatform workspaces application\" }\n        ,\"microsoft.openlogisticsplatform/workspaces/eventgridfilters\": { \"SingularDisplayName\": \"Microsoft.OpenLogisticsPlatform workspaces event grid filter\" }\n        ,\"microsoft.openlogisticsplatform/workspaces/shares\": { \"SingularDisplayName\": \"Microsoft.OpenLogisticsPlatform workspaces share\" }\n        ,\"microsoft.openlogisticsplatform/workspaces/sharesubscriptions\": { \"SingularDisplayName\": \"Microsoft.OpenLogisticsPlatform workspaces share subscription\" }\n        ,\"microsoft.operationalinsights/clusters\": { \"SingularDisplayName\": \"Log Analytics dedicated cluster\" }\n        ,\"microsoft.operationalinsights/querypacks\": { \"SingularDisplayName\": \"Log Analytics query pack\" }\n        ,\"microsoft.operationalinsights/workspaces\": { \"SingularDisplayName\": \"Log Analytics workspace\" }\n        ,\"microsoft.operationsmanagement/managementassociations\": { \"SingularDisplayName\": \"Microsoft.OperationsManagement management association\" }\n        ,\"microsoft.operationsmanagement/solutions\": { \"SingularDisplayName\": \"Solution\" }\n        ,\"microsoft.operatorvoicemail/operatorvoicemailinstances\": { \"SingularDisplayName\": \"Microsoft.OperatorVoicemail operator voicemail instance\" }\n        ,\"microsoft.oraclediscovery/oraclesites\": { \"SingularDisplayName\": \"Microsoft.OracleDiscovery oracle site\" }\n        ,\"microsoft.oraclediscovery/oraclesites/errorsummaries\": { \"SingularDisplayName\": \"Microsoft.OracleDiscovery oracle sites error summary\" }\n        ,\"microsoft.oraclediscovery/oraclesites/oracledatabases\": { \"SingularDisplayName\": \"Microsoft.OracleDiscovery oracle sites oracle database\" }\n        ,\"microsoft.oraclediscovery/oraclesites/oracleservers\": { \"SingularDisplayName\": \"Microsoft.OracleDiscovery oracle sites oracle server\" }\n        ,\"microsoft.oraclediscovery/oraclesites/summaries\": { \"SingularDisplayName\": \"Microsoft.OracleDiscovery oracle sites summary\" }\n        ,\"microsoft.orbital/cloudaccessrouters\": { \"SingularDisplayName\": \"Cloud Access Router\" }\n        ,\"microsoft.orbital/contactprofiles\": { \"SingularDisplayName\": \"Contact Profile\" }\n        ,\"microsoft.orbital/edgesites\": { \"SingularDisplayName\": \"Edge Site\" }\n        ,\"microsoft.orbital/geocatalogs\": { \"SingularDisplayName\": \"GeoCatalog\" }\n        ,\"microsoft.orbital/globalcommunicationssites\": { \"SingularDisplayName\": \"Microsoft.Orbital global communications site\" }\n        ,\"microsoft.orbital/groundstations\": { \"SingularDisplayName\": \"Ground Station\" }\n        ,\"microsoft.orbital/l2connections\": { \"SingularDisplayName\": \"L2 Connection\" }\n        ,\"microsoft.orbital/sdwancontrollers\": { \"SingularDisplayName\": \"SDWAN Controller\" }\n        ,\"microsoft.orbital/spacecrafts\": { \"SingularDisplayName\": \"Spacecraft\" }\n        ,\"microsoft.orbital/spacecrafts/contacts\": { \"SingularDisplayName\": \"Contact\" }\n        ,\"microsoft.orbital/terminals\": { \"SingularDisplayName\": \"Cloud Access Terminal\" }\n        ,\"microsoft.partnermanagedconsumerrecurrence/recurrences\": { \"SingularDisplayName\": \"Microsoft.PartnerManagedConsumerRecurrence recurrence\" }\n        ,\"microsoft.partnermanagedconsumerrecurrence/recurrences/operationresult\": { \"SingularDisplayName\": \"Microsoft.PartnerManagedConsumerRecurrence recurrences operation result\" }\n        ,\"microsoft.peering/peerasns\": { \"SingularDisplayName\": \"Microsoft.Peering peer asn\" }\n        ,\"microsoft.peering/peerings\": { \"SingularDisplayName\": \"Peering\" }\n        ,\"microsoft.peering/peerings/registeredasns\": { \"SingularDisplayName\": \"Registered ASN\" }\n        ,\"microsoft.peering/peerings/registeredprefixes\": { \"SingularDisplayName\": \"Registered prefix\" }\n        ,\"microsoft.peering/peeringservices\": { \"SingularDisplayName\": \"Peering Service\" }\n        ,\"microsoft.peering/peeringservices/prefixes\": { \"SingularDisplayName\": \"Peering Service Prefix\" }\n        ,\"microsoft.pki/pkis\": { \"SingularDisplayName\": \"Microsoft.Pki PKI\" }\n        ,\"microsoft.pki/pkis/certificateauthorities\": { \"SingularDisplayName\": \"Microsoft.Pki pkis certificate authority\" }\n        ,\"microsoft.pki/pkis/enrollmentpolicies\": { \"SingularDisplayName\": \"Microsoft.Pki pkis enrollment policy\" }\n        ,\"microsoft.policyinsights/attestations\": { \"SingularDisplayName\": \"Microsoft.PolicyInsights attestation\" }\n        ,\"microsoft.policyinsights/policymetadata\": { \"SingularDisplayName\": \"Microsoft.PolicyInsights policy metadata\" }\n        ,\"microsoft.policyinsights/remediations\": { \"SingularDisplayName\": \"Microsoft.PolicyInsights remediation\" }\n        ,\"microsoft.portal/consoles\": { \"SingularDisplayName\": \"Microsoft.Portal console\" }\n        ,\"microsoft.portal/dashboards\": { \"SingularDisplayName\": \"Shared dashboard\" }\n        ,\"microsoft.portal/tenantconfigurations\": { \"SingularDisplayName\": \"Microsoft.Portal tenant configuration\" }\n        ,\"microsoft.portal/usersettings\": { \"SingularDisplayName\": \"Microsoft.Portal user setting\" }\n        ,\"microsoft.portal/virtual-privatedashboards\": { \"SingularDisplayName\": \"Private dashboard\" }\n        ,\"microsoft.portalservices/copilotsettings\": { \"SingularDisplayName\": \"Microsoft.PortalServices copilot setting\" }\n        ,\"microsoft.portalservices/dashboards\": { \"SingularDisplayName\": \"Shared dashboard\" }\n        ,\"microsoft.portalservices/extensions\": { \"SingularDisplayName\": \"Portal Extension\" }\n        ,\"microsoft.portalservices/extensions/deployments\": { \"SingularDisplayName\": \"Extension Deployment\" }\n        ,\"microsoft.portalservices/extensions/slots\": { \"SingularDisplayName\": \"Extension Slot\" }\n        ,\"microsoft.portalservices/extensions/versions\": { \"SingularDisplayName\": \"Extension Version\" }\n        ,\"microsoft.portalservices/settings\": { \"SingularDisplayName\": \"Microsoft.PortalServices setting\" }\n        ,\"microsoft.powerbi/privatelinkservicesforpowerbi\": { \"SingularDisplayName\": \"Microsoft.PowerBI private link services for power bi\" }\n        ,\"microsoft.powerbi/privatelinkservicesforpowerbi/privateendpointconnections\": { \"SingularDisplayName\": \"Microsoft.PowerBI private link services for power bi private endpoint connection\" }\n        ,\"microsoft.powerbi/privatelinkservicesforpowerbi/privatelinkresources\": { \"SingularDisplayName\": \"Microsoft.PowerBI private link services for power bi private link resource\" }\n        ,\"microsoft.powerbi/workspacecollections\": { \"SingularDisplayName\": \"Microsoft.PowerBI workspace collection\" }\n        ,\"microsoft.powerbidedicated/autoscalevcores\": { \"SingularDisplayName\": \"Microsoft.PowerBIDedicated auto scale vcore\" }\n        ,\"microsoft.powerbidedicated/capacities\": { \"SingularDisplayName\": \"Power BI Embedded\" }\n        ,\"microsoft.powerplatform/accounts\": { \"SingularDisplayName\": \"Microsoft.PowerPlatform account\" }\n        ,\"microsoft.premonition/libraries\": { \"SingularDisplayName\": \"Microsoft.Premonition library\" }\n        ,\"microsoft.premonition/libraries/analyses\": { \"SingularDisplayName\": \"Microsoft.Premonition libraries analyse\" }\n        ,\"microsoft.premonition/libraries/samples\": { \"SingularDisplayName\": \"Microsoft.Premonition libraries sample\" }\n        ,\"microsoft.professionalservice/resources\": { \"SingularDisplayName\": \"Professional Service\" }\n        ,\"microsoft.programmableconnectivity/gateways\": { \"SingularDisplayName\": \"APC Gateway\" }\n        ,\"microsoft.programmableconnectivity/operatorapiconnections\": { \"SingularDisplayName\": \"APC Operator API Connection\" }\n        ,\"microsoft.programmableconnectivity/operatorapiplans\": { \"SingularDisplayName\": \"APC Operator API Plan\" }\n        ,\"microsoft.proposal/proposals\": { \"SingularDisplayName\": \"Microsoft.Proposal proposal\" }\n        ,\"microsoft.providerhub/providerregistrations\": { \"SingularDisplayName\": \"Resource Provider as a Service\" }\n        ,\"microsoft.providerhub/providerregistrations/customrollouts\": { \"SingularDisplayName\": \"Rollout\" }\n        ,\"microsoft.providerhub/providerregistrations/defaultrollouts\": { \"SingularDisplayName\": \"Rollout\" }\n        ,\"microsoft.providerhub/providerregistrations/resourcetyperegistrations\": { \"SingularDisplayName\": \"Resource Type\" }\n        ,\"microsoft.providerhub/providerregistrations/resourcetyperegistrations/resourcetyperegistrations\": { \"SingularDisplayName\": \"Resource Type\" }\n        ,\"microsoft.providerhubdevtest/regionalstresstests\": { \"SingularDisplayName\": \"Microsoft.ProviderHubDevTest regional stresstest\" }\n        ,\"microsoft.providerhubdevtest/stresstests\": { \"SingularDisplayName\": \"Microsoft.ProviderHubDevTest stresstest\" }\n        ,\"microsoft.purview/accounts\": { \"SingularDisplayName\": \"Microsoft Purview account\" }\n        ,\"microsoft.quantum/provideraccounts\": { \"SingularDisplayName\": \"Microsoft.Quantum provider account\" }\n        ,\"microsoft.quantum/workspaces\": { \"SingularDisplayName\": \"Quantum Workspace\" }\n        ,\"microsoft.quota/groupquotas\": { \"SingularDisplayName\": \"Microsoft.Quota group quota\" }\n        ,\"microsoft.quota/groupquotas/groupquotarequests\": { \"SingularDisplayName\": \"Microsoft.Quota group quotas group quota request\" }\n        ,\"microsoft.quota/groupquotas/quotaallocationrequests\": { \"SingularDisplayName\": \"Microsoft.Quota group quotas quota allocation request\" }\n        ,\"microsoft.quota/groupquotas/quotaallocations\": { \"SingularDisplayName\": \"Microsoft.Quota group quotas quota allocation\" }\n        ,\"microsoft.quota/groupquotas/subscriptionrequests\": { \"SingularDisplayName\": \"Microsoft.Quota group quotas subscription request\" }\n        ,\"microsoft.quota/groupquotas/subscriptions\": { \"SingularDisplayName\": \"Microsoft.Quota group quotas subscription\" }\n        ,\"microsoft.quota/quotarequests\": { \"SingularDisplayName\": \"Microsoft.Quota quota request\" }\n        ,\"microsoft.quota/quotas\": { \"SingularDisplayName\": \"Microsoft.Quota quota\" }\n        ,\"microsoft.quota/usages\": { \"SingularDisplayName\": \"Microsoft.Quota usage\" }\n        ,\"microsoft.recommendationsservice/accounts\": { \"SingularDisplayName\": \"Intelligent Recommendations Account\" }\n        ,\"microsoft.recommendationsservice/accounts/modeling\": { \"SingularDisplayName\": \"Modeling\" }\n        ,\"microsoft.recommendationsservice/accounts/serviceendpoints\": { \"SingularDisplayName\": \"Service Endpoint\" }\n        ,\"microsoft.recoveryservices/replicationeligibilityresults\": { \"SingularDisplayName\": \"Microsoft.RecoveryServices replication eligibility result\" }\n        ,\"microsoft.recoveryservices/vaults\": { \"SingularDisplayName\": \"Recovery Services vault\" }\n        ,\"microsoft.recoveryservices/vaults/backupfabrics/protectioncontainers/protecteditems\": { \"SingularDisplayName\": \"Backup Item\" }\n        ,\"microsoft.recoveryservicesbvtd/vaults\": { \"SingularDisplayName\": \"Recovery Services BVTD\" }\n        ,\"microsoft.recoveryservicesbvtd2/vaults\": { \"SingularDisplayName\": \"Recovery Services BVTD2\" }\n        ,\"microsoft.recoveryservicesintd/vaults\": { \"SingularDisplayName\": \"Recovery Services INTD\" }\n        ,\"microsoft.recoveryservicesintd2/vaults\": { \"SingularDisplayName\": \"Recovery Services INTD2\" }\n        ,\"microsoft.redhatopenshift/openshiftclusters\": { \"SingularDisplayName\": \"Azure Red Hat OpenShift cluster\" }\n        ,\"microsoft.relationships/dependencyof\": { \"SingularDisplayName\": \"Dependency Relationship\" }\n        ,\"microsoft.relationships/servicegroupmember\": { \"SingularDisplayName\": \"Service group member relationship\" }\n        ,\"microsoft.relationships/servicegrouprelationships\": { \"SingularDisplayName\": \"Connected Resource\" }\n        ,\"microsoft.relay/namespaces\": { \"SingularDisplayName\": \"Relay\" }\n        ,\"microsoft.relay/namespaces/hybridconnections\": { \"SingularDisplayName\": \"Hybrid connection\" }\n        ,\"microsoft.relay/namespaces/wcfrelays\": { \"SingularDisplayName\": \"WCF relay\" }\n        ,\"microsoft.resilience/resiliencestates\": { \"SingularDisplayName\": \"Microsoft.Resilience resilience state\" }\n        ,\"microsoft.resourceconnector/appliances\": { \"SingularDisplayName\": \"Resource bridge\" }\n        ,\"microsoft.resourcegraph/queries\": { \"SingularDisplayName\": \"Resource Graph query\" }\n        ,\"microsoft.resourcehealth/availabilitystatuses\": { \"SingularDisplayName\": \"Microsoft.ResourceHealth availability statuse\" }\n        ,\"microsoft.resourcehealth/childavailabilitystatuses\": { \"SingularDisplayName\": \"Microsoft.ResourceHealth child availability statuse\" }\n        ,\"microsoft.resourcehealth/emergingissues\": { \"SingularDisplayName\": \"Microsoft.ResourceHealth emerging issue\" }\n        ,\"microsoft.resourcehealth/events\": { \"SingularDisplayName\": \"Microsoft.ResourceHealth event\" }\n        ,\"microsoft.resourcehealth/events/impactedresources\": { \"SingularDisplayName\": \"Microsoft.ResourceHealth events impacted resource\" }\n        ,\"microsoft.resourcehealth/metadata\": { \"SingularDisplayName\": \"Microsoft.ResourceHealth metadata\" }\n        ,\"microsoft.resources/builtintemplatespecs\": { \"SingularDisplayName\": \"Built-in template spec\" }\n        ,\"microsoft.resources/changes\": { \"SingularDisplayName\": \"Microsoft.Resources change\" }\n        ,\"microsoft.resources/databoundaries\": { \"SingularDisplayName\": \"Microsoft.Resources data boundary\" }\n        ,\"microsoft.resources/deletedresources\": { \"SingularDisplayName\": \"Recycle Bin\" }\n        ,\"microsoft.resources/deployments\": { \"SingularDisplayName\": \"Microsoft.Resources deployment\" }\n        ,\"microsoft.resources/deployments/operations\": { \"SingularDisplayName\": \"Microsoft.Resources deployments operation\" }\n        ,\"microsoft.resources/deploymentscripts\": { \"SingularDisplayName\": \"Deployment Script\" }\n        ,\"microsoft.resources/deploymentstacks\": { \"SingularDisplayName\": \"Deployment stack\" }\n        ,\"microsoft.resources/mobobrokers\": { \"SingularDisplayName\": \"Microsoft.Resources mobo broker\" }\n        ,\"microsoft.resources/resourcechange\": { \"SingularDisplayName\": \"Change Analysis\" }\n        ,\"microsoft.resources/resourcechanges\": { \"SingularDisplayName\": \"Resource change\" }\n        ,\"microsoft.resources/resourcegraphvisualizer\": { \"SingularDisplayName\": \"Resource Graph Visualizer\" }\n        ,\"microsoft.resources/resourcegroups\": { \"SingularDisplayName\": \"Microsoft.Resources resource group\" }\n        ,\"microsoft.resources/resources\": { \"SingularDisplayName\": \"Resource\" }\n        ,\"microsoft.resources/snapshots\": { \"SingularDisplayName\": \"Microsoft.Resources snapshot\" }\n        ,\"microsoft.resources/subscriptions\": { \"SingularDisplayName\": \"Subscription\" }\n        ,\"microsoft.resources/subscriptions/resourcegroups\": { \"SingularDisplayName\": \"Resource group\" }\n        ,\"microsoft.resources/tags\": { \"SingularDisplayName\": \"Microsoft.Resources tag\" }\n        ,\"microsoft.resources/templatespecs\": { \"SingularDisplayName\": \"Template spec\" }\n        ,\"microsoft.resources/virtualsubscriptionsforresourcepicker\": { \"SingularDisplayName\": \"Subscription\" }\n        ,\"microsoft.saas/applications\": { \"SingularDisplayName\": \"Software as a Service (classic)\" }\n        ,\"microsoft.saas/resources\": { \"SingularDisplayName\": \"SaaS\" }\n        ,\"microsoft.saas/saasresources\": { \"SingularDisplayName\": \"SaaS (classic)\" }\n        ,\"microsoft.saashub/cloudservices\": { \"SingularDisplayName\": \"Microsoft.SaaSHub cloud service\" }\n        ,\"microsoft.saashub/cloudservices/hidden\": { \"SingularDisplayName\": \"Microsoft SaaS\" }\n        ,\"microsoft.saashub/saasresources\": { \"SingularDisplayName\": \"Microsoft.SaaSHub saas resource\" }\n        ,\"microsoft.salescopilot/conversationintelligencerecordingaccounts\": { \"SingularDisplayName\": \"Microsoft.SalesCopilot conversation intelligence recording account\" }\n        ,\"microsoft.scheduler/jobcollections\": { \"SingularDisplayName\": \"Scheduler job collection\" }\n        ,\"microsoft.scheduler/jobcollections/jobs\": { \"SingularDisplayName\": \"Scheduler job\" }\n        ,\"microsoft.scom/managedinstances\": { \"SingularDisplayName\": \"SCOM managed instance\" }\n        ,\"microsoft.scvmm/availabilitysets\": { \"SingularDisplayName\": \"Microsoft.ScVmm availability set\" }\n        ,\"microsoft.scvmm/clouds\": { \"SingularDisplayName\": \"Microsoft.ScVmm cloud\" }\n        ,\"microsoft.scvmm/virtualmachineinstances\": { \"SingularDisplayName\": \"Microsoft.ScVmm virtual machine instance\" }\n        ,\"microsoft.scvmm/virtualmachineinstances/guestagents\": { \"SingularDisplayName\": \"Microsoft.ScVmm virtual machine instances guest agent\" }\n        ,\"microsoft.scvmm/virtualmachineinstances/hybrididentitymetadata\": { \"SingularDisplayName\": \"Microsoft.ScVmm virtual machine instances hybrid identity metadata\" }\n        ,\"microsoft.scvmm/virtualmachines\": { \"SingularDisplayName\": \"SCVMM virtual machine - Azure Arc\" }\n        ,\"microsoft.scvmm/virtualmachinetemplates\": { \"SingularDisplayName\": \"Microsoft.ScVmm virtual machine template\" }\n        ,\"microsoft.scvmm/virtualnetworks\": { \"SingularDisplayName\": \"Microsoft.ScVmm virtual network\" }\n        ,\"microsoft.scvmm/vmmservers\": { \"SingularDisplayName\": \"SCVMM management server\" }\n        ,\"microsoft.search/searchservices\": { \"SingularDisplayName\": \"Search service\" }\n        ,\"microsoft.secretmanagementsampleprovider/forecasts\": { \"SingularDisplayName\": \"Microsoft.SecretManagementSampleProvider forecast\" }\n        ,\"microsoft.secretsynccontroller/azurekeyvaultsecretproviderclasses\": { \"SingularDisplayName\": \"Microsoft.SecretSyncController Azure key vault secret provider class\" }\n        ,\"microsoft.secretsynccontroller/secretsyncs\": { \"SingularDisplayName\": \"Microsoft.SecretSyncController secret sync\" }\n        ,\"microsoft.security/adaptivenetworkhardenings\": { \"SingularDisplayName\": \"Microsoft.Security adaptive network hardening\" }\n        ,\"microsoft.security/advancedthreatprotectionsettings\": { \"SingularDisplayName\": \"Microsoft.Security advanced threat protection setting\" }\n        ,\"microsoft.security/alertssuppressionrules\": { \"SingularDisplayName\": \"Microsoft.Security alerts suppression rule\" }\n        ,\"microsoft.security/apicollections\": { \"SingularDisplayName\": \"Microsoft.Security API collection\" }\n        ,\"microsoft.security/applications\": { \"SingularDisplayName\": \"Microsoft.Security application\" }\n        ,\"microsoft.security/assessmentmetadata\": { \"SingularDisplayName\": \"Microsoft.Security assessment metadata\" }\n        ,\"microsoft.security/assessments\": { \"SingularDisplayName\": \"Microsoft.Security assessment\" }\n        ,\"microsoft.security/assessments/governanceassignments\": { \"SingularDisplayName\": \"Microsoft.Security assessments governance assignment\" }\n        ,\"microsoft.security/assessments/subassessments\": { \"SingularDisplayName\": \"Microsoft.Security assessments sub assessment\" }\n        ,\"microsoft.security/assignments\": { \"SingularDisplayName\": \"Microsoft.Security assignment\" }\n        ,\"microsoft.security/automations\": { \"SingularDisplayName\": \"Microsoft.Security automation\" }\n        ,\"microsoft.security/autoprovisioningsettings\": { \"SingularDisplayName\": \"Microsoft.Security auto provisioning setting\" }\n        ,\"microsoft.security/complianceresults\": { \"SingularDisplayName\": \"Microsoft.Security compliance result\" }\n        ,\"microsoft.security/compliances\": { \"SingularDisplayName\": \"Microsoft.Security compliance\" }\n        ,\"microsoft.security/connectors\": { \"SingularDisplayName\": \"Microsoft.Security connector\" }\n        ,\"microsoft.security/customassessmentautomations\": { \"SingularDisplayName\": \"Microsoft.Security custom assessment automation\" }\n        ,\"microsoft.security/defenderforstoragesettings\": { \"SingularDisplayName\": \"Microsoft.Security defender for storage setting\" }\n        ,\"microsoft.security/defenderforstoragesettings/malwarescans\": { \"SingularDisplayName\": \"Microsoft.Security defender for storage settings malware scan\" }\n        ,\"microsoft.security/devicesecuritygroups\": { \"SingularDisplayName\": \"Microsoft.Security device security group\" }\n        ,\"microsoft.security/governancerules\": { \"SingularDisplayName\": \"Microsoft.Security governance rule\" }\n        ,\"microsoft.security/governancerules/operationresults\": { \"SingularDisplayName\": \"Microsoft.Security governance rules operation result\" }\n        ,\"microsoft.security/healthreports\": { \"SingularDisplayName\": \"Microsoft.Security health report\" }\n        ,\"microsoft.security/informationprotectionpolicies\": { \"SingularDisplayName\": \"Microsoft.Security information protection policy\" }\n        ,\"microsoft.security/iotsecuritysolutions\": { \"SingularDisplayName\": \"Microsoft.Security IoT security solution\" }\n        ,\"microsoft.security/iotsecuritysolutions/analyticsmodels\": { \"SingularDisplayName\": \"Microsoft.Security IoT security solutions analytics model\" }\n        ,\"microsoft.security/iotsecuritysolutions/analyticsmodels/aggregatedalerts\": { \"SingularDisplayName\": \"Microsoft.Security IoT security solutions analytics models aggregated alert\" }\n        ,\"microsoft.security/iotsecuritysolutions/analyticsmodels/aggregatedrecommendations\": { \"SingularDisplayName\": \"Microsoft.Security IoT security solutions analytics models aggregated recommendation\" }\n        ,\"microsoft.security/iotsecuritysolutions/iotalerts\": { \"SingularDisplayName\": \"Microsoft.Security IoT security solutions IoT alert\" }\n        ,\"microsoft.security/iotsecuritysolutions/iotalerttypes\": { \"SingularDisplayName\": \"Microsoft.Security IoT security solutions IoT alert type\" }\n        ,\"microsoft.security/iotsecuritysolutions/iotrecommendations\": { \"SingularDisplayName\": \"Microsoft.Security IoT security solutions IoT recommendation\" }\n        ,\"microsoft.security/iotsecuritysolutions/iotrecommendationtypes\": { \"SingularDisplayName\": \"Microsoft.Security IoT security solutions IoT recommendation type\" }\n        ,\"microsoft.security/locations/alerts\": { \"SingularDisplayName\": \"Security Alert\" }\n        ,\"microsoft.security/mdeonboardings\": { \"SingularDisplayName\": \"Microsoft.Security mde onboarding\" }\n        ,\"microsoft.security/pricings\": { \"SingularDisplayName\": \"Defender for Cloud\" }\n        ,\"microsoft.security/pricings/securityoperators\": { \"SingularDisplayName\": \"Microsoft.Security pricings security operator\" }\n        ,\"microsoft.security/regulatorycompliancestandards\": { \"SingularDisplayName\": \"Microsoft.Security regulatory compliance standard\" }\n        ,\"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\": { \"SingularDisplayName\": \"Microsoft.Security regulatory compliance standards regulatory compliance control\" }\n        ,\"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\": { \"SingularDisplayName\": \"Microsoft.Security regulatory compliance standards regulatory compliance controls regulatory compliance assessment\" }\n        ,\"microsoft.security/securescores\": { \"SingularDisplayName\": \"Microsoft.Security secure score\" }\n        ,\"microsoft.security/securityconnectors\": { \"SingularDisplayName\": \"Microsoft.Security security connector\" }\n        ,\"microsoft.security/securityconnectors/devops\": { \"SingularDisplayName\": \"Microsoft.Security security connectors devop\" }\n        ,\"microsoft.security/securitycontacts\": { \"SingularDisplayName\": \"Microsoft.Security security contact\" }\n        ,\"microsoft.security/sensitivitysettings\": { \"SingularDisplayName\": \"Microsoft.Security sensitivity setting\" }\n        ,\"microsoft.security/servervulnerabilityassessments\": { \"SingularDisplayName\": \"Microsoft.Security server vulnerability assessment\" }\n        ,\"microsoft.security/servervulnerabilityassessmentssettings\": { \"SingularDisplayName\": \"Microsoft.Security server vulnerability assessments setting\" }\n        ,\"microsoft.security/settings\": { \"SingularDisplayName\": \"Microsoft.Security setting\" }\n        ,\"microsoft.security/standards\": { \"SingularDisplayName\": \"Microsoft.Security standard\" }\n        ,\"microsoft.security/workspacesettings\": { \"SingularDisplayName\": \"Microsoft.Security workspace setting\" }\n        ,\"microsoft.securitycopilot/capacities\": { \"SingularDisplayName\": \"Microsoft Security compute capacity\" }\n        ,\"microsoft.securitydetonation/chambers\": { \"SingularDisplayName\": \"Security Detonation Chamber\" }\n        ,\"microsoft.securityinsightsarg/sentinel\": { \"SingularDisplayName\": \"Microsoft Sentinel\" }\n        ,\"microsoft.sentinelplatformservices/sentinelplatformservices\": { \"SingularDisplayName\": \"Microsoft.SentinelPlatformServices sentinel platform service\" }\n        ,\"microsoft.serialconsole/consoleservices\": { \"SingularDisplayName\": \"Microsoft.SerialConsole console service\" }\n        ,\"microsoft.serialconsole/serialports\": { \"SingularDisplayName\": \"Microsoft.SerialConsole serial port\" }\n        ,\"microsoft.servicebus/namespaces\": { \"SingularDisplayName\": \"Service Bus namespace\" }\n        ,\"microsoft.servicebus/namespaces/disasterrecoveryconfigs\": { \"SingularDisplayName\": \"Service Bus Geo-DR Alias\" }\n        ,\"microsoft.servicebus/namespaces/queues\": { \"SingularDisplayName\": \"Service Bus queue\" }\n        ,\"microsoft.servicebus/namespaces/topics\": { \"SingularDisplayName\": \"Service Bus topic\" }\n        ,\"microsoft.servicebus/namespaces/topics/subscriptions\": { \"SingularDisplayName\": \"Service Bus Subscription\" }\n        ,\"microsoft.servicefabric/clusters\": { \"SingularDisplayName\": \"Service Fabric cluster\" }\n        ,\"microsoft.servicefabric/managedclusters\": { \"SingularDisplayName\": \"Service Fabric managed cluster\" }\n        ,\"microsoft.servicefabricmesh/applications\": { \"SingularDisplayName\": \"Microsoft.ServiceFabricMesh application\" }\n        ,\"microsoft.servicefabricmesh/applications/services\": { \"SingularDisplayName\": \"Microsoft.ServiceFabricMesh applications service\" }\n        ,\"microsoft.servicefabricmesh/applications/services/replicas\": { \"SingularDisplayName\": \"Microsoft.ServiceFabricMesh applications services replica\" }\n        ,\"microsoft.servicefabricmesh/gateways\": { \"SingularDisplayName\": \"Microsoft.ServiceFabricMesh gateway\" }\n        ,\"microsoft.servicefabricmesh/networks\": { \"SingularDisplayName\": \"Microsoft.ServiceFabricMesh network\" }\n        ,\"microsoft.servicefabricmesh/secrets\": { \"SingularDisplayName\": \"Microsoft.ServiceFabricMesh secret\" }\n        ,\"microsoft.servicefabricmesh/secrets/values\": { \"SingularDisplayName\": \"Microsoft.ServiceFabricMesh secrets value\" }\n        ,\"microsoft.servicefabricmesh/volumes\": { \"SingularDisplayName\": \"Microsoft.ServiceFabricMesh volume\" }\n        ,\"microsoft.servicelinker/dryruns\": { \"SingularDisplayName\": \"Microsoft.ServiceLinker dryrun\" }\n        ,\"microsoft.servicelinker/linkers\": { \"SingularDisplayName\": \"Microsoft.ServiceLinker linker\" }\n        ,\"microsoft.servicenetworking/trafficcontrollers\": { \"SingularDisplayName\": \"Application Gateway for Containers\" }\n        ,\"microsoft.serviceshub/connectors\": { \"SingularDisplayName\": \"Services Hub Connector\" }\n        ,\"microsoft.signalrservice/signalr\": { \"SingularDisplayName\": \"SignalR\" }\n        ,\"microsoft.signalrservice/signalr/replicas\": { \"SingularDisplayName\": \"SignalR Replica\" }\n        ,\"microsoft.signalrservice/webpubsub\": { \"SingularDisplayName\": \"Web PubSub Service\" }\n        ,\"microsoft.signalrservice/webpubsub/replicas\": { \"SingularDisplayName\": \"Web PubSub Service Replica\" }\n        ,\"microsoft.skytap/billingnodes\": { \"SingularDisplayName\": \"Microsoft.Skytap billing node\" }\n        ,\"microsoft.skytap/interfaces\": { \"SingularDisplayName\": \"Microsoft.Skytap interface\" }\n        ,\"microsoft.skytap/nodes\": { \"SingularDisplayName\": \"Microsoft.Skytap node\" }\n        ,\"microsoft.softwareplan/hybridusebenefits\": { \"SingularDisplayName\": \"Microsoft.SoftwarePlan hybrid use benefit\" }\n        ,\"microsoft.solutions/applicationdefinitions\": { \"SingularDisplayName\": \"Service catalog managed application definition\" }\n        ,\"microsoft.solutions/applications\": { \"SingularDisplayName\": \"Managed application\" }\n        ,\"microsoft.solutions/jitrequests\": { \"SingularDisplayName\": \"Microsoft.Solutions JIT request\" }\n        ,\"microsoft.sovereign/landingzoneaccounts\": { \"SingularDisplayName\": \"Landing zone account\" }\n        ,\"microsoft.sovereign/landingzoneaccounts/landingzoneconfigurations\": { \"SingularDisplayName\": \"Landing Zone Configuration\" }\n        ,\"microsoft.sovereign/landingzoneaccounts/landingzoneregistrations\": { \"SingularDisplayName\": \"Landing Zone Registration\" }\n        ,\"microsoft.sovereign/landingzoneconfigurations\": { \"SingularDisplayName\": \"Landing Zone Configuration\" }\n        ,\"microsoft.sovereign/landingzoneregistrations\": { \"SingularDisplayName\": \"Landing Zone Registration\" }\n        ,\"microsoft.sovereign/transparencylogs\": { \"SingularDisplayName\": \"Transparency log\" }\n        ,\"microsoft.sql/azuresql\": { \"SingularDisplayName\": \"Azure SQL resource\" }\n        ,\"microsoft.sql/instancepools\": { \"SingularDisplayName\": \"Instance pool\" }\n        ,\"microsoft.sql/managedinstances\": { \"SingularDisplayName\": \"SQL managed instance\" }\n        ,\"microsoft.sql/managedinstances/databases\": { \"SingularDisplayName\": \"Managed database\" }\n        ,\"microsoft.sql/servers\": { \"SingularDisplayName\": \"SQL server\" }\n        ,\"microsoft.sql/servers/databases\": { \"SingularDisplayName\": \"SQL database\" }\n        ,\"microsoft.sql/servers/elasticpools\": { \"SingularDisplayName\": \"SQL elastic pool\" }\n        ,\"microsoft.sql/servers/jobagents\": { \"SingularDisplayName\": \"Elastic Job agent\" }\n        ,\"microsoft.sql/virtualclusters\": { \"SingularDisplayName\": \"Virtual cluster\" }\n        ,\"microsoft.sqlvirtualmachine/sqlvirtualmachinegroups\": { \"SingularDisplayName\": \"Microsoft.SqlVirtualMachine sql virtual machine group\" }\n        ,\"microsoft.sqlvirtualmachine/sqlvirtualmachinegroups/availabilitygrouplisteners\": { \"SingularDisplayName\": \"Microsoft.SqlVirtualMachine sql virtual machine groups availability group listener\" }\n        ,\"microsoft.sqlvirtualmachine/sqlvirtualmachines\": { \"SingularDisplayName\": \"SQL virtual machine\" }\n        ,\"microsoft.standbypool/standbycontainergrouppools\": { \"SingularDisplayName\": \"Microsoft.StandbyPool standby container group pool\" }\n        ,\"microsoft.standbypool/standbycontainergrouppools/runtimeviews\": { \"SingularDisplayName\": \"Microsoft.StandbyPool standby container group pools runtime view\" }\n        ,\"microsoft.standbypool/standbyvirtualmachinepools\": { \"SingularDisplayName\": \"Microsoft.StandbyPool standby virtual machine pool\" }\n        ,\"microsoft.standbypool/standbyvirtualmachinepools/runtimeviews\": { \"SingularDisplayName\": \"Microsoft.StandbyPool standby virtual machine pools runtime view\" }\n        ,\"microsoft.standbypool/standbyvirtualmachinepools/standbyvirtualmachines\": { \"SingularDisplayName\": \"Microsoft.StandbyPool standby virtual machine pools standby virtual machine\" }\n        ,\"microsoft.storage/storageaccounts\": { \"SingularDisplayName\": \"Storage account\" }\n        ,\"microsoft.storageactions/storagetasks\": { \"SingularDisplayName\": \"Storage task - Azure Storage Actions\" }\n        ,\"microsoft.storagecache/amlfilesystems\": { \"SingularDisplayName\": \"Azure Managed Lustre\" }\n        ,\"microsoft.storagecache/caches\": { \"SingularDisplayName\": \"HPC cache\" }\n        ,\"microsoft.storagediscovery/storagediscoveryworkspaces\": { \"SingularDisplayName\": \"Storage Discovery workspace\" }\n        ,\"microsoft.storagehub/all\": { \"SingularDisplayName\": \"All resources\" }\n        ,\"microsoft.storagehub/policycomplianceresources\": { \"SingularDisplayName\": \"Policy compliance\" }\n        ,\"microsoft.storageinsights/storagecollectionrules\": { \"SingularDisplayName\": \"Microsoft.StorageInsights storage collection rule\" }\n        ,\"microsoft.storagemover/storagemovers\": { \"SingularDisplayName\": \"Storage mover\" }\n        ,\"microsoft.storagepool/diskpools\": { \"SingularDisplayName\": \"Microsoft.StoragePool disk pool\" }\n        ,\"microsoft.storagepool/diskpools/iscsitargets\": { \"SingularDisplayName\": \"Microsoft.StoragePool disk pools iscsi target\" }\n        ,\"microsoft.storagesync/storagesyncservices\": { \"SingularDisplayName\": \"Storage Sync Service\" }\n        ,\"microsoft.storagetasks/storagetasks\": { \"SingularDisplayName\": \"Microsoft.StorageTasks storage task\" }\n        ,\"microsoft.storsimple/managers\": { \"SingularDisplayName\": \"StorSimple device manager\" }\n        ,\"microsoft.storsimple/managers/accesscontrolrecords\": { \"SingularDisplayName\": \"Microsoft.StorSimple managers access control record\" }\n        ,\"microsoft.storsimple/managers/bandwidthsettings\": { \"SingularDisplayName\": \"Microsoft.StorSimple managers bandwidth setting\" }\n        ,\"microsoft.storsimple/managers/certificates\": { \"SingularDisplayName\": \"Microsoft.StorSimple managers certificate\" }\n        ,\"microsoft.storsimple/managers/devices\": { \"SingularDisplayName\": \"Microsoft.StorSimple managers device\" }\n        ,\"microsoft.storsimple/managers/devices/alertsettings\": { \"SingularDisplayName\": \"Microsoft.StorSimple managers devices alert setting\" }\n        ,\"microsoft.storsimple/managers/devices/backuppolicies\": { \"SingularDisplayName\": \"Microsoft.StorSimple managers devices backup policy\" }\n        ,\"microsoft.storsimple/managers/devices/backuppolicies/schedules\": { \"SingularDisplayName\": \"Microsoft.StorSimple managers devices backup policies schedule\" }\n        ,\"microsoft.storsimple/managers/devices/backupschedulegroups\": { \"SingularDisplayName\": \"Microsoft.StorSimple managers devices backup schedule group\" }\n        ,\"microsoft.storsimple/managers/devices/chapsettings\": { \"SingularDisplayName\": \"Microsoft.StorSimple managers devices chap setting\" }\n        ,\"microsoft.storsimple/managers/devices/fileservers\": { \"SingularDisplayName\": \"Microsoft.StorSimple managers devices fileserver\" }\n        ,\"microsoft.storsimple/managers/devices/fileservers/shares\": { \"SingularDisplayName\": \"Microsoft.StorSimple managers devices fileservers share\" }\n        ,\"microsoft.storsimple/managers/devices/iscsiservers\": { \"SingularDisplayName\": \"Microsoft.StorSimple managers devices iscsiserver\" }\n        ,\"microsoft.storsimple/managers/devices/iscsiservers/disks\": { \"SingularDisplayName\": \"Microsoft.StorSimple managers devices iscsiservers disk\" }\n        ,\"microsoft.storsimple/managers/devices/jobs\": { \"SingularDisplayName\": \"Microsoft.StorSimple managers devices job\" }\n        ,\"microsoft.storsimple/managers/devices/networksettings\": { \"SingularDisplayName\": \"Microsoft.StorSimple managers devices network setting\" }\n        ,\"microsoft.storsimple/managers/devices/securitysettings\": { \"SingularDisplayName\": \"Microsoft.StorSimple managers devices security setting\" }\n        ,\"microsoft.storsimple/managers/devices/timesettings\": { \"SingularDisplayName\": \"Microsoft.StorSimple managers devices time setting\" }\n        ,\"microsoft.storsimple/managers/devices/updatesummary\": { \"SingularDisplayName\": \"Microsoft.StorSimple managers devices update summary\" }\n        ,\"microsoft.storsimple/managers/devices/volumecontainers\": { \"SingularDisplayName\": \"Microsoft.StorSimple managers devices volume container\" }\n        ,\"microsoft.storsimple/managers/devices/volumecontainers/volumes\": { \"SingularDisplayName\": \"Microsoft.StorSimple managers devices volume containers volume\" }\n        ,\"microsoft.storsimple/managers/encryptionsettings\": { \"SingularDisplayName\": \"Microsoft.StorSimple managers encryption setting\" }\n        ,\"microsoft.storsimple/managers/extendedinformation\": { \"SingularDisplayName\": \"Microsoft.StorSimple managers extended information\" }\n        ,\"microsoft.storsimple/managers/storageaccountcredentials\": { \"SingularDisplayName\": \"Microsoft.StorSimple managers storage account credential\" }\n        ,\"microsoft.storsimple/managers/storagedomains\": { \"SingularDisplayName\": \"Microsoft.StorSimple managers storage domain\" }\n        ,\"microsoft.streamanalytics/clusters\": { \"SingularDisplayName\": \"Stream Analytics cluster\" }\n        ,\"microsoft.streamanalytics/streamingjobs\": { \"SingularDisplayName\": \"Stream Analytics job\" }\n        ,\"microsoft.subscription/aliases\": { \"SingularDisplayName\": \"Microsoft.Subscription aliase\" }\n        ,\"microsoft.subscription/changetenantrequest\": { \"SingularDisplayName\": \"Microsoft.Subscription change tenant request\" }\n        ,\"microsoft.subscription/policies\": { \"SingularDisplayName\": \"Microsoft.Subscription policy\" }\n        ,\"microsoft.subscription/subscriptiondefinitions\": { \"SingularDisplayName\": \"Microsoft.Subscription subscription definition\" }\n        ,\"microsoft.subscription/subscriptionoperations\": { \"SingularDisplayName\": \"Microsoft.Subscription subscription operation\" }\n        ,\"microsoft.support/fileworkspaces\": { \"SingularDisplayName\": \"Microsoft.Support file workspace\" }\n        ,\"microsoft.support/fileworkspaces/files\": { \"SingularDisplayName\": \"Microsoft.Support file workspaces file\" }\n        ,\"microsoft.support/services\": { \"SingularDisplayName\": \"Microsoft.Support service\" }\n        ,\"microsoft.support/services/problemclassifications\": { \"SingularDisplayName\": \"Microsoft.Support services problem classification\" }\n        ,\"microsoft.support/supporttickets\": { \"SingularDisplayName\": \"Support Request\" }\n        ,\"microsoft.sustainabilityservices/calculations\": { \"SingularDisplayName\": \"Project Sustainability Calculator\" }\n        ,\"microsoft.symphony/instances\": { \"SingularDisplayName\": \"Microsoft.Symphony instance\" }\n        ,\"microsoft.symphony/solutions\": { \"SingularDisplayName\": \"Microsoft.Symphony solution\" }\n        ,\"microsoft.symphony/targets\": { \"SingularDisplayName\": \"Microsoft.Symphony target\" }\n        ,\"microsoft.synapse/privatelinkhubs\": { \"SingularDisplayName\": \"Synapse private link hub\" }\n        ,\"microsoft.synapse/workspaces\": { \"SingularDisplayName\": \"Synapse workspace\" }\n        ,\"microsoft.synapse/workspaces/bigdatapools\": { \"SingularDisplayName\": \"Apache Spark pool\" }\n        ,\"microsoft.synapse/workspaces/kustopools\": { \"SingularDisplayName\": \"Data Explorer pool\" }\n        ,\"microsoft.synapse/workspaces/kustopools/databases\": { \"SingularDisplayName\": \"Data Explorer Database\" }\n        ,\"microsoft.synapse/workspaces/scopepools\": { \"SingularDisplayName\": \"SCOPE pool\" }\n        ,\"microsoft.synapse/workspaces/sqlpools\": { \"SingularDisplayName\": \"Dedicated SQL pool\" }\n        ,\"microsoft.syntex/accounts\": { \"SingularDisplayName\": \"Microsoft.Syntex account\" }\n        ,\"microsoft.syntex/documentprocessors\": { \"SingularDisplayName\": \"Microsoft.Syntex document processor\" }\n        ,\"microsoft.test/healthdataaiservices\": { \"SingularDisplayName\": \"Azure Health Data and AI Services\" }\n        ,\"microsoft.timeseriesinsights/environments\": { \"SingularDisplayName\": \"Microsoft.TimeSeriesInsights environment\" }\n        ,\"microsoft.timeseriesinsights/environments/accesspolicies\": { \"SingularDisplayName\": \"Microsoft.TimeSeriesInsights environments access policy\" }\n        ,\"microsoft.timeseriesinsights/environments/eventsources\": { \"SingularDisplayName\": \"Microsoft.TimeSeriesInsights environments event source\" }\n        ,\"microsoft.timeseriesinsights/environments/referencedatasets\": { \"SingularDisplayName\": \"Microsoft.TimeSeriesInsights environments reference data set\" }\n        ,\"microsoft.toolchainorchestrator/activations\": { \"SingularDisplayName\": \"Microsoft.ToolchainOrchestrator activation\" }\n        ,\"microsoft.toolchainorchestrator/campaigns\": { \"SingularDisplayName\": \"Microsoft.ToolchainOrchestrator campaign\" }\n        ,\"microsoft.toolchainorchestrator/campaigns/versions\": { \"SingularDisplayName\": \"Microsoft.ToolchainOrchestrator campaigns version\" }\n        ,\"microsoft.toolchainorchestrator/catalogs\": { \"SingularDisplayName\": \"Microsoft.ToolchainOrchestrator catalog\" }\n        ,\"microsoft.toolchainorchestrator/catalogs/versions\": { \"SingularDisplayName\": \"Microsoft.ToolchainOrchestrator catalogs version\" }\n        ,\"microsoft.toolchainorchestrator/diagnostics\": { \"SingularDisplayName\": \"Microsoft.ToolchainOrchestrator diagnostic\" }\n        ,\"microsoft.toolchainorchestrator/instances\": { \"SingularDisplayName\": \"Microsoft.ToolchainOrchestrator instance\" }\n        ,\"microsoft.toolchainorchestrator/instances/versions\": { \"SingularDisplayName\": \"Microsoft.ToolchainOrchestrator instances version\" }\n        ,\"microsoft.toolchainorchestrator/solutions\": { \"SingularDisplayName\": \"Microsoft.ToolchainOrchestrator solution\" }\n        ,\"microsoft.toolchainorchestrator/solutions/versions\": { \"SingularDisplayName\": \"Microsoft.ToolchainOrchestrator solutions version\" }\n        ,\"microsoft.toolchainorchestrator/targets\": { \"SingularDisplayName\": \"Microsoft.ToolchainOrchestrator target\" }\n        ,\"microsoft.toolchainorchestrator/targets/versions\": { \"SingularDisplayName\": \"Microsoft.ToolchainOrchestrator targets version\" }\n        ,\"microsoft.updatemanager/updaterules\": { \"SingularDisplayName\": \"Update Rule\" }\n        ,\"microsoft.usagebilling/accounts\": { \"SingularDisplayName\": \"Microsoft.UsageBilling account\" }\n        ,\"microsoft.usagebilling/accounts/dataexports\": { \"SingularDisplayName\": \"Microsoft.UsageBilling accounts data export\" }\n        ,\"microsoft.usagebilling/accounts/inputs\": { \"SingularDisplayName\": \"Microsoft.UsageBilling accounts input\" }\n        ,\"microsoft.usagebilling/accounts/metricexports\": { \"SingularDisplayName\": \"Microsoft.UsageBilling accounts metric export\" }\n        ,\"microsoft.usagebilling/accounts/pav2outputs\": { \"SingularDisplayName\": \"Microsoft.UsageBilling accounts pav2output\" }\n        ,\"microsoft.usagebilling/accounts/pipelines\": { \"SingularDisplayName\": \"Microsoft.UsageBilling accounts pipeline\" }\n        ,\"microsoft.usagebilling/accounts/pipelines/outputselectors\": { \"SingularDisplayName\": \"Microsoft.UsageBilling accounts pipelines output selector\" }\n        ,\"microsoft.verifiedid/authorities\": { \"SingularDisplayName\": \"Microsoft.VerifiedId authority\" }\n        ,\"microsoft.videoindexer/accounts\": { \"SingularDisplayName\": \"Azure AI Video Indexer\" }\n        ,\"microsoft.virtualmachineimages/imagetemplates\": { \"SingularDisplayName\": \"Image template\" }\n        ,\"microsoft.visualstudio/account\": { \"SingularDisplayName\": \"Azure DevOps organization\" }\n        ,\"microsoft.vmware/resourcepools\": { \"SingularDisplayName\": \"Microsoft.VMware resource pool\" }\n        ,\"microsoft.vmware/vcenters\": { \"SingularDisplayName\": \"Microsoft.VMware vcenter\" }\n        ,\"microsoft.vmware/vcenters/inventoryitems\": { \"SingularDisplayName\": \"Microsoft.VMware vcenters inventory item\" }\n        ,\"microsoft.vmware/virtualmachines\": { \"SingularDisplayName\": \"Microsoft.VMware virtual machine\" }\n        ,\"microsoft.vmware/virtualmachinetemplates\": { \"SingularDisplayName\": \"Microsoft.VMware virtual machine template\" }\n        ,\"microsoft.vmware/virtualnetworks\": { \"SingularDisplayName\": \"Microsoft.VMware virtual network\" }\n        ,\"microsoft.vmwarecloudsimple/dedicatedcloudnodes\": { \"SingularDisplayName\": \"Microsoft.VMwareCloudSimple dedicated cloud node\" }\n        ,\"microsoft.vmwarecloudsimple/dedicatedcloudservices\": { \"SingularDisplayName\": \"Microsoft.VMwareCloudSimple dedicated cloud service\" }\n        ,\"microsoft.vmwarecloudsimple/virtualmachines\": { \"SingularDisplayName\": \"Microsoft.VMwareCloudSimple virtual machine\" }\n        ,\"microsoft.vnfmanager/devices\": { \"SingularDisplayName\": \"Microsoft.VnfManager device\" }\n        ,\"microsoft.vnfmanager/vendors\": { \"SingularDisplayName\": \"Microsoft.VnfManager vendor\" }\n        ,\"microsoft.vnfmanager/vendors/skus\": { \"SingularDisplayName\": \"Microsoft.VnfManager vendors SKU\" }\n        ,\"microsoft.vnfmanager/vnfs\": { \"SingularDisplayName\": \"Microsoft.VnfManager vnf\" }\n        ,\"microsoft.voiceservices/communicationsgateways\": { \"SingularDisplayName\": \"Communications Gateway\" }\n        ,\"microsoft.voiceservices/communicationsgateways/testlines\": { \"SingularDisplayName\": \"Communications Gateway Test Line\" }\n        ,\"microsoft.vsonline/accounts\": { \"SingularDisplayName\": \"Microsoft.VSOnline account\" }\n        ,\"microsoft.vsonline/plans\": { \"SingularDisplayName\": \"Visual Studio Online Plan\" }\n        ,\"microsoft.web/certificates\": { \"SingularDisplayName\": \"Microsoft.Web certificate\" }\n        ,\"microsoft.web/connectiongateways\": { \"SingularDisplayName\": \"App Service on-premises data gateway\" }\n        ,\"microsoft.web/connections\": { \"SingularDisplayName\": \"App Service API connection\" }\n        ,\"microsoft.web/containerapps\": { \"SingularDisplayName\": \"Microsoft.Web container app\" }\n        ,\"microsoft.web/containerapps/revisions\": { \"SingularDisplayName\": \"Microsoft.Web container apps revision\" }\n        ,\"microsoft.web/customapis\": { \"SingularDisplayName\": \"Logic apps custom connector\" }\n        ,\"microsoft.web/deletedsites\": { \"SingularDisplayName\": \"Microsoft.Web deleted site\" }\n        ,\"microsoft.web/hostingenvironments\": { \"SingularDisplayName\": \"App Service Environment\" }\n        ,\"microsoft.web/ishostingenvironmentnameavailable\": { \"SingularDisplayName\": \"Microsoft.Web ishostingenvironmentnameavailable\" }\n        ,\"microsoft.web/kubeenvironments\": { \"SingularDisplayName\": \"App Service Kubernetes Environment\" }\n        ,\"microsoft.web/logicappstemplate\": { \"SingularDisplayName\": \"Logic Apps Template\" }\n        ,\"microsoft.web/publishingusers\": { \"SingularDisplayName\": \"Microsoft.Web publishing user\" }\n        ,\"microsoft.web/serverfarms\": { \"SingularDisplayName\": \"App Service plan\" }\n        ,\"microsoft.web/sites\": { \"SingularDisplayName\": \"App Service web app\" }\n        ,\"microsoft.web/sites/slots\": { \"SingularDisplayName\": \"App Service deployment slot\" }\n        ,\"microsoft.web/sourcecontrols\": { \"SingularDisplayName\": \"Microsoft.Web sourcecontrol\" }\n        ,\"microsoft.web/staticsites\": { \"SingularDisplayName\": \"Static Web App\" }\n        ,\"microsoft.weightsandbiases/instances\": { \"SingularDisplayName\": \"Azure Native Weights & Biases Cloud Service\" }\n        ,\"microsoft.whiteboxcadlprovider/whiteboxresources\": { \"SingularDisplayName\": \"Microsoft.WhiteBoxCadlProvider white box resource\" }\n        ,\"microsoft.windows365/cloudpcdelegatedmsis\": { \"SingularDisplayName\": \"Microsoft.Windows365 cloud pc delegated msi\" }\n        ,\"microsoft.windowsesu/multipleactivationkeys\": { \"SingularDisplayName\": \"Microsoft.WindowsESU multiple activation key\" }\n        ,\"microsoft.windowsiot/deviceservices\": { \"SingularDisplayName\": \"Microsoft.WindowsIoT device service\" }\n        ,\"microsoft.windowspushnotificationservices/registrations\": { \"SingularDisplayName\": \"Windows Push Notification Service\" }\n        ,\"microsoft.workloadmonitor/monitors\": { \"SingularDisplayName\": \"Microsoft.WorkloadMonitor monitor\" }\n        ,\"microsoft.workloadmonitor/monitors/history\": { \"SingularDisplayName\": \"Microsoft.WorkloadMonitor monitors history\" }\n        ,\"microsoft.workloads/configurationvalidationresults\": { \"SingularDisplayName\": \"Microsoft.Workloads configuration validation result\" }\n        ,\"microsoft.workloads/connectors\": { \"SingularDisplayName\": \"Microsoft.Workloads connector\" }\n        ,\"microsoft.workloads/connectors/acssbackups\": { \"SingularDisplayName\": \"Microsoft.Workloads connectors acss backup\" }\n        ,\"microsoft.workloads/connectors/amsinsights\": { \"SingularDisplayName\": \"Microsoft.Workloads connectors ams insight\" }\n        ,\"microsoft.workloads/connectors/sapvirtualinstancemonitors\": { \"SingularDisplayName\": \"Microsoft.Workloads connectors sap virtual instance monitor\" }\n        ,\"microsoft.workloads/epicvirtualinstances\": { \"SingularDisplayName\": \"Virtual Instance for Epic solution\" }\n        ,\"microsoft.workloads/insights\": { \"SingularDisplayName\": \"Microsoft.Workloads insight\" }\n        ,\"microsoft.workloads/instancegroupmonitors\": { \"SingularDisplayName\": \"Microsoft.Workloads instance group monitor\" }\n        ,\"microsoft.workloads/instancehealthdefinitions\": { \"SingularDisplayName\": \"Microsoft.Workloads instance health definition\" }\n        ,\"microsoft.workloads/instancehealthdefinitions/signaldefinitions\": { \"SingularDisplayName\": \"Microsoft.Workloads instance health definitions signal definition\" }\n        ,\"microsoft.workloads/instancemonitors\": { \"SingularDisplayName\": \"Microsoft.Workloads instance monitor\" }\n        ,\"microsoft.workloads/monitors\": { \"SingularDisplayName\": \"Azure Monitor for SAP solutions\" }\n        ,\"microsoft.workloads/oraclevirtualinstances\": { \"SingularDisplayName\": \"Microsoft.Workloads oracle virtual instance\" }\n        ,\"microsoft.workloads/oraclevirtualinstances/databaseinstances\": { \"SingularDisplayName\": \"Microsoft.Workloads oracle virtual instances database instance\" }\n        ,\"microsoft.workloads/phpworkloads\": { \"SingularDisplayName\": \"Microsoft.Workloads php workload\" }\n        ,\"microsoft.workloads/phpworkloads/wordpressinstances\": { \"SingularDisplayName\": \"Microsoft.Workloads php workloads wordpress instance\" }\n        ,\"microsoft.workloads/sapdiscoverysites\": { \"SingularDisplayName\": \"Microsoft.Workloads sap discovery site\" }\n        ,\"microsoft.workloads/sapdiscoverysites/sapinstances\": { \"SingularDisplayName\": \"Microsoft.Workloads sap discovery sites sap instance\" }\n        ,\"microsoft.workloads/sapdiscoverysites/sapinstances/serverinstances\": { \"SingularDisplayName\": \"Microsoft.Workloads sap discovery sites sap instances server instance\" }\n        ,\"microsoft.workloads/sapvirtualinstances\": { \"SingularDisplayName\": \"Virtual Instance for SAP solutions\" }\n        ,\"microsoft.workloads/sapvirtualinstances/applicationinstances\": { \"SingularDisplayName\": \"App server instance for SAP solutions\" }\n        ,\"microsoft.workloads/sapvirtualinstances/centralinstances\": { \"SingularDisplayName\": \"Central service instance for SAP solutions\" }\n        ,\"microsoft.workloads/sapvirtualinstances/databaseinstances\": { \"SingularDisplayName\": \"Database for SAP solutions\" }\n        ,\"microsoft.workloads/virtualinstances\": { \"SingularDisplayName\": \"Microsoft.Workloads virtual instance\" }\n        ,\"microsoft.workloads/virtualinstances/components\": { \"SingularDisplayName\": \"Microsoft.Workloads virtual instances component\" }\n        ,\"microsoft.workloads/workloadinstance\": { \"SingularDisplayName\": \"My Resource\" }\n        ,\"microsoft.zerotrustsegmentation/segmentationmanagers\": { \"SingularDisplayName\": \"Segmentation Manager\" }\n        ,\"mongodb.atlas/organizations\": { \"SingularDisplayName\": \"MongoDB Atlas Organization\" }\n        ,\"neon.postgres/organizations\": { \"SingularDisplayName\": \"Neon Serverless Postgres Organization\" }\n        ,\"newrelic.observability/monitors\": { \"SingularDisplayName\": \"New Relic\" }\n        ,\"nginx.nginxplus/nginxdeployments\": { \"SingularDisplayName\": \"NGINXaaS\" }\n        ,\"oracle.database/autonomousdatabases\": { \"SingularDisplayName\": \"Autonomous Database\" }\n        ,\"oracle.database/basedb\": { \"SingularDisplayName\": \"Autonomous Database\" }\n        ,\"oracle.database/cloudexadatainfrastructures\": { \"SingularDisplayName\": \"Oracle Exadata Infrastructure\" }\n        ,\"oracle.database/cloudvmclusters\": { \"SingularDisplayName\": \"Oracle Exadata VM Cluster\" }\n        ,\"oracle.database/exadbvmclusters\": { \"SingularDisplayName\": \"Oracle Exascale VM Cluster\" }\n        ,\"oracle.database/exascaledbstoragevaults\": { \"SingularDisplayName\": \"Oracle Exascale DB Storage Vault\" }\n        ,\"oracle.database/networkanchors\": { \"SingularDisplayName\": \"Network Anchor\" }\n        ,\"oracle.database/oraclesubscriptions\": { \"SingularDisplayName\": \"OracleSubscription\" }\n        ,\"oracle.database/resourceanchors\": { \"SingularDisplayName\": \"Resource Anchor\" }\n        ,\"paloaltonetworks.cloudngfw/firewalls\": { \"SingularDisplayName\": \"Cloud NGFW by Palo Alto Networks\" }\n        ,\"paloaltonetworks.cloudngfw/globalrulestacks\": { \"SingularDisplayName\": \"Global Rulestack\" }\n        ,\"paloaltonetworks.cloudngfw/localrulestacks\": { \"SingularDisplayName\": \"Local Rulestack for Cloud NGFW by Palo Alto Networks\" }\n        ,\"pinecone.vectordb/organizations\": { \"SingularDisplayName\": \"Azure Native Pinecone Cloud Service\" }\n        ,\"purestorage.block/reservations\": { \"SingularDisplayName\": \"Azure Native Pure Storage Cloud Service\" }\n        ,\"purestorage.block/storagepools\": { \"SingularDisplayName\": \"Storage pool\" }\n        ,\"purestorage.block/storagepools/avsstoragecontainers\": { \"SingularDisplayName\": \"PureStorage.Block storage pools avs storage container\" }\n    })[tolower(id)]\n}\n",
                    "$fxv#5": "// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\n.create-or-alter function \nwith (docstring = 'Return details about the specified ID.', folder = 'OpenData/Internal')\n_resource_type_5(id: string) {\n    dynamic({\n        \"qumulo.qaas/storages\": { \"SingularDisplayName\": \"Qumulo.QaaS storage\" }\n        ,\"qumulo.storage/filesystems\": { \"SingularDisplayName\": \"Azure Native Qumulo Scalable File Service\" }\n        ,\"solarwinds.observability/organizations\": { \"SingularDisplayName\": \"SolarWinds Observability\" }\n        ,\"splitio.experimentation/experimentationworkspaces\": { \"SingularDisplayName\": \"Split Experimentation Workspace\" }\n        ,\"wandisco.fusion/migrators\": { \"SingularDisplayName\": \"LiveData Migrator\" }\n        ,\"wandisco.fusion/migrators/datatransferagents\": { \"SingularDisplayName\": \"Data Transfer Agent\" }\n        ,\"wandisco.fusion/migrators/exclusiontemplates\": { \"SingularDisplayName\": \"Exclusion\" }\n        ,\"wandisco.fusion/migrators/livedatamigrations\": { \"SingularDisplayName\": \"Migration\" }\n        ,\"wandisco.fusion/migrators/metadatamigrations\": { \"SingularDisplayName\": \"Metadata Migration\" }\n        ,\"wandisco.fusion/migrators/metadatatargets\": { \"SingularDisplayName\": \"Metadata Target\" }\n        ,\"wandisco.fusion/migrators/pathmappings\": { \"SingularDisplayName\": \"Path Mapping\" }\n        ,\"wandisco.fusion/migrators/targets\": { \"SingularDisplayName\": \"Target\" }\n        ,\"wandisco.fusion/migrators/verifications\": { \"SingularDisplayName\": \"Verification\" }\n    })[tolower(id)]\n}\n",
                    "$fxv#6": "// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\n// resource_type\n.create-or-alter function \nwith (docstring = 'Return details about the specified ID.', folder = 'OpenData')\nresource_type(id: string) {\n    coalesce(_resource_type_1(id), _resource_type_2(id), _resource_type_3(id), _resource_type_4(id), _resource_type_5(id))\n}\n",
                    "$fxv#7": "// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\n//======================================================================================================================\n// Common utility functions\n//\n// TIP: Use Ctrl+K,Ctrl+0 to collapse all regions in VS Code\n//======================================================================================================================\n\n\n//===| Date functions |=================================================================================================\n\n// monthstring\n.create-or-alter function \nwith (docstring = @'Returns the name of the month for the specified date (e.g. Jan or January)', folder =@'Common') \nmonthstring(['date']: datetime, length: int = 9)\n{\n    substring(dynamic(['January','February','March','April','May','June','July','August','September','October','November','December'])[getmonth(['date']) - 1], 0, length)\n}\n\n// datestring\n.create-or-alter function \nwith (docstring = @'Converts 2 dates into a simple, user-friendly date range (e.g. Jan 1-Jan 3)', folder =@'Common') \ndatestring(start: datetime, end: datetime = datetime('0001-01-01'))\n{\n    let month = (d: datetime) { monthstring(d, 3) };\n    let endDate = iff(end == datetime('0001-01-01'), start, end);\n    let sameDate = startofday(start) == startofday(endDate);\n    let sameMonth = startofmonth(start) == startofmonth(endDate);\n    let sameYear = startofyear(start) == startofyear(endDate);\n    let fullMonth = startofday(start) == startofmonth(start) and startofday(endDate) == startofday(endofmonth(endDate));\n    let fullYear = startofday(start) == startofyear(start) and startofday(endDate) == startofday(endofyear(endDate));\n    let currentYear = sameYear and startofyear(start) == startofyear(now());\n    case(\n        // Full year             | yyyy (same year) / yyyy-yyyy (diff years)\n        fullYear,\n            strcat(getyear(start), iff(sameYear, '', strcat('-', getyear(endDate)))),\n        // 1 full mo, same year  | Mmm yyyy\n        fullMonth and sameMonth and sameYear,\n            strcat(month(start), ' ', getyear(start)),\n        // 2+ full mo, same year | Mmm-Mmm (current year) / Mmm-Mmm yyyy (other year)\n        fullMonth and sameYear,\n            strcat(month(start), '-', month(endDate), iff(currentYear, '', strcat(' ', getyear(endDate)))),\n        // Full mo, diff year    | Mmm yyyy-Mmm yyyy\n        fullMonth and not(sameYear),\n            strcat(month(start), ' ', getyear(start), '-', month(endDate), ' ', getyear(endDate)),\n        // Same date             | Mmm d (current year) / Mmm d, yyyy (other year)\n        sameDate,\n            strcat(month(start), ' ', dayofmonth(start), iff(currentYear, '', strcat(', ', getyear(endDate)))),\n        // 1 partial M, same Y   | Mmm d-d (current year) / Mmm d-d, yyyy (other year)\n        not(fullMonth) and sameMonth and sameYear,\n            strcat(month(start), ' ', dayofmonth(start), '-', dayofmonth(endDate), iff(currentYear, '', strcat(' ', getyear(endDate)))),\n        // 2+ partial M, same Y  | Mmm d-Mmm d (current year) / Mmm d-Mmm d, yyyy (other year)\n        not(fullMonth) and not(sameMonth) and sameYear,\n            strcat(month(start), ' ', dayofmonth(start), '-', month(endDate), ' ', dayofmonth(endDate), iff(currentYear, '', strcat(', ', getyear(endDate)))),\n        // All other cases       | Mmm d, yyyy-Mmm d, yyyy\n        strcat(month(start), ' ', dayofmonth(start), ', ', getyear(start), '-', month(endDate), ' ', dayofmonth(endDate), ', ', getyear(endDate))\n    )\n}\n\n// daterange\n.create-or-alter function \nwith (docstring = @'DEPRECATED: Please use datestring(); function will be removed on or after the Jan 2026 release', folder =@'Common') \ndaterange(start: datetime, end: datetime = datetime('0001-01-01'))\n{\n    datestring(start, end)\n}\n\n// monthsago\n.create-or-alter function \nwith (docstring = 'DEPRECATED: Please use startofmonth(now(), -<# of months>); function will be removed on or after the Jan 2026 release', folder = 'Common')\nmonthsago(months: int)\n{\n    datetime_add('month', -months, startofmonth(now()))\n}\n\n\n//===| Number functions |===============================================================================================\n// NOTE: Must be defined before string converters\n\n// delta\n.create-or-alter function \nwith (docstring = @'Compares 2 values and returns the percentage change from oldval to newval', folder =@'Common') \ndelta(oldval: double, newval: double)\n{\n    (newval - todouble(oldval))/oldval\n}\n\n// percentOfTotal\n// NOTE: Must be before percent() function\n.create-or-alter function \nwith (docstring = @'Calculates the percentage of each record based on a required Count column', folder =@'Common') \npercentOfTotal(t: (Count: long), tot: long)\n{\n    let total = todouble(tot);\n    t \n    | extend Percent = round(Count / total * 100, 3) \n    | order by Count desc\n}\n\n// percent\n.create-or-alter function \nwith (docstring = @'Calculates the percentage of each record based on a required Count column', folder =@'Common') \npercent(t: (Count: long))\n{\n    let total = todouble(toscalar(t | summarize sum(Count)));\n    percentOfTotal(t, total)\n}\n\n// plusminus\n.create-or-alter function \nwith (docstring = 'Shows a +/- sign based on the direction of the number', folder = 'Common')\nplusminus(val: string)\n{\n    let neg = substring(val, 0, 1) == '-';\n    iff(neg, val, strcat('+', val))\n}\n\n// updown\n.create-or-alter function \nwith (docstring = 'Shows an up/down indicator based on the direction of the number', folder = 'Common')\nupdown(val: string)\n{\n    // TODO: Handle 0\n    let neg = substring(val, 0, 1) == '-';\n    iff(neg, strcat('(v)', substring(val, 1)), strcat('(^)', val))\n}\n\n\n//===| String functions |===============================================================================================\n\n// percentstring\n// NOTE: Must be defined before deltastring\n.create-or-alter function \nwith (docstring = 'Calculate a percentage and render as a string', folder = 'Common')\npercentstring(num: double, total: double = 1.0, places: int = 9)\n{\n    let value = 1.0 * num / total * 100;\n    strcat(case(\n        places != 9, round(value, places),\n        value < 10,  round(value, 2),\n        round(value, 1)\n    ), '%')\n}\n\n//----------------------------------------------------------------------------------------------------------------------\n\n// arraystring\n.create-or-alter function \nwith (docstring = 'Convert an array to a comma-delimited string', folder = 'Common')\narraystring(arr: dynamic)\n{\n    replace_string(replace_regex(replace_regex(replace_regex(replace_regex(replace_regex(\n        tostring(arr)\n        , @'^\\[\"', '')\n        , @'\"\\]$', '')\n        , @'^, ', '')\n        , @', $', '')\n        , @'^\\[]$', '')\n        , '\",\"', ', ')\n}\n\n// deltastring\n.create-or-alter function \nwith (docstring = 'Calculate a delta percentage and render as a string', folder = 'Common')\ndeltastring(oldval: double, newval: double, places: int = 1, useArrows: bool = false)\n{\n    let d = delta(oldval, newval);\n    strcat(case(useArrows and d > 0, '(^)', useArrows and d < 0, '(v)', d < 0, '-', ''), percentstring(abs(d), 1, places))\n}\n\n// diffstring\n.create-or-alter function \nwith (docstring = 'Calculate the difference and render as a string', folder = 'Common')\ndiffstring(oldval: double, newval: double, places: int = 1)\n{\n    plusminus(round(newval - oldval, places))\n}\n\n// numberstring\n.create-or-alter function \nwith (docstring = 'Convert a number to a string', folder = 'Common')\nnumberstring(num: double, abbrev: bool = true)\n{\n    replace_regex(case(\n        num >= 10000000000000, strcat(round(1.0 * num / 1000000000000, 1), 'T'),\n        num >= 1000000000000,  strcat(round(1.0 * num / 1000000000000, 2), 'T'),\n        num >= 10000000000,    strcat(round(1.0 * num / 1000000000, 1), 'B'),\n        num >= 1000000000,     strcat(round(1.0 * num / 1000000000, 2), 'B'),\n        num >= 10000000,       strcat(round(1.0 * num / 1000000, 1), 'M'),\n        num >= 1000000,        strcat(round(1.0 * num / 1000000, 2), 'M'),\n        num >= 10000,          strcat(round(1.0 * num / 1000, 1), 'K'),\n        // Kusto doesn't support back-refs yet -- num > 1000, replace_regex(tostring(num), @'(\\d)(?=(\\d{3})+\\.)', @'\\1,'), // See https://docs.microsoft.com/azure/data-explorer/kusto/query/re2-library\n        num > 1000, replace_regex(tostring(num), @'([0-9]{3})$', @',\\1'), //num / 1000, ',', substring(tostring(num), 0) - (num / 1000 * 1000)),\n        tostring(num)\n    ), @'\\.0$', '')\n}\n\n\n//===| Other |==========================================================================================================\n\n// ifempty\n.create-or-alter function \nwith (docstring = 'Replaces an empty value with the specified default value', folder = 'Common')\nifempty(val: dynamic, defaultVal: dynamic)\n{\n    iff(isempty(val), defaultVal, val)\n}\n",
                    "$fxv#8": "// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\n//======================================================================================================================\n// Ingestion database\n// Used for data ingestion, normalization, and cleansing.\n//======================================================================================================================\n\n// For allowed commands, see https://learn.microsoft.com/azure/data-explorer/database-script\n\n//===| Settings |=======================================================================================================\n\n.create-merge table HubSettingsLog (\n    version:   string,\n    scopes:    dynamic,\n    retention: dynamic\n)\n\n//----------------------------------------------------------------------------------------------------------------------\n\n// HubSettings function\n.create-or-alter function\nwith (docstring='Gets the latest version of hub settings.', folder='Settings')\nHubSettings()\n{\n    HubSettingsLog\n    | extend timestamp = ingestion_time()\n    | summarize arg_max(timestamp, *)\n}\n\n//----------------------------------------------------------------------------------------------------------------------\n\n// HubScopes function\n.create-or-alter function\nwith (docstring='Gets the currently configured scopes.', folder='Settings')\nHubScopes()\n{\n    HubSettings\n    | project scopes\n    | mv-expand scopes\n}\n\n\n//===| Open data |======================================================================================================\n\n// PricingUnits -- Create table if it doesn't exist\n.create-merge table PricingUnits ( ignore: string )\n\n// PricingUnits -- Remove all columns\n.alter table PricingUnits ( ignore: string )\n\n// PricingUnits -- Redefine all columns to change types\n.alter table PricingUnits (\n    x_PricingUnitDescription: string,\n    x_PricingBlockSize:       real,\n    PricingUnit:              string\n)\n\n// Regions\n.create-merge table Regions(\n    ResourceLocation: string,\n    RegionId:         string,\n    RegionName:       string\n)\n\n// ResourceTypes\n.create-merge table ResourceTypes(\n    x_ResourceType:           string,\n    SingularDisplayName:      string,\n    PluralDisplayName:        string,\n    LowerSingularDisplayName: string,\n    LowerPluralDisplayName:   string,\n    IsPreview:                bool,\n    Description:              string,\n    IconUri:                  string\n)\n\n// Services\n.create-merge table Services(\n    x_ConsumedService:        string,\n    x_ResourceType:           string,\n    ServiceName:              string,\n    ServiceCategory:          string,\n    ServiceSubcategory:       string,\n    PublisherName:            string,\n    x_PublisherCategory:      string,\n    x_Environment:            string,\n    x_ServiceModel:           string\n)\n\n//----------------------------------------------------------------------------------------------------------------------\n\n// parse_resourceid\n.create-or-alter function\nwith (docstring = 'Parses an Azure resource ID to extract resource attributes like the name, type, resource group, and subaccount ID.', folder = 'Common')\nparse_resourceid(resourceId: string) {\n    let ResourceId = tolower(resourceId);\n    // let ResourceId = tolower('/providers/Microsoft.BillingBenefits/savingsPlanOrders/2d2e284b-0638-427e-b8c6-1b874d4f17c8/sp/xxx');\n    let SubAccountId = tostring(extract('/subscriptions/[^/]+', 1, ResourceId));\n    let x_ResourceGroupName = tostring(extract('/resourcegroups/[^/]+', 1, ResourceId));\n    let providerPath = iff(ResourceId !contains '/providers/', '', split(iff(ResourceId startswith '/subscriptions/', strcat('/providers/microsoft.resources/', ResourceId), ResourceId), '/providers/')[-1]);\n    let x_ResourceProvider = iff(isempty(providerPath), '', split(providerPath, '/')[0]);\n    let tmp_ResourceProviderPath = iff(isempty(providerPath), '', substring(providerPath, strlen(x_ResourceProvider) + 1));\n    let segments = split(tmp_ResourceProviderPath, '/');\n    let ResourceName = trim(@'/+', replace_string(strcat_array(array_iff(\n        dynamic([false, true, false, true, false, true, false, true, false, true, false, true, false, true, false, true, false, true]),\n        segments, dynamic([])), '/'), '//', '/'));\n    let x_ResourceTypePath = trim(@'/+', replace_string(strcat_array(array_iff(\n        dynamic([true, false, true, false, true, false, true, false, true, false, true, false, true, false, true, false, true, false]),\n        segments, dynamic([])), '/'), '//', '/'));\n    let xRT = iff(isempty(x_ResourceProvider) or isempty(x_ResourceTypePath), '', strcat(x_ResourceProvider, '/', x_ResourceTypePath));\n    // TODO: Remove ResourceType in 0.9\n    bag_pack('ResourceId', ResourceId, 'ResourceName', ResourceName, 'ResourceType', xRT, 'SubAccountId', SubAccountId, 'x_ResourceGroupName', x_ResourceGroupName, 'x_ResourceProvider', x_ResourceProvider, 'x_ResourceType', xRT)\n}\n",
                    "$fxv#9": "// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\n//======================================================================================================================\n// Ingestion database\n// Used for data ingestion, normalization, and cleansing.\n// See known issues @ https://github.com/microsoft/finops-toolkit/issues/1111\n//======================================================================================================================\n\n// For allowed commands, see https://learn.microsoft.com/azure/data-explorer/database-script\n\n//===| Prices |=========================================================================================================\n// Supported versions:\n// - MS EA 2023-05-01  -- See https://learn.microsoft.com/azure/cost-management-billing/dataset-schema/price-sheet-ea\n// - MS MCA 2023-05-01 -- See https://learn.microsoft.com/azure/cost-management-billing/dataset-schema/price-sheet-mca\n//======================================================================================================================\n\n// Prices_transform_v1_0 function\n.create-or-alter function\nwith (docstring='DEPRECATED: All prices transformed to FOCUS 1.0. Use Prices_transform_v1_2() instead.', folder='Prices')\nPrices_transform_v1_0()\n{\n    // NOTE: All open issues and questions are tracked @ https://github.com/microsoft/finops-toolkit/issues/1111\n    let isoMonths = (duration: string) {\n        let number = toint(replace_regex(duration, @'[PMY]', ''));\n        toint(case(\n            duration == '', toint(''),\n            duration endswith \"Y\", number * 12,\n            duration endswith \"M\", number,\n            -1\n        ))\n    };\n    let prices = materialize(\n        Prices_raw\n        //\n        // Change real to decimal\n        | extend\n            BasePrice        = todecimal(BasePrice),\n            IncludedQuantity = todecimal(IncludedQuantity),\n            MarketPrice      = todecimal(MarketPrice),\n            TierMinimumUnits = todecimal(TierMinimumUnits),\n            UnitPrice        = todecimal(UnitPrice)\n        //\n        | extend x_SkuId = coalesce(SkuId, SkuID)\n        | extend x_SkuMeterId = coalesce(MeterId, MeterID)\n        | extend x_SkuProductId = coalesce(ProductId, ProductID)\n        | extend x_SkuTerm = isoMonths(Term)\n        | project-rename\n            x_BaseUnitPrice = BasePrice,\n            x_EffectivePeriodEnd = EffectiveEndDate,\n            x_EffectivePeriodStart = EffectiveStartDate,\n            x_PricingUnitDescription = UnitOfMeasure,\n            x_SkuIncludedQuantity = IncludedQuantity,\n            x_SkuMeterCategory = MeterCategory,\n            x_SkuMeterName = MeterName,\n            x_SkuMeterSubcategory = MeterSubCategory,\n            x_SkuMeterType = MeterType,\n            x_SkuOfferId = OfferID,\n            x_SkuPartNumber = PartNumber,\n            x_SkuPriceType = PriceType,\n            x_SkuRegion = MeterRegion,\n            x_SkuServiceFamily = ServiceFamily,\n            x_SkuTier = TierMinimumUnits\n        | extend ContractedUnitPrice = iff(x_SkuPriceType != 'SavingsPlan', UnitPrice, todecimal(''))  // UnitPrice for savings plan is not the on-demand unit price\n        | extend ListUnitPrice = iff(x_SkuPriceType != 'SavingsPlan', MarketPrice, todecimal(''))  // MarketPrice for savings plan is not the list price\n        | extend ChargeCategory = case(\n            x_SkuPriceType == 'Consumption', 'Usage',\n            x_SkuPriceType == 'ReservedInstance', 'Purchase',\n            x_SkuPriceType == 'SavingsPlan', 'Usage',  // Savings plan prices are for committed usage, not the purchase\n            ''\n        )\n        | extend SkuPriceIdv2 = strcat(case(x_SkuPriceType == 'Consumption', 'OD', x_SkuPriceType == 'ReservedInstance', 'RI', x_SkuPriceType == 'SavingsPlan', 'SP', 'XX'), substring(ChargeCategory, 0, 1), x_SkuTerm, '_', x_SkuProductId, '_', x_SkuId, '_', x_SkuMeterType, '_', x_SkuTier, x_SkuOfferId)\n        | extend x_BillingAccountId = iff(BillingAccountId startswith '/', split(BillingAccountId, '/')[-1], coalesce(BillingAccountId, EnrollmentNumber))\n        | extend x_BillingProfileId = iff(BillingProfileId startswith '/', split(BillingProfileId, '/')[-1], coalesce(BillingProfileId, EnrollmentNumber))\n        | extend tmp_SavingsPlanKey = strcat(x_SkuMeterId, x_SkuProductId, x_SkuId, x_SkuTier, x_SkuOfferId)\n        //\n        // Get latest ingested row based on the unique ID\n        | extend x_IngestionTime = ingestion_time()\n    );\n    //\n    // Meters for reservations and savings plans to identify commitment eligibility\n    let riMeters = prices | where x_SkuPriceType == 'ReservedInstance' | distinct x_SkuMeterId;\n    let spMeters = prices | where x_SkuPriceType == 'SavingsPlan' | distinct x_SkuMeterId;\n    //\n    // Copy list/base/contracted prices from on-demand SKUs\n    prices\n    | where x_SkuPriceType == 'SavingsPlan'\n    // If we use join, specify the shuffle key\n    // TODO: Compare join vs. lookup perf -- | join kind=leftouter hint.strategy=shuffle (prices | where x_SkuPriceType == 'Consumption' | where x_SkuMeterId in (spMeters) | distinct tmp_SavingsPlanKey, ListUnitPrice, ContractedUnitPrice, x_BaseUnitPrice) on tmp_SavingsPlanKey\n    | lookup kind=leftouter (prices | where x_SkuPriceType == 'Consumption' | where x_SkuMeterId in (spMeters) | distinct tmp_SavingsPlanKey, ListUnitPrice, ContractedUnitPrice, x_BaseUnitPrice) on tmp_SavingsPlanKey\n    | extend ListUnitPrice = coalesce(ListUnitPrice, ListUnitPrice1)\n    | extend ContractedUnitPrice = coalesce(ContractedUnitPrice, ContractedUnitPrice1)\n    | extend x_BaseUnitPrice = coalesce(x_BaseUnitPrice, x_BaseUnitPrice1)\n    | project-away ListUnitPrice1, ContractedUnitPrice1, x_BaseUnitPrice1, tmp_SavingsPlanKey\n    | union ((prices | where x_SkuPriceType != 'SavingsPlan'))\n    //\n    // Calculate commitment discount elgibility\n    // TODO: Would a join be faster?\n    | extend x_CommitmentDiscountSpendEligibility = iff(x_SkuMeterId in (riMeters) and x_SkuPriceType != 'ReservedInstance', 'Eligible', 'Not Eligible')\n    | extend x_CommitmentDiscountUsageEligibility = iff(x_SkuMeterId in (spMeters), 'Eligible', 'Not Eligible')\n    //\n    // Add PricingUnit and x_PricingBlockSize\n    // TODO: Compare join vs. lookup perf -- | join kind=leftouter (PricingUnits) on x_PricingUnitDescription | project-away x_PricingUnitDescription1\n    | lookup kind=leftouter (PricingUnits | extend x_PricingBlockSize = todecimal(x_PricingBlockSize)) on x_PricingUnitDescription\n    //\n    | extend x_EffectiveUnitPrice = iff(x_SkuPriceType == 'SavingsPlan', UnitPrice, todecimal(''))  // Savings plan prices are for the effective price, not the contracted price\n    | extend x_EffectiveUnitPriceDiscount = ContractedUnitPrice - x_EffectiveUnitPrice\n    | extend x_ContractedUnitPriceDiscount = ListUnitPrice - ContractedUnitPrice\n    | extend x_TotalUnitPriceDiscount = ListUnitPrice - x_EffectiveUnitPrice\n    | project\n        BillingAccountId = tolower(case(\n            BillingProfileId startswith '/', BillingProfileId,\n            BillingAccountId startswith '/', BillingAccountId,\n            strcat('/providers/microsoft.billing/billingaccounts/', x_BillingAccountId, iff(x_BillingProfileId == x_BillingAccountId, '', strcat('/billingprofiles/', x_BillingProfileId)))\n        )),\n        BillingAccountName = coalesce(BillingProfileName, BillingAccountName, x_BillingProfileId),\n        BillingCurrency = coalesce(BillingCurrency, CurrencyCode, Currency),  // Currency last as a fallback only\n        ChargeCategory,\n        CommitmentDiscountCategory = case(\n            x_SkuPriceType == 'ReservedInstance', 'Usage',\n            x_SkuPriceType == 'SavingsPlan', 'Spend',\n            ''\n        ),\n        CommitmentDiscountType = case(\n            x_SkuPriceType == 'ReservedInstance', 'Reservation',\n            x_SkuPriceType == 'SavingsPlan', 'Savings plan',\n            ''\n        ),\n        ContractedUnitPrice,\n        ListUnitPrice,\n        PricingCategory = case(\n            x_SkuPriceType == 'Consumption', 'Standard',\n            x_SkuPriceType == 'ReservedInstance', 'Standard',  // Reservation purchases are tracked as \"Standard\"\n            x_SkuPriceType == 'SavingsPlan', 'Committed',\n            ''\n        ),\n        PricingUnit,\n        SkuId = coalesce(ProductId, ProductID),\n        SkuPriceId = strcat(x_SkuProductId, '_', x_SkuId, '_', x_SkuMeterType),\n        SkuPriceIdv2,\n        x_BaseUnitPrice,\n        x_BillingAccountAgreement = case(\n            strlen(x_BillingAccountId) > 32, 'MCA',\n            strlen(x_BillingAccountId) < 32, 'EA',\n            'Unknown'\n        ),\n        x_BillingAccountId,\n        x_BillingProfileId,\n        x_CommitmentDiscountSpendEligibility,\n        x_CommitmentDiscountUsageEligibility,\n        x_ContractedUnitPriceDiscount,\n        x_ContractedUnitPriceDiscountPercent = 1.0 * x_ContractedUnitPriceDiscount / ListUnitPrice * 100,\n        x_EffectivePeriodEnd = startofmonth(x_EffectivePeriodEnd + 1h),\n        x_EffectivePeriodStart,\n        x_EffectiveUnitPrice,\n        x_EffectiveUnitPriceDiscount,\n        x_EffectiveUnitPriceDiscountPercent = 1.0 * x_EffectiveUnitPriceDiscount / ContractedUnitPrice * 100,\n        x_IngestionTime,\n        x_PricingBlockSize,\n        x_PricingCurrency = coalesce(Currency, CurrencyCode),  // CurrencyCode last as a fallback only\n        x_PricingSubcategory = case(\n            x_SkuPriceType == 'Consumption' and (x_SkuIncludedQuantity > 0 or x_SkuTier > 0), 'Tiered',\n            x_SkuPriceType == 'Consumption', 'Standard',\n            x_SkuPriceType == 'ReservedInstance', 'Standard', // Reservation purchases are tracked as \"Standard\"\n            x_SkuPriceType == 'SavingsPlan', 'Committed Spend',\n            ''\n        ),\n        x_PricingUnitDescription,\n        x_SkuDescription = Product,\n        x_SkuId,\n        x_SkuIncludedQuantity,\n        x_SkuMeterCategory,\n        x_SkuMeterId,\n        x_SkuMeterName,\n        x_SkuMeterSubcategory,\n        x_SkuMeterType,\n        x_SkuPriceType,\n        x_SkuProductId,\n        x_SkuRegion,\n        x_SkuServiceFamily,\n        x_SkuOfferId,\n        x_SkuPartNumber,\n        x_SkuTerm,\n        x_SkuTier,\n        x_SourceName = coalesce(x_SourceName, 'Cost Management'),\n        x_SourceProvider = coalesce(x_SourceProvider, 'Microsoft'),\n        x_SourceType = coalesce(x_SourceType, 'PriceSheet'),\n        x_SourceVersion = coalesce(x_SourceVersion, '2023-05-01'),\n        x_TotalUnitPriceDiscount,\n        x_TotalUnitPriceDiscountPercent = 1.0 * x_TotalUnitPriceDiscount / ListUnitPrice * 100\n}\n\n// Prices_final_v1_0 table\n.create-merge table Prices_final_v1_0 (\n    BillingAccountId:                     string,\n    BillingAccountName:                   string,\n    BillingCurrency:                      string,\n    ChargeCategory:                       string,\n    CommitmentDiscountCategory:           string,\n    CommitmentDiscountType:               string,\n    ContractedUnitPrice:                  decimal,\n    ListUnitPrice:                        decimal,\n    PricingCategory:                      string,\n    PricingUnit:                          string,\n    SkuId:                                string,\n    SkuPriceId:                           string,\n    SkuPriceIdv2:                         string,    // Hubs add-on\n    x_BaseUnitPrice:                      decimal,   // Azure\n    x_BillingAccountAgreement:            string,    // Hubs add-on\n    x_BillingAccountId:                   string,    // Azure MCA\n    x_BillingProfileId:                   string,    // Azure MCA\n    x_CommitmentDiscountSpendEligibility: string,    // Hubs add-on\n    x_CommitmentDiscountUsageEligibility: string,    // Hubs add-on\n    x_ContractedUnitPriceDiscount:        decimal,   // Hubs add-on\n    x_ContractedUnitPriceDiscountPercent: decimal,   // Hubs add-on\n    x_EffectivePeriodEnd:                 datetime,  // Azure\n    x_EffectivePeriodStart:               datetime,  // Azure\n    x_EffectiveUnitPrice:                 decimal,   // Azure\n    x_EffectiveUnitPriceDiscount:         decimal,   // Hubs add-on\n    x_EffectiveUnitPriceDiscountPercent:  decimal,   // Hubs add-on\n    x_IngestionTime:                      datetime,  // Hubs add-on\n    x_PricingBlockSize:                   decimal,   // Hubs add-on\n    x_PricingCurrency:                    string,    // Azure\n    x_PricingSubcategory:                 string,    // Hubs add-on\n    x_PricingUnitDescription:             string,    // Azure\n    x_SkuDescription:                     string,    // Azure\n    x_SkuId:                              string,    // Azure\n    x_SkuIncludedQuantity:                decimal,   // Azure EA\n    x_SkuMeterCategory:                   string,    // Azure\n    x_SkuMeterId:                         string,    // Azure\n    x_SkuMeterName:                       string,    // Azure\n    x_SkuMeterSubcategory:                string,    // Azure\n    x_SkuMeterType:                       string,    // Azure\n    x_SkuPriceType:                       string,    // Azure\n    x_SkuProductId:                       string,    // Azure\n    x_SkuRegion:                          string,    // Azure\n    x_SkuServiceFamily:                   string,    // Azure\n    x_SkuOfferId:                         string,    // Azure EA\n    x_SkuPartNumber:                      string,    // Azure EA\n    x_SkuTerm:                            int,       // Azure\n    x_SkuTier:                            decimal,   // Azure MCA\n    x_SourceName:                         string,    // Hubs add-on\n    x_SourceProvider:                     string,    // Hubs add-on\n    x_SourceType:                         string,    // Hubs add-on\n    x_SourceVersion:                      string,    // Hubs add-on\n    x_TotalUnitPriceDiscount:             decimal,   // Hubs add-on\n    x_TotalUnitPriceDiscountPercent:      decimal    // Hubs add-on\n)\n\n// Update policy for Prices_raw -> Prices_final_v1_0\n.alter table Prices_final_v1_0 policy update\n```\n[{\n    \"IsEnabled\": false,\n    \"Source\": \"Prices_raw\",\n    \"Query\": \"Prices_transform_v1_0()\",\n    \"IsTransactional\": true,\n    \"PropagateIngestionProperties\": true\n}]\n```\n\n\n//===| Cost and usage |=================================================================================================\n// Supported versions:\n// - MS: 1.0, 1.0-preview(v1) -- See https://aka.ms/costmgmt/exports/focus\n// - AWS: 1.0                 -- See https://docs.aws.amazon.com/cur/latest/userguide/table-dictionary-focus-1-0-aws-columns.html\n// - GCP: Jan-Jun 2024        -- See https://cloud.google.com/resources/google-cloud-focus?e=48754805&hl=en\n//                                   Links to (Aug 2024): https://services.google.com/fh/files/misc/focus_guide_v1.pdf\n//                               See also:\n//                               - https://cloud.google.com/billing/docs/how-to/export-data-bigquery-tables/standard-usage\n//                               - https://cloud.google.com/billing/docs/how-to/export-data-bigquery-tables/detailed-usage\n// - OCI: 1.0                 -- See https://docs.oracle.com/iaas/Content/Billing/Concepts/costusagereportsoverview.htm#costreports__focus-cost-report-schema\n//\n// Support for non-Azure data is limited to ingestion only. Data is not transformed across versions.\n//======================================================================================================================\n\n// Costs_transform_v1_0 function\n.create-or-alter function\nwith (docstring='DEPRECATED: All costs transformed to FOCUS 1.0. Use Costs_transform_v1_2() instead.', folder='Costs')\nCosts_transform_v1_0()\n{\n    // NOTE: All open issues and questions are tracked @ https://github.com/microsoft/finops-toolkit/issues/1111\n    Costs_raw\n    //\n    // Change real to decimal\n    | extend\n        BilledCost                 = todecimal(BilledCost),\n        CommitmentDiscountQuantity = todecimal(CommitmentDiscountQuantity),\n        ConsumedQuantity           = todecimal(ConsumedQuantity),\n        ContractedCost             = todecimal(ContractedCost),\n        ContractedUnitPrice        = todecimal(ContractedUnitPrice),\n        EffectiveCost              = todecimal(EffectiveCost),\n        ListCost                   = todecimal(ListCost),\n        ListUnitPrice              = todecimal(ListUnitPrice),\n        PricingQuantity            = todecimal(PricingQuantity),\n        UsageAmount                = todecimal(UsageAmount),\n        UsageQuantity              = todecimal(UsageQuantity),\n        x_BilledCostInUsd          = todecimal(x_BilledCostInUsd),\n        x_BilledUnitPrice          = todecimal(x_BilledUnitPrice),\n        x_BillingExchangeRate      = todecimal(x_BillingExchangeRate),\n        x_ContractedCostInUsd      = todecimal(x_ContractedCostInUsd),\n        x_Cost                     = todecimal(x_Cost),\n        x_CurrencyConversionRate   = todecimal(x_CurrencyConversionRate),\n        x_EffectiveCostInUsd       = todecimal(x_EffectiveCostInUsd),\n        x_EffectiveUnitPrice       = todecimal(x_EffectiveUnitPrice),\n        x_ListCostInUsd            = todecimal(x_ListCostInUsd),\n        x_OnDemandCost             = todecimal(x_OnDemandCost),\n        x_OnDemandCostInUsd        = todecimal(x_OnDemandCostInUsd),\n        x_OnDemandUnitPrice        = todecimal(x_OnDemandUnitPrice),\n        x_PricingBlockSize         = todecimal(x_PricingBlockSize)\n    //\n    // Dedupe rows\n    | extend x_IngestionTime = ingestion_time()\n    | extend x_ChargeId = ''\n    // TODO: Consider adding a unique charge ID per row\n    // hash_sha256(strcat(\n    //     // DO NOT CHANGE COLUMNS OR COLUMN ORDER\n    //     // 1. Resource hierarchy (including resource name), highest to lowest\n    //     BillingAccountId,\n    //     x_InvoiceSectionId,\n    //     x_AccountOwnerId,\n    //     SubAccountId,\n    //     x_ResourceGroupName,\n    //     ResourceName,\n    //     // 2. Resource details\n    //     ResourceId,\n    //     RegionId,\n    //     Tags,\n    //     CommitmentDiscountId,\n    //     x_CostCenter,\n    //     // 4. Meter details\n    //     SkuPriceId,\n    //     x_SkuMeterId,\n    //     x_SkuPartNumber,\n    //     x_SkuOfferId,\n    //     x_SkuDetails,\n    //     // 5. Date\n    //     ChargePeriodStart\n    // ))\n    //\n    // Identify data quality issues\n    | extend x_SourceChanges = trim_end(',', strcat(\n        iff(ChargeCategory == 'Purchase' and isnotempty(CommitmentDiscountId) and ChargeFrequency == 'Usage-Based',                 'InvalidChargeFrequency,',           ''),\n        iff(ChargeCategory == 'Purchase' and isnotempty(CommitmentDiscountId) and EffectiveCost > 0,                                'InvalidEffectiveCost,',             ''),\n        iff((isempty(ContractedCost)      or ContractedCost == 0)      and EffectiveCost != 0,                                      'MissingContractedCost,',            ''),\n        iff((isempty(ContractedUnitPrice) or ContractedUnitPrice == 0) and x_EffectiveUnitPrice != 0,                               'MissingContractedUnitPrice,',       ''),\n        iff(ListCost < ContractedCost,                                                                                              'ListCostLessThanContractedCost,',   ''),\n        iff(ContractedCost < EffectiveCost,                                                                                         'ContractedCostLessThanEffectiveCost,', ''),\n        iff((isempty(ListCost)            or ListCost == 0)            and (ContractedCost != 0      or EffectiveCost != 0),        'MissingListCost,',                  ''),\n        iff((isempty(ListUnitPrice)       or ListUnitPrice == 0)       and (ContractedUnitPrice != 0 or x_EffectiveUnitPrice != 0), 'MissingListUnitPrice,',             ''),\n        iff((isnotempty(x_BilledUnitPrice) and x_BilledUnitPrice != 0 and isnotempty(x_EffectiveUnitPrice) and x_EffectiveUnitPrice != 0 and abs(x_BilledUnitPrice - x_EffectiveUnitPrice) < 0.0001)\n            or (isnotempty(ContractedUnitPrice) and ContractedUnitPrice != 0 and isnotempty(x_EffectiveUnitPrice) and x_EffectiveUnitPrice != 0 and abs(ContractedUnitPrice - x_EffectiveUnitPrice) < 0.0001),\n            'XEffectiveUnitPriceRoundingError,',  ''),\n        iff(ConsumedQuantity == 0 and (EffectiveCost != 0 or BilledCost != 0),                                                      'MissingConsumedQuantity,',              ''),\n        iff(PricingQuantity == 0 and (EffectiveCost != 0 or BilledCost != 0),                                                       'MissingPricingQuantity,',              ''),\n        iff(isempty(ProviderName),                                                                                                  'MissingProviderName,',              ''),\n        iff(isempty(PublisherName),                                                                                                 'MissingPublisherName,',             ''),\n        iff(ChargeCategory == 'Purchase' and isnotempty(CommitmentDiscountId) and isempty(ResourceId),                              'MissingResourceId,',                ''),\n        iff(ChargeCategory == 'Purchase' and isnotempty(CommitmentDiscountId) and isempty(ResourceName),                            'MissingResourceName,',              ''),\n        iff(ChargeCategory == 'Purchase' and isnotempty(CommitmentDiscountId) and isempty(ResourceType),                            'MissingResourceType,',              ''),\n        iff(BilledCost > 0 and x_BilledUnitPrice == 0,                                                                              'MissingXBilledUnitPrice,',          ''),\n        iff(ChargeCategory == 'Purchase' and isnotempty(CommitmentDiscountId) and isempty(x_ResourceType),                          'MissingXResourceType,',             ''),\n        iff(PricingCategory == 'Standard' and isnotempty(CommitmentDiscountId) and ChargeCategory == 'Usage',                       'PricingCategoryShouldBeCommitted,', ''),\n        iff(x_SkuTerm == '1Year' or x_SkuTerm == '3Years' or x_SkuTerm == '5Years',                                                 'SkuTermShouldBeAnInteger,',         '')\n    ))\n    //\n    // Fix columns needed in other changes\n    | extend ProviderName = case(\n        isnotempty(ProviderName), ProviderName,\n        isnotempty(coalesce(x_CostCategories, x_Discount, x_Operation, x_ServiceCode, x_UsageType)), 'AWS',\n        isnotempty(coalesce(tostring(UsageAmount), tostring(x_Cost), x_Credits, x_CostType, tostring(x_CurrencyConversionRate), tostring(x_ExportTime), x_Project, x_ServiceId)), 'GCP',\n        isnotempty(coalesce(x_BillingProfileId, x_InvoiceSectionId)), 'Microsoft',\n        ''\n    )\n    //\n    // Identify source\n    | extend x_SourceName     = coalesce(x_SourceName, iff(isnotempty(x_BillingProfileId), 'Cost Management', ProviderName))\n    | extend x_SourceProvider = coalesce(x_SourceProvider, ProviderName)\n    | extend x_SourceType     = coalesce(x_SourceType, iff(isnotempty(x_BillingProfileId), 'FocusCost', ''))\n    | extend x_SourceVersion  = coalesce(x_SourceVersion, case(\n        isnotempty(coalesce(InvoiceId, SkuMeter, PricingCurrency)) and isempty(SkuPriceDetails) and isnotempty(x_SkuDetails), '1.2-preview',\n        isnotempty(coalesce(InvoiceId, SkuMeter, PricingCurrency)), '1.2',\n        isnotempty(coalesce(ChargeClass, CommitmentDiscountStatus, tostring(ConsumedQuantity), ConsumedUnit, tostring(ContractedCost), tostring(ContractedUnitPrice), RegionId, RegionName)), '1.0',\n        isnotempty(coalesce(ChargeSubcategory, Region, tostring(UsageQuantity), UsageUnit)), iff(ProviderName == 'Microsoft', '1.0-preview(v1)', '1.0-preview'),\n        ''\n    ))\n    // Append version check error code\n    | extend x_SourceChanges = iff(x_SourceVersion == '1.0', x_SourceChanges,\n        strcat(x_SourceChanges, iff(isempty(x_SourceChanges), '', ','), iff(x_SourceVersion == '', 'UnknownFocusVersion', 'LegacyFocusVersion'))\n    )\n    //\n    // Fix quantities\n    | extend PricingQuantity  = case(\n        PricingQuantity != 0 or (EffectiveCost == 0 and BilledCost == 0), PricingQuantity,\n        PricingQuantity == 0 and isnotempty(BilledCost) and BilledCost != 0 and isnotempty(x_BilledUnitPrice) and x_BilledUnitPrice != 0, BilledCost / x_BilledUnitPrice,\n        PricingQuantity == 0 and isnotempty(BilledCost) and BilledCost != 0 and isnotempty(x_BilledUnitPrice) and x_BilledUnitPrice != 0, BilledCost / x_BilledUnitPrice,\n        PricingQuantity == 0 and isnotempty(EffectiveCost) and EffectiveCost != 0 and isnotempty(x_EffectiveUnitPrice) and x_EffectiveUnitPrice != 0, EffectiveCost / x_EffectiveUnitPrice,\n        PricingQuantity\n    )\n    | extend ConsumedQuantity = case(\n        isnotempty(ConsumedQuantity) and ConsumedQuantity != 0, ConsumedQuantity,\n        ChargeCategory == 'Usage', PricingQuantity / coalesce(x_PricingBlockSize, decimal(1)),\n        ConsumedQuantity\n    )\n    //\n    // Populate missing prices -- mapping to on-demand prices requires meter ID and offer ID\n    | extend tmp_MissingPrices = ProviderName == 'Microsoft'\n        and (ListUnitPrice == 0 or ContractedUnitPrice == 0)\n        and x_EffectiveUnitPrice != 0\n        and not(CommitmentDiscountCategory == 'Spend' and CommitmentDiscountStatus == 'Unused')\n        and isnotempty(strcat(x_SkuMeterId, x_SkuOfferId))\n    | as allCosts\n    | where tmp_MissingPrices\n    | extend tmp_ReservationPriceLookupKey = tolower(strcat(x_BillingProfileId, substring(ChargePeriodStart, 0, 7), x_SkuMeterId, x_SkuOfferId))\n    | as costsWithMissingPrices\n    | join kind=leftouter (\n        Prices_final_v1_0\n        | extend tmp_ReservationPriceLookupKey = tolower(strcat(x_BillingProfileId, substring(x_EffectivePeriodStart, 0, 7), x_SkuMeterId, x_SkuOfferId))\n        | where x_SkuPriceType == 'Consumption' and tmp_ReservationPriceLookupKey in ((costsWithMissingPrices | summarize by tmp_ReservationPriceLookupKey))\n        | summarize ListUnitPrice = min(ListUnitPrice), ContractedUnitPrice = min(ContractedUnitPrice) by tmp_ReservationPriceLookupKey, x_PricingBlockSize, PricingUnit\n    ) on tmp_ReservationPriceLookupKey\n    //\n    // Select the best price to use for each row\n    // TODO: Save values before changing -- | extend x_old_ContractedUnitPrice = ContractedUnitPrice, x_old_EffectiveUnitPrice = x_EffectiveUnitPrice, x_old_ListUnitPrice = ListUnitPrice, x_old_ListCost = ListCost, x_old_ContractedCost = ContractedCost\n    | extend x_EffectiveUnitPrice = case(\n        // If price is a rounding error away from the billed price, use the billed price\n        isnotempty(x_BilledUnitPrice) and x_BilledUnitPrice != 0 and isnotempty(x_EffectiveUnitPrice) and x_EffectiveUnitPrice != 0 and abs(x_BilledUnitPrice - x_EffectiveUnitPrice) < 0.0001, x_BilledUnitPrice,\n        // If price is a rounding error away from the contracted price, use the contracted price\n        isnotempty(ContractedUnitPrice) and ContractedUnitPrice != 0 and isnotempty(x_EffectiveUnitPrice) and x_EffectiveUnitPrice != 0 and abs(ContractedUnitPrice - x_EffectiveUnitPrice) < 0.0001, ContractedUnitPrice,\n        x_EffectiveUnitPrice\n    )\n    | extend ContractedUnitPrice = case(\n        // If price is already correct, keep that\n        (isnotempty(ContractedUnitPrice) and ContractedUnitPrice != 0) or (EffectiveCost == 0 and BilledCost == 0), ContractedUnitPrice,\n        // If both prices use the same scale, use the new one\n        PricingUnit == PricingUnit1 and x_PricingBlockSize == x_PricingBlockSize1, ContractedUnitPrice1 * x_BillingExchangeRate,\n        // If prices are the same unit but not the same scale, use the new one but correct the scale\n        PricingUnit == PricingUnit1 and x_PricingBlockSize != x_PricingBlockSize1 and isnotempty(x_PricingBlockSize) and isnotempty(x_PricingBlockSize1), ContractedUnitPrice1 * x_BillingExchangeRate / x_PricingBlockSize1 * x_PricingBlockSize,\n        // If billed price is available, assume the billed price is the same as contracted price to support aggregations\n        isnotempty(x_BilledUnitPrice) and x_BilledUnitPrice != 0, x_EffectiveUnitPrice,\n        // Otherwise, assume the effective price is the same as contracted price to support aggregations\n        x_EffectiveUnitPrice\n    )\n    | extend ListUnitPrice = case(\n        // If price is already correct, keep that\n        (isnotempty(ListUnitPrice) and ListUnitPrice != 0) or (EffectiveCost == 0 and BilledCost == 0), ListUnitPrice,\n        // If both prices use the same scale, use the new one\n        PricingUnit == PricingUnit1 and x_PricingBlockSize == x_PricingBlockSize1, ListUnitPrice1 * x_BillingExchangeRate,\n        // If prices are the same unit but not the same scale, use the new one but correct the scale\n        PricingUnit == PricingUnit1 and x_PricingBlockSize != x_PricingBlockSize1 and isnotempty(x_PricingBlockSize) and isnotempty(x_PricingBlockSize1), ListUnitPrice1 * x_BillingExchangeRate / x_PricingBlockSize1 * x_PricingBlockSize,\n        // Otherwise, assume the contracted price is the same as list price to support aggregations\n        ContractedUnitPrice\n    )\n    // Calculate missing costs based on new prices -- If cost is already correct, keep that; if not and price is available, recalculate the cost; otherwise, keep the existing cost\n    | extend ContractedCost = case(\n        // If not set or there's no cost, keep the original value\n        (isnotempty(ContractedCost) and ContractedCost != 0) or (EffectiveCost == 0 and BilledCost == 0), ContractedCost,\n        // ContractedCost is 0 in all other scenarios...\n        // If 0 and there's a billed cost and prices are the same, use BilledCost\n        isnotempty(BilledCost)    and BilledCost    != 0 and ContractedUnitPrice == x_BilledUnitPrice,    BilledCost,\n        // If 0 and there's a billed cost and prices are the same, use EffectiveCost\n        isnotempty(EffectiveCost) and EffectiveCost != 0 and ContractedUnitPrice == x_EffectiveUnitPrice, EffectiveCost,\n        // If 0 and there's a price, calculate the cost based on the price\n        isnotempty(ContractedUnitPrice) and ContractedUnitPrice != 0, ContractedUnitPrice * PricingQuantity,\n        // If 0 and there's no price, assume EffectiveCost\n        isempty(ContractedUnitPrice) or ContractedUnitPrice == 0, EffectiveCost,\n        // Fall back to the original value for any unhandled scenarios\n        ContractedCost\n    )\n    | extend ListCost = case(\n        // If not set or there's no cost, keep the original value\n        (isnotempty(ListCost) and ListCost != 0) or (EffectiveCost == 0 and BilledCost == 0), ListCost,\n        // ListCost is 0 in all other scenarios...\n        // If 0 and there's a contracted cost and prices are the same, use ContractedCost\n        isnotempty(ContractedCost) and ContractedCost != 0 and ListUnitPrice == ContractedUnitPrice, ContractedCost,\n        // If 0 and there's a price, calculate the cost based on the price\n        isnotempty(ListUnitPrice) and ListUnitPrice != 0, ListUnitPrice * PricingQuantity,\n        // If 0 and there's no price, assume ContractedCost\n        isempty(ListUnitPrice) or ListUnitPrice == 0, ContractedCost,\n        // Fall back to the original value for any unhandled scenarios\n        ListCost\n    )\n    // Merge the rest of the unmodified cost records and remove excess columns\n    | union (allCosts | where not(tmp_MissingPrices))\n    | project-away x_PricingBlockSize1, PricingUnit1, ListUnitPrice1, ContractedUnitPrice1, tmp_MissingPrices, tmp_ReservationPriceLookupKey, tmp_ReservationPriceLookupKey1\n    //\n    // BUG: Fix ContractedCost that has bad values\n    | extend ContractedCost = iff(ProviderName == 'Microsoft' and isnotempty(PricingQuantity) and isnotempty(x_PricingBlockSize) and ContractedCost != ContractedUnitPrice * PricingQuantity, ContractedUnitPrice * PricingQuantity, ContractedCost)\n    //\n    // Handle FOCUS 1.0-preview UsageQuantity/Unit\n    | extend ConsumedQuantity = iff(ChargeCategory == 'Usage', coalesce(ConsumedQuantity, UsageQuantity, UsageAmount), todecimal(''))\n    | extend ConsumedUnit = iff(ChargeCategory == 'Usage' and isnotempty(ConsumedQuantity), coalesce(ConsumedUnit, UsageUnit, 'Units'), '')\n    //\n    // Convert IDs to lowercase for consistency\n    | extend CommitmentDiscountId = tolower(CommitmentDiscountId)\n    //\n    // BUG: Remove EffectiveCost for commitment discount purchases\n    | extend EffectiveCost = iff(ChargeCategory == 'Purchase' and isnotempty(CommitmentDiscountId), decimal(0), EffectiveCost)\n    | extend x_EffectiveCostInUsd = iff(ChargeCategory == 'Purchase' and isnotempty(CommitmentDiscountId), decimal(0), x_EffectiveCostInUsd)\n    //\n    // Clean up resource columns\n    | extend ResourceId = case(\n        isnotempty(ResourceId), ResourceId,\n        ChargeCategory == 'Purchase' and isnotempty(CommitmentDiscountId), CommitmentDiscountId,\n        ResourceId)\n    | extend ResourceName = tolower(case(\n        isnotempty(ResourceName), ResourceName,\n        ChargeCategory == 'Purchase' and isnotempty(CommitmentDiscountName), CommitmentDiscountName,\n        isnotempty(ResourceId), parse_resourceid(ResourceId).ResourceName,\n        ResourceName))\n    | extend x_ResourceType = case(\n        isnotempty(x_ResourceType), x_ResourceType,\n        isnotempty(ResourceId), parse_resourceid(ResourceId).x_ResourceType,\n        x_ResourceType)\n    | extend ResourceType = case(\n        // Use existing resource type display name unless it's an internal resource type ID\n        isnotempty(ResourceType) and tolower(ResourceType) != tolower(x_ResourceType) and ResourceType !contains '/', ResourceType,\n        // Use CommitmentDiscountType for commitment discount purchases\n        ChargeCategory == 'Purchase' and isnotempty(CommitmentDiscountType), CommitmentDiscountType,\n        // Look up display name from internal type\n        isnotempty(x_ResourceType), coalesce(resource_type(x_ResourceType).SingularDisplayName, ResourceType, x_ResourceType),\n        ResourceType)\n    //\n    // Sort columns and apply final transforms\n    | project\n        AvailabilityZone,\n        BilledCost,\n        BillingAccountId = tolower(BillingAccountId),\n        BillingAccountName,\n        BillingAccountType,\n        BillingCurrency,\n        BillingPeriodEnd = startofmonth(BillingPeriodEnd),\n        BillingPeriodStart = startofmonth(BillingPeriodStart),\n        ChargeCategory = case(\n            // Handle FOCUS 1.0-preview ChargeSubcategory\n            ChargeSubcategory == 'Credit', 'Credit',\n            ChargeSubcategory == 'Refund', 'Purchase',  // We are assuming purchase refunds since we don't have data to indicate usage refunds\n            ChargeCategory\n        ),\n        ChargeClass = case(ChargeSubcategory == 'Refund', 'Correction', ChargeClass),\n        ChargeDescription,\n        // BUG: ChargeFrequency shows \"Usage-Based\" for monthly recurring savings plan purchases\n        ChargeFrequency = iff(ChargeCategory == 'Purchase' and isnotempty(CommitmentDiscountId) and ChargeFrequency == 'Usage-Based' and ProviderName == 'Microsoft' and x_SourceVersion startswith '1.0', 'Recurring', ChargeFrequency),\n        ChargePeriodEnd,\n        ChargePeriodStart,\n        CommitmentDiscountCategory,\n        CommitmentDiscountId = tolower(CommitmentDiscountId),\n        CommitmentDiscountName,\n        CommitmentDiscountStatus = case(\n            // Handle FOCUS 1.0-preview ChargeSubcategory\n            ChargeSubcategory == 'Used Commitment', 'Used',\n            ChargeSubcategory == 'Unused Commitment', 'Unused',\n            CommitmentDiscountStatus\n        ),\n        CommitmentDiscountType,\n        ConsumedQuantity,\n        ConsumedUnit,\n        ContractedCost = coalesce(ContractedCost, x_OnDemandCost, x_Cost),\n        ContractedUnitPrice = coalesce(ContractedUnitPrice, x_OnDemandUnitPrice),\n        EffectiveCost,\n        InvoiceIssuerName,\n        ListCost,\n        ListUnitPrice,\n        PricingCategory = case(\n            // Handle FOCUS 1.0-preview PricingCategory values\n            PricingCategory == 'On-Demand', 'Standard',\n            PricingCategory == 'Commitment-Based', 'Committed',\n            PricingCategory\n        ),\n        PricingQuantity,\n        PricingUnit,\n        ProviderName,\n        // Handle missing PublisherName values\n        PublisherName = case(PublisherName == 'Microsoft Corporation', 'Microsoft', isnotempty(PublisherName), PublisherName, x_PublisherCategory == 'Cloud Provider', ProviderName, ''),\n        // Handle FOCUS 1.0-preview Region column\n        RegionId = coalesce(RegionId, iff(ProviderName == 'Microsoft', replace_string(tolower(Region), ' ', ''), Region)),\n        RegionName = coalesce(RegionName, Region),\n        ResourceId,\n        ResourceName,\n        ResourceType,\n        ServiceCategory,\n        ServiceName,\n        SkuId,\n        SkuPriceId,\n        SubAccountId,\n        SubAccountName,\n        SubAccountType,              // Azure 1.0-preview(v1)+\n        Tags = parse_json(Tags),\n        x_AccountId,                 // Azure 1.0-preview(v1)+\n        x_AccountName,               // Azure 1.0-preview(v1)+\n        x_AccountOwnerId,            // Azure 1.0-preview(v1)+\n        x_BilledCostInUsd,           // Azure 1.0-preview(v1)+\n        x_BilledUnitPrice,           // Azure 1.0-preview(v1)+\n        x_BillingAccountAgreement = case(\n            ProviderName == 'Microsoft' and x_BillingAccountId == x_BillingProfileId, 'EA',\n            ProviderName == 'Microsoft' and x_BillingAccountId != x_BillingProfileId, 'MCA',\n            ProviderName\n        ),                           // Hubs add-on\n        x_BillingAccountId,          // Azure 1.0-preview(v1)+\n        x_BillingAccountName,        // Azure 1.0-preview(v1)+\n        x_BillingExchangeRate,       // Azure 1.0-preview(v1)+\n        x_BillingExchangeRateDate,   // Azure 1.0-preview(v1)+\n        x_BillingProfileId,          // Azure 1.0-preview(v1)+\n        x_BillingProfileName,        // Azure 1.0-preview(v1)+\n        x_ChargeId,                  // Azure 1.0-preview(v1) only\n        x_ContractedCostInUsd = coalesce(x_ContractedCostInUsd, x_OnDemandCostInUsd), // Azure 1.0+\n        x_CostAllocationRuleName,    // Azure 1.0-preview(v1)+\n        x_CostCategories = parse_json(x_CostCategories),  // AWS 1.0 (JSON)\n        x_CostCenter,                // Azure 1.0-preview(v1)+\n        x_Credits = parse_json(x_Credits),  // GCP Jan 2024\n        x_CostType,                  // GCP Jan 2024\n        x_CurrencyConversionRate,    // GCP Jun 2024\n        x_CustomerId,                // Azure 1.0-preview(v1)+\n        x_CustomerName,              // Azure 1.0-preview(v1)+\n        x_Discount = parse_json(x_Discount),  // AWS 1.0 (JSON)\n        x_EffectiveCostInUsd,        // Azure 1.0-preview(v1)+\n        x_EffectiveUnitPrice,        // Azure 1.0-preview(v1)+\n        x_ExportTime,                // GCP Jan 2024\n        x_IngestionTime,             // Hubs add-on\n        x_InvoiceId = coalesce(InvoiceId, x_InvoiceId),  // Azure 1.0-preview(v1)+\n        x_InvoiceIssuerId,           // Azure 1.0-preview(v1)+\n        x_InvoiceSectionId = case(   // Azure 1.0-preview(v1)+\n            x_InvoiceSectionId == '-2', '',\n            x_InvoiceSectionId\n        ),\n        x_InvoiceSectionName = case(   // Azure 1.0-preview(v1)+\n            x_InvoiceSectionName == 'Unassigned', '',\n            x_InvoiceSectionName\n        ),\n        x_ListCostInUsd,             // Azure 1.0-preview(v1)+\n        x_Location,                  // GCP Jan 2024\n        x_Operation,                 // AWS 1.0\n        x_PartnerCreditApplied,      // Azure 1.0-preview(v1)+\n        x_PartnerCreditRate,         // Azure 1.0-preview(v1)+\n        x_PricingBlockSize,          // Azure 1.0-preview(v1)+\n        x_PricingCurrency = coalesce(PricingCurrency, x_PricingCurrency),  // Azure 1.0-preview(v1)+\n        x_PricingSubcategory,        // Azure 1.0-preview(v1)+\n        x_PricingUnitDescription,    // Azure 1.0-preview(v1)+\n        x_Project,                   // GCP Jan 2024\n        x_PublisherCategory,         // Azure 1.0-preview(v1)+\n        x_PublisherId,               // Azure 1.0-preview(v1)+\n        x_ResellerId,                // Azure 1.0-preview(v1)+\n        x_ResellerName,              // Azure 1.0-preview(v1)+\n        x_ResourceGroupName = tolower(x_ResourceGroupName),  // Azure 1.0-preview(v1)+\n        x_ResourceType,              // Azure 1.0-preview(v1)+\n        x_ServiceCode,               // AWS 1.0\n        x_ServiceId,                 // GCP Jan 2024\n        x_ServicePeriodEnd,          // Azure 1.0-preview(v1)+\n        x_ServicePeriodStart,        // Azure 1.0-preview(v1)+\n        x_SkuDescription,            // Azure 1.0-preview(v1)+\n        x_SkuDetails = parse_json(x_SkuDetails),  // Azure 1.0-preview(v1)+\n        x_SkuIsCreditEligible,       // Azure 1.0-preview(v1)+\n        x_SkuMeterCategory,          // Azure 1.0-preview(v1)+\n        x_SkuMeterId,                // Azure 1.0-preview(v1)+\n        x_SkuMeterName = coalesce(SkuMeter, x_SkuMeterName),  // Azure 1.0-preview(v1)+\n        x_SkuMeterSubcategory,       // Azure 1.0-preview(v1)+\n        x_SkuOfferId,                // Azure 1.0-preview(v1)+\n        x_SkuOrderId,                // Azure 1.0-preview(v1)+\n        x_SkuOrderName,              // Azure 1.0-preview(v1)+\n        x_SkuPartNumber,             // Azure 1.0-preview(v1)+\n        x_SkuRegion,                 // Azure 1.0-preview(v1)+\n        x_SkuServiceFamily,          // Azure 1.0-preview(v1)+\n        x_SkuTerm,                   // Azure 1.0-preview(v1)+\n        x_SkuTier,                   // Azure 1.0-preview(v1)+\n        x_SourceChanges,             // Hubs add-on\n        x_SourceName,                // Hubs add-on\n        x_SourceProvider,            // Hubs add-on\n        x_SourceType,                // Hubs add-on\n        x_SourceVersion,             // Hubs add-on\n        x_UsageType                  // AWS 1.0\n}\n\n// Costs_final_v1_0 table\n.create-merge table Costs_final_v1_0 (\n    AvailabilityZone:           string,\n    BilledCost:                 decimal,\n    BillingAccountId:           string,\n    BillingAccountName:         string,\n    BillingAccountType:         string,    // Azure 1.0-preview(v1)+\n    BillingCurrency:            string,\n    BillingPeriodEnd:           datetime,\n    BillingPeriodStart:         datetime,\n    ChargeCategory:             string,\n    ChargeClass:                string,\n    ChargeDescription:          string,\n    ChargeFrequency:            string,\n    ChargePeriodEnd:            datetime,\n    ChargePeriodStart:          datetime,\n    CommitmentDiscountCategory: string,    // FOCUS 1.0-preview only\n    CommitmentDiscountId:       string,\n    CommitmentDiscountName:     string,\n    CommitmentDiscountStatus:   string,\n    CommitmentDiscountType:     string,\n    ConsumedQuantity:           decimal,\n    ConsumedUnit:               string,\n    ContractedCost:             decimal,\n    ContractedUnitPrice:        decimal,\n    EffectiveCost:              decimal,\n    InvoiceIssuerName:          string,\n    ListCost:                   decimal,\n    ListUnitPrice:              decimal,\n    PricingCategory:            string,\n    PricingQuantity:            decimal,\n    PricingUnit:                string,\n    ProviderName:               string,\n    PublisherName:              string,\n    RegionId:                   string,\n    RegionName:                 string,\n    ResourceId:                 string,\n    ResourceName:               string,\n    ResourceType:               string,\n    ServiceCategory:            string,\n    ServiceName:                string,\n    SkuId:                      string,\n    SkuPriceId:                 string,\n    SubAccountId:               string,\n    SubAccountName:             string,\n    SubAccountType:             string,\n    Tags:                       dynamic,\n    x_AccountId:                string,    // Azure 1.0-preview(v1)+\n    x_AccountName:              string,    // Azure 1.0-preview(v1)+\n    x_AccountOwnerId:           string,    // Azure 1.0-preview(v1)+\n    x_BilledCostInUsd:          decimal,   // Azure 1.0-preview(v1)+\n    x_BilledUnitPrice:          decimal,   // Azure 1.0-preview(v1)+\n    x_BillingAccountAgreement:  string,    // Hubs add-on\n    x_BillingAccountId:         string,    // Azure 1.0-preview(v1)+\n    x_BillingAccountName:       string,    // Azure 1.0-preview(v1)+\n    x_BillingExchangeRate:      decimal,   // Azure 1.0-preview(v1)+\n    x_BillingExchangeRateDate:  datetime,  // Azure 1.0-preview(v1)+\n    x_BillingProfileId:         string,    // Azure 1.0-preview(v1)+\n    x_BillingProfileName:       string,    // Azure 1.0-preview(v1)+\n    x_ChargeId:                 string,    // Azure 1.0-preview(v1) only\n    x_ContractedCostInUsd:      decimal,   // Azure 1.0+\n    x_CostAllocationRuleName:   string,    // Azure 1.0-preview(v1)+\n    x_CostCategories:           dynamic,   // AWS 1.0 (JSON)\n    x_CostCenter:               string,    // Azure 1.0-preview(v1)+\n    x_Credits:                  dynamic,   // GCP Jan 2024\n    x_CostType:                 string,    // GCP Jan 2024\n    x_CurrencyConversionRate:   decimal,   // GCP Jun 2024\n    x_CustomerId:               string,    // Azure 1.0-preview(v1)+\n    x_CustomerName:             string,    // Azure 1.0-preview(v1)+\n    x_Discount:                 dynamic,   // AWS 1.0 (JSON)\n    x_EffectiveCostInUsd:       decimal,   // Azure 1.0-preview(v1)+\n    x_EffectiveUnitPrice:       decimal,   // Azure 1.0-preview(v1)+\n    x_ExportTime:               datetime,  // GCP Jan 2024\n    x_IngestionTime:            datetime,  // Hubs add-on\n    x_InvoiceId:                string,    // Azure 1.0-preview(v1)+\n    x_InvoiceIssuerId:          string,    // Azure 1.0-preview(v1)+\n    x_InvoiceSectionId:         string,    // Azure 1.0-preview(v1)+\n    x_InvoiceSectionName:       string,    // Azure 1.0-preview(v1)+\n    x_ListCostInUsd:            decimal,   // Azure 1.0-preview(v1)+\n    x_Location:                 string,    // GCP Jan 2024\n    x_Operation:                string,    // AWS 1.0\n    x_PartnerCreditApplied:     string,    // Azure 1.0-preview(v1)+\n    x_PartnerCreditRate:        string,    // Azure 1.0-preview(v1)+\n    x_PricingBlockSize:         decimal,   // Azure 1.0-preview(v1)+\n    x_PricingCurrency:          string,    // Azure 1.0-preview(v1)+\n    x_PricingSubcategory:       string,    // Azure 1.0-preview(v1)+\n    x_PricingUnitDescription:   string,    // Azure 1.0-preview(v1)+\n    x_Project:                  string,    // GCP Jan 2024\n    x_PublisherCategory:        string,    // Azure 1.0-preview(v1)+\n    x_PublisherId:              string,    // Azure 1.0-preview(v1)+\n    x_ResellerId:               string,    // Azure 1.0-preview(v1)+\n    x_ResellerName:             string,    // Azure 1.0-preview(v1)+\n    x_ResourceGroupName:        string,    // Azure 1.0-preview(v1)+\n    x_ResourceType:             string,    // Azure 1.0-preview(v1)+\n    x_ServiceCode:              string,    // AWS 1.0\n    x_ServiceId:                string,    // GCP Jan 2024\n    x_ServicePeriodEnd:         datetime,  // Azure 1.0-preview(v1)+\n    x_ServicePeriodStart:       datetime,  // Azure 1.0-preview(v1)+\n    x_SkuDescription:           string,    // Azure 1.0-preview(v1)+\n    x_SkuDetails:               dynamic,   // Azure 1.0-preview(v1)+\n    x_SkuIsCreditEligible:      bool,      // Azure 1.0-preview(v1)+\n    x_SkuMeterCategory:         string,    // Azure 1.0-preview(v1)+\n    x_SkuMeterId:               string,    // Azure 1.0-preview(v1)+\n    x_SkuMeterName:             string,    // Azure 1.0-preview(v1)+\n    x_SkuMeterSubcategory:      string,    // Azure 1.0-preview(v1)+\n    x_SkuOfferId:               string,    // Azure 1.0-preview(v1)+\n    x_SkuOrderId:               string,    // Azure 1.0-preview(v1)+\n    x_SkuOrderName:             string,    // Azure 1.0-preview(v1)+\n    x_SkuPartNumber:            string,    // Azure 1.0-preview(v1)+\n    x_SkuRegion:                string,    // Azure 1.0-preview(v1)+\n    x_SkuServiceFamily:         string,    // Azure 1.0-preview(v1)+\n    x_SkuTerm:                  int,       // Azure 1.0-preview(v1)+\n    x_SkuTier:                  string,    // Azure 1.0-preview(v1)+\n    x_SourceChanges:            string,    // Hubs add-on\n    x_SourceName:               string,    // Hubs add-on\n    x_SourceProvider:           string,    // Hubs add-on\n    x_SourceType:               string,    // Hubs add-on\n    x_SourceVersion:            string,    // Hubs add-on\n    x_UsageType:                string     // AWS 1.0\n)\n\n// Update policy for Costs_raw -> Costs_final_v1_0 table\n.alter table Costs_final_v1_0 policy update\n```\n[{\n    \"IsEnabled\": false,\n    \"Source\": \"Costs_raw\",\n    \"Query\": \"Costs_transform_v1_0()\",\n    \"IsTransactional\": true,\n    \"PropagateIngestionProperties\": true\n}]\n```\n\n\n//===| Actual costs |===================================================================================================\n// Supported versions:\n// - C360-2025-04\n//======================================================================================================================\n\n// ActualCosts_transform_v1_0 function\n.create-or-alter function\nwith (docstring='DEPRECATED: ActualCost exports transformed to FOCUS 1.0. Use ActualCosts_transform_v1_2() instead.', folder='Costs')\nActualCosts_transform_v1_0()\n{\n    // NOTE: All open issues and questions are tracked @ https://github.com/microsoft/finops-toolkit/issues/1111\n    // TODO: Transform actual costs to FOCUS 1.0 format\n    ActualCosts_raw\n    | where ChargeType in ('Purchase', 'Refund') and isnotempty(ReservationId)\n    //\n    //\n    // !!! The rest of the query is reused for both the ActualCosts and AmortizedCosts queries -- Copy all changes in both transform functions !!!\n    //\n    //\n    | extend x_AmortizationClass = case(\n        ChargeType in ('Purchase', 'Refund') and (tolower(ResourceId) contains '/microsoft.capacity/reservationorders/' or tolower(ResourceId) contains '/microsoft.billingbenefits/savingsplanorders/'), 'Principal',\n        ChargeType == 'Usage' and isnotempty(ReservationId) and ChargeType != 'UnusedSavingsPlan', 'Amortized Charge',\n        ''\n    )\n    | extend tmp_ResourceInfo = parse_resourceid(ResourceId)\n    // TODO: PricingCategory needs to include savings plan usage and spot usage\n    | extend PricingCategory = case(\n        x_AmortizationClass == 'Amortized Charge', 'Committed',\n        ChargeType in ('Usage', 'Purchase'), 'Standard',\n        ''\n    )\n    | extend x_ResourceType = tostring(tmp_ResourceInfo.x_ResourceType)\n    | project-rename\n        PricingQuantity = Quantity,\n        x_PricingUnitDescription = UnitOfMeasure\n    | join kind=leftouter (PricingUnits) on x_PricingUnitDescription\n    | join kind=leftouter (Regions) on ResourceLocation\n    | join kind=leftouter (ResourceTypes | project x_ResourceType, ResourceType = SingularDisplayName) on x_ResourceType\n    // TODO: Add the following in 1.2: ServiceSubcategory, PublisherName, x_PublisherCategory, x_Environment, x_ServiceModel\n    | join kind=leftouter (Services | where isnotempty(x_ResourceType) | project x_ResourceType, ServiceName, ServiceCategory) on x_ResourceType\n    | join kind=leftouter (Services | where isnotempty(x_ConsumedService) | summarize take_any(ServiceName), take_any(ServiceCategory) by ConsumedService = x_ConsumedService) on ConsumedService\n    | extend CommitmentDiscountCategory = iff(isnotempty(ReservationId), 'Usage', '')  // TODO: CommitmentDiscountCategory needs to handle savings plans\n    | project\n        AvailabilityZone = AvailabilityZone,\n        BilledCost = iff(x_AmortizationClass == 'Amortized Charge', real(0), Cost),\n        BillingAccountId = strcat('/providers/microsoft.billing/billingaccounts/', BillingAccountId, iff(BillingAccountId == BillingProfileId or isempty(BillingProfileId), '', strcat('/billingprofiles/', BillingProfileId))),\n        BillingAccountName = coalesce(BillingProfileName, BillingAccountName),\n        BillingAccountType = iff(BillingAccountId == BillingProfileId or isempty(BillingProfileId), 'Billing Profile', 'Billing Account'),\n        BillingCurrency,\n        BillingPeriodEnd = startofmonth(BillingPeriodEndDate, 1),\n        BillingPeriodStart = startofmonth(BillingPeriodStartDate),\n        CapacityReservationId = '',\n        CapacityReservationStatus = '',\n        ChargeCategory = case(\n            ChargeType in ('Usage', 'Purchase', 'Credit', 'Tax'), ChargeType,\n            ChargeType in ('UnusedReservation', 'UnusedSavingsPlan'), 'Usage',\n            ChargeType == 'Refund', 'Purchase',\n            'Adjustment'\n        ),\n        ChargeClass = iff(ChargeType == 'Refund', 'Correction', ''),\n        ChargeDescription = Product,\n        ChargeFrequency = case(\n            Frequency == 'UsageBased', 'Usage-Based',\n            Frequency == 'OneTime', 'One-Time',\n            Frequency  // \"Recurring\" and any fallback\n        ),\n        ChargePeriodStart = Date,\n        ChargePeriodEnd = Date + 1d,\n        ChargeSubcategory = '',\n        // TODO: CommitmentDiscount* columns need to handle savings plans\n        CommitmentDiscountCategory,\n        CommitmentDiscountId = iff(isnotempty(ReservationId), strcat('/providers/microsoft.capacity/reservationorders/', ProductOrderId, '/reservations/', ReservationId), ''),\n        CommitmentDiscountName = ReservationName,\n        CommitmentDiscountQuantity = real(null),\n        CommitmentDiscountStatus = case(\n            isempty(ReservationId), '',\n            isnotempty(ReservationId) and ChargeType == 'Usage', 'Used',\n            ChargeType startswith 'Unused', 'Unused',\n            'Unused'\n        ),\n        CommitmentDiscountType = iff(isnotempty(ReservationId), 'Reservation', ''),\n        CommitmentDiscountUnit = '',\n        ConsumedQuantity = PricingQuantity * x_PricingBlockSize,\n        ConsumedUnit = PricingUnit,\n        ContractedCost = UnitPrice * PricingQuantity,\n        ContractedUnitPrice = UnitPrice,\n        EffectiveCost = iff(x_AmortizationClass == 'Principal', real(0), Cost),\n        InvoiceId = '',\n        InvoiceIssuerName = 'Microsoft',\n        ListCost = real(null),\n        ListUnitPrice = real(null),\n        PricingCategory,\n        PricingCurrency = '',\n        PricingQuantity,\n        PricingUnit,\n        ProviderName = 'Microsoft',\n        PublisherName = iff(PublisherType == 'Marketplace', PublisherName, 'Microsoft'),\n        Region = '',\n        RegionId,\n        RegionName,\n        ResourceId = tostring(tmp_ResourceInfo.ResourceId),\n        ResourceName = tostring(tmp_ResourceInfo.ResourceName),\n        ResourceType,\n        ServiceCategory,\n        ServiceName,\n        ServiceSubcategory = '',\n        SkuId = '',\n        SkuMeter = '',\n        SkuPriceDetails = '',\n        SkuPriceId = '',\n        SubAccountId = strcat('/subscriptions/', SubscriptionId),\n        SubAccountName = SubscriptionName,\n        SubAccountType = iff(isempty(SubscriptionId), '', 'Subscription'),\n        Tags = iff(Tags startswith '{', Tags, strcat('{', Tags, '}')),\n        UsageAmount = real(null),\n        UsageQuantity = real(null),\n        UsageUnit = '',\n        x_AccountId = '',\n        x_AccountName = AccountName,\n        x_AccountOwnerId = AccountOwnerId,\n        x_AmortizationClass = '',\n        x_BilledCostInUsd = real(null),\n        x_BilledUnitPrice = iff(ChargeType == 'Usage' and isnotempty(ReservationId) and ChargeType != 'UnusedSavingsPlan', real(0), UnitPrice),\n        x_BillingAccountId = BillingAccountId,\n        x_BillingAccountName = BillingAccountName,\n        x_BillingExchangeRate = real(null),\n        x_BillingExchangeRateDate = datetime(null),\n        x_BillingProfileId = BillingProfileId,\n        x_BillingProfileName = BillingProfileName,\n        x_BillingItemCode = '',\n        x_BillingItemName = '',\n        x_ChargeId = '',\n        x_CommodityCode = '',\n        x_CommodityName = '',\n        x_ComponentName = '',\n        x_ComponentType = '',\n        x_ContractedCostInUsd = real(null),\n        x_Cost = real(null),\n        x_CostAllocationRuleName = '',\n        x_CostCategories = '',\n        x_CostCenter = CostCenter,\n        x_CostType = '',\n        x_Credits = '',\n        x_CurrencyConversionRate = real(null),\n        x_CustomerId = '',\n        x_CustomerName = '',\n        x_Discount = '',\n        x_EffectiveCostInUsd = real(null),\n        x_EffectiveUnitPrice = iff(ChargeType == 'Usage' and isnotempty(ReservationId) and ChargeType != 'UnusedSavingsPlan', real(0), EffectivePrice),\n        x_ExportTime = datetime(null),\n        x_InstanceID = '',\n        x_InvoiceId = '',\n        x_InvoiceIssuerId = '',\n        x_InvoiceSectionId = InvoiceSectionId,\n        x_InvoiceSectionName = InvoiceSection,\n        x_ListCostInUsd = real(null),\n        x_Location = '',\n        x_OnDemandCost = real(null),\n        x_OnDemandCostInUsd = real(null),\n        x_OnDemandUnitPrice = real(null),\n        x_Operation = '',\n        x_OwnerAccountID = '',\n        x_PartnerCreditApplied = '',\n        x_PartnerCreditRate = '',\n        x_PricingBlockSize,\n        x_PricingCurrency = iff(BillingAccountId == BillingProfileId, BillingCurrency, ''),\n        x_PricingSubcategory = case(\n            // TODO: Add x_SkuTier when supported by C360 -- PricingCategory == 'Standard' and isnotempty(x_SkuTier), 'Tiered',\n            PricingCategory == 'Standard', 'Standard',\n            PricingCategory == 'Committed', strcat('Committed ', CommitmentDiscountCategory),\n            PricingCategory == 'Dynamic', 'Spot',\n            ''\n        ),\n        x_PricingUnitDescription,\n        x_Project = '',\n        x_PublisherCategory = iff(PublisherType == 'Marketplace', 'Vendor', 'Cloud Provider'),\n        x_PublisherId = '',\n        x_ResellerId = '',\n        x_ResellerName = '',\n        x_ResourceGroupName = ResourceGroup,\n        x_ResourceType,\n        x_ServiceCode = '',\n        x_ServiceId = '',\n        x_ServiceModel = '',\n        x_ServicePeriodEnd = datetime(null),\n        x_ServicePeriodStart = datetime(null),\n        x_SkuDescription = Product,\n        x_SkuDetails = iff(AdditionalInfo startswith '{', AdditionalInfo, strcat('{', AdditionalInfo, '}')),\n        x_SkuIsCreditEligible = IsAzureCreditEligible,\n        x_SkuMeterCategory = MeterCategory,\n        x_SkuMeterId = MeterId,\n        x_SkuMeterName = MeterName,\n        x_SkuMeterSubcategory = MeterSubCategory,\n        x_SkuOfferId = OfferId,\n        x_SkuOrderId = ProductOrderId,\n        x_SkuOrderName = ProductOrderName,\n        x_SkuPartNumber = PartNumber,\n        x_SkuPlanName = '',\n        x_SkuRegion = MeterRegion,\n        x_SkuServiceFamily = ServiceFamily,\n        x_SkuTerm = toint(Term),\n        x_SkuTier = '',\n        x_SourceName = 'C360',\n        x_SourceProvider = 'Microsoft',\n        x_SourceType = 'ActualCost',\n        x_SourceVersion = 'C360-2025-04',\n        x_SubproductName = '',\n        x_UsageType = ''\n}\n\n// Update policy for ActualCosts_raw -> Costs_raw table\n.alter table Costs_raw policy update\n``` \n[{\n    \"IsEnabled\": false,\n    \"Source\": \"ActualCosts_raw\",\n    \"Query\": \"ActualCosts_transform_v1_0()\",\n    \"IsTransactional\": true,\n    \"PropagateIngestionProperties\": true\n}]\n```\n\n\n//===| Amortized costs |================================================================================================\n// Supported versions:\n// - C360-2025-04\n//======================================================================================================================\n\n// AmortizedCosts_transform_v1_0 function\n.create-or-alter function\nwith (docstring='DEPRECATED: ActualCost exports transformed to FOCUS 1.0. Use AmortizedCosts_transform_v1_2() instead.', folder='Costs')\nAmortizedCosts_transform_v1_0()\n{\n    // NOTE: All open issues and questions are tracked @ https://github.com/microsoft/finops-toolkit/issues/1111\n    // TODO: Transform actual costs to FOCUS 1.0 format\n    AmortizedCosts_raw\n    //\n    //\n    // !!! The rest of the query is reused for both the ActualCosts and AmortizedCosts queries -- Copy all changes in both transform functions !!!\n    //\n    //\n    | extend x_AmortizationClass = case(\n        ChargeType in ('Purchase', 'Refund') and (tolower(ResourceId) contains '/microsoft.capacity/reservationorders/' or tolower(ResourceId) contains '/microsoft.billingbenefits/savingsplanorders/'), 'Principal',\n        ChargeType == 'Usage' and isnotempty(ReservationId) and ChargeType != 'UnusedSavingsPlan', 'Amortized Charge',\n        ''\n    )\n    | extend tmp_ResourceInfo = parse_resourceid(ResourceId)\n    // TODO: PricingCategory needs to include savings plan usage and spot usage\n    | extend PricingCategory = case(\n        x_AmortizationClass == 'Amortized Charge', 'Committed',\n        ChargeType in ('Usage', 'Purchase'), 'Standard',\n        ''\n    )\n    | extend x_ResourceType = tostring(tmp_ResourceInfo.x_ResourceType)\n    | project-rename\n        PricingQuantity = Quantity,\n        x_PricingUnitDescription = UnitOfMeasure\n    | join kind=leftouter (PricingUnits) on x_PricingUnitDescription\n    | join kind=leftouter (Regions) on ResourceLocation\n    | join kind=leftouter (ResourceTypes | project x_ResourceType, ResourceType = SingularDisplayName) on x_ResourceType\n    // TODO: Add the following in 1.2: ServiceSubcategory, PublisherName, x_PublisherCategory, x_Environment, x_ServiceModel\n    | join kind=leftouter (Services | where isnotempty(x_ResourceType) | project x_ResourceType, ServiceName, ServiceCategory) on x_ResourceType\n    | join kind=leftouter (Services | where isnotempty(x_ConsumedService) | summarize take_any(ServiceName), take_any(ServiceCategory) by ConsumedService = x_ConsumedService) on ConsumedService\n    | extend CommitmentDiscountCategory = iff(isnotempty(ReservationId), 'Usage', '')  // TODO: CommitmentDiscountCategory needs to handle savings plans\n    | project\n        AvailabilityZone = AvailabilityZone,\n        BilledCost = iff(x_AmortizationClass == 'Amortized Charge', real(0), Cost),\n        BillingAccountId = strcat('/providers/microsoft.billing/billingaccounts/', BillingAccountId, iff(BillingAccountId == BillingProfileId or isempty(BillingProfileId), '', strcat('/billingprofiles/', BillingProfileId))),\n        BillingAccountName = coalesce(BillingProfileName, BillingAccountName),\n        BillingAccountType = iff(BillingAccountId == BillingProfileId or isempty(BillingProfileId), 'Billing Profile', 'Billing Account'),\n        BillingCurrency,\n        BillingPeriodEnd = startofmonth(BillingPeriodEndDate, 1),\n        BillingPeriodStart = startofmonth(BillingPeriodStartDate),\n        CapacityReservationId = '',\n        CapacityReservationStatus = '',\n        ChargeCategory = case(\n            ChargeType in ('Usage', 'Purchase', 'Credit', 'Tax'), ChargeType,\n            ChargeType in ('UnusedReservation', 'UnusedSavingsPlan'), 'Usage',\n            ChargeType == 'Refund', 'Purchase',\n            'Adjustment'\n        ),\n        ChargeClass = iff(ChargeType == 'Refund', 'Correction', ''),\n        ChargeDescription = Product,\n        ChargeFrequency = case(\n            Frequency == 'UsageBased', 'Usage-Based',\n            Frequency == 'OneTime', 'One-Time',\n            Frequency  // \"Recurring\" and any fallback\n        ),\n        ChargePeriodStart = Date,\n        ChargePeriodEnd = Date + 1d,\n        ChargeSubcategory = '',\n        // TODO: CommitmentDiscount* columns need to handle savings plans\n        CommitmentDiscountCategory,\n        CommitmentDiscountId = iff(isnotempty(ReservationId), strcat('/providers/microsoft.capacity/reservationorders/', ProductOrderId, '/reservations/', ReservationId), ''),\n        CommitmentDiscountName = ReservationName,\n        CommitmentDiscountQuantity = real(null),\n        CommitmentDiscountStatus = case(\n            isempty(ReservationId), '',\n            isnotempty(ReservationId) and ChargeType == 'Usage', 'Used',\n            ChargeType startswith 'Unused', 'Unused',\n            'Unused'\n        ),\n        CommitmentDiscountType = iff(isnotempty(ReservationId), 'Reservation', ''),\n        CommitmentDiscountUnit = '',\n        ConsumedQuantity = PricingQuantity * x_PricingBlockSize,\n        ConsumedUnit = PricingUnit,\n        ContractedCost = UnitPrice * PricingQuantity,\n        ContractedUnitPrice = UnitPrice,\n        EffectiveCost = iff(x_AmortizationClass == 'Principal', real(0), Cost),\n        InvoiceId = '',\n        InvoiceIssuerName = 'Microsoft',\n        ListCost = real(null),\n        ListUnitPrice = real(null),\n        PricingCategory,\n        PricingCurrency = '',\n        PricingQuantity,\n        PricingUnit,\n        ProviderName = 'Microsoft',\n        PublisherName = iff(PublisherType == 'Marketplace', PublisherName, 'Microsoft'),\n        Region = '',\n        RegionId,\n        RegionName,\n        ResourceId = tostring(tmp_ResourceInfo.ResourceId),\n        ResourceName = tostring(tmp_ResourceInfo.ResourceName),\n        ResourceType,\n        ServiceCategory,\n        ServiceName,\n        ServiceSubcategory = '',\n        SkuId = '',\n        SkuMeter = '',\n        SkuPriceDetails = '',\n        SkuPriceId = '',\n        SubAccountId = strcat('/subscriptions/', SubscriptionId),\n        SubAccountName = SubscriptionName,\n        SubAccountType = iff(isempty(SubscriptionId), '', 'Subscription'),\n        Tags = iff(Tags startswith '{', Tags, strcat('{', Tags, '}')),\n        UsageAmount = real(null),\n        UsageQuantity = real(null),\n        UsageUnit = '',\n        x_AccountId = '',\n        x_AccountName = AccountName,\n        x_AccountOwnerId = AccountOwnerId,\n        x_AmortizationClass = '',\n        x_BilledCostInUsd = real(null),\n        x_BilledUnitPrice = iff(ChargeType == 'Usage' and isnotempty(ReservationId) and ChargeType != 'UnusedSavingsPlan', real(0), UnitPrice),\n        x_BillingAccountId = BillingAccountId,\n        x_BillingAccountName = BillingAccountName,\n        x_BillingExchangeRate = real(null),\n        x_BillingExchangeRateDate = datetime(null),\n        x_BillingProfileId = BillingProfileId,\n        x_BillingProfileName = BillingProfileName,\n        x_BillingItemCode = '',\n        x_BillingItemName = '',\n        x_ChargeId = '',\n        x_CommodityCode = '',\n        x_CommodityName = '',\n        x_ComponentName = '',\n        x_ComponentType = '',\n        x_ContractedCostInUsd = real(null),\n        x_Cost = real(null),\n        x_CostAllocationRuleName = '',\n        x_CostCategories = '',\n        x_CostCenter = CostCenter,\n        x_CostType = '',\n        x_Credits = '',\n        x_CurrencyConversionRate = real(null),\n        x_CustomerId = '',\n        x_CustomerName = '',\n        x_Discount = '',\n        x_EffectiveCostInUsd = real(null),\n        x_EffectiveUnitPrice = iff(ChargeType == 'Usage' and isnotempty(ReservationId) and ChargeType != 'UnusedSavingsPlan', real(0), EffectivePrice),\n        x_ExportTime = datetime(null),\n        x_InstanceID = '',\n        x_InvoiceId = '',\n        x_InvoiceIssuerId = '',\n        x_InvoiceSectionId = InvoiceSectionId,\n        x_InvoiceSectionName = InvoiceSection,\n        x_ListCostInUsd = real(null),\n        x_Location = '',\n        x_OnDemandCost = real(null),\n        x_OnDemandCostInUsd = real(null),\n        x_OnDemandUnitPrice = real(null),\n        x_Operation = '',\n        x_OwnerAccountID = '',\n        x_PartnerCreditApplied = '',\n        x_PartnerCreditRate = '',\n        x_PricingBlockSize,\n        x_PricingCurrency = iff(BillingAccountId == BillingProfileId, BillingCurrency, ''),\n        x_PricingSubcategory = case(\n            // TODO: Add x_SkuTier when supported by C360 -- PricingCategory == 'Standard' and isnotempty(x_SkuTier), 'Tiered',\n            PricingCategory == 'Standard', 'Standard',\n            PricingCategory == 'Committed', strcat('Committed ', CommitmentDiscountCategory),\n            PricingCategory == 'Dynamic', 'Spot',\n            ''\n        ),\n        x_PricingUnitDescription,\n        x_Project = '',\n        x_PublisherCategory = iff(PublisherType == 'Marketplace', 'Vendor', 'Cloud Provider'),\n        x_PublisherId = '',\n        x_ResellerId = '',\n        x_ResellerName = '',\n        x_ResourceGroupName = ResourceGroup,\n        x_ResourceType,\n        x_ServiceCode = '',\n        x_ServiceId = '',\n        x_ServiceModel = '',\n        x_ServicePeriodEnd = datetime(null),\n        x_ServicePeriodStart = datetime(null),\n        x_SkuDescription = Product,\n        x_SkuDetails = iff(AdditionalInfo startswith '{', AdditionalInfo, strcat('{', AdditionalInfo, '}')),\n        x_SkuIsCreditEligible = IsAzureCreditEligible,\n        x_SkuMeterCategory = MeterCategory,\n        x_SkuMeterId = MeterId,\n        x_SkuMeterName = MeterName,\n        x_SkuMeterSubcategory = MeterSubCategory,\n        x_SkuOfferId = OfferId,\n        x_SkuOrderId = ProductOrderId,\n        x_SkuOrderName = ProductOrderName,\n        x_SkuPartNumber = PartNumber,\n        x_SkuPlanName = '',\n        x_SkuRegion = MeterRegion,\n        x_SkuServiceFamily = ServiceFamily,\n        x_SkuTerm = toint(Term),\n        x_SkuTier = '',\n        x_SourceName = 'C360',\n        x_SourceProvider = 'Microsoft',\n        x_SourceType = 'ActualCost',\n        x_SourceVersion = 'C360-2025-04',\n        x_SubproductName = '',\n        x_UsageType = ''\n}\n\n// Update policy for AmortizedCosts_raw -> Costs_raw table\n.alter table Costs_raw policy update\n``` \n[{\n    \"IsEnabled\": false,\n    \"Source\": \"AmortizedCosts_raw\",\n    \"Query\": \"AmortizedCosts_transform_v1_0()\",\n    \"IsTransactional\": true,\n    \"PropagateIngestionProperties\": true\n}]\n```\n\n\n//===| CommitmentDiscountUsage |========================================================================================\n// Supported versions:\n// - MS EA reservation details: 2023-03-01  -- See https://learn.microsoft.com/azure/cost-management-billing/dataset-schema/reservation-details-ea\n// - MS MCA reservation details: 2023-03-01 -- See https://learn.microsoft.com/azure/cost-management-billing/dataset-schema/reservation-details-mca\n//======================================================================================================================\n\n// CommitmentDiscountUsage_transform_v1_0 function\n.create-or-alter function\nwith (docstring='DEPRECATED: All commitment discount usage transformed to FOCUS 1.0. This includes reservationdeatils_raw. Use CommitmentDiscountUsage_transform_v1_2() instead.', folder='Commitment discounts')\nCommitmentDiscountUsage_transform_v1_0()\n{\n    // NOTE: All open issues and questions are tracked @ https://github.com/microsoft/finops-toolkit/issues/1111\n    CommitmentDiscountUsage_raw\n    //\n    // Change real to decimal\n    | extend\n        InstanceFlexibilityRatio = todecimal(InstanceFlexibilityRatio),\n        ReservedHours            = todecimal(ReservedHours),\n        TotalReservedQuantity    = todecimal(TotalReservedQuantity),\n        UsedHours                = todecimal(UsedHours)\n    //\n    // Set ProviderName\n    | extend ProviderName = 'Microsoft'\n    //\n    // Handle resource columns\n    | extend ResourceId = tolower(InstanceId)\n    | extend tmp_ResourceDetails = parse_resourceid(ResourceId)\n    | extend ResourceName        = tostring(tmp_ResourceDetails.ResourceName)\n    | extend SubAccountId        = tostring(tmp_ResourceDetails.SubAccountId)\n    | extend x_ResourceGroupName = tostring(tmp_ResourceDetails.x_ResourceGroupName)\n    | extend x_ResourceType      = tostring(tmp_ResourceDetails.x_ResourceType)\n    | lookup kind=leftouter (ResourceTypes | distinct x_ResourceType, ResourceType = SingularDisplayName) on x_ResourceType\n    | lookup kind=leftouter (Services | distinct x_ResourceType, ServiceName, ServiceCategory, x_ServiceModel) on x_ResourceType\n    //\n    // Sort columns and apply final transforms\n    | project\n        ChargePeriodEnd                     = UsageDate + 1d,\n        ChargePeriodStart                   = UsageDate,\n        CommitmentDiscountCategory          = 'Usage',\n        CommitmentDiscountId                = tolower(strcat('/providers/microsoft.capacity/reservationorders/', ReservationOrderId, '/reservations/', ReservationId)),\n        CommitmentDiscountType              = 'Reservation',\n        ConsumedQuantity                    = UsedHours,\n        ProviderName,\n        ResourceId,\n        ResourceName,\n        ResourceType,\n        ServiceCategory,\n        ServiceName,\n        SubAccountId,\n        x_CommitmentDiscountCommittedCount  = TotalReservedQuantity,\n        x_CommitmentDiscountCommittedAmount = ReservedHours,\n        // TODO: Is this needed? -- x_CommitmentDiscountKind            = Kind,\n        x_CommitmentDiscountNormalizedGroup = iff(InstanceFlexibilityGroup == 'NA', '', InstanceFlexibilityGroup),\n        x_CommitmentDiscountNormalizedRatio = InstanceFlexibilityRatio,\n        x_CommitmentDiscountQuantity        = UsedHours * InstanceFlexibilityRatio,\n        x_IngestionTime                     = ingestion_time(),\n        x_ResourceGroupName,\n        x_ResourceType,\n        // x_RowId = hash_sha256(strcat(\n        //     // DO NOT CHANGE COLUMNS OR COLUMN ORDER\n        //     CommitmentDiscountId,\n        //     ResourceId,\n        //     ChargePeriodStart\n        // )),\n        x_ServiceModel,\n        x_SkuOrderId                        = ReservationOrderId,\n        x_SkuSize                           = iff(SkuName == 'NA', '', SkuName),\n        x_SourceName                        = coalesce(x_SourceName, iff(ProviderName == 'Microsoft', 'Cost Management', ProviderName)),\n        x_SourceProvider                    = coalesce(x_SourceProvider, ProviderName),\n        x_SourceType                        = coalesce(x_SourceType, iff(ProviderName == 'Microsoft', 'ReservationDetails', '')),\n        x_SourceVersion                     = coalesce(x_SourceVersion, iff(ProviderName == 'Microsoft', '2024-03-01', ''))\n}\n\n// CommitmentDiscountUsage_final_v1_0 table\n.create-merge table CommitmentDiscountUsage_final_v1_0 (\n    ChargePeriodEnd:                     datetime,  // Hubs add-on\n    ChargePeriodStart:                   datetime,  // MS 2023-03-01\n    CommitmentDiscountCategory:          string,    // Hubs add-on\n    CommitmentDiscountId:                string,    // MS 2023-03-01\n    CommitmentDiscountType:              string,    // Hubs add-on\n    ConsumedQuantity:                    decimal,   // MS 2023-03-01\n    ProviderName:                        string,    // Hubs add-on\n    ResourceId:                          string,    // MS 2023-03-01\n    ResourceName:                        string,    // Hubs add-on\n    ResourceType:                        string,    // Hubs add-on\n    ServiceCategory:                     string,    // Hubs add-on\n    ServiceName:                         string,    // Hubs add-on\n    SubAccountId:                        string,    // Hubs add-on\n    x_CommitmentDiscountCommittedCount:  decimal,   // MS 2023-03-01\n    x_CommitmentDiscountCommittedAmount: decimal,   // MS 2023-03-01\n    x_CommitmentDiscountNormalizedGroup: string,    // MS 2023-03-01\n    x_CommitmentDiscountNormalizedRatio: decimal,   // MS 2023-03-01\n    x_CommitmentDiscountQuantity:        decimal,   // MS 2023-03-01\n    x_IngestionTime:                     datetime,  // Hubs add-on\n    x_ResourceGroupName:                 string,    // Hubs add-on\n    x_ResourceType:                      string,    // Hubs add-on\n    x_ServiceModel:                      string,    // Hubs add-on\n    x_SkuOrderId:                        string,    // MS 2023-03-01\n    x_SkuSize:                           string,    // MS 2023-03-01\n    x_SourceName:                        string,    // Hubs add-on\n    x_SourceProvider:                    string,    // Hubs add-on\n    x_SourceType:                        string,    // Hubs add-on\n    x_SourceVersion:                     string     // Hubs add-on\n)\n\n// Update policy for CommitmentDiscountUsage_raw -> CommitmentDiscountUsage_final_v1_0 table\n.alter table CommitmentDiscountUsage_final_v1_0 policy update\n```\n[{\n    \"IsEnabled\": false,\n    \"Source\": \"CommitmentDiscountUsage_raw\",\n    \"Query\": \"CommitmentDiscountUsage_transform_v1_0()\",\n    \"IsTransactional\": true,\n    \"PropagateIngestionProperties\": true\n}]\n```\n\n\n//===| Recommendations |================================================================================================\n// Supported datasets/versions:\n// - MS CM EA reservation recommendations: 2023-05-01  -- See https://learn.microsoft.com/azure/cost-management-billing/dataset-schema/reservation-recommendations-ea\n// - MS CM MCA reservation recommendations: 2023-05-01 -- See https://learn.microsoft.com/azure/cost-management-billing/dataset-schema/reservation-recommendations-mca\n//======================================================================================================================\n\n// Recommendations_transform_v1_0 function\n.create-or-alter function\nwith (docstring='DEPRECATED: All recommendations transformed to FOCUS 1.0. Use Recommendations_transform_v1_2() instead.', folder='Recommendations')\nRecommendations_transform_v1_0()\n{\n    // NOTE: All open issues and questions are tracked @ https://github.com/microsoft/finops-toolkit/issues/1111\n    let isoMonths = (duration: string) {\n        let number = toint(replace_regex(duration, @'[PMY]', ''));\n        toint(case(\n            duration == '', toint(''),\n            duration endswith \"Y\", number * 12,\n            duration endswith \"M\", number,\n            -1\n        ))\n    };\n    Recommendations_raw\n    //\n    // Change real to decimal\n    | extend\n        CostWithNoReservedInstances    = todecimal(CostWithNoReservedInstances),\n        InstanceFlexibilityRatio       = todecimal(InstanceFlexibilityRatio),\n        NetSavings                     = todecimal(NetSavings),\n        RecommendedQuantity            = todecimal(RecommendedQuantity),\n        RecommendedQuantityNormalized  = todecimal(RecommendedQuantityNormalized),\n        TotalCostWithReservedInstances = todecimal(TotalCostWithReservedInstances)\n    //\n    | extend x_IngestionTime = ingestion_time()\n    //\n    // Set ProviderName\n    | extend ProviderName = 'Microsoft'\n    //\n    // Set source columns\n    | extend x_SourceName     = coalesce(x_SourceName, iff(ProviderName == 'Microsoft', 'Cost Management', ProviderName))\n    | extend x_SourceProvider = coalesce(x_SourceProvider, ProviderName)\n    | extend x_SourceType     = coalesce(x_SourceType, iff(ProviderName == 'Microsoft', 'ReservationRecommendations', ''))\n    | extend x_SourceVersion  = coalesce(x_SourceVersion, iff(ProviderName == 'Microsoft', '2023-05-01', ''))\n    //\n    // Convert JSON cost columns to decimal\n    | extend CostWithNoReservedInstances    = case(isnotempty(CostWithNoReservedInstances),    CostWithNoReservedInstances,    isnotempty(CostWithNoReservedInstancesJson),    todecimal(extract(@'\"value\":([0-9\\.]+)', 1, CostWithNoReservedInstancesJson)),    CostWithNoReservedInstances)\n    | extend NetSavings                     = case(isnotempty(NetSavings),                     NetSavings,                     isnotempty(NetSavingsJson),                     todecimal(extract(@'\"value\":([0-9\\.]+)', 1, NetSavingsJson)),                     NetSavings)\n    | extend TotalCostWithReservedInstances = case(isnotempty(TotalCostWithReservedInstances), TotalCostWithReservedInstances, isnotempty(TotalCostWithReservedInstancesJson), todecimal(extract(@'\"value\":([0-9\\.]+)', 1, TotalCostWithReservedInstancesJson)), TotalCostWithReservedInstances)\n    //\n    // Build recommendation details\n    | lookup kind=leftouter (Regions | summarize RegionName = make_set(RegionName)[0] by Location = RegionId) on Location\n    | extend x_RecommendationDetails = case(\n      x_SourceType == 'ReservationRecommendations', bag_pack(\n        'CommitmentDiscountNormalizedGroup', InstanceFlexibilityGroup,\n        'CommitmentDiscountNormalizedRatio', InstanceFlexibilityRatio,\n        'CommitmentDiscountNormalizedSize', NormalizedSize,\n        'CommitmentDiscountResourceType', ResourceType,\n        'CommitmentDiscountScope', Scope,\n        'LookbackPeriodDuration', case(\n            LookBackPeriod matches regex @'^Last([0-9]+)Days$', replace_regex(LookBackPeriod, @'^Last([0-9]+)Days$', @'P\\1D'),\n            LookBackPeriod matches regex @'^[0-9]+$',           strcat('P', LookBackPeriod, 'D'),\n            ''\n        ),\n        'LookbackPeriodStart', FirstUsageDate,\n        'RecommendedQuantity', RecommendedQuantity,\n        'RecommendedQuantityNormalized', RecommendedQuantityNormalized,\n        'RegionId', Location,\n        'RegionName', RegionName,\n        'SkuMeterId', MeterId,\n        'SkuPriceDetails', SkuProperties,\n        'SkuSize', coalesce(SKU, SkuName),\n        'SkuTerm', isoMonths(Term)\n      ),\n      dynamic({})\n    )\n    //\n    // Sort columns and apply final transforms\n    | extend x_RecommendationDate = FirstUsageDate + (toint(extract(@'^P([0-9]+)D$', 1, tostring(x_RecommendationDetails.LookbackPeriodDuration))) * 1d)\n    | extend x_RecommendationDate = iff(x_RecommendationDate > now(), startofday(now()), x_RecommendationDate)\n    | project\n      ProviderName,\n      SubAccountId = iff(isnotempty(SubscriptionId), strcat('/subscriptions/', SubscriptionId), ''),\n      x_IngestionTime,\n      x_EffectiveCostAfter = TotalCostWithReservedInstances,\n      x_EffectiveCostBefore = CostWithNoReservedInstances,\n      x_EffectiveCostSavings = NetSavings,\n      x_RecommendationDate = FirstUsageDate + (toint(extract(@'^P([0-9]+)D$', 1, tostring(x_RecommendationDetails.LookbackPeriodDuration))) * 1d),\n      x_RecommendationDetails,\n      x_SourceName,\n      x_SourceProvider,\n      x_SourceType,\n      x_SourceVersion\n}\n\n// Recommendations_final_v1_0 table\n.create-merge table Recommendations_final_v1_0 (\n    ProviderName:            string,\n    SubAccountId:            string,\n    x_IngestionTime:         datetime,\n    x_EffectiveCostAfter:    decimal,\n    x_EffectiveCostBefore:   decimal,\n    x_EffectiveCostSavings:  decimal,\n    x_RecommendationDate:    datetime,\n    x_RecommendationDetails: dynamic,\n    x_SourceName:            string,\n    x_SourceProvider:        string,\n    x_SourceType:            string,\n    x_SourceVersion:         string\n)\n\n// Update policy for Recommendations_raw -> Recommendations_final_v1_0 table\n.alter table Recommendations_final_v1_0 policy update\n```\n[{\n    \"IsEnabled\": false,\n    \"Source\": \"Recommendations_raw\",\n    \"Query\": \"Recommendations_transform_v1_0()\",\n    \"IsTransactional\": true,\n    \"PropagateIngestionProperties\": true\n}]\n```\n\n\n//===| Transactions |===================================================================================================\n// Supported versions:\n// - MS CM EA reservation transactions: 2023-05-01  -- See https://learn.microsoft.com/azure/cost-management-billing/dataset-schema/reservation-transactions-ea\n// - MS CM MCA reservation transactions: 2023-05-01 -- See https://learn.microsoft.com/azure/cost-management-billing/dataset-schema/reservation-transactions-mca\n//======================================================================================================================\n\n// Transactions_transform_v1_0 function\n.create-or-alter function\nwith (docstring='DEPRECATED: All transactions transformed to FOCUS 1.0. Use Transactions_transform_v1_2() instead.', folder='Transactions')\nTransactions_transform_v1_0()\n{\n    // NOTE: All open issues and questions are tracked @ https://github.com/microsoft/finops-toolkit/issues/1111\n    let isoMonths = (duration: string) {\n        let number = toint(replace_regex(duration, @'[PMY]', ''));\n        toint(case(\n            duration == '', toint(''),\n            duration endswith \"Y\", number * 12,\n            duration endswith \"M\", number,\n            -1\n        ))\n    };\n    Transactions_raw\n    //\n    // Change real to decimal\n    | extend\n        Amount             = todecimal(Amount),\n        MonetaryCommitment = todecimal(MonetaryCommitment),\n        Overage            = todecimal(Overage),\n        Quantity           = todecimal(Quantity)\n    //\n    // Set ProviderName\n    | extend ProviderName = 'Microsoft'\n    //\n    // Set source columns\n    | extend x_SourceName     = coalesce(x_SourceName, iff(ProviderName == 'Microsoft', 'Cost Management', ProviderName))\n    | extend x_SourceProvider = coalesce(x_SourceProvider, ProviderName)\n    | extend x_SourceType     = coalesce(x_SourceType, iff(ProviderName == 'Microsoft', 'ReservationTransactions', ''))\n    | extend x_SourceVersion  = coalesce(x_SourceVersion, iff(ProviderName == 'Microsoft', '2023-05-01', ''))\n    //\n    // Handle BillingPeriodStart/End\n    | extend BillingMonth = tostring(BillingMonth)\n    | extend BillingPeriodStart = iff(isempty(BillingMonth), datetime(null), todatetime(strcat(substring(BillingMonth, 0, 4), \"-\", substring(BillingMonth, 4, 2), \"-\", substring(BillingMonth, 6, 2))))\n    | extend BillingPeriodEnd = iff(isempty(BillingMonth), datetime(null), startofmonth(endofmonth(BillingPeriodStart) + 1d))\n    //\n    // Sort columns and apply final transforms\n    | project\n      BilledCost = Amount,\n      BillingAccountId = case(\n        BillingProfileId startswith '/', BillingProfileId,\n        isnotempty(CurrentEnrollmentId), strcat('/providers/Microsoft.Billing/billingAccounts/', CurrentEnrollmentId),\n        isnotempty(BillingProfileId), strcat('/providers/Microsoft.Billing/billingProfiles/', BillingProfileId),\n        ''\n      ),\n      BillingAccountName = coalesce(BillingProfileName, CurrentEnrollmentId),\n      BillingCurrency = Currency,\n      BillingPeriodEnd,\n      BillingPeriodStart,\n      ChargeCategory = case(\n        EventType in ('Cancel', 'Purchase', 'Refund'), 'Purchase',\n        'Adjustment'\n      ),\n      ChargeClass = case(\n        EventType == 'Cancel', 'Cancel',  // FOCUS does not handle this scenario\n        EventType == 'Refund', 'Correction',\n        ''\n      ),\n      ChargeDescription = Description,\n      ChargeFrequency   = case(\n        BillingFrequency == 'OneTime', 'One-Time',\n        BillingFrequency == 'Recurring', 'Recurring',\n        BillingFrequency\n      ),\n      ChargePeriodStart    = EventDate,\n      PricingQuantity      = Quantity,\n      PricingUnit          = 'Reservations',\n      ProviderName,\n      RegionId             = Region,\n      RegionName           = Region,\n      SubAccountId         = iff(isempty(PurchasingSubscriptionGuid), '', strcat('/subscriptions/', PurchasingSubscriptionGuid)),\n      SubAccountName       = iff(isempty(PurchasingSubscriptionGuid), '', PurchasingSubscriptionName),\n      x_AccountName        = AccountName,\n      x_AccountOwnerId     = AccountOwnerEmail,\n      x_CostCenter         = CostCenter,\n      x_InvoiceId          = InvoiceId,\n      x_InvoiceNumber      = Invoice,\n      x_InvoiceSectionId   = InvoiceSectionId,\n      x_InvoiceSectionName = coalesce(InvoiceSectionName, DepartmentName),\n      x_IngestionTime      = ingestion_time(),\n      x_MonetaryCommitment = MonetaryCommitment,\n      x_Overage            = Overage,\n      x_PurchasingBillingAccountId = PurchasingEnrollment,\n      x_SkuOrderId         = ReservationOrderId,\n      x_SkuOrderName       = ReservationOrderName,\n      x_SkuSize            = ArmSkuName,\n      x_SkuTerm            = isoMonths(Term),\n      x_SourceName,\n      x_SourceProvider,\n      x_SourceType,\n      x_SourceVersion,\n      x_SubscriptionId  = PurchasingSubscriptionGuid,\n      x_TransactionType = EventType\n}\n\n// Transactions_final_v1_0 table\n.create-merge table Transactions_final_v1_0 (\n    BilledCost:                   decimal,   // MS CM EA+MCA 2023-05-01\n    BillingAccountId:             string,    // MS CM EA+MCA 2023-05-01\n    BillingAccountName:           string,    // MS CM EA+MCA 2023-05-01\n    BillingCurrency:              string,    // MS CM EA+MCA 2023-05-01\n    BillingPeriodEnd:             datetime,  // MS CM EA+MCA 2023-05-01\n    BillingPeriodStart:           datetime,  // MS CM EA+MCA 2023-05-01\n    ChargeCategory:               string,    // Hubs add-on\n    ChargeClass:                  string,    // Hubs add-on\n    ChargeDescription:            string,    // MS CM EA+MCA 2023-05-01\n    ChargeFrequency:              string,    // MS CM EA+MCA 2023-05-01\n    ChargePeriodStart:            datetime,  // MS CM EA+MCA 2023-05-01\n    PricingQuantity:              decimal,   // MS CM EA+MCA 2023-05-01\n    PricingUnit:                  string,    // Hubs add-on\n    ProviderName:                 string,    // Hubs add-on\n    RegionId:                     string,    // MS CM EA+MCA 2023-05-01\n    RegionName:                   string,    // MS CM EA+MCA 2023-05-01\n    SubAccountId:                 string,    // MS CM EA+MCA 2023-05-01\n    SubAccountName:               string,    // MS CM EA+MCA 2023-05-01\n    x_AccountName:                string,    // MS CM EA 2023-05-01\n    x_AccountOwnerId:             string,    // MS CM EA 2023-05-01\n    x_CostCenter:                 string,    // MS CM EA 2023-05-01\n    x_InvoiceId:                  string,    // MS CM MCA 2023-05-01\n    x_InvoiceNumber:              string,    // MS CM MCA 2023-05-01\n    x_InvoiceSectionId:           string,    // MS CM MCA 2023-05-01\n    x_InvoiceSectionName:         string,    // MS CM MCA 2023-05-01\n    x_IngestionTime:              datetime,  // Hubs add-on\n    x_MonetaryCommitment:         decimal,   // MS CM EA 2023-05-01\n    x_Overage:                    decimal,   // MS CM EA 2023-05-01\n    x_PurchasingBillingAccountId: string,    // MS CM EA 2023-05-01\n    x_SkuOrderId:                 string,    // MS CM EA+MCA 2023-05-01\n    x_SkuOrderName:               string,    // MS CM EA+MCA 2023-05-01\n    x_SkuSize:                    string,    // MS CM EA+MCA 2023-05-01\n    x_SkuTerm:                    int,       // MS CM EA+MCA 2023-05-01\n    x_SourceName:                 string,    // Hubs add-on\n    x_SourceProvider:             string,    // Hubs add-on\n    x_SourceType:                 string,    // Hubs add-on\n    x_SourceVersion:              string,    // Hubs add-on\n    x_SubscriptionId:             string,    // MS CM EA+MCA 2023-05-01\n    x_TransactionType:            string     // MS CM EA+MCA 2023-05-01\n)\n\n// Update policy for Transactions_raw -> Transactions_final_v1_0 table\n.alter table Transactions_final_v1_0 policy update\n```\n[{\n    \"IsEnabled\": false,\n    \"Source\": \"Transactions_raw\",\n    \"Query\": \"Transactions_transform_v1_0()\",\n    \"IsTransactional\": true,\n    \"PropagateIngestionProperties\": true\n}]\n```\n",
                    "ingestionDbName": "Ingestion",
                    "hubDbName": "Hub",
                    "rawTablesScript": "[replace(variables('$fxv#0'), '$$rawRetentionInDays$$', string(parameters('rawRetentionInDays')))]"
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "FinOpsHub_Ingestion_OpenDataInternal",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "clusterName": {
                            "value": "[parameters('clusterName')]"
                          },
                          "databaseName": {
                            "value": "[variables('ingestionDbName')]"
                          },
                          "scripts": {
                            "value": {
                              "OpenDataFunctions_resource_type_1": "[variables('$fxv#1')]",
                              "OpenDataFunctions_resource_type_2": "[variables('$fxv#2')]",
                              "OpenDataFunctions_resource_type_3": "[variables('$fxv#3')]",
                              "OpenDataFunctions_resource_type_4": "[variables('$fxv#4')]",
                              "OpenDataFunctions_resource_type_5": "[variables('$fxv#5')]"
                            }
                          },
                          "continueOnErrors": {
                            "value": "[parameters('continueOnErrors')]"
                          },
                          "forceUpdateTag": {
                            "value": "[parameters('forceUpdateTag')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.40.2.10011",
                              "templateHash": "12152535787010550020"
                            }
                          },
                          "parameters": {
                            "clusterName": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. Name of the Azure Data Explorer cluster."
                              }
                            },
                            "databaseName": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. Name of the database to run scripts on."
                              }
                            },
                            "scripts": {
                              "type": "object",
                              "metadata": {
                                "description": "Required. Dictionary of scripts to run. Key = script name, Value = KQL script content."
                              }
                            },
                            "continueOnErrors": {
                              "type": "bool",
                              "defaultValue": true,
                              "metadata": {
                                "description": "Optional. If true, script execution continues even if some commands fail. Default: true."
                              }
                            },
                            "forceUpdateTag": {
                              "type": "string",
                              "defaultValue": "[utcNow()]",
                              "metadata": {
                                "description": "Optional. Force script re-execution by changing this value. Uses current UTC time by default."
                              }
                            }
                          },
                          "resources": [
                            {
                              "copy": {
                                "name": "cluster::database::script",
                                "count": "[length(items(parameters('scripts')))]"
                              },
                              "type": "Microsoft.Kusto/clusters/databases/scripts",
                              "apiVersion": "2024-04-13",
                              "name": "[format('{0}/{1}/{2}', parameters('clusterName'), parameters('databaseName'), items(parameters('scripts'))[copyIndex()].key)]",
                              "properties": {
                                "scriptContent": "[items(parameters('scripts'))[copyIndex()].value]",
                                "continueOnErrors": "[parameters('continueOnErrors')]",
                                "forceUpdateTag": "[parameters('forceUpdateTag')]"
                              }
                            }
                          ],
                          "outputs": {
                            "clusterName": {
                              "type": "string",
                              "metadata": {
                                "description": "Cluster name where scripts were deployed."
                              },
                              "value": "[parameters('clusterName')]"
                            },
                            "databaseName": {
                              "type": "string",
                              "metadata": {
                                "description": "Database name where scripts were deployed."
                              },
                              "value": "[parameters('databaseName')]"
                            },
                            "scriptCount": {
                              "type": "int",
                              "metadata": {
                                "description": "Number of scripts deployed."
                              },
                              "value": "[length(items(parameters('scripts')))]"
                            }
                          }
                        }
                      }
                    },
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "FinOpsHub_Ingestion_Init",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "clusterName": {
                            "value": "[parameters('clusterName')]"
                          },
                          "databaseName": {
                            "value": "[variables('ingestionDbName')]"
                          },
                          "scripts": {
                            "value": {
                              "openData": "[variables('$fxv#6')]",
                              "common": "[variables('$fxv#7')]",
                              "infra": "[variables('$fxv#8')]",
                              "rawTables": "[variables('rawTablesScript')]"
                            }
                          },
                          "continueOnErrors": {
                            "value": "[parameters('continueOnErrors')]"
                          },
                          "forceUpdateTag": {
                            "value": "[parameters('forceUpdateTag')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.40.2.10011",
                              "templateHash": "12152535787010550020"
                            }
                          },
                          "parameters": {
                            "clusterName": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. Name of the Azure Data Explorer cluster."
                              }
                            },
                            "databaseName": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. Name of the database to run scripts on."
                              }
                            },
                            "scripts": {
                              "type": "object",
                              "metadata": {
                                "description": "Required. Dictionary of scripts to run. Key = script name, Value = KQL script content."
                              }
                            },
                            "continueOnErrors": {
                              "type": "bool",
                              "defaultValue": true,
                              "metadata": {
                                "description": "Optional. If true, script execution continues even if some commands fail. Default: true."
                              }
                            },
                            "forceUpdateTag": {
                              "type": "string",
                              "defaultValue": "[utcNow()]",
                              "metadata": {
                                "description": "Optional. Force script re-execution by changing this value. Uses current UTC time by default."
                              }
                            }
                          },
                          "resources": [
                            {
                              "copy": {
                                "name": "cluster::database::script",
                                "count": "[length(items(parameters('scripts')))]"
                              },
                              "type": "Microsoft.Kusto/clusters/databases/scripts",
                              "apiVersion": "2024-04-13",
                              "name": "[format('{0}/{1}/{2}', parameters('clusterName'), parameters('databaseName'), items(parameters('scripts'))[copyIndex()].key)]",
                              "properties": {
                                "scriptContent": "[items(parameters('scripts'))[copyIndex()].value]",
                                "continueOnErrors": "[parameters('continueOnErrors')]",
                                "forceUpdateTag": "[parameters('forceUpdateTag')]"
                              }
                            }
                          ],
                          "outputs": {
                            "clusterName": {
                              "type": "string",
                              "metadata": {
                                "description": "Cluster name where scripts were deployed."
                              },
                              "value": "[parameters('clusterName')]"
                            },
                            "databaseName": {
                              "type": "string",
                              "metadata": {
                                "description": "Database name where scripts were deployed."
                              },
                              "value": "[parameters('databaseName')]"
                            },
                            "scriptCount": {
                              "type": "int",
                              "metadata": {
                                "description": "Number of scripts deployed."
                              },
                              "value": "[length(items(parameters('scripts')))]"
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Resources/deployments', 'FinOpsHub_Ingestion_OpenDataInternal')]"
                      ]
                    },
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "FinOpsHub_Ingestion_Versioned",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "clusterName": {
                            "value": "[parameters('clusterName')]"
                          },
                          "databaseName": {
                            "value": "[variables('ingestionDbName')]"
                          },
                          "scripts": {
                            "value": {
                              "v1_0": "[variables('$fxv#9')]",
                              "v1_2": "[variables('$fxv#10')]"
                            }
                          },
                          "continueOnErrors": {
                            "value": "[parameters('continueOnErrors')]"
                          },
                          "forceUpdateTag": {
                            "value": "[parameters('forceUpdateTag')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.40.2.10011",
                              "templateHash": "12152535787010550020"
                            }
                          },
                          "parameters": {
                            "clusterName": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. Name of the Azure Data Explorer cluster."
                              }
                            },
                            "databaseName": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. Name of the database to run scripts on."
                              }
                            },
                            "scripts": {
                              "type": "object",
                              "metadata": {
                                "description": "Required. Dictionary of scripts to run. Key = script name, Value = KQL script content."
                              }
                            },
                            "continueOnErrors": {
                              "type": "bool",
                              "defaultValue": true,
                              "metadata": {
                                "description": "Optional. If true, script execution continues even if some commands fail. Default: true."
                              }
                            },
                            "forceUpdateTag": {
                              "type": "string",
                              "defaultValue": "[utcNow()]",
                              "metadata": {
                                "description": "Optional. Force script re-execution by changing this value. Uses current UTC time by default."
                              }
                            }
                          },
                          "resources": [
                            {
                              "copy": {
                                "name": "cluster::database::script",
                                "count": "[length(items(parameters('scripts')))]"
                              },
                              "type": "Microsoft.Kusto/clusters/databases/scripts",
                              "apiVersion": "2024-04-13",
                              "name": "[format('{0}/{1}/{2}', parameters('clusterName'), parameters('databaseName'), items(parameters('scripts'))[copyIndex()].key)]",
                              "properties": {
                                "scriptContent": "[items(parameters('scripts'))[copyIndex()].value]",
                                "continueOnErrors": "[parameters('continueOnErrors')]",
                                "forceUpdateTag": "[parameters('forceUpdateTag')]"
                              }
                            }
                          ],
                          "outputs": {
                            "clusterName": {
                              "type": "string",
                              "metadata": {
                                "description": "Cluster name where scripts were deployed."
                              },
                              "value": "[parameters('clusterName')]"
                            },
                            "databaseName": {
                              "type": "string",
                              "metadata": {
                                "description": "Database name where scripts were deployed."
                              },
                              "value": "[parameters('databaseName')]"
                            },
                            "scriptCount": {
                              "type": "int",
                              "metadata": {
                                "description": "Number of scripts deployed."
                              },
                              "value": "[length(items(parameters('scripts')))]"
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Resources/deployments', 'FinOpsHub_Ingestion_Init')]"
                      ]
                    },
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "FinOpsHub_Hub_Init",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "clusterName": {
                            "value": "[parameters('clusterName')]"
                          },
                          "databaseName": {
                            "value": "[variables('hubDbName')]"
                          },
                          "scripts": {
                            "value": {
                              "common": "[variables('$fxv#11')]",
                              "openData": "[variables('$fxv#12')]"
                            }
                          },
                          "continueOnErrors": {
                            "value": "[parameters('continueOnErrors')]"
                          },
                          "forceUpdateTag": {
                            "value": "[parameters('forceUpdateTag')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.40.2.10011",
                              "templateHash": "12152535787010550020"
                            }
                          },
                          "parameters": {
                            "clusterName": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. Name of the Azure Data Explorer cluster."
                              }
                            },
                            "databaseName": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. Name of the database to run scripts on."
                              }
                            },
                            "scripts": {
                              "type": "object",
                              "metadata": {
                                "description": "Required. Dictionary of scripts to run. Key = script name, Value = KQL script content."
                              }
                            },
                            "continueOnErrors": {
                              "type": "bool",
                              "defaultValue": true,
                              "metadata": {
                                "description": "Optional. If true, script execution continues even if some commands fail. Default: true."
                              }
                            },
                            "forceUpdateTag": {
                              "type": "string",
                              "defaultValue": "[utcNow()]",
                              "metadata": {
                                "description": "Optional. Force script re-execution by changing this value. Uses current UTC time by default."
                              }
                            }
                          },
                          "resources": [
                            {
                              "copy": {
                                "name": "cluster::database::script",
                                "count": "[length(items(parameters('scripts')))]"
                              },
                              "type": "Microsoft.Kusto/clusters/databases/scripts",
                              "apiVersion": "2024-04-13",
                              "name": "[format('{0}/{1}/{2}', parameters('clusterName'), parameters('databaseName'), items(parameters('scripts'))[copyIndex()].key)]",
                              "properties": {
                                "scriptContent": "[items(parameters('scripts'))[copyIndex()].value]",
                                "continueOnErrors": "[parameters('continueOnErrors')]",
                                "forceUpdateTag": "[parameters('forceUpdateTag')]"
                              }
                            }
                          ],
                          "outputs": {
                            "clusterName": {
                              "type": "string",
                              "metadata": {
                                "description": "Cluster name where scripts were deployed."
                              },
                              "value": "[parameters('clusterName')]"
                            },
                            "databaseName": {
                              "type": "string",
                              "metadata": {
                                "description": "Database name where scripts were deployed."
                              },
                              "value": "[parameters('databaseName')]"
                            },
                            "scriptCount": {
                              "type": "int",
                              "metadata": {
                                "description": "Number of scripts deployed."
                              },
                              "value": "[length(items(parameters('scripts')))]"
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Resources/deployments', 'FinOpsHub_Ingestion_Init')]"
                      ]
                    },
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "FinOpsHub_Hub_Versioned",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "clusterName": {
                            "value": "[parameters('clusterName')]"
                          },
                          "databaseName": {
                            "value": "[variables('hubDbName')]"
                          },
                          "scripts": {
                            "value": {
                              "v1_0": "[variables('$fxv#13')]",
                              "v1_2": "[variables('$fxv#14')]"
                            }
                          },
                          "continueOnErrors": {
                            "value": "[parameters('continueOnErrors')]"
                          },
                          "forceUpdateTag": {
                            "value": "[parameters('forceUpdateTag')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.40.2.10011",
                              "templateHash": "12152535787010550020"
                            }
                          },
                          "parameters": {
                            "clusterName": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. Name of the Azure Data Explorer cluster."
                              }
                            },
                            "databaseName": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. Name of the database to run scripts on."
                              }
                            },
                            "scripts": {
                              "type": "object",
                              "metadata": {
                                "description": "Required. Dictionary of scripts to run. Key = script name, Value = KQL script content."
                              }
                            },
                            "continueOnErrors": {
                              "type": "bool",
                              "defaultValue": true,
                              "metadata": {
                                "description": "Optional. If true, script execution continues even if some commands fail. Default: true."
                              }
                            },
                            "forceUpdateTag": {
                              "type": "string",
                              "defaultValue": "[utcNow()]",
                              "metadata": {
                                "description": "Optional. Force script re-execution by changing this value. Uses current UTC time by default."
                              }
                            }
                          },
                          "resources": [
                            {
                              "copy": {
                                "name": "cluster::database::script",
                                "count": "[length(items(parameters('scripts')))]"
                              },
                              "type": "Microsoft.Kusto/clusters/databases/scripts",
                              "apiVersion": "2024-04-13",
                              "name": "[format('{0}/{1}/{2}', parameters('clusterName'), parameters('databaseName'), items(parameters('scripts'))[copyIndex()].key)]",
                              "properties": {
                                "scriptContent": "[items(parameters('scripts'))[copyIndex()].value]",
                                "continueOnErrors": "[parameters('continueOnErrors')]",
                                "forceUpdateTag": "[parameters('forceUpdateTag')]"
                              }
                            }
                          ],
                          "outputs": {
                            "clusterName": {
                              "type": "string",
                              "metadata": {
                                "description": "Cluster name where scripts were deployed."
                              },
                              "value": "[parameters('clusterName')]"
                            },
                            "databaseName": {
                              "type": "string",
                              "metadata": {
                                "description": "Database name where scripts were deployed."
                              },
                              "value": "[parameters('databaseName')]"
                            },
                            "scriptCount": {
                              "type": "int",
                              "metadata": {
                                "description": "Number of scripts deployed."
                              },
                              "value": "[length(items(parameters('scripts')))]"
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Resources/deployments', 'FinOpsHub_Hub_Init')]",
                        "[resourceId('Microsoft.Resources/deployments', 'FinOpsHub_Ingestion_Versioned')]"
                      ]
                    },
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "FinOpsHub_Hub_Latest",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "clusterName": {
                            "value": "[parameters('clusterName')]"
                          },
                          "databaseName": {
                            "value": "[variables('hubDbName')]"
                          },
                          "scripts": {
                            "value": {
                              "latest": "[variables('$fxv#15')]"
                            }
                          },
                          "continueOnErrors": {
                            "value": "[parameters('continueOnErrors')]"
                          },
                          "forceUpdateTag": {
                            "value": "[parameters('forceUpdateTag')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.40.2.10011",
                              "templateHash": "12152535787010550020"
                            }
                          },
                          "parameters": {
                            "clusterName": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. Name of the Azure Data Explorer cluster."
                              }
                            },
                            "databaseName": {
                              "type": "string",
                              "metadata": {
                                "description": "Required. Name of the database to run scripts on."
                              }
                            },
                            "scripts": {
                              "type": "object",
                              "metadata": {
                                "description": "Required. Dictionary of scripts to run. Key = script name, Value = KQL script content."
                              }
                            },
                            "continueOnErrors": {
                              "type": "bool",
                              "defaultValue": true,
                              "metadata": {
                                "description": "Optional. If true, script execution continues even if some commands fail. Default: true."
                              }
                            },
                            "forceUpdateTag": {
                              "type": "string",
                              "defaultValue": "[utcNow()]",
                              "metadata": {
                                "description": "Optional. Force script re-execution by changing this value. Uses current UTC time by default."
                              }
                            }
                          },
                          "resources": [
                            {
                              "copy": {
                                "name": "cluster::database::script",
                                "count": "[length(items(parameters('scripts')))]"
                              },
                              "type": "Microsoft.Kusto/clusters/databases/scripts",
                              "apiVersion": "2024-04-13",
                              "name": "[format('{0}/{1}/{2}', parameters('clusterName'), parameters('databaseName'), items(parameters('scripts'))[copyIndex()].key)]",
                              "properties": {
                                "scriptContent": "[items(parameters('scripts'))[copyIndex()].value]",
                                "continueOnErrors": "[parameters('continueOnErrors')]",
                                "forceUpdateTag": "[parameters('forceUpdateTag')]"
                              }
                            }
                          ],
                          "outputs": {
                            "clusterName": {
                              "type": "string",
                              "metadata": {
                                "description": "Cluster name where scripts were deployed."
                              },
                              "value": "[parameters('clusterName')]"
                            },
                            "databaseName": {
                              "type": "string",
                              "metadata": {
                                "description": "Database name where scripts were deployed."
                              },
                              "value": "[parameters('databaseName')]"
                            },
                            "scriptCount": {
                              "type": "int",
                              "metadata": {
                                "description": "Number of scripts deployed."
                              },
                              "value": "[length(items(parameters('scripts')))]"
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Resources/deployments', 'FinOpsHub_Hub_Versioned')]"
                      ]
                    }
                  ],
                  "outputs": {
                    "clusterName": {
                      "type": "string",
                      "metadata": {
                        "description": "Name of the ADX cluster where schema was deployed."
                      },
                      "value": "[parameters('clusterName')]"
                    },
                    "ingestionDatabaseName": {
                      "type": "string",
                      "metadata": {
                        "description": "Name of the Ingestion database."
                      },
                      "value": "[variables('ingestionDbName')]"
                    },
                    "hubDatabaseName": {
                      "type": "string",
                      "metadata": {
                        "description": "Name of the Hub database."
                      },
                      "value": "[variables('hubDbName')]"
                    },
                    "rawRetentionDays": {
                      "type": "int",
                      "metadata": {
                        "description": "Raw data retention in days configured for tables."
                      },
                      "value": "[parameters('rawRetentionInDays')]"
                    },
                    "deployedComponents": {
                      "type": "array",
                      "metadata": {
                        "description": "List of schema components deployed."
                      },
                      "value": [
                        "Cluster managed identity policy for ADF ingestion",
                        "OpenData internal functions (5 files)",
                        "OpenData wrapper functions",
                        "Common utility functions",
                        "Hub infrastructure",
                        "Raw tables (Costs_raw, Prices_raw, etc.)",
                        "Ingestion v1.0 schema",
                        "Ingestion v1.2 schema",
                        "MACC tables and functions (MACC_Lots, MACC_Events)",
                        "Hub v1.0 functions",
                        "Hub v1.2 functions",
                        "Latest wrapper functions (Costs, Prices, etc.)",
                        "MACC dashboard queries (status, trends, forecasting)"
                      ]
                    }
                  }
                }
              },
              "dependsOn": [
                "dataExplorer"
              ]
            },
            "adfStorageRoleAssignment": {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-adf-storage-role', uniqueString(deployment().name, parameters('location')))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "resourceId": {
                    "value": "[reference('storageAccount').outputs.resourceId.value]"
                  },
                  "principalId": {
                    "value": "[reference('dataFactory').outputs.systemAssignedMIPrincipalId.value]"
                  },
                  "roleDefinitionId": {
                    "value": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'ba92f5b4-2d11-453d-a403-e96b0029c9fe')]"
                  },
                  "principalType": {
                    "value": "ServicePrincipal"
                  },
                  "enableTelemetry": {
                    "value": "[parameters('enableTelemetry')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.32.4.45862",
                      "templateHash": "14634305923902101494"
                    },
                    "name": "Resource-scoped role assignment",
                    "description": "This module deploys a Role Assignment for a specific resource."
                  },
                  "parameters": {
                    "resourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. The scope for the role assignment, fully qualified resourceId."
                      }
                    },
                    "name": {
                      "type": "string",
                      "defaultValue": "[guid(parameters('resourceId'), parameters('principalId'), if(contains(parameters('roleDefinitionId'), '/providers/Microsoft.Authorization/roleDefinitions/'), parameters('roleDefinitionId'), subscriptionResourceId('Microsoft.Authorization/roleDefinitions', parameters('roleDefinitionId'))))]",
                      "metadata": {
                        "description": "Optional. The unique guid name for the role assignment."
                      }
                    },
                    "roleDefinitionId": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. The role definition ID for the role assignment."
                      }
                    },
                    "roleName": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Optional. The name for the role, used for logging."
                      }
                    },
                    "principalId": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. The Principal or Object ID of the Security Principal (User, Group, Service Principal, Managed Identity)."
                      }
                    },
                    "principalType": {
                      "type": "string",
                      "defaultValue": "",
                      "allowedValues": [
                        "ServicePrincipal",
                        "Group",
                        "User",
                        "ForeignGroup",
                        "Device",
                        ""
                      ],
                      "metadata": {
                        "description": "Optional. The principal type of the assigned principal ID."
                      }
                    },
                    "description": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Optional. The description of role assignment."
                      }
                    },
                    "enableTelemetry": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Optional. Enable/Disable usage telemetry for module."
                      }
                    }
                  },
                  "variables": {
                    "$fxv#0": {
                      "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "scope": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "roleDefinitionId": {
                          "type": "string"
                        },
                        "principalId": {
                          "type": "string"
                        },
                        "principalType": {
                          "type": "string",
                          "allowedValues": [
                            "Device",
                            "ForeignGroup",
                            "Group",
                            "ServicePrincipal",
                            "User",
                            ""
                          ],
                          "defaultValue": "",
                          "metadata": {
                            "description": "Optional. The principal type of the assigned principal ID."
                          }
                        },
                        "description": {
                          "type": "string"
                        }
                      },
                      "resources": [
                        {
                          "type": "Microsoft.Authorization/roleAssignments",
                          "apiVersion": "2022-04-01",
                          "scope": "[[parameters('scope')]",
                          "name": "[[parameters('name')]",
                          "properties": {
                            "roleDefinitionId": "[[parameters('roleDefinitionId')]",
                            "principalId": "[[parameters('principalId')]",
                            "principalType": "[[parameters('principalType')]",
                            "description": "[[parameters('description')]"
                          }
                        }
                      ],
                      "outputs": {
                        "roleAssignmentId": {
                          "type": "string",
                          "value": "[[extensionResourceId(parameters('scope'), 'Microsoft.Authorization/roleAssignments', parameters('name'))]"
                        }
                      }
                    }
                  },
                  "resources": [
                    {
                      "condition": "[parameters('enableTelemetry')]",
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2024-03-01",
                      "name": "[format('46d3xbcp.ptn.authorization-resourceroleassignment.{0}.{1}', replace('0.1.2', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                      "properties": {
                        "mode": "Incremental",
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "resources": [],
                          "outputs": {
                            "telemetry": {
                              "type": "String",
                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                            }
                          }
                        }
                      }
                    },
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2023-07-01",
                      "name": "[format('{0}-ResourceRoleAssignment', guid(parameters('resourceId'), parameters('principalId'), parameters('roleDefinitionId')))]",
                      "properties": {
                        "mode": "Incremental",
                        "expressionEvaluationOptions": {
                          "scope": "Outer"
                        },
                        "template": "[variables('$fxv#0')]",
                        "parameters": {
                          "scope": {
                            "value": "[parameters('resourceId')]"
                          },
                          "name": {
                            "value": "[parameters('name')]"
                          },
                          "roleDefinitionId": {
                            "value": "[if(contains(parameters('roleDefinitionId'), '/providers/Microsoft.Authorization/roleDefinitions/'), parameters('roleDefinitionId'), subscriptionResourceId('Microsoft.Authorization/roleDefinitions', parameters('roleDefinitionId')))]"
                          },
                          "principalId": {
                            "value": "[parameters('principalId')]"
                          },
                          "principalType": {
                            "value": "[parameters('principalType')]"
                          },
                          "description": {
                            "value": "[parameters('description')]"
                          }
                        }
                      }
                    }
                  ],
                  "outputs": {
                    "name": {
                      "type": "string",
                      "metadata": {
                        "description": "The GUID of the Role Assignment."
                      },
                      "value": "[parameters('name')]"
                    },
                    "roleName": {
                      "type": "string",
                      "metadata": {
                        "description": "The name for the role, used for logging."
                      },
                      "value": "[parameters('roleName')]"
                    },
                    "resourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "The resource ID of the Role Assignment."
                      },
                      "value": "[reference(resourceId('Microsoft.Resources/deployments', format('{0}-ResourceRoleAssignment', guid(parameters('resourceId'), parameters('principalId'), parameters('roleDefinitionId')))), '2023-07-01').outputs.roleAssignmentId.value]"
                    },
                    "resourceGroupName": {
                      "type": "string",
                      "metadata": {
                        "description": "The name of the resource group the role assignment was applied at."
                      },
                      "value": "[resourceGroup().name]"
                    }
                  }
                }
              },
              "dependsOn": [
                "dataFactory",
                "storageAccount"
              ]
            },
            "adxStorageRoleAssignment": {
              "condition": "[variables('createNewAdx')]",
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-adx-storage-role', uniqueString(deployment().name, parameters('location')))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "resourceId": {
                    "value": "[reference('storageAccount').outputs.resourceId.value]"
                  },
                  "principalId": {
                    "value": "[reference('dataExplorer').outputs.systemAssignedMIPrincipalId.value]"
                  },
                  "roleDefinitionId": {
                    "value": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '2a2b9908-6ea1-4ae2-8e65-a410df84e7d1')]"
                  },
                  "principalType": {
                    "value": "ServicePrincipal"
                  },
                  "enableTelemetry": {
                    "value": "[parameters('enableTelemetry')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.32.4.45862",
                      "templateHash": "14634305923902101494"
                    },
                    "name": "Resource-scoped role assignment",
                    "description": "This module deploys a Role Assignment for a specific resource."
                  },
                  "parameters": {
                    "resourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. The scope for the role assignment, fully qualified resourceId."
                      }
                    },
                    "name": {
                      "type": "string",
                      "defaultValue": "[guid(parameters('resourceId'), parameters('principalId'), if(contains(parameters('roleDefinitionId'), '/providers/Microsoft.Authorization/roleDefinitions/'), parameters('roleDefinitionId'), subscriptionResourceId('Microsoft.Authorization/roleDefinitions', parameters('roleDefinitionId'))))]",
                      "metadata": {
                        "description": "Optional. The unique guid name for the role assignment."
                      }
                    },
                    "roleDefinitionId": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. The role definition ID for the role assignment."
                      }
                    },
                    "roleName": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Optional. The name for the role, used for logging."
                      }
                    },
                    "principalId": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. The Principal or Object ID of the Security Principal (User, Group, Service Principal, Managed Identity)."
                      }
                    },
                    "principalType": {
                      "type": "string",
                      "defaultValue": "",
                      "allowedValues": [
                        "ServicePrincipal",
                        "Group",
                        "User",
                        "ForeignGroup",
                        "Device",
                        ""
                      ],
                      "metadata": {
                        "description": "Optional. The principal type of the assigned principal ID."
                      }
                    },
                    "description": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Optional. The description of role assignment."
                      }
                    },
                    "enableTelemetry": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Optional. Enable/Disable usage telemetry for module."
                      }
                    }
                  },
                  "variables": {
                    "$fxv#0": {
                      "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "scope": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "roleDefinitionId": {
                          "type": "string"
                        },
                        "principalId": {
                          "type": "string"
                        },
                        "principalType": {
                          "type": "string",
                          "allowedValues": [
                            "Device",
                            "ForeignGroup",
                            "Group",
                            "ServicePrincipal",
                            "User",
                            ""
                          ],
                          "defaultValue": "",
                          "metadata": {
                            "description": "Optional. The principal type of the assigned principal ID."
                          }
                        },
                        "description": {
                          "type": "string"
                        }
                      },
                      "resources": [
                        {
                          "type": "Microsoft.Authorization/roleAssignments",
                          "apiVersion": "2022-04-01",
                          "scope": "[[parameters('scope')]",
                          "name": "[[parameters('name')]",
                          "properties": {
                            "roleDefinitionId": "[[parameters('roleDefinitionId')]",
                            "principalId": "[[parameters('principalId')]",
                            "principalType": "[[parameters('principalType')]",
                            "description": "[[parameters('description')]"
                          }
                        }
                      ],
                      "outputs": {
                        "roleAssignmentId": {
                          "type": "string",
                          "value": "[[extensionResourceId(parameters('scope'), 'Microsoft.Authorization/roleAssignments', parameters('name'))]"
                        }
                      }
                    }
                  },
                  "resources": [
                    {
                      "condition": "[parameters('enableTelemetry')]",
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2024-03-01",
                      "name": "[format('46d3xbcp.ptn.authorization-resourceroleassignment.{0}.{1}', replace('0.1.2', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                      "properties": {
                        "mode": "Incremental",
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "resources": [],
                          "outputs": {
                            "telemetry": {
                              "type": "String",
                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                            }
                          }
                        }
                      }
                    },
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2023-07-01",
                      "name": "[format('{0}-ResourceRoleAssignment', guid(parameters('resourceId'), parameters('principalId'), parameters('roleDefinitionId')))]",
                      "properties": {
                        "mode": "Incremental",
                        "expressionEvaluationOptions": {
                          "scope": "Outer"
                        },
                        "template": "[variables('$fxv#0')]",
                        "parameters": {
                          "scope": {
                            "value": "[parameters('resourceId')]"
                          },
                          "name": {
                            "value": "[parameters('name')]"
                          },
                          "roleDefinitionId": {
                            "value": "[if(contains(parameters('roleDefinitionId'), '/providers/Microsoft.Authorization/roleDefinitions/'), parameters('roleDefinitionId'), subscriptionResourceId('Microsoft.Authorization/roleDefinitions', parameters('roleDefinitionId')))]"
                          },
                          "principalId": {
                            "value": "[parameters('principalId')]"
                          },
                          "principalType": {
                            "value": "[parameters('principalType')]"
                          },
                          "description": {
                            "value": "[parameters('description')]"
                          }
                        }
                      }
                    }
                  ],
                  "outputs": {
                    "name": {
                      "type": "string",
                      "metadata": {
                        "description": "The GUID of the Role Assignment."
                      },
                      "value": "[parameters('name')]"
                    },
                    "roleName": {
                      "type": "string",
                      "metadata": {
                        "description": "The name for the role, used for logging."
                      },
                      "value": "[parameters('roleName')]"
                    },
                    "resourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "The resource ID of the Role Assignment."
                      },
                      "value": "[reference(resourceId('Microsoft.Resources/deployments', format('{0}-ResourceRoleAssignment', guid(parameters('resourceId'), parameters('principalId'), parameters('roleDefinitionId')))), '2023-07-01').outputs.roleAssignmentId.value]"
                    },
                    "resourceGroupName": {
                      "type": "string",
                      "metadata": {
                        "description": "The name of the resource group the role assignment was applied at."
                      },
                      "value": "[resourceGroup().name]"
                    }
                  }
                }
              },
              "dependsOn": [
                "dataExplorer",
                "storageAccount"
              ]
            },
            "adfKeyVaultRoleAssignment": {
              "condition": "[parameters('enableRbacAuthorization')]",
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-adf-kv-role', uniqueString(deployment().name, parameters('location')))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "resourceId": {
                    "value": "[reference('keyVault').outputs.resourceId.value]"
                  },
                  "principalId": {
                    "value": "[reference('dataFactory').outputs.systemAssignedMIPrincipalId.value]"
                  },
                  "roleDefinitionId": {
                    "value": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4633458b-17de-408a-b874-0445c86b69e6')]"
                  },
                  "principalType": {
                    "value": "ServicePrincipal"
                  },
                  "enableTelemetry": {
                    "value": "[parameters('enableTelemetry')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.32.4.45862",
                      "templateHash": "14634305923902101494"
                    },
                    "name": "Resource-scoped role assignment",
                    "description": "This module deploys a Role Assignment for a specific resource."
                  },
                  "parameters": {
                    "resourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. The scope for the role assignment, fully qualified resourceId."
                      }
                    },
                    "name": {
                      "type": "string",
                      "defaultValue": "[guid(parameters('resourceId'), parameters('principalId'), if(contains(parameters('roleDefinitionId'), '/providers/Microsoft.Authorization/roleDefinitions/'), parameters('roleDefinitionId'), subscriptionResourceId('Microsoft.Authorization/roleDefinitions', parameters('roleDefinitionId'))))]",
                      "metadata": {
                        "description": "Optional. The unique guid name for the role assignment."
                      }
                    },
                    "roleDefinitionId": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. The role definition ID for the role assignment."
                      }
                    },
                    "roleName": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Optional. The name for the role, used for logging."
                      }
                    },
                    "principalId": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. The Principal or Object ID of the Security Principal (User, Group, Service Principal, Managed Identity)."
                      }
                    },
                    "principalType": {
                      "type": "string",
                      "defaultValue": "",
                      "allowedValues": [
                        "ServicePrincipal",
                        "Group",
                        "User",
                        "ForeignGroup",
                        "Device",
                        ""
                      ],
                      "metadata": {
                        "description": "Optional. The principal type of the assigned principal ID."
                      }
                    },
                    "description": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Optional. The description of role assignment."
                      }
                    },
                    "enableTelemetry": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Optional. Enable/Disable usage telemetry for module."
                      }
                    }
                  },
                  "variables": {
                    "$fxv#0": {
                      "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "scope": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "roleDefinitionId": {
                          "type": "string"
                        },
                        "principalId": {
                          "type": "string"
                        },
                        "principalType": {
                          "type": "string",
                          "allowedValues": [
                            "Device",
                            "ForeignGroup",
                            "Group",
                            "ServicePrincipal",
                            "User",
                            ""
                          ],
                          "defaultValue": "",
                          "metadata": {
                            "description": "Optional. The principal type of the assigned principal ID."
                          }
                        },
                        "description": {
                          "type": "string"
                        }
                      },
                      "resources": [
                        {
                          "type": "Microsoft.Authorization/roleAssignments",
                          "apiVersion": "2022-04-01",
                          "scope": "[[parameters('scope')]",
                          "name": "[[parameters('name')]",
                          "properties": {
                            "roleDefinitionId": "[[parameters('roleDefinitionId')]",
                            "principalId": "[[parameters('principalId')]",
                            "principalType": "[[parameters('principalType')]",
                            "description": "[[parameters('description')]"
                          }
                        }
                      ],
                      "outputs": {
                        "roleAssignmentId": {
                          "type": "string",
                          "value": "[[extensionResourceId(parameters('scope'), 'Microsoft.Authorization/roleAssignments', parameters('name'))]"
                        }
                      }
                    }
                  },
                  "resources": [
                    {
                      "condition": "[parameters('enableTelemetry')]",
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2024-03-01",
                      "name": "[format('46d3xbcp.ptn.authorization-resourceroleassignment.{0}.{1}', replace('0.1.2', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                      "properties": {
                        "mode": "Incremental",
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "resources": [],
                          "outputs": {
                            "telemetry": {
                              "type": "String",
                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                            }
                          }
                        }
                      }
                    },
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2023-07-01",
                      "name": "[format('{0}-ResourceRoleAssignment', guid(parameters('resourceId'), parameters('principalId'), parameters('roleDefinitionId')))]",
                      "properties": {
                        "mode": "Incremental",
                        "expressionEvaluationOptions": {
                          "scope": "Outer"
                        },
                        "template": "[variables('$fxv#0')]",
                        "parameters": {
                          "scope": {
                            "value": "[parameters('resourceId')]"
                          },
                          "name": {
                            "value": "[parameters('name')]"
                          },
                          "roleDefinitionId": {
                            "value": "[if(contains(parameters('roleDefinitionId'), '/providers/Microsoft.Authorization/roleDefinitions/'), parameters('roleDefinitionId'), subscriptionResourceId('Microsoft.Authorization/roleDefinitions', parameters('roleDefinitionId')))]"
                          },
                          "principalId": {
                            "value": "[parameters('principalId')]"
                          },
                          "principalType": {
                            "value": "[parameters('principalType')]"
                          },
                          "description": {
                            "value": "[parameters('description')]"
                          }
                        }
                      }
                    }
                  ],
                  "outputs": {
                    "name": {
                      "type": "string",
                      "metadata": {
                        "description": "The GUID of the Role Assignment."
                      },
                      "value": "[parameters('name')]"
                    },
                    "roleName": {
                      "type": "string",
                      "metadata": {
                        "description": "The name for the role, used for logging."
                      },
                      "value": "[parameters('roleName')]"
                    },
                    "resourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "The resource ID of the Role Assignment."
                      },
                      "value": "[reference(resourceId('Microsoft.Resources/deployments', format('{0}-ResourceRoleAssignment', guid(parameters('resourceId'), parameters('principalId'), parameters('roleDefinitionId')))), '2023-07-01').outputs.roleAssignmentId.value]"
                    },
                    "resourceGroupName": {
                      "type": "string",
                      "metadata": {
                        "description": "The name of the resource group the role assignment was applied at."
                      },
                      "value": "[resourceGroup().name]"
                    }
                  }
                }
              },
              "dependsOn": [
                "dataFactory",
                "keyVault"
              ]
            },
            "adfStoragePeApprovalRole": {
              "condition": "[and(variables('effectiveAdfManagedVnet'), parameters('enableManagedPeAutoApproval'))]",
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-adf-storage-pe-approval', uniqueString(deployment().name, parameters('location')))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "resourceId": {
                    "value": "[reference('storageAccount').outputs.resourceId.value]"
                  },
                  "principalId": {
                    "value": "[reference('dataFactory').outputs.systemAssignedMIPrincipalId.value]"
                  },
                  "roleDefinitionId": {
                    "value": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '17d1049b-9a84-46fb-8f53-869881c3d3ab')]"
                  },
                  "principalType": {
                    "value": "ServicePrincipal"
                  },
                  "enableTelemetry": {
                    "value": "[parameters('enableTelemetry')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.32.4.45862",
                      "templateHash": "14634305923902101494"
                    },
                    "name": "Resource-scoped role assignment",
                    "description": "This module deploys a Role Assignment for a specific resource."
                  },
                  "parameters": {
                    "resourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. The scope for the role assignment, fully qualified resourceId."
                      }
                    },
                    "name": {
                      "type": "string",
                      "defaultValue": "[guid(parameters('resourceId'), parameters('principalId'), if(contains(parameters('roleDefinitionId'), '/providers/Microsoft.Authorization/roleDefinitions/'), parameters('roleDefinitionId'), subscriptionResourceId('Microsoft.Authorization/roleDefinitions', parameters('roleDefinitionId'))))]",
                      "metadata": {
                        "description": "Optional. The unique guid name for the role assignment."
                      }
                    },
                    "roleDefinitionId": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. The role definition ID for the role assignment."
                      }
                    },
                    "roleName": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Optional. The name for the role, used for logging."
                      }
                    },
                    "principalId": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. The Principal or Object ID of the Security Principal (User, Group, Service Principal, Managed Identity)."
                      }
                    },
                    "principalType": {
                      "type": "string",
                      "defaultValue": "",
                      "allowedValues": [
                        "ServicePrincipal",
                        "Group",
                        "User",
                        "ForeignGroup",
                        "Device",
                        ""
                      ],
                      "metadata": {
                        "description": "Optional. The principal type of the assigned principal ID."
                      }
                    },
                    "description": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Optional. The description of role assignment."
                      }
                    },
                    "enableTelemetry": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Optional. Enable/Disable usage telemetry for module."
                      }
                    }
                  },
                  "variables": {
                    "$fxv#0": {
                      "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "scope": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "roleDefinitionId": {
                          "type": "string"
                        },
                        "principalId": {
                          "type": "string"
                        },
                        "principalType": {
                          "type": "string",
                          "allowedValues": [
                            "Device",
                            "ForeignGroup",
                            "Group",
                            "ServicePrincipal",
                            "User",
                            ""
                          ],
                          "defaultValue": "",
                          "metadata": {
                            "description": "Optional. The principal type of the assigned principal ID."
                          }
                        },
                        "description": {
                          "type": "string"
                        }
                      },
                      "resources": [
                        {
                          "type": "Microsoft.Authorization/roleAssignments",
                          "apiVersion": "2022-04-01",
                          "scope": "[[parameters('scope')]",
                          "name": "[[parameters('name')]",
                          "properties": {
                            "roleDefinitionId": "[[parameters('roleDefinitionId')]",
                            "principalId": "[[parameters('principalId')]",
                            "principalType": "[[parameters('principalType')]",
                            "description": "[[parameters('description')]"
                          }
                        }
                      ],
                      "outputs": {
                        "roleAssignmentId": {
                          "type": "string",
                          "value": "[[extensionResourceId(parameters('scope'), 'Microsoft.Authorization/roleAssignments', parameters('name'))]"
                        }
                      }
                    }
                  },
                  "resources": [
                    {
                      "condition": "[parameters('enableTelemetry')]",
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2024-03-01",
                      "name": "[format('46d3xbcp.ptn.authorization-resourceroleassignment.{0}.{1}', replace('0.1.2', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                      "properties": {
                        "mode": "Incremental",
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "resources": [],
                          "outputs": {
                            "telemetry": {
                              "type": "String",
                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                            }
                          }
                        }
                      }
                    },
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2023-07-01",
                      "name": "[format('{0}-ResourceRoleAssignment', guid(parameters('resourceId'), parameters('principalId'), parameters('roleDefinitionId')))]",
                      "properties": {
                        "mode": "Incremental",
                        "expressionEvaluationOptions": {
                          "scope": "Outer"
                        },
                        "template": "[variables('$fxv#0')]",
                        "parameters": {
                          "scope": {
                            "value": "[parameters('resourceId')]"
                          },
                          "name": {
                            "value": "[parameters('name')]"
                          },
                          "roleDefinitionId": {
                            "value": "[if(contains(parameters('roleDefinitionId'), '/providers/Microsoft.Authorization/roleDefinitions/'), parameters('roleDefinitionId'), subscriptionResourceId('Microsoft.Authorization/roleDefinitions', parameters('roleDefinitionId')))]"
                          },
                          "principalId": {
                            "value": "[parameters('principalId')]"
                          },
                          "principalType": {
                            "value": "[parameters('principalType')]"
                          },
                          "description": {
                            "value": "[parameters('description')]"
                          }
                        }
                      }
                    }
                  ],
                  "outputs": {
                    "name": {
                      "type": "string",
                      "metadata": {
                        "description": "The GUID of the Role Assignment."
                      },
                      "value": "[parameters('name')]"
                    },
                    "roleName": {
                      "type": "string",
                      "metadata": {
                        "description": "The name for the role, used for logging."
                      },
                      "value": "[parameters('roleName')]"
                    },
                    "resourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "The resource ID of the Role Assignment."
                      },
                      "value": "[reference(resourceId('Microsoft.Resources/deployments', format('{0}-ResourceRoleAssignment', guid(parameters('resourceId'), parameters('principalId'), parameters('roleDefinitionId')))), '2023-07-01').outputs.roleAssignmentId.value]"
                    },
                    "resourceGroupName": {
                      "type": "string",
                      "metadata": {
                        "description": "The name of the resource group the role assignment was applied at."
                      },
                      "value": "[resourceGroup().name]"
                    }
                  }
                }
              },
              "dependsOn": [
                "dataFactory",
                "storageAccount"
              ]
            },
            "adfKeyVaultPeApprovalRole": {
              "condition": "[and(variables('effectiveAdfManagedVnet'), parameters('enableManagedPeAutoApproval'))]",
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-adf-kv-pe-approval', uniqueString(deployment().name, parameters('location')))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "resourceId": {
                    "value": "[reference('keyVault').outputs.resourceId.value]"
                  },
                  "principalId": {
                    "value": "[reference('dataFactory').outputs.systemAssignedMIPrincipalId.value]"
                  },
                  "roleDefinitionId": {
                    "value": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'f25e0fa2-a7c8-4377-a976-54943a77a395')]"
                  },
                  "principalType": {
                    "value": "ServicePrincipal"
                  },
                  "enableTelemetry": {
                    "value": "[parameters('enableTelemetry')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.32.4.45862",
                      "templateHash": "14634305923902101494"
                    },
                    "name": "Resource-scoped role assignment",
                    "description": "This module deploys a Role Assignment for a specific resource."
                  },
                  "parameters": {
                    "resourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. The scope for the role assignment, fully qualified resourceId."
                      }
                    },
                    "name": {
                      "type": "string",
                      "defaultValue": "[guid(parameters('resourceId'), parameters('principalId'), if(contains(parameters('roleDefinitionId'), '/providers/Microsoft.Authorization/roleDefinitions/'), parameters('roleDefinitionId'), subscriptionResourceId('Microsoft.Authorization/roleDefinitions', parameters('roleDefinitionId'))))]",
                      "metadata": {
                        "description": "Optional. The unique guid name for the role assignment."
                      }
                    },
                    "roleDefinitionId": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. The role definition ID for the role assignment."
                      }
                    },
                    "roleName": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Optional. The name for the role, used for logging."
                      }
                    },
                    "principalId": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. The Principal or Object ID of the Security Principal (User, Group, Service Principal, Managed Identity)."
                      }
                    },
                    "principalType": {
                      "type": "string",
                      "defaultValue": "",
                      "allowedValues": [
                        "ServicePrincipal",
                        "Group",
                        "User",
                        "ForeignGroup",
                        "Device",
                        ""
                      ],
                      "metadata": {
                        "description": "Optional. The principal type of the assigned principal ID."
                      }
                    },
                    "description": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Optional. The description of role assignment."
                      }
                    },
                    "enableTelemetry": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Optional. Enable/Disable usage telemetry for module."
                      }
                    }
                  },
                  "variables": {
                    "$fxv#0": {
                      "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "scope": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "roleDefinitionId": {
                          "type": "string"
                        },
                        "principalId": {
                          "type": "string"
                        },
                        "principalType": {
                          "type": "string",
                          "allowedValues": [
                            "Device",
                            "ForeignGroup",
                            "Group",
                            "ServicePrincipal",
                            "User",
                            ""
                          ],
                          "defaultValue": "",
                          "metadata": {
                            "description": "Optional. The principal type of the assigned principal ID."
                          }
                        },
                        "description": {
                          "type": "string"
                        }
                      },
                      "resources": [
                        {
                          "type": "Microsoft.Authorization/roleAssignments",
                          "apiVersion": "2022-04-01",
                          "scope": "[[parameters('scope')]",
                          "name": "[[parameters('name')]",
                          "properties": {
                            "roleDefinitionId": "[[parameters('roleDefinitionId')]",
                            "principalId": "[[parameters('principalId')]",
                            "principalType": "[[parameters('principalType')]",
                            "description": "[[parameters('description')]"
                          }
                        }
                      ],
                      "outputs": {
                        "roleAssignmentId": {
                          "type": "string",
                          "value": "[[extensionResourceId(parameters('scope'), 'Microsoft.Authorization/roleAssignments', parameters('name'))]"
                        }
                      }
                    }
                  },
                  "resources": [
                    {
                      "condition": "[parameters('enableTelemetry')]",
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2024-03-01",
                      "name": "[format('46d3xbcp.ptn.authorization-resourceroleassignment.{0}.{1}', replace('0.1.2', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                      "properties": {
                        "mode": "Incremental",
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "resources": [],
                          "outputs": {
                            "telemetry": {
                              "type": "String",
                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                            }
                          }
                        }
                      }
                    },
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2023-07-01",
                      "name": "[format('{0}-ResourceRoleAssignment', guid(parameters('resourceId'), parameters('principalId'), parameters('roleDefinitionId')))]",
                      "properties": {
                        "mode": "Incremental",
                        "expressionEvaluationOptions": {
                          "scope": "Outer"
                        },
                        "template": "[variables('$fxv#0')]",
                        "parameters": {
                          "scope": {
                            "value": "[parameters('resourceId')]"
                          },
                          "name": {
                            "value": "[parameters('name')]"
                          },
                          "roleDefinitionId": {
                            "value": "[if(contains(parameters('roleDefinitionId'), '/providers/Microsoft.Authorization/roleDefinitions/'), parameters('roleDefinitionId'), subscriptionResourceId('Microsoft.Authorization/roleDefinitions', parameters('roleDefinitionId')))]"
                          },
                          "principalId": {
                            "value": "[parameters('principalId')]"
                          },
                          "principalType": {
                            "value": "[parameters('principalType')]"
                          },
                          "description": {
                            "value": "[parameters('description')]"
                          }
                        }
                      }
                    }
                  ],
                  "outputs": {
                    "name": {
                      "type": "string",
                      "metadata": {
                        "description": "The GUID of the Role Assignment."
                      },
                      "value": "[parameters('name')]"
                    },
                    "roleName": {
                      "type": "string",
                      "metadata": {
                        "description": "The name for the role, used for logging."
                      },
                      "value": "[parameters('roleName')]"
                    },
                    "resourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "The resource ID of the Role Assignment."
                      },
                      "value": "[reference(resourceId('Microsoft.Resources/deployments', format('{0}-ResourceRoleAssignment', guid(parameters('resourceId'), parameters('principalId'), parameters('roleDefinitionId')))), '2023-07-01').outputs.roleAssignmentId.value]"
                    },
                    "resourceGroupName": {
                      "type": "string",
                      "metadata": {
                        "description": "The name of the resource group the role assignment was applied at."
                      },
                      "value": "[resourceGroup().name]"
                    }
                  }
                }
              },
              "dependsOn": [
                "dataFactory",
                "keyVault"
              ]
            },
            "adxManagedPrivateEndpoint": {
              "condition": "[and(variables('createNewAdx'), variables('effectiveAdfManagedVnet'))]",
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-adx-mpe', uniqueString(deployment().name, parameters('location')))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "dataFactoryName": {
                    "value": "[reference('dataFactory').outputs.name.value]"
                  },
                  "adxClusterName": {
                    "value": "[reference('dataExplorer').outputs.name.value]"
                  },
                  "adxClusterResourceId": {
                    "value": "[reference('dataExplorer').outputs.resourceId.value]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.40.2.10011",
                      "templateHash": "16337010864221052450"
                    }
                  },
                  "parameters": {
                    "dataFactoryName": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. Name of the Data Factory."
                      }
                    },
                    "adxClusterName": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. Name of the ADX cluster."
                      }
                    },
                    "adxClusterResourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. Resource ID of the ADX cluster."
                      }
                    },
                    "location": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. Azure region (for constructing ADX FQDN)."
                      }
                    }
                  },
                  "resources": [
                    {
                      "type": "Microsoft.DataFactory/factories/managedVirtualNetworks/managedPrivateEndpoints",
                      "apiVersion": "2018-06-01",
                      "name": "[format('{0}/{1}/{2}', parameters('dataFactoryName'), 'default', format('{0}-mpe', parameters('adxClusterName')))]",
                      "properties": {
                        "groupId": "cluster",
                        "privateLinkResourceId": "[parameters('adxClusterResourceId')]",
                        "fqdns": [
                          "[format('https://{0}.{1}.kusto.windows.net', parameters('adxClusterName'), parameters('location'))]"
                        ]
                      }
                    },
                    {
                      "type": "Microsoft.DataFactory/factories/managedVirtualNetworks/managedPrivateEndpoints",
                      "apiVersion": "2018-06-01",
                      "name": "[format('{0}/{1}/{2}', parameters('dataFactoryName'), 'default', format('{0}-ingest-mpe', parameters('adxClusterName')))]",
                      "properties": {
                        "groupId": "ingestion",
                        "privateLinkResourceId": "[parameters('adxClusterResourceId')]",
                        "fqdns": [
                          "[format('https://ingest-{0}.{1}.kusto.windows.net', parameters('adxClusterName'), parameters('location'))]"
                        ]
                      }
                    }
                  ],
                  "outputs": {
                    "clusterManagedPrivateEndpointName": {
                      "type": "string",
                      "metadata": {
                        "description": "Name of the created cluster managed private endpoint."
                      },
                      "value": "[format('{0}-mpe', parameters('adxClusterName'))]"
                    },
                    "ingestionManagedPrivateEndpointName": {
                      "type": "string",
                      "metadata": {
                        "description": "Name of the created ingestion managed private endpoint."
                      },
                      "value": "[format('{0}-ingest-mpe', parameters('adxClusterName'))]"
                    },
                    "clusterProvisioningState": {
                      "type": "string",
                      "metadata": {
                        "description": "Provisioning state of the cluster managed private endpoint."
                      },
                      "value": "[coalesce(reference(resourceId('Microsoft.DataFactory/factories/managedVirtualNetworks/managedPrivateEndpoints', parameters('dataFactoryName'), 'default', format('{0}-mpe', parameters('adxClusterName'))), '2018-06-01').provisioningState, 'Unknown')]"
                    },
                    "ingestionProvisioningState": {
                      "type": "string",
                      "metadata": {
                        "description": "Provisioning state of the ingestion managed private endpoint."
                      },
                      "value": "[coalesce(reference(resourceId('Microsoft.DataFactory/factories/managedVirtualNetworks/managedPrivateEndpoints', parameters('dataFactoryName'), 'default', format('{0}-ingest-mpe', parameters('adxClusterName'))), '2018-06-01').provisioningState, 'Unknown')]"
                    },
                    "clusterConnectionState": {
                      "type": "string",
                      "metadata": {
                        "description": "Connection state of the cluster managed private endpoint."
                      },
                      "value": "[coalesce(reference(resourceId('Microsoft.DataFactory/factories/managedVirtualNetworks/managedPrivateEndpoints', parameters('dataFactoryName'), 'default', format('{0}-mpe', parameters('adxClusterName'))), '2018-06-01').connectionState.status, 'Pending')]"
                    },
                    "ingestionConnectionState": {
                      "type": "string",
                      "metadata": {
                        "description": "Connection state of the ingestion managed private endpoint."
                      },
                      "value": "[coalesce(reference(resourceId('Microsoft.DataFactory/factories/managedVirtualNetworks/managedPrivateEndpoints', parameters('dataFactoryName'), 'default', format('{0}-ingest-mpe', parameters('adxClusterName'))), '2018-06-01').connectionState.status, 'Pending')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "dataExplorer",
                "dataFactory"
              ]
            },
            "getAdxPendingConnections": {
              "condition": "[and(variables('createNewAdx'), variables('effectiveAdfManagedVnet'))]",
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-adx-pe-get', uniqueString(deployment().name, parameters('location')))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "adxClusterName": {
                    "value": "[reference('dataExplorer').outputs.name.value]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.40.2.10011",
                      "templateHash": "8488403584356895054"
                    }
                  },
                  "parameters": {
                    "adxClusterName": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. Name of the ADX cluster."
                      }
                    },
                    "privateEndpointConnections": {
                      "type": "array",
                      "defaultValue": [],
                      "metadata": {
                        "description": "Optional. Array of private endpoint connections to approve. If empty, will query the cluster."
                      }
                    }
                  },
                  "resources": [
                    {
                      "copy": {
                        "name": "approveConnection",
                        "count": "[length(parameters('privateEndpointConnections'))]"
                      },
                      "condition": "[equals(parameters('privateEndpointConnections')[copyIndex()].properties.privateLinkServiceConnectionState.status, 'Pending')]",
                      "type": "Microsoft.Kusto/clusters/privateEndpointConnections",
                      "apiVersion": "2024-04-13",
                      "name": "[format('{0}/{1}', parameters('adxClusterName'), last(array(split(parameters('privateEndpointConnections')[copyIndex()].id, '/'))))]",
                      "properties": {
                        "privateLinkServiceConnectionState": {
                          "status": "Approved",
                          "description": "Approved by FinOps Hub deployment"
                        }
                      }
                    }
                  ],
                  "outputs": {
                    "privateEndpointConnections": {
                      "type": "array",
                      "metadata": {
                        "description": "Current private endpoint connections on the cluster (for chaining get->approve pattern)."
                      },
                      "value": "[coalesce(reference(resourceId('Microsoft.Kusto/clusters', parameters('adxClusterName')), '2024-04-13').privateEndpointConnections, createArray())]"
                    }
                  }
                }
              },
              "dependsOn": [
                "adxManagedPrivateEndpoint",
                "dataExplorer"
              ]
            },
            "approveAdxManagedPeConnections": {
              "condition": "[and(variables('createNewAdx'), variables('effectiveAdfManagedVnet'))]",
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-adx-pe-approve', uniqueString(deployment().name, parameters('location')))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "adxClusterName": {
                    "value": "[reference('dataExplorer').outputs.name.value]"
                  },
                  "privateEndpointConnections": {
                    "value": "[reference('getAdxPendingConnections').outputs.privateEndpointConnections.value]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.40.2.10011",
                      "templateHash": "8488403584356895054"
                    }
                  },
                  "parameters": {
                    "adxClusterName": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. Name of the ADX cluster."
                      }
                    },
                    "privateEndpointConnections": {
                      "type": "array",
                      "defaultValue": [],
                      "metadata": {
                        "description": "Optional. Array of private endpoint connections to approve. If empty, will query the cluster."
                      }
                    }
                  },
                  "resources": [
                    {
                      "copy": {
                        "name": "approveConnection",
                        "count": "[length(parameters('privateEndpointConnections'))]"
                      },
                      "condition": "[equals(parameters('privateEndpointConnections')[copyIndex()].properties.privateLinkServiceConnectionState.status, 'Pending')]",
                      "type": "Microsoft.Kusto/clusters/privateEndpointConnections",
                      "apiVersion": "2024-04-13",
                      "name": "[format('{0}/{1}', parameters('adxClusterName'), last(array(split(parameters('privateEndpointConnections')[copyIndex()].id, '/'))))]",
                      "properties": {
                        "privateLinkServiceConnectionState": {
                          "status": "Approved",
                          "description": "Approved by FinOps Hub deployment"
                        }
                      }
                    }
                  ],
                  "outputs": {
                    "privateEndpointConnections": {
                      "type": "array",
                      "metadata": {
                        "description": "Current private endpoint connections on the cluster (for chaining get->approve pattern)."
                      },
                      "value": "[coalesce(reference(resourceId('Microsoft.Kusto/clusters', parameters('adxClusterName')), '2024-04-13').privateEndpointConnections, createArray())]"
                    }
                  }
                }
              },
              "dependsOn": [
                "dataExplorer",
                "getAdxPendingConnections"
              ]
            },
            "identityStorageRoleAssignment": {
              "condition": "[parameters('enableTriggerManagement')]",
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-identity-storage-role', uniqueString(deployment().name, parameters('location')))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "resourceId": {
                    "value": "[reference('storageAccount').outputs.resourceId.value]"
                  },
                  "principalId": "[if(variables('useExistingIdentity'), createObject('value', reference('existingManagedIdentity').principalId), createObject('value', reference('managedIdentity').outputs.principalId.value))]",
                  "roleDefinitionId": {
                    "value": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '69566ab7-960f-475b-8e7c-b3118f30c6bd')]"
                  },
                  "principalType": {
                    "value": "ServicePrincipal"
                  },
                  "enableTelemetry": {
                    "value": "[parameters('enableTelemetry')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.32.4.45862",
                      "templateHash": "14634305923902101494"
                    },
                    "name": "Resource-scoped role assignment",
                    "description": "This module deploys a Role Assignment for a specific resource."
                  },
                  "parameters": {
                    "resourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. The scope for the role assignment, fully qualified resourceId."
                      }
                    },
                    "name": {
                      "type": "string",
                      "defaultValue": "[guid(parameters('resourceId'), parameters('principalId'), if(contains(parameters('roleDefinitionId'), '/providers/Microsoft.Authorization/roleDefinitions/'), parameters('roleDefinitionId'), subscriptionResourceId('Microsoft.Authorization/roleDefinitions', parameters('roleDefinitionId'))))]",
                      "metadata": {
                        "description": "Optional. The unique guid name for the role assignment."
                      }
                    },
                    "roleDefinitionId": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. The role definition ID for the role assignment."
                      }
                    },
                    "roleName": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Optional. The name for the role, used for logging."
                      }
                    },
                    "principalId": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. The Principal or Object ID of the Security Principal (User, Group, Service Principal, Managed Identity)."
                      }
                    },
                    "principalType": {
                      "type": "string",
                      "defaultValue": "",
                      "allowedValues": [
                        "ServicePrincipal",
                        "Group",
                        "User",
                        "ForeignGroup",
                        "Device",
                        ""
                      ],
                      "metadata": {
                        "description": "Optional. The principal type of the assigned principal ID."
                      }
                    },
                    "description": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Optional. The description of role assignment."
                      }
                    },
                    "enableTelemetry": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Optional. Enable/Disable usage telemetry for module."
                      }
                    }
                  },
                  "variables": {
                    "$fxv#0": {
                      "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "scope": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "roleDefinitionId": {
                          "type": "string"
                        },
                        "principalId": {
                          "type": "string"
                        },
                        "principalType": {
                          "type": "string",
                          "allowedValues": [
                            "Device",
                            "ForeignGroup",
                            "Group",
                            "ServicePrincipal",
                            "User",
                            ""
                          ],
                          "defaultValue": "",
                          "metadata": {
                            "description": "Optional. The principal type of the assigned principal ID."
                          }
                        },
                        "description": {
                          "type": "string"
                        }
                      },
                      "resources": [
                        {
                          "type": "Microsoft.Authorization/roleAssignments",
                          "apiVersion": "2022-04-01",
                          "scope": "[[parameters('scope')]",
                          "name": "[[parameters('name')]",
                          "properties": {
                            "roleDefinitionId": "[[parameters('roleDefinitionId')]",
                            "principalId": "[[parameters('principalId')]",
                            "principalType": "[[parameters('principalType')]",
                            "description": "[[parameters('description')]"
                          }
                        }
                      ],
                      "outputs": {
                        "roleAssignmentId": {
                          "type": "string",
                          "value": "[[extensionResourceId(parameters('scope'), 'Microsoft.Authorization/roleAssignments', parameters('name'))]"
                        }
                      }
                    }
                  },
                  "resources": [
                    {
                      "condition": "[parameters('enableTelemetry')]",
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2024-03-01",
                      "name": "[format('46d3xbcp.ptn.authorization-resourceroleassignment.{0}.{1}', replace('0.1.2', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                      "properties": {
                        "mode": "Incremental",
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "resources": [],
                          "outputs": {
                            "telemetry": {
                              "type": "String",
                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                            }
                          }
                        }
                      }
                    },
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2023-07-01",
                      "name": "[format('{0}-ResourceRoleAssignment', guid(parameters('resourceId'), parameters('principalId'), parameters('roleDefinitionId')))]",
                      "properties": {
                        "mode": "Incremental",
                        "expressionEvaluationOptions": {
                          "scope": "Outer"
                        },
                        "template": "[variables('$fxv#0')]",
                        "parameters": {
                          "scope": {
                            "value": "[parameters('resourceId')]"
                          },
                          "name": {
                            "value": "[parameters('name')]"
                          },
                          "roleDefinitionId": {
                            "value": "[if(contains(parameters('roleDefinitionId'), '/providers/Microsoft.Authorization/roleDefinitions/'), parameters('roleDefinitionId'), subscriptionResourceId('Microsoft.Authorization/roleDefinitions', parameters('roleDefinitionId')))]"
                          },
                          "principalId": {
                            "value": "[parameters('principalId')]"
                          },
                          "principalType": {
                            "value": "[parameters('principalType')]"
                          },
                          "description": {
                            "value": "[parameters('description')]"
                          }
                        }
                      }
                    }
                  ],
                  "outputs": {
                    "name": {
                      "type": "string",
                      "metadata": {
                        "description": "The GUID of the Role Assignment."
                      },
                      "value": "[parameters('name')]"
                    },
                    "roleName": {
                      "type": "string",
                      "metadata": {
                        "description": "The name for the role, used for logging."
                      },
                      "value": "[parameters('roleName')]"
                    },
                    "resourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "The resource ID of the Role Assignment."
                      },
                      "value": "[reference(resourceId('Microsoft.Resources/deployments', format('{0}-ResourceRoleAssignment', guid(parameters('resourceId'), parameters('principalId'), parameters('roleDefinitionId')))), '2023-07-01').outputs.roleAssignmentId.value]"
                    },
                    "resourceGroupName": {
                      "type": "string",
                      "metadata": {
                        "description": "The name of the resource group the role assignment was applied at."
                      },
                      "value": "[resourceGroup().name]"
                    }
                  }
                }
              },
              "dependsOn": [
                "existingManagedIdentity",
                "managedIdentity",
                "storageAccount"
              ]
            },
            "identityAdfRoleAssignment": {
              "condition": "[parameters('enableTriggerManagement')]",
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-identity-adf-role', uniqueString(deployment().name, parameters('location')))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "resourceId": {
                    "value": "[reference('dataFactory').outputs.resourceId.value]"
                  },
                  "principalId": "[if(variables('useExistingIdentity'), createObject('value', reference('existingManagedIdentity').principalId), createObject('value', reference('managedIdentity').outputs.principalId.value))]",
                  "roleDefinitionId": {
                    "value": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '673868aa-7521-48a0-acc6-0f60742d39f5')]"
                  },
                  "principalType": {
                    "value": "ServicePrincipal"
                  },
                  "enableTelemetry": {
                    "value": "[parameters('enableTelemetry')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.32.4.45862",
                      "templateHash": "14634305923902101494"
                    },
                    "name": "Resource-scoped role assignment",
                    "description": "This module deploys a Role Assignment for a specific resource."
                  },
                  "parameters": {
                    "resourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. The scope for the role assignment, fully qualified resourceId."
                      }
                    },
                    "name": {
                      "type": "string",
                      "defaultValue": "[guid(parameters('resourceId'), parameters('principalId'), if(contains(parameters('roleDefinitionId'), '/providers/Microsoft.Authorization/roleDefinitions/'), parameters('roleDefinitionId'), subscriptionResourceId('Microsoft.Authorization/roleDefinitions', parameters('roleDefinitionId'))))]",
                      "metadata": {
                        "description": "Optional. The unique guid name for the role assignment."
                      }
                    },
                    "roleDefinitionId": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. The role definition ID for the role assignment."
                      }
                    },
                    "roleName": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Optional. The name for the role, used for logging."
                      }
                    },
                    "principalId": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. The Principal or Object ID of the Security Principal (User, Group, Service Principal, Managed Identity)."
                      }
                    },
                    "principalType": {
                      "type": "string",
                      "defaultValue": "",
                      "allowedValues": [
                        "ServicePrincipal",
                        "Group",
                        "User",
                        "ForeignGroup",
                        "Device",
                        ""
                      ],
                      "metadata": {
                        "description": "Optional. The principal type of the assigned principal ID."
                      }
                    },
                    "description": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Optional. The description of role assignment."
                      }
                    },
                    "enableTelemetry": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Optional. Enable/Disable usage telemetry for module."
                      }
                    }
                  },
                  "variables": {
                    "$fxv#0": {
                      "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "scope": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "roleDefinitionId": {
                          "type": "string"
                        },
                        "principalId": {
                          "type": "string"
                        },
                        "principalType": {
                          "type": "string",
                          "allowedValues": [
                            "Device",
                            "ForeignGroup",
                            "Group",
                            "ServicePrincipal",
                            "User",
                            ""
                          ],
                          "defaultValue": "",
                          "metadata": {
                            "description": "Optional. The principal type of the assigned principal ID."
                          }
                        },
                        "description": {
                          "type": "string"
                        }
                      },
                      "resources": [
                        {
                          "type": "Microsoft.Authorization/roleAssignments",
                          "apiVersion": "2022-04-01",
                          "scope": "[[parameters('scope')]",
                          "name": "[[parameters('name')]",
                          "properties": {
                            "roleDefinitionId": "[[parameters('roleDefinitionId')]",
                            "principalId": "[[parameters('principalId')]",
                            "principalType": "[[parameters('principalType')]",
                            "description": "[[parameters('description')]"
                          }
                        }
                      ],
                      "outputs": {
                        "roleAssignmentId": {
                          "type": "string",
                          "value": "[[extensionResourceId(parameters('scope'), 'Microsoft.Authorization/roleAssignments', parameters('name'))]"
                        }
                      }
                    }
                  },
                  "resources": [
                    {
                      "condition": "[parameters('enableTelemetry')]",
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2024-03-01",
                      "name": "[format('46d3xbcp.ptn.authorization-resourceroleassignment.{0}.{1}', replace('0.1.2', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                      "properties": {
                        "mode": "Incremental",
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "resources": [],
                          "outputs": {
                            "telemetry": {
                              "type": "String",
                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                            }
                          }
                        }
                      }
                    },
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2023-07-01",
                      "name": "[format('{0}-ResourceRoleAssignment', guid(parameters('resourceId'), parameters('principalId'), parameters('roleDefinitionId')))]",
                      "properties": {
                        "mode": "Incremental",
                        "expressionEvaluationOptions": {
                          "scope": "Outer"
                        },
                        "template": "[variables('$fxv#0')]",
                        "parameters": {
                          "scope": {
                            "value": "[parameters('resourceId')]"
                          },
                          "name": {
                            "value": "[parameters('name')]"
                          },
                          "roleDefinitionId": {
                            "value": "[if(contains(parameters('roleDefinitionId'), '/providers/Microsoft.Authorization/roleDefinitions/'), parameters('roleDefinitionId'), subscriptionResourceId('Microsoft.Authorization/roleDefinitions', parameters('roleDefinitionId')))]"
                          },
                          "principalId": {
                            "value": "[parameters('principalId')]"
                          },
                          "principalType": {
                            "value": "[parameters('principalType')]"
                          },
                          "description": {
                            "value": "[parameters('description')]"
                          }
                        }
                      }
                    }
                  ],
                  "outputs": {
                    "name": {
                      "type": "string",
                      "metadata": {
                        "description": "The GUID of the Role Assignment."
                      },
                      "value": "[parameters('name')]"
                    },
                    "roleName": {
                      "type": "string",
                      "metadata": {
                        "description": "The name for the role, used for logging."
                      },
                      "value": "[parameters('roleName')]"
                    },
                    "resourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "The resource ID of the Role Assignment."
                      },
                      "value": "[reference(resourceId('Microsoft.Resources/deployments', format('{0}-ResourceRoleAssignment', guid(parameters('resourceId'), parameters('principalId'), parameters('roleDefinitionId')))), '2023-07-01').outputs.roleAssignmentId.value]"
                    },
                    "resourceGroupName": {
                      "type": "string",
                      "metadata": {
                        "description": "The name of the resource group the role assignment was applied at."
                      },
                      "value": "[resourceGroup().name]"
                    }
                  }
                }
              },
              "dependsOn": [
                "dataFactory",
                "existingManagedIdentity",
                "managedIdentity"
              ]
            },
            "deployerStorageRoleAssignment": {
              "condition": "[not(empty(parameters('deployerPrincipalId')))]",
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-deployer-storage-role', uniqueString(deployment().name, parameters('location')))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "resourceId": {
                    "value": "[reference('storageAccount').outputs.resourceId.value]"
                  },
                  "principalId": {
                    "value": "[parameters('deployerPrincipalId')]"
                  },
                  "roleDefinitionId": {
                    "value": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'ba92f5b4-2d11-453d-a403-e96b0029c9fe')]"
                  },
                  "principalType": {
                    "value": "User"
                  },
                  "enableTelemetry": {
                    "value": "[parameters('enableTelemetry')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.32.4.45862",
                      "templateHash": "14634305923902101494"
                    },
                    "name": "Resource-scoped role assignment",
                    "description": "This module deploys a Role Assignment for a specific resource."
                  },
                  "parameters": {
                    "resourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. The scope for the role assignment, fully qualified resourceId."
                      }
                    },
                    "name": {
                      "type": "string",
                      "defaultValue": "[guid(parameters('resourceId'), parameters('principalId'), if(contains(parameters('roleDefinitionId'), '/providers/Microsoft.Authorization/roleDefinitions/'), parameters('roleDefinitionId'), subscriptionResourceId('Microsoft.Authorization/roleDefinitions', parameters('roleDefinitionId'))))]",
                      "metadata": {
                        "description": "Optional. The unique guid name for the role assignment."
                      }
                    },
                    "roleDefinitionId": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. The role definition ID for the role assignment."
                      }
                    },
                    "roleName": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Optional. The name for the role, used for logging."
                      }
                    },
                    "principalId": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. The Principal or Object ID of the Security Principal (User, Group, Service Principal, Managed Identity)."
                      }
                    },
                    "principalType": {
                      "type": "string",
                      "defaultValue": "",
                      "allowedValues": [
                        "ServicePrincipal",
                        "Group",
                        "User",
                        "ForeignGroup",
                        "Device",
                        ""
                      ],
                      "metadata": {
                        "description": "Optional. The principal type of the assigned principal ID."
                      }
                    },
                    "description": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Optional. The description of role assignment."
                      }
                    },
                    "enableTelemetry": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Optional. Enable/Disable usage telemetry for module."
                      }
                    }
                  },
                  "variables": {
                    "$fxv#0": {
                      "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                      "contentVersion": "1.0.0.0",
                      "parameters": {
                        "scope": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "roleDefinitionId": {
                          "type": "string"
                        },
                        "principalId": {
                          "type": "string"
                        },
                        "principalType": {
                          "type": "string",
                          "allowedValues": [
                            "Device",
                            "ForeignGroup",
                            "Group",
                            "ServicePrincipal",
                            "User",
                            ""
                          ],
                          "defaultValue": "",
                          "metadata": {
                            "description": "Optional. The principal type of the assigned principal ID."
                          }
                        },
                        "description": {
                          "type": "string"
                        }
                      },
                      "resources": [
                        {
                          "type": "Microsoft.Authorization/roleAssignments",
                          "apiVersion": "2022-04-01",
                          "scope": "[[parameters('scope')]",
                          "name": "[[parameters('name')]",
                          "properties": {
                            "roleDefinitionId": "[[parameters('roleDefinitionId')]",
                            "principalId": "[[parameters('principalId')]",
                            "principalType": "[[parameters('principalType')]",
                            "description": "[[parameters('description')]"
                          }
                        }
                      ],
                      "outputs": {
                        "roleAssignmentId": {
                          "type": "string",
                          "value": "[[extensionResourceId(parameters('scope'), 'Microsoft.Authorization/roleAssignments', parameters('name'))]"
                        }
                      }
                    }
                  },
                  "resources": [
                    {
                      "condition": "[parameters('enableTelemetry')]",
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2024-03-01",
                      "name": "[format('46d3xbcp.ptn.authorization-resourceroleassignment.{0}.{1}', replace('0.1.2', '.', '-'), substring(uniqueString(deployment().name), 0, 4))]",
                      "properties": {
                        "mode": "Incremental",
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "resources": [],
                          "outputs": {
                            "telemetry": {
                              "type": "String",
                              "value": "For more information, see https://aka.ms/avm/TelemetryInfo"
                            }
                          }
                        }
                      }
                    },
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2023-07-01",
                      "name": "[format('{0}-ResourceRoleAssignment', guid(parameters('resourceId'), parameters('principalId'), parameters('roleDefinitionId')))]",
                      "properties": {
                        "mode": "Incremental",
                        "expressionEvaluationOptions": {
                          "scope": "Outer"
                        },
                        "template": "[variables('$fxv#0')]",
                        "parameters": {
                          "scope": {
                            "value": "[parameters('resourceId')]"
                          },
                          "name": {
                            "value": "[parameters('name')]"
                          },
                          "roleDefinitionId": {
                            "value": "[if(contains(parameters('roleDefinitionId'), '/providers/Microsoft.Authorization/roleDefinitions/'), parameters('roleDefinitionId'), subscriptionResourceId('Microsoft.Authorization/roleDefinitions', parameters('roleDefinitionId')))]"
                          },
                          "principalId": {
                            "value": "[parameters('principalId')]"
                          },
                          "principalType": {
                            "value": "[parameters('principalType')]"
                          },
                          "description": {
                            "value": "[parameters('description')]"
                          }
                        }
                      }
                    }
                  ],
                  "outputs": {
                    "name": {
                      "type": "string",
                      "metadata": {
                        "description": "The GUID of the Role Assignment."
                      },
                      "value": "[parameters('name')]"
                    },
                    "roleName": {
                      "type": "string",
                      "metadata": {
                        "description": "The name for the role, used for logging."
                      },
                      "value": "[parameters('roleName')]"
                    },
                    "resourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "The resource ID of the Role Assignment."
                      },
                      "value": "[reference(resourceId('Microsoft.Resources/deployments', format('{0}-ResourceRoleAssignment', guid(parameters('resourceId'), parameters('principalId'), parameters('roleDefinitionId')))), '2023-07-01').outputs.roleAssignmentId.value]"
                    },
                    "resourceGroupName": {
                      "type": "string",
                      "metadata": {
                        "description": "The name of the resource group the role assignment was applied at."
                      },
                      "value": "[resourceGroup().name]"
                    }
                  }
                }
              },
              "dependsOn": [
                "storageAccount"
              ]
            },
            "startTriggers": {
              "condition": "[parameters('enableTriggerManagement')]",
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-start-triggers', uniqueString(deployment().name, parameters('location')))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "dataFactoryName": {
                    "value": "[reference('dataFactory').outputs.name.value]"
                  },
                  "resourceGroupName": {
                    "value": "[resourceGroup().name]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "managedIdentityResourceId": "[if(variables('useExistingIdentity'), createObject('value', parameters('existingManagedIdentityResourceId')), createObject('value', reference('managedIdentity').outputs.resourceId.value))]",
                  "storageAccountResourceId": {
                    "value": "[reference('storageAccount').outputs.resourceId.value]"
                  },
                  "operation": {
                    "value": "start"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.40.2.10011",
                      "templateHash": "9868901521815016226"
                    }
                  },
                  "parameters": {
                    "dataFactoryName": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. Name of the Data Factory."
                      }
                    },
                    "resourceGroupName": {
                      "type": "string",
                      "defaultValue": "[resourceGroup().name]",
                      "metadata": {
                        "description": "Required. Resource group name where Data Factory is located."
                      }
                    },
                    "location": {
                      "type": "string",
                      "defaultValue": "[resourceGroup().location]",
                      "metadata": {
                        "description": "Required. Location for the deployment script resources."
                      }
                    },
                    "managedIdentityResourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Required. Managed identity resource ID for running the scripts."
                      }
                    },
                    "storageAccountResourceId": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Optional. Existing storage account resource ID for deployment scripts. Uses the FinOps Hub storage account to avoid creating additional resources."
                      }
                    },
                    "operation": {
                      "type": "string",
                      "defaultValue": "start",
                      "allowedValues": [
                        "stop",
                        "start"
                      ],
                      "metadata": {
                        "description": "Optional. Operation to perform: \"stop\" before deployment, \"start\" after deployment."
                      }
                    },
                    "triggerNames": {
                      "type": "array",
                      "defaultValue": [],
                      "metadata": {
                        "description": "Optional. Trigger names to manage. Empty means all triggers."
                      }
                    },
                    "forceRun": {
                      "type": "string",
                      "defaultValue": "[utcNow()]",
                      "metadata": {
                        "description": "Optional. Force script to run even if nothing changed (use timestamp)."
                      }
                    },
                    "timeout": {
                      "type": "string",
                      "defaultValue": "PT10M",
                      "metadata": {
                        "description": "Optional. Timeout for the script execution."
                      }
                    }
                  },
                  "variables": {
                    "stopScript": "$ErrorActionPreference = 'Continue'\n$factory = $env:ADF_NAME\n$rg = $env:RESOURCE_GROUP\n$subId = $env:SUBSCRIPTION_ID\n$specificTriggers = $env:TRIGGER_NAMES\n\nWrite-Output \"=== Stop Triggers Script ===\"\nWrite-Output \"Data Factory: $factory\"\nWrite-Output \"Resource Group: $rg\"\nWrite-Output \"Subscription: $subId\"\n\ntry {\n    # Get access token using managed identity\n    $token = (Get-AzAccessToken -ResourceUrl 'https://management.azure.com').Token\n    $headers = @{ \n        'Authorization' = \"Bearer $token\"\n        'Content-Type' = 'application/json'\n    }\n    \n    # Check if ADF exists\n    $adfUri = \"https://management.azure.com/subscriptions/$subId/resourceGroups/$rg/providers/Microsoft.DataFactory/factories/$factory?api-version=2018-06-01\"\n    try {\n        $adfCheck = Invoke-RestMethod -Uri $adfUri -Method Get -Headers $headers -ErrorAction Stop\n        Write-Output \"Data Factory exists: $($adfCheck.name)\"\n    } catch {\n        if ($_.Exception.Response.StatusCode -eq 'NotFound') {\n            Write-Output \"Data Factory does not exist yet (first deployment). Skipping trigger stop.\"\n            $DeploymentScriptOutputs = @{ stoppedTriggers = @(); status = \"skipped-not-found\"; triggersCount = 0 }\n            exit 0\n        }\n        throw\n    }\n    \n    # List all triggers\n    $listUri = \"https://management.azure.com/subscriptions/$subId/resourceGroups/$rg/providers/Microsoft.DataFactory/factories/$factory/triggers?api-version=2018-06-01\"\n    $triggersResponse = Invoke-RestMethod -Uri $listUri -Method Get -Headers $headers\n    \n    $stoppedList = @()\n    foreach ($trigger in $triggersResponse.value) {\n        $triggerName = $trigger.name\n        $state = $trigger.properties.runtimeState\n        \n        # Skip if not started or if specific triggers specified and this isn't one of them\n        if ($state -ne 'Started') {\n            Write-Output \"Trigger $triggerName is already $state - skipping\"\n            continue\n        }\n        \n        if (-not [string]::IsNullOrEmpty($specificTriggers) -and $specificTriggers -notcontains $triggerName) {\n            continue\n        }\n        \n        Write-Output \"Stopping trigger: $triggerName (currently $state)\"\n        $stopUri = \"https://management.azure.com/subscriptions/$subId/resourceGroups/$rg/providers/Microsoft.DataFactory/factories/$factory/triggers/$triggerName/stop?api-version=2018-06-01\"\n        try {\n            Invoke-RestMethod -Uri $stopUri -Method Post -Headers $headers\n            $stoppedList += $triggerName\n            Write-Output \"  Successfully stopped: $triggerName\"\n        } catch {\n            Write-Output \"  Warning: Failed to stop $triggerName - $($_.Exception.Message)\"\n        }\n    }\n\n    Write-Output \"=== Summary ===\"\n    Write-Output \"Stopped $($stoppedList.Count) triggers\"\n    $DeploymentScriptOutputs = @{ \n        stoppedTriggers = $stoppedList\n        status = \"completed\"\n        triggersCount = $stoppedList.Count\n    }\n} catch {\n    Write-Output \"Error: $_\"\n    # Don't fail the deployment if we can't stop triggers\n    $DeploymentScriptOutputs = @{ stoppedTriggers = @(); status = \"error\"; error = $_.ToString(); triggersCount = 0 }\n}\n",
                    "startScript": "$ErrorActionPreference = 'Stop'\n$factory = $env:ADF_NAME\n$rg = $env:RESOURCE_GROUP\n$subId = $env:SUBSCRIPTION_ID\n$specificTriggers = $env:TRIGGER_NAMES\n\nWrite-Output \"=== Start Triggers Script ===\"\nWrite-Output \"Data Factory: $factory\"\nWrite-Output \"Resource Group: $rg\"\nWrite-Output \"Subscription: $subId\"\n\ntry {\n    # Get access token using managed identity\n    $token = (Get-AzAccessToken -ResourceUrl 'https://management.azure.com').Token\n    $headers = @{ \n        'Authorization' = \"Bearer $token\"\n        'Content-Type' = 'application/json'\n    }\n    \n    # List all triggers\n    $listUri = \"https://management.azure.com/subscriptions/$subId/resourceGroups/$rg/providers/Microsoft.DataFactory/factories/$factory/triggers?api-version=2018-06-01\"\n    $triggersResponse = Invoke-RestMethod -Uri $listUri -Method Get -Headers $headers\n    \n    $startedList = @()\n    $failedList = @()\n    \n    foreach ($trigger in $triggersResponse.value) {\n        $triggerName = $trigger.name\n        $state = $trigger.properties.runtimeState\n        \n        # Skip if already started\n        if ($state -eq 'Started') {\n            Write-Output \"Trigger $triggerName is already Started - skipping\"\n            continue\n        }\n        \n        # Skip if specific triggers specified and this isn't one of them\n        if (-not [string]::IsNullOrEmpty($specificTriggers) -and $specificTriggers -notcontains $triggerName) {\n            continue\n        }\n        \n        Write-Output \"Starting trigger: $triggerName (currently $state)\"\n        $startUri = \"https://management.azure.com/subscriptions/$subId/resourceGroups/$rg/providers/Microsoft.DataFactory/factories/$factory/triggers/$triggerName/start?api-version=2018-06-01\"\n        try {\n            Invoke-RestMethod -Uri $startUri -Method Post -Headers $headers\n            $startedList += $triggerName\n            Write-Output \"  Successfully started: $triggerName\"\n        } catch {\n            $failedList += $triggerName\n            Write-Output \"  Warning: Failed to start $triggerName - $($_.Exception.Message)\"\n        }\n    }\n\n    Write-Output \"=== Summary ===\"\n    Write-Output \"Started: $($startedList.Count) triggers\"\n    Write-Output \"Failed: $($failedList.Count) triggers\"\n    \n    if ($failedList.Count -gt 0) {\n        Write-Warning \"Some triggers failed to start. Check EventGrid subscription registration.\"\n    }\n    \n    $DeploymentScriptOutputs = @{ \n        startedTriggers = $startedList\n        failedTriggers = $failedList\n        status = if ($failedList.Count -eq 0) { \"completed\" } else { \"partial\" }\n        triggersCount = $startedList.Count\n    }\n} catch {\n    Write-Output \"Error: $_\"\n    throw\n}\n"
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Resources/deploymentScripts",
                      "apiVersion": "2023-08-01",
                      "name": "[format('ds-{0}-triggers-{1}', parameters('operation'), take(uniqueString(parameters('dataFactoryName'), parameters('forceRun')), 8))]",
                      "location": "[parameters('location')]",
                      "kind": "AzurePowerShell",
                      "identity": {
                        "type": "UserAssigned",
                        "userAssignedIdentities": {
                          "[format('{0}', parameters('managedIdentityResourceId'))]": {}
                        }
                      },
                      "properties": {
                        "azPowerShellVersion": "12.0",
                        "timeout": "[parameters('timeout')]",
                        "retentionInterval": "PT1H",
                        "cleanupPreference": "OnSuccess",
                        "forceUpdateTag": "[parameters('forceRun')]",
                        "storageAccountSettings": "[if(not(empty(parameters('storageAccountResourceId'))), createObject('storageAccountKey', null(), 'storageAccountName', last(split(parameters('storageAccountResourceId'), '/'))), null())]",
                        "environmentVariables": [
                          {
                            "name": "ADF_NAME",
                            "value": "[parameters('dataFactoryName')]"
                          },
                          {
                            "name": "RESOURCE_GROUP",
                            "value": "[parameters('resourceGroupName')]"
                          },
                          {
                            "name": "SUBSCRIPTION_ID",
                            "value": "[subscription().subscriptionId]"
                          },
                          {
                            "name": "TRIGGER_NAMES",
                            "value": "[join(parameters('triggerNames'), ',')]"
                          }
                        ],
                        "scriptContent": "[if(equals(parameters('operation'), 'stop'), variables('stopScript'), variables('startScript'))]"
                      }
                    }
                  ],
                  "outputs": {
                    "managedTriggers": {
                      "type": "array",
                      "metadata": {
                        "description": "List of triggers that were managed."
                      },
                      "value": "[if(and(contains(reference(resourceId('Microsoft.Resources/deploymentScripts', format('ds-{0}-triggers-{1}', parameters('operation'), take(uniqueString(parameters('dataFactoryName'), parameters('forceRun')), 8))), '2023-08-01'), 'outputs'), not(equals(reference(resourceId('Microsoft.Resources/deploymentScripts', format('ds-{0}-triggers-{1}', parameters('operation'), take(uniqueString(parameters('dataFactoryName'), parameters('forceRun')), 8))), '2023-08-01').outputs, null()))), if(equals(parameters('operation'), 'stop'), if(contains(reference(resourceId('Microsoft.Resources/deploymentScripts', format('ds-{0}-triggers-{1}', parameters('operation'), take(uniqueString(parameters('dataFactoryName'), parameters('forceRun')), 8))), '2023-08-01').outputs, 'stoppedTriggers'), reference(resourceId('Microsoft.Resources/deploymentScripts', format('ds-{0}-triggers-{1}', parameters('operation'), take(uniqueString(parameters('dataFactoryName'), parameters('forceRun')), 8))), '2023-08-01').outputs.stoppedTriggers, createArray()), if(contains(reference(resourceId('Microsoft.Resources/deploymentScripts', format('ds-{0}-triggers-{1}', parameters('operation'), take(uniqueString(parameters('dataFactoryName'), parameters('forceRun')), 8))), '2023-08-01').outputs, 'startedTriggers'), reference(resourceId('Microsoft.Resources/deploymentScripts', format('ds-{0}-triggers-{1}', parameters('operation'), take(uniqueString(parameters('dataFactoryName'), parameters('forceRun')), 8))), '2023-08-01').outputs.startedTriggers, createArray())), createArray())]"
                    },
                    "status": {
                      "type": "string",
                      "metadata": {
                        "description": "Script execution status."
                      },
                      "value": "[if(and(and(contains(reference(resourceId('Microsoft.Resources/deploymentScripts', format('ds-{0}-triggers-{1}', parameters('operation'), take(uniqueString(parameters('dataFactoryName'), parameters('forceRun')), 8))), '2023-08-01'), 'outputs'), not(equals(reference(resourceId('Microsoft.Resources/deploymentScripts', format('ds-{0}-triggers-{1}', parameters('operation'), take(uniqueString(parameters('dataFactoryName'), parameters('forceRun')), 8))), '2023-08-01').outputs, null()))), contains(reference(resourceId('Microsoft.Resources/deploymentScripts', format('ds-{0}-triggers-{1}', parameters('operation'), take(uniqueString(parameters('dataFactoryName'), parameters('forceRun')), 8))), '2023-08-01').outputs, 'status')), reference(resourceId('Microsoft.Resources/deploymentScripts', format('ds-{0}-triggers-{1}', parameters('operation'), take(uniqueString(parameters('dataFactoryName'), parameters('forceRun')), 8))), '2023-08-01').outputs.status, 'unknown')]"
                    },
                    "triggerCount": {
                      "type": "int",
                      "metadata": {
                        "description": "Number of triggers managed."
                      },
                      "value": "[if(and(and(contains(reference(resourceId('Microsoft.Resources/deploymentScripts', format('ds-{0}-triggers-{1}', parameters('operation'), take(uniqueString(parameters('dataFactoryName'), parameters('forceRun')), 8))), '2023-08-01'), 'outputs'), not(equals(reference(resourceId('Microsoft.Resources/deploymentScripts', format('ds-{0}-triggers-{1}', parameters('operation'), take(uniqueString(parameters('dataFactoryName'), parameters('forceRun')), 8))), '2023-08-01').outputs, null()))), contains(reference(resourceId('Microsoft.Resources/deploymentScripts', format('ds-{0}-triggers-{1}', parameters('operation'), take(uniqueString(parameters('dataFactoryName'), parameters('forceRun')), 8))), '2023-08-01').outputs, 'triggersCount')), reference(resourceId('Microsoft.Resources/deploymentScripts', format('ds-{0}-triggers-{1}', parameters('operation'), take(uniqueString(parameters('dataFactoryName'), parameters('forceRun')), 8))), '2023-08-01').outputs.triggersCount, 0)]"
                    },
                    "scriptResourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Deployment script resource ID."
                      },
                      "value": "[resourceId('Microsoft.Resources/deploymentScripts', format('ds-{0}-triggers-{1}', parameters('operation'), take(uniqueString(parameters('dataFactoryName'), parameters('forceRun')), 8)))]"
                    }
                  }
                }
              },
              "dependsOn": [
                "adxSchemaSetup",
                "approveAdxManagedPeConnections",
                "dataFactory",
                "dataFactoryResources",
                "managedIdentity",
                "storageAccount"
              ]
            }
          },
          "outputs": {
            "hubName": {
              "type": "string",
              "metadata": {
                "description": "Name of the deployed FinOps Hub."
              },
              "value": "[parameters('hubName')]"
            },
            "location": {
              "type": "string",
              "metadata": {
                "description": "Azure region where resources were deployed."
              },
              "value": "[parameters('location')]"
            },
            "resourceGroupName": {
              "type": "string",
              "metadata": {
                "description": "Resource group name."
              },
              "value": "[resourceGroup().name]"
            },
            "storageAccountName": {
              "type": "string",
              "metadata": {
                "description": "Storage account name."
              },
              "value": "[reference('storageAccount').outputs.name.value]"
            },
            "storageAccountId": {
              "type": "string",
              "metadata": {
                "description": "Storage account resource ID."
              },
              "value": "[reference('storageAccount').outputs.resourceId.value]"
            },
            "storageBlobEndpoint": {
              "type": "string",
              "metadata": {
                "description": "Storage account primary blob endpoint."
              },
              "value": "[reference('storageAccount').outputs.primaryBlobEndpoint.value]"
            },
            "storageUrlForPowerBI": {
              "type": "string",
              "metadata": {
                "description": "URL for Power BI connection to ingestion container."
              },
              "value": "[format('https://{0}.dfs.{1}/ingestion', variables('storageAccountName'), environment().suffixes.storage)]"
            },
            "keyVaultName": {
              "type": "string",
              "metadata": {
                "description": "Key Vault name."
              },
              "value": "[reference('keyVault').outputs.name.value]"
            },
            "keyVaultId": {
              "type": "string",
              "metadata": {
                "description": "Key Vault resource ID."
              },
              "value": "[reference('keyVault').outputs.resourceId.value]"
            },
            "keyVaultUri": {
              "type": "string",
              "metadata": {
                "description": "Key Vault URI."
              },
              "value": "[reference('keyVault').outputs.uri.value]"
            },
            "dataFactoryName": {
              "type": "string",
              "metadata": {
                "description": "Data Factory name."
              },
              "value": "[reference('dataFactory').outputs.name.value]"
            },
            "dataFactoryId": {
              "type": "string",
              "metadata": {
                "description": "Data Factory resource ID."
              },
              "value": "[reference('dataFactory').outputs.resourceId.value]"
            },
            "dataFactoryPrincipalId": {
              "type": "string",
              "metadata": {
                "description": "Data Factory managed identity principal ID (for configuring managed exports)."
              },
              "value": "[reference('dataFactory').outputs.systemAssignedMIPrincipalId.value]"
            },
            "managedIdentityName": {
              "type": "string",
              "metadata": {
                "description": "User-assigned managed identity name."
              },
              "value": "[if(variables('useExistingIdentity'), variables('existingIdentityName'), reference('managedIdentity').outputs.name.value)]"
            },
            "managedIdentityResourceId": {
              "type": "string",
              "metadata": {
                "description": "User-assigned managed identity resource ID."
              },
              "value": "[if(variables('useExistingIdentity'), parameters('existingManagedIdentityResourceId'), reference('managedIdentity').outputs.resourceId.value)]"
            },
            "managedIdentityPrincipalId": {
              "type": "string",
              "metadata": {
                "description": "User-assigned managed identity principal ID (object ID)."
              },
              "value": "[if(variables('useExistingIdentity'), reference('existingManagedIdentity').principalId, reference('managedIdentity').outputs.principalId.value)]"
            },
            "managedIdentityClientId": {
              "type": "string",
              "metadata": {
                "description": "User-assigned managed identity client ID (application ID)."
              },
              "value": "[if(variables('useExistingIdentity'), reference('existingManagedIdentity').clientId, reference('managedIdentity').outputs.clientId.value)]"
            },
            "tenantId": {
              "type": "string",
              "metadata": {
                "description": "Azure AD tenant ID (for configuring managed exports)."
              },
              "value": "[tenant().tenantId]"
            },
            "dataExplorerName": {
              "type": "string",
              "metadata": {
                "description": "Data Explorer cluster name. Returns existing cluster name if using existing, or new cluster name if created."
              },
              "value": "[if(variables('useExistingAdx'), variables('existingAdxClusterName'), if(and(variables('createNewAdx'), not(equals(reference('dataExplorer'), null()))), reference('dataExplorer').outputs.name.value, ''))]"
            },
            "dataExplorerEndpoint": {
              "type": "string",
              "metadata": {
                "description": "Data Explorer cluster endpoint. For Fabric, returns the Eventhouse query URI."
              },
              "value": "[if(variables('useExistingAdx'), format('https://{0}.{1}.kusto.windows.net', variables('existingAdxClusterName'), parameters('location')), if(and(variables('createNewAdx'), not(equals(reference('dataExplorer'), null()))), format('https://{0}.{1}.kusto.windows.net', reference('dataExplorer').outputs.name.value, parameters('location')), if(variables('useFabric'), parameters('fabricQueryUri'), '')))]"
            },
            "dataExplorerResourceId": {
              "type": "string",
              "metadata": {
                "description": "Data Explorer cluster resource ID. Returns existing cluster ID if using existing."
              },
              "value": "[if(variables('useExistingAdx'), parameters('existingDataExplorerClusterId'), if(and(variables('createNewAdx'), not(equals(reference('dataExplorer'), null()))), reference('dataExplorer').outputs.resourceId.value, ''))]"
            },
            "fabricEventhouseQueryUri": {
              "type": "string",
              "metadata": {
                "description": "Fabric eventhouse query URI. Empty if not using Fabric."
              },
              "value": "[if(variables('useFabric'), parameters('fabricQueryUri'), '')]"
            },
            "fabricEventhouseIngestionUri": {
              "type": "string",
              "metadata": {
                "description": "Fabric eventhouse ingestion URI. Empty if not using Fabric."
              },
              "value": "[if(variables('useFabric'), parameters('fabricIngestionUri'), '')]"
            },
            "fabricDatabase": {
              "type": "string",
              "metadata": {
                "description": "Fabric database name. Empty if not using Fabric."
              },
              "value": "[if(variables('useFabric'), parameters('fabricDatabaseName'), '')]"
            },
            "dataFactoryPipelines": {
              "type": "array",
              "metadata": {
                "description": "List of core Data Factory pipelines (msexports, ingestion)."
              },
              "value": "[reference('dataFactoryResources').outputs.pipelineNames.value]"
            },
            "dataFactoryTriggers": {
              "type": "array",
              "metadata": {
                "description": "List of core Data Factory triggers."
              },
              "value": "[reference('dataFactoryResources').outputs.triggerNames.value]"
            },
            "managedExportsEnabled": {
              "type": "bool",
              "metadata": {
                "description": "Indicates whether managed export pipelines are deployed. Only true for EA/MCA/MPA with scopes."
              },
              "value": "[variables('enableManagedExports')]"
            },
            "managedExportsPipelines": {
              "type": "array",
              "metadata": {
                "description": "List of managed export pipelines. Empty if not using managed exports."
              },
              "value": "[if(variables('enableManagedExports'), reference('managedExportsPipelines').outputs.pipelineNames.value, createArray())]"
            },
            "managedExportsTriggers": {
              "type": "array",
              "metadata": {
                "description": "List of managed export triggers. Empty if not using managed exports."
              },
              "value": "[if(variables('enableManagedExports'), reference('managedExportsPipelines').outputs.triggerNames.value, createArray())]"
            },
            "analyticsPlatform": {
              "type": "string",
              "metadata": {
                "description": "Analytics platform configured (adx, fabric, or none)."
              },
              "value": "[reference('dataFactoryResources').outputs.analyticsPlatform.value]"
            },
            "maccEnabled": {
              "type": "bool",
              "metadata": {
                "description": "Indicates whether MACC (Microsoft Azure Consumption Commitment) tracking is enabled."
              },
              "value": "[reference('dataFactoryResources').outputs.maccEnabled.value]"
            },
            "adxSchemaDeployed": {
              "type": "bool",
              "metadata": {
                "description": "Indicates whether ADX schema was deployed."
              },
              "value": "[variables('deployAdxSchema')]"
            },
            "adxSchemaComponents": {
              "type": "array",
              "metadata": {
                "description": "List of schema components deployed to ADX. Empty if schema not deployed."
              },
              "value": "[if(and(variables('deployAdxSchema'), not(equals(reference('adxSchemaSetup'), null()))), reference('adxSchemaSetup').outputs.deployedComponents.value, createArray())]"
            },
            "networkIsolationMode": {
              "type": "string",
              "metadata": {
                "description": "Network isolation mode used for this deployment."
              },
              "value": "[variables('effectiveNetworkIsolationMode')]"
            },
            "vnetResourceId": {
              "type": "string",
              "metadata": {
                "description": "VNet resource ID. Only populated when networkIsolationMode is \"Managed\"."
              },
              "value": "[if(equals(variables('effectiveNetworkIsolationMode'), 'Managed'), reference('managedNetwork').outputs.vnetResourceId.value, '')]"
            },
            "privateEndpointSubnetResourceId": {
              "type": "string",
              "metadata": {
                "description": "Private endpoint subnet resource ID. Empty when networkIsolationMode is \"None\"."
              },
              "value": "[if(equals(variables('effectiveNetworkIsolationMode'), 'Managed'), reference('managedNetwork').outputs.subnetResourceId.value, if(equals(variables('effectiveNetworkIsolationMode'), 'BringYourOwn'), if(not(empty(parameters('byoSubnetResourceId'))), parameters('byoSubnetResourceId'), parameters('privateEndpointSubnetId')), ''))]"
            },
            "billingAccountTypeHint": {
              "type": "string",
              "metadata": {
                "description": "Billing account type. Use to determine export support."
              },
              "value": "[parameters('billingAccountType')]"
            },
            "exportSupported": {
              "type": "bool",
              "metadata": {
                "description": "Whether Cost Management exports are supported."
              },
              "value": "[contains(createArray('ea', 'mca', 'mpa', 'auto'), parameters('billingAccountType'))]"
            },
            "configuredScopes": {
              "type": "array",
              "metadata": {
                "description": "Scopes configured for monitoring."
              },
              "value": "[parameters('scopesToMonitor')]"
            },
            "scopeCount": {
              "type": "int",
              "metadata": {
                "description": "Number of scopes configured for monitoring."
              },
              "value": "[length(parameters('scopesToMonitor'))]"
            },
            "deploymentMode": {
              "type": "string",
              "metadata": {
                "description": "Deployment mode: enterprise, demo, or hybrid."
              },
              "value": "[if(or(or(empty(parameters('scopesToMonitor')), equals(parameters('billingAccountType'), 'paygo')), equals(parameters('billingAccountType'), 'csp')), 'demo', if(contains(createArray('ea', 'mca', 'mpa'), parameters('billingAccountType')), 'enterprise', 'hybrid'))]"
            },
            "exportConfiguration": {
              "type": "object",
              "metadata": {
                "description": "Cost Management export configuration."
              },
              "value": {
                "storageAccountId": "[reference('storageAccount').outputs.resourceId.value]",
                "storageAccountName": "[reference('storageAccount').outputs.name.value]",
                "msexportsContainer": "msexports",
                "ingestionContainer": "ingestion",
                "configContainer": "config",
                "exportSupported": "[contains(createArray('ea', 'mca', 'mpa', 'auto'), parameters('billingAccountType'))]",
                "billingType": "[parameters('billingAccountType')]",
                "scopeCount": "[length(parameters('scopesToMonitor'))]",
                "exportCommandTemplate": "[format('New-FinOpsCostExport -Name \"FinOpsHub-{0}\" -Scope \"<YOUR-SCOPE-ID>\" -StorageAccountId \"{1}\" -StorageContainer \"msexports\" -Dataset FocusCost -Execute -Backfill 3', parameters('hubName'), reference('storageAccount').outputs.resourceId.value)]",
                "demoCommands": {
                  "generateTestData": "[format('.\\src\\Generate-MultiCloudTestData.ps1 -Upload -StorageAccountName \"{0}\" -CloudProvider Azure -TotalBudget 30000 -MonthsOfData 3', reference('storageAccount').outputs.name.value)]",
                  "generateMultiCloudData": "[format('.\\src\\Generate-MultiCloudTestData.ps1 -Upload -StorageAccountName \"{0}\" -TotalBudget 100000', reference('storageAccount').outputs.name.value)]"
                }
              }
            },
            "settingsJson": {
              "type": "object",
              "metadata": {
                "description": "Settings.json content for the config container."
              },
              "value": {
                "$schema": "https://aka.ms/finops/hubs/settings-schema",
                "type": "HubInstance",
                "version": "1.0.0",
                "hubName": "[parameters('hubName')]",
                "learnMore": "https://aka.ms/finops/hubs",
                "scopes": "[variables('settingsJsonScopes')]",
                "deployment": {
                  "mode": "[if(or(empty(parameters('scopesToMonitor')), equals(parameters('billingAccountType'), 'paygo')), 'demo', 'enterprise')]",
                  "billingType": "[parameters('billingAccountType')]",
                  "exportSupported": "[contains(createArray('ea', 'mca', 'mpa', 'auto'), parameters('billingAccountType'))]",
                  "storageAccount": "[reference('storageAccount').outputs.name.value]",
                  "resourceGroup": "[resourceGroup().name]",
                  "location": "[parameters('location')]"
                }
              }
            },
            "gettingStartedGuide": {
              "type": "object",
              "metadata": {
                "description": "Getting started guide based on deployment mode."
              },
              "value": {
                "mode": "[if(or(or(empty(parameters('scopesToMonitor')), equals(parameters('billingAccountType'), 'paygo')), equals(parameters('billingAccountType'), 'csp')), 'demo', 'enterprise')]",
                "demoModeSteps": [
                  "1. Navigate to the src/ folder in this module",
                  "[format('2. Run: .\\Generate-MultiCloudTestData.ps1 -Upload -StorageAccountName \"{0}\"', reference('storageAccount').outputs.name.value)]",
                  "3. Wait ~5 minutes for ADF pipelines to process the data",
                  "4. Query data in ADX: Hub database > Costs table",
                  "Note: Demo mode generates realistic FOCUS 1.0-1.3 test data (~$100K total across 3 months)"
                ],
                "enterpriseModeSteps": [
                  "1. Install FinOps Toolkit: Install-Module FinOpsToolkit -Force",
                  "2. Create exports for each scope using the exportCommandTemplate",
                  "3. Wait for first export to run (can take up to 24 hours for initial export)",
                  "4. ADF pipelines will automatically process data as it arrives",
                  "5. Query data in ADX: Hub database > Costs table",
                  "Note: Backfill historical data with -Backfill parameter (up to 13 months)"
                ],
                "commonSteps": [
                  "[format('Connect Power BI using the Data Explorer endpoint: {0}', if(variables('useExistingAdx'), format('https://{0}.{1}.kusto.windows.net', variables('existingAdxClusterName'), parameters('location')), if(and(variables('createNewAdx'), not(equals(reference('dataExplorer'), null()))), format('https://{0}.{1}.kusto.windows.net', reference('dataExplorer').outputs.name.value, parameters('location')), 'N/A')))]",
                  "Create ADX dashboard for cost visualization",
                  "Set up alerts using ADX alerting or Azure Monitor"
                ],
                "troubleshooting": {
                  "noData": "Check ADF pipeline runs in Data Factory Studio > Monitor",
                  "exportErrors": "Verify ADF managed identity has Cost Management Reader on billing scope",
                  "testDataUpload": "Ensure your IP is allowed in storage firewall, or use -SkipFirewallConfig"
                },
                "exportSupportMatrix": {
                  "ea": "Full support: FOCUS Costs, Prices, Reservation Details/Recommendations/Transactions",
                  "mca": "Full support: FOCUS Costs, Prices, Reservation Details/Recommendations/Transactions",
                  "subscription": "Limited: FOCUS Costs only (no pricing or reservation data)",
                  "resourceGroup": "Very limited: Resource group costs only",
                  "paygo": "Not supported: Use Demo mode with test data scripts"
                }
              }
            }
          }
        }
      },
      "dependsOn": [
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('resourceGroupName')), 'Microsoft.Resources/deployments', format('{0}-dependencies', uniqueString(deployment().name, variables('enforcedLocation'))))]",
        "[subscriptionResourceId('Microsoft.Resources/resourceGroups', parameters('resourceGroupName'))]"
      ]
    }
  ]
}