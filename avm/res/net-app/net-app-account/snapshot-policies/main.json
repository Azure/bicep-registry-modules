{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "languageVersion": "2.0",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "_generator": {
      "name": "bicep",
      "version": "0.31.92.45157",
      "templateHash": "2653371542359349223"
    },
    "name": "Azure NetApp Files Snapshot Policy",
    "description": "This module deploys a Snapshot Policy for an Azure NetApp File.",
    "owner": "Azure/module-maintainers"
  },
  "definitions": {
    "dailyScheduleType": {
      "type": "object",
      "properties": {
        "hour": {
          "type": "int",
          "nullable": true,
          "metadata": {
            "description": "Optional. The daily snapshot hour."
          }
        },
        "minute": {
          "type": "int",
          "nullable": true,
          "metadata": {
            "description": "Optional. The daily snapshot minute."
          }
        },
        "snapshotsToKeep": {
          "type": "int",
          "nullable": true,
          "metadata": {
            "description": "Optional. Daily snapshot count to keep."
          }
        },
        "usedBytes": {
          "type": "int",
          "nullable": true,
          "metadata": {
            "description": "Optional. Daily snapshot used bytes."
          }
        }
      },
      "metadata": {
        "__bicep_export!": true
      }
    },
    "hourlyScheduleType": {
      "type": "object",
      "properties": {
        "minute": {
          "type": "int",
          "nullable": true,
          "metadata": {
            "description": "Optional. The hourly snapshot minute."
          }
        },
        "snapshotsToKeep": {
          "type": "int",
          "nullable": true,
          "metadata": {
            "description": "Optional. Hourly snapshot count to keep."
          }
        },
        "usedBytes": {
          "type": "int",
          "nullable": true,
          "metadata": {
            "description": "Optional. Hourly snapshot used bytes."
          }
        }
      },
      "metadata": {
        "__bicep_export!": true
      }
    },
    "monthlyScheduleType": {
      "type": "object",
      "properties": {
        "daysOfMonth": {
          "type": "string",
          "nullable": true,
          "metadata": {
            "description": "Optional. The monthly snapshot day."
          }
        },
        "hour": {
          "type": "int",
          "nullable": true,
          "metadata": {
            "description": "Optional. The monthly snapshot hour."
          }
        },
        "minute": {
          "type": "int",
          "nullable": true,
          "metadata": {
            "description": "Optional. The monthly snapshot minute."
          }
        },
        "snapshotsToKeep": {
          "type": "int",
          "nullable": true,
          "metadata": {
            "description": "Optional. Monthly snapshot count to keep."
          }
        },
        "usedBytes": {
          "type": "int",
          "nullable": true,
          "metadata": {
            "description": "Optional. Monthly snapshot used bytes."
          }
        }
      },
      "metadata": {
        "__bicep_export!": true
      }
    },
    "weeklyScheduleType": {
      "type": "object",
      "properties": {
        "day": {
          "type": "string",
          "nullable": true,
          "metadata": {
            "description": "Optional. The weekly snapshot day."
          }
        },
        "hour": {
          "type": "int",
          "nullable": true,
          "metadata": {
            "description": "Optional. The weekly snapshot hour."
          }
        },
        "minute": {
          "type": "int",
          "nullable": true,
          "metadata": {
            "description": "Optional. The weekly snapshot minute."
          }
        },
        "snapshotsToKeep": {
          "type": "int",
          "nullable": true,
          "metadata": {
            "description": "Optional. Weekly snapshot count to keep."
          }
        },
        "usedBytes": {
          "type": "int",
          "nullable": true,
          "metadata": {
            "description": "Optional. Weekly snapshot used bytes."
          }
        }
      },
      "metadata": {
        "__bicep_export!": true
      }
    }
  },
  "parameters": {
    "netAppAccountName": {
      "type": "string",
      "metadata": {
        "description": "Conditional. The name of the parent NetApp account. Required if the template is used in a standalone deployment."
      }
    },
    "name": {
      "type": "string",
      "defaultValue": "snapshotPolicy",
      "metadata": {
        "description": "Optional. The name of the snapshot policy."
      }
    },
    "location": {
      "type": "string",
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Optional. The location of the snapshot policy."
      }
    },
    "dailySchedule": {
      "$ref": "#/definitions/dailyScheduleType",
      "defaultValue": {
        "hour": 0,
        "minute": 0,
        "snapshotsToKeep": 0,
        "usedBytes": 0
      },
      "metadata": {
        "description": "Optional. Schedule for daily snapshots."
      }
    },
    "hourlySchedule": {
      "$ref": "#/definitions/hourlyScheduleType",
      "defaultValue": {
        "minute": 0,
        "snapshotsToKeep": 0,
        "usedBytes": 0
      },
      "metadata": {
        "description": "Optional. Schedule for hourly snapshots."
      }
    },
    "monthlySchedule": {
      "$ref": "#/definitions/monthlyScheduleType",
      "defaultValue": {
        "daysOfMonth": "",
        "hour": 0,
        "minute": 0,
        "snapshotsToKeep": 0,
        "usedBytes": 0
      },
      "metadata": {
        "description": "Optional. Schedule for monthly snapshots."
      }
    },
    "weeklySchedule": {
      "$ref": "#/definitions/weeklyScheduleType",
      "defaultValue": {
        "day": "",
        "hour": 0,
        "minute": 0,
        "snapshotsToKeep": 0,
        "usedBytes": 0
      },
      "metadata": {
        "description": "Optional. Schedule for weekly snapshots."
      }
    },
    "snapEnabled": {
      "type": "bool",
      "defaultValue": false,
      "metadata": {
        "description": "Optional. Indicates whether the snapshot policy is enabled."
      }
    }
  },
  "resources": {
    "netAppAccount": {
      "existing": true,
      "type": "Microsoft.NetApp/netAppAccounts",
      "apiVersion": "2024-03-01",
      "name": "[parameters('netAppAccountName')]"
    },
    "snapshotPolicies": {
      "type": "Microsoft.NetApp/netAppAccounts/snapshotPolicies",
      "apiVersion": "2024-03-01",
      "name": "[format('{0}/{1}', parameters('netAppAccountName'), parameters('name'))]",
      "location": "[parameters('location')]",
      "properties": {
        "enabled": "[parameters('snapEnabled')]",
        "dailySchedule": "[parameters('dailySchedule')]",
        "hourlySchedule": "[parameters('hourlySchedule')]",
        "monthlySchedule": "[parameters('monthlySchedule')]",
        "weeklySchedule": "[parameters('weeklySchedule')]"
      },
      "dependsOn": [
        "netAppAccount"
      ]
    }
  },
  "outputs": {
    "resourceId": {
      "type": "string",
      "metadata": {
        "description": "The resource IDs of the snapshot Policy created within volume."
      },
      "value": "[resourceId('Microsoft.NetApp/netAppAccounts/snapshotPolicies', parameters('netAppAccountName'), parameters('name'))]"
    },
    "name": {
      "type": "string",
      "metadata": {
        "description": "The name of the Backup Policy."
      },
      "value": "[parameters('name')]"
    },
    "resourceGroupName": {
      "type": "string",
      "metadata": {
        "description": "The name of the Resource Group the Snapshot was created in."
      },
      "value": "[resourceGroup().name]"
    }
  }
}