{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "_generator": {
      "name": "bicep",
      "version": "0.37.4.10188",
      "templateHash": "5679672050000621262"
    },
    "name": "DevTest Lab Secrets",
    "description": "This module deploys a DevTest Lab Secret.\n\nLab secrets will be accessible to all lab users. Depending on their scope, secrets can be used to securely provide credentials when creating formulas, virtual machines, artifacts, or ARM templates."
  },
  "parameters": {
    "labName": {
      "type": "string",
      "metadata": {
        "description": "Conditional. The name of the parent lab. Required if the template is used in a standalone deployment."
      }
    },
    "name": {
      "type": "string",
      "metadata": {
        "description": "Required. The name of the secret. Secret names can only contain alphanumeric characters and dashes."
      }
    },
    "value": {
      "type": "securestring",
      "metadata": {
        "description": "Required. The value of the secret."
      }
    },
    "enabledForArtifacts": {
      "type": "bool",
      "defaultValue": false,
      "metadata": {
        "description": "Optional. Set a secret for your artifacts (e.g., a personal access token to clone your Git repository via an artifact). At least one of the following must be true: enabledForArtifacts, enabledForVmCreation."
      }
    },
    "enabledForVmCreation": {
      "type": "bool",
      "defaultValue": false,
      "metadata": {
        "description": "Optional. Set a user password or provide an SSH public key to access your Windows or Linux virtual machines. At least one of the following must be true: enabledForArtifacts, enabledForVmCreation."
      }
    }
  },
  "resources": [
    {
      "type": "Microsoft.DevTestLab/labs/secrets",
      "apiVersion": "2018-10-15-preview",
      "name": "[format('{0}/{1}', parameters('labName'), parameters('name'))]",
      "properties": {
        "enabledForArtifacts": "[parameters('enabledForArtifacts')]",
        "enabledForVmCreation": "[parameters('enabledForVmCreation')]",
        "value": "[parameters('value')]"
      }
    }
  ],
  "outputs": {
    "name": {
      "type": "string",
      "metadata": {
        "description": "The name of the secret."
      },
      "value": "[parameters('name')]"
    },
    "resourceId": {
      "type": "string",
      "metadata": {
        "description": "The resource ID of the secret."
      },
      "value": "[resourceId('Microsoft.DevTestLab/labs/secrets', parameters('labName'), parameters('name'))]"
    },
    "resourceGroupName": {
      "type": "string",
      "metadata": {
        "description": "The name of the resource group the secret was created in."
      },
      "value": "[resourceGroup().name]"
    }
  }
}