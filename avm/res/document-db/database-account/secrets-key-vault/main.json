{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "languageVersion": "2.0",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "_generator": {
      "name": "bicep",
      "version": "0.26.54.24096",
      "templateHash": "5320517424215194992"
    }
  },
  "definitions": {
    "keySecret": {
      "type": "object",
      "properties": {
        "secretName": {
          "type": "string"
        },
        "secretValue": {
          "type": "string"
        }
      }
    }
  },
  "parameters": {
    "keyVaultName": {
      "type": "string",
      "metadata": {
        "description": "The key vault name where to store the keys and connection strings generated by the modules."
      }
    },
    "keySecrets": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/keySecret"
      },
      "metadata": {
        "description": "The name of the secret that will store the primary write key."
      }
    }
  },
  "resources": {
    "kv": {
      "existing": true,
      "type": "Microsoft.KeyVault/vaults",
      "apiVersion": "2022-07-01",
      "name": "[parameters('keyVaultName')]"
    },
    "keySecretsSecrets": {
      "copy": {
        "name": "keySecretsSecrets",
        "count": "[length(parameters('keySecrets'))]"
      },
      "type": "Microsoft.KeyVault/vaults/secrets",
      "apiVersion": "2022-07-01",
      "name": "[format('{0}/{1}', parameters('keyVaultName'), parameters('keySecrets')[copyIndex()].secretName)]",
      "properties": {
        "value": "[parameters('keySecrets')[copyIndex()].secretValue]"
      },
      "dependsOn": [
        "kv"
      ]
    }
  }
}