# DAPR ACA Environment

Container Apps Environment for DAPR

## Description

Provides an optimised Container App Environment for DAPR applications.

The Azure resources that this module creates are;

- Azure Container Apps Environment
- DAPR components for Container Apps
- A ServiceBus (Pub-Sub DAPR component) or a Storage Account (State DAPR component)
- Log Analytics Workspace
- Application Insights

## Parameters

| Name                    | Type     | Required | Description                                                                |
| :---------------------- | :------: | :------: | :------------------------------------------------------------------------- |
| `location`              | `string` | Yes      | Specifies the location for all resources.                                  |
| `nameseed`              | `string` | Yes      | Used to name the Azure resources that are created                          |
| `applicationEntityName` | `string` | No       | The application relevant name for the dapr component you are implementing  |
| `daprComponentType`     | `string` | Yes      | The dapr application component type to configure in the Environment        |
| `daprComponentName`     | `string` | No       | The name of the dapr component, this will be autogenerated if not provided |
| `daprComponentScopes`   | `array`  | No       | Names of container apps that can use this dapr component                   |
| `tags`                  | `object` | No       | Any tags that are to be applied to the Environment Components              |

## Outputs

| Name                          | Type   | Description                                                     |
| :---------------------------- | :----: | :-------------------------------------------------------------- |
| containerAppEnvironmentName   | string | The name of the created Azure Container Apps Environment        |
| appInsightsInstrumentationKey | string | The Azure Applications Insights (telemetry) instrumentation key |

## Examples

### Creation of Environment for ServiceBus PubSub apps

```bicep
module myenv 'br/public:app/dapr-containerapps-environment:1.0.1' = {
  name: 'pubsub'
  params: {
    location: location
    nameseed: 'pubsub-sb1'
    applicationEntityName: 'orders'
    daprComponentType: 'pubsub.azure.servicebus'
  }
}
```

### Creation of Environment for Blob based state

```bicep
module myenv 'br/public:app/dapr-containerapps-environment:1.0.1' = {
  name: 'state'
  params: {
    location: location
    nameseed: 'stateSt1'
    applicationEntityName: 'appdata'
    daprComponentType: 'state.azure.blobstorage'
    daprComponentScopes: [
      'myapp'
    ]
  }
}
```

### Creation of Environment for CosmosDb based state

```bicep
module myenv 'br/public:app/dapr-containerapps-environment:1.0.1' = {
  name: 'state'
  params: {
    location: location
    nameseed: 'stateSt2'
    applicationEntityName: 'appdata'
    daprComponentType: 'state.azure.cosmosdb'
    daprComponentScopes: [
      'myapp'
    ]
  }
}
```