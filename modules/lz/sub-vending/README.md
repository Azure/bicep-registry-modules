# Bicep Landing Zone (Subscription) Vending Module

This module is designed to accelerate deployment of landing zones (aka Subscriptions) within an Azure AD Tenant.

## Description

{{ Add detailed description for the module. }}

## Parameters

| Name                                                 | Type     | Required | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| :--------------------------------------------------- | :------: | :------: | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `subscriptionAliasEnabled`                           | `bool`   | No       | Whether to create a new Subscription using the Subscription Alias resource. If `false`, supply an existing Subscription's ID in the parameter named `existingSubscriptionId` instead to deploy resources to an existing Subscription.<br /><br />- Type: Boolean                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| `subscriptionDisplayName`                            | `string` | No       | The name of the subscription alias. The string must be comprised of a-z, A-Z, 0-9, - and _. The maximum length is 63 characters.<br /><br />The string must be comprised of `a-z`, `A-Z`, `0-9`, `-`, `_` and ` ` (space). The maximum length is 63 characters.<br /><br />> The value for this parameter and the parameter named `subscriptionAliasName` are usually set to the same value for simplicity. But they can be different if required for a reason.<br /><br />> **Not required when providing an existing Subscription ID via the parameter `existingSubscriptionId`**<br /><br />- Type: String<br />- Default value: `''` *(empty string)*                                                                                                                                                                  |
| `subscriptionAliasName`                              | `string` | No       | The name of the Subscription Alias, that will be created by this module.<br /><br />The string must be comprised of `a-z`, `A-Z`, `0-9`, `-`, `_` and ` ` (space). The maximum length is 63 characters.<br /><br />> **Not required when providing an existing Subscription ID via the parameter `existingSubscriptionId`**<br /><br />- Type: String<br />- Default value: `''` *(empty string)*                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `subscriptionBillingScope`                           | `string` | No       | The Billing Scope for the new Subscription alias, that will be created by this module.<br /><br />A valid Billing Scope starts with `/providers/Microsoft.Billing/billingAccounts/` and is case sensitive.<br /><br />> See below [example in parameter file](#parameter-file) for an example<br /><br />> **Not required when providing an existing Subscription ID via the parameter `existingSubscriptionId`**<br /><br />- Type: String<br />- Default value: `''` *(empty string)*                                                                                                                                                                                                                                                                                                                                    |
| `subscriptionWorkload`                               | `string` | No       | The workload type can be either `Production` or `DevTest` and is case sensitive.<br /><br />> **Not required when providing an existing Subscription ID via the parameter `existingSubscriptionId`**<br /><br />- Type: String                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| `existingSubscriptionId`                             | `string` | No       | An existing subscription ID. Use this when you do not want the module to create a new subscription. But do want to manage the management group membership. A subscription ID should be provided in the example format `xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx`.<br /><br />- Type: String<br />- Default value: `''` *(empty string)*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| `subscriptionManagementGroupAssociationEnabled`      | `bool`   | No       | Whether to move the Subscription to the specified Management Group supplied in the parameter `subscriptionManagementGroupId`.<br /><br />- Type: Boolean                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `subscriptionManagementGroupId`                      | `string` | No       | The destination Management Group ID for the new Subscription that will be created by this module (or the existing one provided in the parameter `existingSubscriptionId`).<br /><br />**IMPORTANT:** Do not supply the display name of the Management Group. The Management Group ID forms part of the Azure Resource ID. e.g., `/providers/Microsoft.Management/managementGroups/{managementGroupId}`.<br /><br />> See below [example in parameter file](#parameter-file) for an example<br /><br />- Type: String<br />- Default value: `''` *(empty string)*                                                                                                                                                                                                                                                           |
| `subscriptionTags`                                   | `object` | No       | An object of Tag key & value pairs to be appended to a Subscription.<br /><br />> **NOTE:** Tags will only be overwritten if existing tag exists with same key as provided in this parameter; values provided here win.<br /><br />- Type: `{}` Object<br />- Default value: `{}` *(empty object)*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `virtualNetworkEnabled`                              | `bool`   | No       | Whether to create a Virtual Network or not.<br /><br />If set to `true` ensure you also provide values for the following parameters at a minimum:<br /><br />- `virtualNetworkResourceGroupName`<br />- `virtualNetworkResourceGroupLockEnabled`<br />- `virtualNetworkLocation`<br />- `virtualNetworkName`<br />- `virtualNetworkAddressSpace`<br /><br />> Other parameters may need to be set based on other parameters that you enable that are listed above. Check each parameters documentation for further information.<br /><br />- Type: Boolean                                                                                                                                                                                                                                                                 |
| `virtualNetworkResourceGroupName`                    | `string` | No       | The name of the Resource Group to create the Virtual Network in that is created by this module.<br /><br />- Type: String<br />- Default value: `''` *(empty string)*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| `virtualNetworkResourceGroupTags`                    | `object` | No       | An object of Tag key & value pairs to be appended to the Resource Group that the Virtual Network is created in.<br /><br />> **NOTE:** Tags will only be overwritten if existing tag exists with same key as provided in this parameter; values provided here win.<br /><br />- Type: `{}` Object<br />- Default value: `{}` *(empty object)*                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| `virtualNetworkResourceGroupLockEnabled`             | `bool`   | No       | Enables the deployment of a `CanNotDelete` resource locks to the Virtual Networks Resource Group that is created by this module.<br /><br />- Type: Boolean                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| `virtualNetworkLocation`                             | `string` | No       | The location of the virtual network. Use region shortnames e.g. `uksouth`, `eastus`, etc. Defaults to the region where the ARM/Bicep deployment is targeted to unless overridden.<br /><br />- Type: String                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| `virtualNetworkName`                                 | `string` | No       | The name of the virtual network. The string must consist of a-z, A-Z, 0-9, -, _, and . (period) and be between 2 and 64 characters in length.<br /><br />- Type: String<br />- Default value: `''` *(empty string)*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| `virtualNetworkTags`                                 | `object` | No       | An object of tag key/value pairs to be set on the Virtual Network that is created.<br /><br />> **NOTE:** Tags will be overwritten on resource if any exist already.<br /><br />- Type: `{}` Object<br />- Default value: `{}` *(empty object)*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| `virtualNetworkAddressSpace`                         | `array`  | No       | The address space of the Virtual Network that will be created by this module, supplied as multiple CIDR blocks in an array, e.g. `["10.0.0.0/16","172.16.0.0/12"]`<br /><br />- Type: `[]` Array<br />- Default value: `[]` *(empty array)*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| `virtualNetworkDnsServers`                           | `array`  | No       | The custom DNS servers to use on the Virtual Network, e.g. `["10.4.1.4", "10.2.1.5"]`. If left empty (default) then Azure DNS will be used for the Virtual Network.<br /><br />- Type: `[]` Array<br />- Default value: `[]` *(empty array)*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `virtualNetworkDdosPlanId`                           | `string` | No       | The resource ID of an existing DDoS Network Protection Plan that you wish to link to this Virtual Network.<br /><br />**Example Expected Values:**<br />- `''` (empty string)<br />- DDoS Netowrk Protection Plan Resource ID: `/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/xxxxxxxxxx/providers/Microsoft.Network/ddosProtectionPlans/xxxxxxxxxx`<br /><br />- Type: String<br />- Default value: `''` *(empty string)*                                                                                                                                                                                                                                                                                                                                                                            |
| `virtualNetworkPeeringEnabled`                       | `bool`   | No       | Whether to enable peering/connection with the supplied hub Virtual Network or Virtual WAN Virtual Hub.<br /><br />- Type: Boolean                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `hubNetworkResourceId`                               | `string` | No       | The resource ID of the Virtual Network or Virtual WAN Hub in the hub to which the created Virtual Network, by this module, will be peered/connected to via Virtual Network Peering or a Virtual WAN Virtual Hub Connection.<br /><br />**Example Expected Values:**<br />- `''` (empty string)<br />- Hub Virtual Network Resource ID: `/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/xxxxxxxxxx/providers/Microsoft.Network/virtualNetworks/xxxxxxxxxx`<br />- Virtual WAN Virtual Hub Resource ID: `/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/xxxxxxxxxx/providers/Microsoft.Network/virtualHubs/xxxxxxxxxx`<br /><br />- Type: String<br />- Default value: `''` *(empty string)*                                                                                         |
| `virtualNetworkUseRemoteGateways`                    | `bool`   | No       | Enables the use of remote gateways in the specified hub virtual network.<br /><br />> **IMPORTANT:** If no gateways exist in the hub virtual network, set this to `false`, otherwise peering will fail to create.<br /><br />- Type: Boolean                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `virtualNetworkVwanAssociatedRouteTableResourceId`   | `string` | No       | The resource ID of the virtual hub route table to associate to the virtual hub connection (this virtual network). If left blank/empty the `defaultRouteTable` will be associated.<br /><br />- Type: String<br />- Default value: `''` *(empty string)* = Which means if the parameter `virtualNetworkPeeringEnabled` is `true` and also the parameter `hubNetworkResourceId` is not empty then the `defaultRouteTable` will be associated of the provided Virtual Hub in the parameter `hubNetworkResourceId`.<br />    - e.g. `/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/xxxxxxxxxx/providers/Microsoft.Network/virtualHubs/xxxxxxxxx/hubRouteTables/defaultRouteTable`                                                                                                                         |
| `virtualNetworkVwanPropagatedRouteTablesResourceIds` | `array`  | No       | An array of of objects of virtual hub route table resource IDs to propagate routes to. If left blank/empty the `defaultRouteTable` will be propagated to only.<br /><br />Each object must contain the following `key`:<br />- `id` = The Resource ID of the Virtual WAN Virtual Hub Route Table IDs you wish to propagate too<br /><br />> See below [example in parameter file](#parameter-file)<br /><br />> **IMPORTANT:** If you provide any Route Tables in this array of objects you must ensure you include also the `defaultRouteTable` Resource ID as an object in the array as it is not added by default when a value is provided for this parameter.<br /><br />- Type: `[]` Array<br />- Default value: `[]` *(empty array)*                                                                                 |
| `virtualNetworkVwanPropagatedLabels`                 | `array`  | No       | An array of virtual hub route table labels to propagate routes to. If left blank/empty the default label will be propagated to only.<br /><br />- Type: `[]` Array<br />- Default value: `[]` *(empty array)*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| `roleAssignmentEnabled`                              | `bool`   | No       | Whether to create role assignments or not. If true, supply the array of role assignment objects in the parameter called `roleAssignments`.<br /><br />- Type: Boolean                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| `roleAssignments`                                    | `array`  | No       | Supply an array of objects containing the details of the role assignments to create.<br /><br />Each object must contain the following `keys`:<br />- `principalId` = The Object ID of the User, Group, SPN, Managed Identity to assign the RBAC role too.<br />- `definition` = The Name of built-In RBAC Roles or a Resource ID of a Built-in or custom RBAC Role Definition.<br />- `relativeScope` = 2 options can be provided for input value:<br />    1. `''` *(empty string)* = Make RBAC Role Assignment to Subscription scope<br />    2. `'/resourceGroups/<RESOURCE GROUP NAME>'` = Make RBAC Role Assignment to specified Resource Group<br /><br />> See below [example in parameter file](#parameter-file) of various combinations<br /><br />- Type: `[]` Array<br />- Default value: `[]` *(empty array)* |
| `disableTelemetry`                                   | `bool`   | No       | Disable telemetry collection by this module.<br /><br />For more information on the telemetry collected by this module, that is controlled by this parameter, see this page in the wiki: [Telemetry Tracking Using Customer Usage Attribution (PID)](https://github.com/Azure/bicep-lz-vending/wiki/Telemetry)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |

## Outputs

| Name                   | Type   | Description                                                     |
| :--------------------- | :----: | :-------------------------------------------------------------- |
| subscriptionId         | string | The Subscription ID that has been created or provided.          |
| subscriptionResourceId | string | The Subscription Resource ID that has been created or provided. |

## Examples

### Example 1

```bicep
```

### Example 2

```bicep
```